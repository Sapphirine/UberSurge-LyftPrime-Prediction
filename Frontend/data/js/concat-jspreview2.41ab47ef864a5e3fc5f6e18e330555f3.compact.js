(function e(i,k,m){function n(f,b){if(!k[f]){if(!i[f]){var c=typeof require=="function"&&require;if(!b&&c){return c(f,!0)}if(j){return j(f,!0)}var a=new Error("Cannot find module '"+f+"'");throw a.code="MODULE_NOT_FOUND",a}var d=k[f]={exports:{}};i[f][0].call(d.exports,function(h){var p=i[f][1][h];return n(p?p:h)},d,d.exports,e,i,k,m)}return k[f].exports}var j=typeof require=="function"&&require;for(var l=0;l<m.length;l++){n(m[l])}return n})({1:[function(C,F,z){z.byteLength=i;z.toByteArray=B;z.fromByteArray=H;var D=[];var u=[];var t=typeof Uint8Array!=="undefined"?Uint8Array:Array;var G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var v=0,s=G.length;v<s;++v){D[v]=G[v];u[G.charCodeAt(v)]=v}u["-".charCodeAt(0)]=62;u["_".charCodeAt(0)]=63;function E(b){var a=b.length;if(a%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b[a-2]==="="?2:b[a-1]==="="?1:0}function i(a){return a.length*3/4-E(a)}function B(l){var f,h,k,d,j,c;var b=l.length;j=E(l);c=new t(b*3/4-j);k=j>0?b-4:b;var a=0;for(f=0,h=0;f<k;f+=4,h+=3){d=(u[l.charCodeAt(f)]<<18)|(u[l.charCodeAt(f+1)]<<12)|(u[l.charCodeAt(f+2)]<<6)|u[l.charCodeAt(f+3)];c[a++]=(d>>16)&255;c[a++]=(d>>8)&255;c[a++]=d&255}if(j===2){d=(u[l.charCodeAt(f)]<<2)|(u[l.charCodeAt(f+1)]>>4);c[a++]=d&255}else{if(j===1){d=(u[l.charCodeAt(f)]<<10)|(u[l.charCodeAt(f+1)]<<4)|(u[l.charCodeAt(f+2)]>>2);c[a++]=(d>>8)&255;c[a++]=d&255}}return c}function w(a){return D[a>>18&63]+D[a>>12&63]+D[a>>6&63]+D[a&63]}function A(d,h,f){var a;var c=[];for(var b=h;b<f;b+=3){a=(d[b]<<16)+(d[b+1]<<8)+(d[b+2]);c.push(w(a))}return c.join("")}function H(c){var f;var b=c.length;var a=b%3;var k="";var h=[];var l=16383;for(var d=0,j=b-a;d<j;d+=l){h.push(A(c,d,(d+l)>j?j:(d+l)))}if(a===1){f=c[b-1];k+=D[f>>2];k+=D[(f<<4)&63];k+="=="}else{if(a===2){f=(c[b-2]<<8)+(c[b-1]);k+=D[f>>10];k+=D[(f>>4)&63];k+=D[(f<<2)&63];k+="="}}h.push(k);return h.join("")}},{}],2:[function(d,h,f){(function(a0){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
;"use strict";var cu=d("base64-js");var bp=d("ieee754");var bq=d("isarray");f.Buffer=cw;f.SlowBuffer=cj;f.INSPECT_MAX_BYTES=50;cw.TYPED_ARRAY_SUPPORT=a0.TYPED_ARRAY_SUPPORT!==undefined?a0.TYPED_ARRAY_SUPPORT:cq();f.kMaxLength=cI();function cq(){try{var j=new Uint8Array(1);j.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return j.foo()===42&&typeof j.subarray==="function"&&j.subarray(1,1).byteLength===0}catch(i){return false}}function cI(){return cw.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function bw(i,j){if(cI()<j){throw new RangeError("Invalid typed array length")}if(cw.TYPED_ARRAY_SUPPORT){i=new Uint8Array(j);i.__proto__=cw.prototype}else{if(i===null){i=new cw(j)}i.length=j}return i}function cw(k,j,i){if(!cw.TYPED_ARRAY_SUPPORT&&!(this instanceof cw)){return new cw(k,j,i)}if(typeof k==="number"){if(typeof j==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return b8(this,k)}return cb(this,k,j,i)}cw.poolSize=8192;cw._augment=function(i){i.__proto__=cw.prototype;return i};function cb(j,i,l,k){if(typeof i==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&i instanceof ArrayBuffer){return bU(j,i,l,k)}if(typeof i==="string"){return bo(j,i,l)}return b6(j,i)}cw.from=function(i,k,j){return cb(null,i,k,j)};if(cw.TYPED_ARRAY_SUPPORT){cw.prototype.__proto__=Uint8Array.prototype;cw.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&cw[Symbol.species]===cw){Object.defineProperty(cw,Symbol.species,{value:null,configurable:true})}}function bz(i){if(typeof i!=="number"){throw new TypeError('"size" argument must be a number')}else{if(i<0){throw new RangeError('"size" argument must not be negative')}}}function b2(j,l,i,k){bz(l);if(l<=0){return bw(j,l)}if(i!==undefined){return typeof k==="string"?bw(j,l).fill(i,k):bw(j,l).fill(i)}return bw(j,l)}cw.alloc=function(k,i,j){return b2(null,k,i,j)};function b8(i,j){bz(j);i=bw(i,j<0?0:cl(j)|0);if(!cw.TYPED_ARRAY_SUPPORT){for(var k=0;k<j;++k){i[k]=0}}return i}cw.allocUnsafe=function(i){return b8(null,i)};cw.allocUnsafeSlow=function(i){return b8(null,i)};function bo(j,m,k){if(typeof k!=="string"||k===""){k="utf8"}if(!cw.isEncoding(k)){throw new TypeError('"encoding" must be a valid string encoding')}var l=cD(m,k)|0;j=bw(j,l);var i=j.write(m,k);if(i!==l){j=j.slice(0,i)}return j}function bA(j,i){var k=i.length<0?0:cl(i.length)|0;j=bw(j,k);for(var l=0;l<k;l+=1){j[l]=i[l]&255}return j}function bU(j,i,l,k){i.byteLength;if(l<0||i.byteLength<l){throw new RangeError("'offset' is out of bounds")}if(i.byteLength<l+(k||0)){throw new RangeError("'length' is out of bounds")}if(l===undefined&&k===undefined){i=new Uint8Array(i)}else{if(k===undefined){i=new Uint8Array(i,l)}else{i=new Uint8Array(i,l,k)}}if(cw.TYPED_ARRAY_SUPPORT){j=i;j.__proto__=cw.prototype}else{j=bA(j,i)}return j}function b6(j,i){if(cw.isBuffer(i)){var k=cl(i.length)|0;j=bw(j,k);if(j.length===0){return j}i.copy(j,0,0,k);return j}if(i){if((typeof ArrayBuffer!=="undefined"&&i.buffer instanceof ArrayBuffer)||"length" in i){if(typeof i.length!=="number"||bs(i.length)){return bw(j,0)}return bA(j,i)}if(i.type==="Buffer"&&bq(i.data)){return bA(j,i.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function cl(i){if(i>=cI()){throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+cI().toString(16)+" bytes")}return i|0}function cj(i){if(+i!=i){i=0}return cw.alloc(+i)}cw.isBuffer=function b1(i){return !!(i!=null&&i._isBuffer)};cw.compare=function cK(k,l){if(!cw.isBuffer(k)||!cw.isBuffer(l)){throw new TypeError("Arguments must be Buffers")}if(k===l){return 0}var m=k.length;var i=l.length;for(var j=0,n=Math.min(m,i);j<n;++j){if(k[j]!==l[j]){m=k[j];i=l[j];break}}if(m<i){return -1}if(i<m){return 1}return 0};cw.isEncoding=function cg(i){switch(String(i).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};cw.concat=function cN(j,k){if(!bq(j)){throw new TypeError('"list" argument must be an Array of Buffers')}if(j.length===0){return cw.alloc(0)}var l;if(k===undefined){k=0;for(l=0;l<j.length;++l){k+=j[l].length}}var n=cw.allocUnsafe(k);var i=0;for(l=0;l<j.length;++l){var m=j[l];if(!cw.isBuffer(m)){throw new TypeError('"list" argument must be an Array of Buffers')}m.copy(n,i);i+=m.length}return n};function cD(k,j){if(cw.isBuffer(k)){return k.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(k)||k instanceof ArrayBuffer)){return k.byteLength}if(typeof k!=="string"){k=""+k}var l=k.length;if(l===0){return 0}var i=false;for(;;){switch(j){case"ascii":case"latin1":case"binary":return l;case"utf8":case"utf-8":case undefined:return cR(k).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return l*2;case"hex":return l>>>1;case"base64":return b5(k).length;default:if(i){return cR(k).length}j=(""+j).toLowerCase();i=true}}}cw.byteLength=cD;function bx(k,i,l){var j=false;if(i===undefined||i<0){i=0}if(i>this.length){return""}if(l===undefined||l>this.length){l=this.length}if(l<=0){return""}l>>>=0;i>>>=0;if(l<=i){return""}if(!k){k="utf8"}while(true){switch(k){case"hex":return b9(this,i,l);case"utf8":case"utf-8":return ck(this,i,l);case"ascii":return bF(this,i,l);case"latin1":case"binary":return bW(this,i,l);case"base64":return cs(this,i,l);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bY(this,i,l);default:if(j){throw new TypeError("Unknown encoding: "+k)}k=(k+"").toLowerCase();j=true}}}cw.prototype._isBuffer=true;function cL(k,i,l){var j=k[i];k[i]=k[l];k[l]=j}cw.prototype.swap16=function bI(){var j=this.length;if(j%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<j;i+=2){cL(this,i,i+1)}return this};cw.prototype.swap32=function bC(){var j=this.length;if(j%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<j;i+=4){cL(this,i,i+3);cL(this,i+1,i+2)}return this};cw.prototype.swap64=function cc(){var j=this.length;if(j%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<j;i+=8){cL(this,i,i+7);cL(this,i+1,i+6);cL(this,i+2,i+5);cL(this,i+3,i+4)}return this};cw.prototype.toString=function cG(){var i=this.length|0;if(i===0){return""}if(arguments.length===0){return ck(this,0,i)}return bx.apply(this,arguments)};cw.prototype.equals=function bG(i){if(!cw.isBuffer(i)){throw new TypeError("Argument must be a Buffer")}if(this===i){return true}return cw.compare(this,i)===0};cw.prototype.inspect=function cQ(){var i="";var j=f.INSPECT_MAX_BYTES;if(this.length>0){i=this.toString("hex",0,j).match(/.{2}/g).join(" ");if(this.length>j){i+=" ... "}}return"<Buffer "+i+">"};cw.prototype.compare=function cK(l,s,p,k,r){if(!cw.isBuffer(l)){throw new TypeError("Argument must be a Buffer")}if(s===undefined){s=0}if(p===undefined){p=l?l.length:0}if(k===undefined){k=0}if(r===undefined){r=this.length}if(s<0||p>l.length||k<0||r>this.length){throw new RangeError("out of range index")}if(k>=r&&s>=p){return 0}if(k>=r){return -1}if(s>=p){return 1}s>>>=0;p>>>=0;k>>>=0;r>>>=0;if(this===l){return 0}var i=r-k;var j=p-s;var m=Math.min(i,j);var q=this.slice(k,r);var n=l.slice(s,p);for(var o=0;o<m;++o){if(q[o]!==n[o]){i=q[o];j=n[o];break}}if(i<j){return -1}if(j<i){return 1}return 0};function cH(m,i,k,j,l){if(m.length===0){return -1}if(typeof k==="string"){j=k;k=0}else{if(k>2147483647){k=2147483647}else{if(k<-2147483648){k=-2147483648}}}k=+k;if(isNaN(k)){k=l?0:(m.length-1)}if(k<0){k=m.length+k}if(k>=m.length){if(l){return -1}else{k=m.length-1}}else{if(k<0){if(l){k=0}else{return -1}}}if(typeof i==="string"){i=cw.from(i,j)}if(cw.isBuffer(i)){if(i.length===0){return -1}return be(m,i,k,j,l)}else{if(typeof i==="number"){i=i&255;if(cw.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(l){return Uint8Array.prototype.indexOf.call(m,i,k)}else{return Uint8Array.prototype.lastIndexOf.call(m,i,k)}}return be(m,[i],k,j,l)}}throw new TypeError("val must be string, number or Buffer")}function be(n,s,r,t,q){var k=1;var j=n.length;var m=s.length;if(t!==undefined){t=String(t).toLowerCase();if(t==="ucs2"||t==="ucs-2"||t==="utf16le"||t==="utf-16le"){if(n.length<2||s.length<2){return -1}k=2;j/=2;m/=2;r/=2}}function u(w,v){if(k===1){return w[v]}else{return w.readUInt16BE(v*k)}}var o;if(q){var l=-1;for(o=r;o<j;o++){if(u(n,o)===u(s,l===-1?0:o-l)){if(l===-1){l=o}if(o-l+1===m){return l*k}}else{if(l!==-1){o-=o-l}l=-1}}}else{if(r+m>j){r=j-m}for(o=r;o>=0;o--){var i=true;for(var p=0;p<m;p++){if(u(n,o+p)!==u(s,p)){i=false;break}}if(i){return o}}}return -1}cw.prototype.includes=function bD(i,k,j){return this.indexOf(i,k,j)!==-1};cw.prototype.indexOf=function bl(i,k,j){return cH(this,i,k,j,true)};cw.prototype.lastIndexOf=function co(i,k,j){return cH(this,i,k,j,false)};function bf(n,o,i,j){i=Number(i)||0;var l=n.length-i;if(!j){j=l}else{j=Number(j);if(j>l){j=l}}var k=o.length;if(k%2!==0){throw new TypeError("Invalid hex string")}if(j>k/2){j=k/2}for(var m=0;m<j;++m){var p=parseInt(o.substr(m*2,2),16);if(isNaN(p)){return m}n[i+m]=p}return m}function ce(k,l,i,j){return cf(cR(l,k.length-i),k,i,j)}function cJ(k,l,i,j){return cf(b4(l),k,i,j)}function bO(k,l,i,j){return cJ(k,l,i,j)}function ci(k,l,i,j){return cf(b5(l),k,i,j)}function b(k,l,i,j){return cf(cE(l,k.length-i),k,i,j)}cw.prototype.write=function cO(n,j,k,l){if(j===undefined){l="utf8";k=this.length;j=0}else{if(k===undefined&&typeof j==="string"){l=j;k=this.length;j=0}else{if(isFinite(j)){j=j|0;if(isFinite(k)){k=k|0;if(l===undefined){l="utf8"}}else{l=k;k=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}}}var m=this.length-j;if(k===undefined||k>m){k=m}if((n.length>0&&(k<0||j<0))||j>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!l){l="utf8"}var i=false;for(;;){switch(l){case"hex":return bf(this,n,j,k);case"utf8":case"utf-8":return ce(this,n,j,k);case"ascii":return cJ(this,n,j,k);case"latin1":case"binary":return bO(this,n,j,k);case"base64":return ci(this,n,j,k);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,n,j,k);default:if(i){throw new TypeError("Unknown encoding: "+l)}l=(""+l).toLowerCase();i=true}}};cw.prototype.toJSON=function bQ(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function cs(j,i,k){if(i===0&&k===j.length){return cu.fromByteArray(j)}else{return cu.fromByteArray(j.slice(i,k))}}function ck(r,s,p){p=Math.min(r.length,p);var m=[];var o=s;while(o<p){var k=r[o];var l=null;var i=(k>239)?4:(k>223)?3:(k>191)?2:1;if(o+i<=p){var j,t,n,q;switch(i){case 1:if(k<128){l=k}break;case 2:j=r[o+1];if((j&192)===128){q=(k&31)<<6|(j&63);if(q>127){l=q}}break;case 3:j=r[o+1];t=r[o+2];if((j&192)===128&&(t&192)===128){q=(k&15)<<12|(j&63)<<6|(t&63);if(q>2047&&(q<55296||q>57343)){l=q}}break;case 4:j=r[o+1];t=r[o+2];n=r[o+3];if((j&192)===128&&(t&192)===128&&(n&192)===128){q=(k&15)<<18|(j&63)<<12|(t&63)<<6|(n&63);if(q>65535&&q<1114112){l=q}}}}if(l===null){l=65533;i=1}else{if(l>65535){l-=65536;m.push(l>>>10&1023|55296);l=56320|l&1023}}m.push(l);o+=i}return b7(m)}var ch=4096;function b7(k){var l=k.length;if(l<=ch){return String.fromCharCode.apply(String,k)}var i="";var j=0;while(j<l){i+=String.fromCharCode.apply(String,k.slice(j,j+=ch))}return i}function bF(k,i,m){var l="";m=Math.min(k.length,m);for(var j=i;j<m;++j){l+=String.fromCharCode(k[j]&127)}return l}function bW(k,i,m){var l="";m=Math.min(k.length,m);for(var j=i;j<m;++j){l+=String.fromCharCode(k[j])}return l}function b9(k,i,m){var n=k.length;if(!i||i<0){i=0}if(!m||m<0||m>n){m=n}var l="";for(var j=i;j<m;++j){l+=cA(k[j])}return l}function bY(l,i,m){var n=l.slice(i,m);var j="";for(var k=0;k<n.length;k+=2){j+=String.fromCharCode(n[k]+n[k+1]*256)}return j}cw.prototype.slice=function bV(i,m){var n=this.length;i=~~i;m=m===undefined?n:~~m;if(i<0){i+=n;if(i<0){i=0}}else{if(i>n){i=n}}if(m<0){m+=n;if(m<0){m=0}}else{if(m>n){m=n}}if(m<i){m=i}var j;if(cw.TYPED_ARRAY_SUPPORT){j=this.subarray(i,m);j.__proto__=cw.prototype}else{var k=m-i;j=new cw(k,undefined);for(var l=0;l<k;++l){j[l]=this[l+i]}}return j};function cF(i,k,j){if((i%1)!==0||i<0){throw new RangeError("offset is not uint")}if(i+k>j){throw new RangeError("Trying to access beyond buffer length")}}cw.prototype.readUIntLE=function bm(i,n,k){i=i|0;n=n|0;if(!k){cF(i,n,this.length)}var j=this[i];var l=1;var m=0;while(++m<n&&(l*=256)){j+=this[i+m]*l}return j};cw.prototype.readUIntBE=function cz(i,m,k){i=i|0;m=m|0;if(!k){cF(i,m,this.length)}var j=this[i+ --m];var l=1;while(m>0&&(l*=256)){j+=this[i+ --m]*l}return j};cw.prototype.readUInt8=function bj(i,j){if(!j){cF(i,1,this.length)}return this[i]};cw.prototype.readUInt16LE=function bg(i,j){if(!j){cF(i,2,this.length)}return this[i]|(this[i+1]<<8)};cw.prototype.readUInt16BE=function cp(i,j){if(!j){cF(i,2,this.length)}return(this[i]<<8)|this[i+1]};cw.prototype.readUInt32LE=function by(i,j){if(!j){cF(i,4,this.length)}return((this[i])|(this[i+1]<<8)|(this[i+2]<<16))+(this[i+3]*16777216)};cw.prototype.readUInt32BE=function bE(i,j){if(!j){cF(i,4,this.length)}return(this[i]*16777216)+((this[i+1]<<16)|(this[i+2]<<8)|this[i+3])};cw.prototype.readIntLE=function bS(i,n,k){i=i|0;n=n|0;if(!k){cF(i,n,this.length)}var j=this[i];var l=1;var m=0;while(++m<n&&(l*=256)){j+=this[i+m]*l}l*=128;if(j>=l){j-=Math.pow(2,8*n)}return j};cw.prototype.readIntBE=function bT(i,n,k){i=i|0;n=n|0;if(!k){cF(i,n,this.length)}var m=n;var l=1;var j=this[i+ --m];while(m>0&&(l*=256)){j+=this[i+ --m]*l}l*=128;if(j>=l){j-=Math.pow(2,8*n)}return j};cw.prototype.readInt8=function cm(i,j){if(!j){cF(i,1,this.length)}if(!(this[i]&128)){return(this[i])}return((255-this[i]+1)*-1)};cw.prototype.readInt16LE=function cC(i,k){if(!k){cF(i,2,this.length)}var j=this[i]|(this[i+1]<<8);return(j&32768)?j|4294901760:j};cw.prototype.readInt16BE=function bB(i,k){if(!k){cF(i,2,this.length)}var j=this[i+1]|(this[i]<<8);return(j&32768)?j|4294901760:j};cw.prototype.readInt32LE=function cP(i,j){if(!j){cF(i,4,this.length)}return(this[i])|(this[i+1]<<8)|(this[i+2]<<16)|(this[i+3]<<24)};cw.prototype.readInt32BE=function ca(i,j){if(!j){cF(i,4,this.length)}return(this[i]<<24)|(this[i+1]<<16)|(this[i+2]<<8)|(this[i+3])};cw.prototype.readFloatLE=function bk(i,j){if(!j){cF(i,4,this.length)}return bp.read(this,i,true,23,4)};cw.prototype.readFloatBE=function cv(i,j){if(!j){cF(i,4,this.length)}return bp.read(this,i,false,23,4)};cw.prototype.readDoubleLE=function br(i,j){if(!j){cF(i,8,this.length)}return bp.read(this,i,true,52,8)};cw.prototype.readDoubleBE=function bP(i,j){if(!j){cF(i,8,this.length)}return bp.read(this,i,false,52,8)};function cn(m,j,i,k,n,l){if(!cw.isBuffer(m)){throw new TypeError('"buffer" argument must be a Buffer instance')}if(j>n||j<l){throw new RangeError('"value" argument is out of bounds')}if(i+k>m.length){throw new RangeError("Index out of range")}}cw.prototype.writeUIntLE=function bM(l,i,n,j){l=+l;i=i|0;n=n|0;if(!j){var o=Math.pow(2,8*n)-1;cn(this,l,i,n,o,0)}var k=1;var m=0;this[i]=l&255;while(++m<n&&(k*=256)){this[i+m]=(l/k)&255}return i+n};cw.prototype.writeUIntBE=function bJ(l,i,n,j){l=+l;i=i|0;n=n|0;if(!j){var o=Math.pow(2,8*n)-1;cn(this,l,i,n,o,0)}var m=n-1;var k=1;this[i+m]=l&255;while(--m>=0&&(k*=256)){this[i+m]=(l/k)&255}return i+n};cw.prototype.writeUInt8=function cy(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,1,255,0)}if(!cw.TYPED_ARRAY_SUPPORT){k=Math.floor(k)}this[i]=(k&255);return i+1};function cB(m,k,i,j){if(k<0){k=65535+k+1}for(var l=0,n=Math.min(m.length-i,2);l<n;++l){m[i+l]=(k&(255<<(8*(j?l:1-l))))>>>(j?l:1-l)*8}}cw.prototype.writeUInt16LE=function cd(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,2,65535,0)}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k&255);this[i+1]=(k>>>8)}else{cB(this,k,i,true)}return i+2};cw.prototype.writeUInt16BE=function bn(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,2,65535,0)}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k>>>8);this[i+1]=(k&255)}else{cB(this,k,i,false)}return i+2};function bt(m,k,i,j){if(k<0){k=4294967295+k+1}for(var l=0,n=Math.min(m.length-i,4);l<n;++l){m[i+l]=(k>>>(j?l:3-l)*8)&255}}cw.prototype.writeUInt32LE=function bN(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,4,4294967295,0)}if(cw.TYPED_ARRAY_SUPPORT){this[i+3]=(k>>>24);this[i+2]=(k>>>16);this[i+1]=(k>>>8);this[i]=(k&255)}else{bt(this,k,i,true)}return i+4};cw.prototype.writeUInt32BE=function bL(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,4,4294967295,0)}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k>>>24);this[i+1]=(k>>>16);this[i+2]=(k>>>8);this[i+3]=(k&255)}else{bt(this,k,i,false)}return i+4};cw.prototype.writeIntLE=function c(l,i,o,j){l=+l;i=i|0;if(!j){var p=Math.pow(2,8*o-1);cn(this,l,i,o,p-1,-p)}var n=0;var k=1;var m=0;this[i]=l&255;while(++n<o&&(k*=256)){if(l<0&&m===0&&this[i+n-1]!==0){m=1}this[i+n]=((l/k)>>0)-m&255}return i+o};cw.prototype.writeIntBE=function a(l,i,o,j){l=+l;i=i|0;if(!j){var p=Math.pow(2,8*o-1);cn(this,l,i,o,p-1,-p)}var n=o-1;var k=1;var m=0;this[i+n]=l&255;while(--n>=0&&(k*=256)){if(l<0&&m===0&&this[i+n+1]!==0){m=1}this[i+n]=((l/k)>>0)-m&255}return i+o};cw.prototype.writeInt8=function b3(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,1,127,-128)}if(!cw.TYPED_ARRAY_SUPPORT){k=Math.floor(k)}if(k<0){k=255+k+1}this[i]=(k&255);return i+1};cw.prototype.writeInt16LE=function b0(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,2,32767,-32768)}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k&255);this[i+1]=(k>>>8)}else{cB(this,k,i,true)}return i+2};cw.prototype.writeInt16BE=function bX(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,2,32767,-32768)}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k>>>8);this[i+1]=(k&255)}else{cB(this,k,i,false)}return i+2};cw.prototype.writeInt32LE=function ct(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,4,2147483647,-2147483648)}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k&255);this[i+1]=(k>>>8);this[i+2]=(k>>>16);this[i+3]=(k>>>24)}else{bt(this,k,i,true)}return i+4};cw.prototype.writeInt32BE=function bu(k,i,j){k=+k;i=i|0;if(!j){cn(this,k,i,4,2147483647,-2147483648)}if(k<0){k=4294967295+k+1}if(cw.TYPED_ARRAY_SUPPORT){this[i]=(k>>>24);this[i+1]=(k>>>16);this[i+2]=(k>>>8);this[i+3]=(k&255)}else{bt(this,k,i,false)}return i+4};function bv(m,j,i,k,n,l){if(i+k>m.length){throw new RangeError("Index out of range")}if(i<0){throw new RangeError("Index out of range")}}function bZ(m,l,i,j,k){if(!k){bv(m,l,i,4,3.4028234663852886e+38,-3.4028234663852886e+38)}bp.write(m,l,i,j,23,4);return i+4}cw.prototype.writeFloatLE=function bi(k,i,j){return bZ(this,k,i,true,j)};cw.prototype.writeFloatBE=function cr(k,i,j){return bZ(this,k,i,false,j)};function bc(m,l,i,j,k){if(!k){bv(m,l,i,8,1.7976931348623157e+308,-1.7976931348623157e+308)}bp.write(m,l,i,j,52,8);return i+8}cw.prototype.writeDoubleLE=function bH(k,i,j){return bc(this,k,i,true,j)};cw.prototype.writeDoubleBE=function cM(k,i,j){return bc(this,k,i,false,j)};cw.prototype.copy=function bK(k,j,i,m){if(!i){i=0}if(!m&&m!==0){m=this.length}if(j>=k.length){j=k.length}if(!j){j=0}if(m>0&&m<i){m=i}if(m===i){return 0}if(k.length===0||this.length===0){return 0}if(j<0){throw new RangeError("targetStart out of bounds")}if(i<0||i>=this.length){throw new RangeError("sourceStart out of bounds")}if(m<0){throw new RangeError("sourceEnd out of bounds")}if(m>this.length){m=this.length}if(k.length-j<m-i){m=k.length-j+i}var n=m-i;var l;if(this===k&&i<j&&j<m){for(l=n-1;l>=0;--l){k[l+j]=this[l+i]}}else{if(n<1000||!cw.TYPED_ARRAY_SUPPORT){for(l=0;l<n;++l){k[l+j]=this[l+i]}}else{Uint8Array.prototype.set.call(k,this.subarray(i,i+n),j)}}return n};cw.prototype.fill=function bR(j,i,n,k){if(typeof j==="string"){if(typeof i==="string"){k=i;i=0;n=this.length}else{if(typeof n==="string"){k=n;n=this.length}}if(j.length===1){var l=j.charCodeAt(0);if(l<256){j=l}}if(k!==undefined&&typeof k!=="string"){throw new TypeError("encoding must be a string")}if(typeof k==="string"&&!cw.isEncoding(k)){throw new TypeError("Unknown encoding: "+k)}}else{if(typeof j==="number"){j=j&255}}if(i<0||this.length<i||this.length<n){throw new RangeError("Out of range index")}if(n<=i){return this}i=i>>>0;n=n===undefined?this.length:n>>>0;if(!j){j=0}var m;if(typeof j==="number"){for(m=i;m<n;++m){this[m]=j}}else{var o=cw.isBuffer(j)?j:cR(new cw(j,k).toString());var p=o.length;for(m=0;m<n-i;++m){this[m+i]=o[m%p]}}return this};var cx=/[^+\/0-9A-Za-z-_]/g;function bh(i){i=bd(i).replace(cx,"");if(i.length<2){return""}while(i.length%4!==0){i=i+"="}return i}function bd(i){if(i.trim){return i.trim()}return i.replace(/^\s+|\s+$/g,"")}function cA(i){if(i<16){return"0"+i.toString(16)}return i.toString(16)}function cR(l,n){n=n||Infinity;var m;var i=l.length;var j=null;var o=[];for(var k=0;k<i;++k){m=l.charCodeAt(k);if(m>55295&&m<57344){if(!j){if(m>56319){if((n-=3)>-1){o.push(239,191,189)}continue}else{if(k+1===i){if((n-=3)>-1){o.push(239,191,189)}continue}}j=m;continue}if(m<56320){if((n-=3)>-1){o.push(239,191,189)}j=m;continue}m=(j-55296<<10|m-56320)+65536}else{if(j){if((n-=3)>-1){o.push(239,191,189)}}}j=null;if(m<128){if((n-=1)<0){break}o.push(m)}else{if(m<2048){if((n-=2)<0){break}o.push(m>>6|192,m&63|128)}else{if(m<65536){if((n-=3)<0){break}o.push(m>>12|224,m>>6&63|128,m&63|128)}else{if(m<1114112){if((n-=4)<0){break}o.push(m>>18|240,m>>12&63|128,m>>6&63|128,m&63|128)}else{throw new Error("Invalid code point")}}}}}return o}function b4(i){var k=[];for(var j=0;j<i.length;++j){k.push(i.charCodeAt(j)&255)}return k}function cE(j,n){var i,m,k;var o=[];for(var l=0;l<j.length;++l){if((n-=2)<0){break}i=j.charCodeAt(l);m=i>>8;k=i%256;o.push(k);o.push(m)}return o}function b5(i){return cu.toByteArray(bh(i))}function cf(j,i,k,l){for(var m=0;m<l;++m){if((m+k>=i.length)||(m>=j.length)){break}i[m+k]=j[m]}return m}function bs(i){return i!==i}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"base64-js":1,ieee754:3,isarray:4}],3:[function(d,h,f){f.read=function(i,m,A,B,a){var G,s;var z=a*8-B-1;var b=(1<<z)-1;var C=b>>1;var E=-7;var c=A?(a-1):0;var F=A?-1:1;var D=i[m+c];c+=F;G=D&((1<<(-E))-1);D>>=(-E);E+=z;for(;E>0;G=G*256+i[m+c],c+=F,E-=8){}s=G&((1<<(-E))-1);G>>=(-E);E+=B;for(;E>0;s=s*256+i[m+c],c+=F,E-=8){}if(G===0){G=1-C}else{if(G===b){return s?NaN:((D?-1:1)*Infinity)}else{s=s+Math.pow(2,B);G=G-C}}return(D?-1:1)*s*Math.pow(2,G-B)};f.write=function(c,G,m,D,E,K){var J,B,H;var C=K*8-E-1;var a=(1<<C)-1;var F=a>>1;var s=(E===23?Math.pow(2,-24)-Math.pow(2,-77):0);var b=D?0:(K-1);var I=D?1:-1;var i=G<0||(G===0&&1/G<0)?1:0;G=Math.abs(G);if(isNaN(G)||G===Infinity){B=isNaN(G)?1:0;J=a}else{J=Math.floor(Math.log(G)/Math.LN2);if(G*(H=Math.pow(2,-J))<1){J--;H*=2}if(J+F>=1){G+=s/H}else{G+=s*Math.pow(2,1-F)}if(G*H>=2){J++;H/=2}if(J+F>=a){B=0;J=a}else{if(J+F>=1){B=(G*H-1)*Math.pow(2,E);J=J+F}else{B=G*Math.pow(2,F-1)*Math.pow(2,E);J=0}}}for(;E>=8;c[m+b]=B&255,b+=I,B/=256,E-=8){}J=(J<<E)|B;C+=E;for(;C>0;c[m+b]=J&255,b+=I,J/=256,C-=8){}c[m+b-I]|=i*128}},{}],4:[function(f,j,h){var i={}.toString;j.exports=Array.isArray||function(a){return i.call(a)=="[object Array]"}},{}],5:[function(I,N,u){var F=N.exports={};var E;var C;function H(){throw new Error("setTimeout has not been defined")}function w(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){E=setTimeout}else{E=H}}catch(a){E=H}try{if(typeof clearTimeout==="function"){C=clearTimeout}else{C=w}}catch(a){C=w}}());function J(b){if(E===setTimeout){return setTimeout(b,0)}if((E===H||!E)&&setTimeout){E=setTimeout;return setTimeout(b,0)}try{return E(b,0)}catch(a){try{return E.call(null,b,0)}catch(a){return E.call(this,b,0)}}}function K(b){if(C===clearTimeout){return clearTimeout(b)}if((C===w||!C)&&clearTimeout){C=clearTimeout;return clearTimeout(b)}try{return C(b)}catch(a){try{return C.call(null,b)}catch(a){return C.call(this,b)}}}var B=[];var v=false;var G;var A=-1;function D(){if(!v||!G){return}v=false;if(G.length){B=G.concat(B)}else{A=-1}if(B.length){z()}}function z(){if(v){return}var a=J(D);v=true;var b=B.length;while(b){G=B;B=[];while(++A<b){if(G){G[A].run()}}A=-1;b=B.length}G=null;v=false;K(a)}F.nextTick=function(c){var b=new Array(arguments.length-1);if(arguments.length>1){for(var a=1;a<arguments.length;a++){b[a-1]=arguments[a]}}B.push(new M(c,b));if(B.length===1&&!v){J(z)}};function M(b,a){this.fun=b;this.array=a}M.prototype.run=function(){this.fun.apply(null,this.array)};F.title="browser";F.browser=true;F.env={};F.argv=[];F.version="";F.versions={};function L(){}F.on=L;F.addListener=L;F.once=L;F.off=L;F.removeListener=L;F.removeAllListeners=L;F.emit=L;F.binding=function(a){throw new Error("process.binding is not supported")};F.cwd=function(){return"/"};F.chdir=function(a){throw new Error("process.chdir is not supported")};F.umask=function(){return 0}},{}],6:[function(n,m,i){var j=(typeof Array.isArray==="function")?Array.isArray:function(a){return a instanceof Array};function l(b){var a=/^\/(.*)\/([gimyu]*)$/.exec(b.toString());return new RegExp(a[1],a[2])}function k(b){if(typeof b!=="object"){return b}if(b===null){return null}if(j(b)){return b.map(k)}if(b instanceof Date){return new Date(b.getTime())}if(b instanceof RegExp){return l(b)}var c={};for(var a in b){if(Object.prototype.hasOwnProperty.call(b,a)){c[a]=k(b[a])}}return c}m.exports=k},{}],7:[function(k,j,l){var i=k("../pipe").Pipe;var h=function h(){};h.prototype.setResult=function(a){this.result=a;this.hasResult=true;return this};h.prototype.exit=function(){this.exiting=true;return this};h.prototype.switchTo=function(a,b){if(typeof a==="string"||a instanceof i){this.nextPipe=a}else{this.next=a;if(b){this.nextPipe=b}}return this};h.prototype.push=function(a,b){a.parent=this;if(typeof b!=="undefined"){a.childName=b}a.root=this.root||this;a.options=a.options||this.options;if(!this.children){this.children=[a];this.nextAfterChildren=this.next||null;this.next=a}else{this.children[this.children.length-1].next=a;this.children.push(a)}a.next=this;return this};l.Context=h},{"../pipe":21}],8:[function(n,l,i){var j=n("./context").Context;var m=n("../clone");var k=function k(a,b){this.left=a;this.right=b;this.pipe="diff"};k.prototype=new j();k.prototype.setResult=function(b){if(this.options.cloneDiffValues&&typeof b==="object"){var a=typeof this.options.cloneDiffValues==="function"?this.options.cloneDiffValues:m;if(typeof b[0]==="object"){b[0]=a(b[0])}if(typeof b[1]==="object"){b[1]=a(b[1])}}return j.prototype.setResult.apply(this,arguments)};i.DiffContext=k},{"../clone":6,"./context":7}],9:[function(l,j,h){var i=l("./context").Context;var k=function k(b,a){this.left=b;this.delta=a;this.pipe="patch"};k.prototype=new i();h.PatchContext=k},{"./context":7}],10:[function(k,j,l){var h=k("./context").Context;var i=function i(a){this.delta=a;this.pipe="reverse"};i.prototype=new h();l.ReverseContext=i},{"./context":7}],11:[function(f,j,h){j.exports=function i(c,b){var a;if(typeof b==="string"){a=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(b);if(a){return new Date(Date.UTC(+a[1],+a[2]-1,+a[3],+a[4],+a[5],+a[6],+(a[7]||0)))}}return b}},{}],12:[function(C,D,w){var z=C("./processor").Processor;var v=C("./pipe").Pipe;var r=C("./contexts/diff").DiffContext;var H=C("./contexts/patch").PatchContext;var F=C("./contexts/reverse").ReverseContext;var t=C("./clone");var A=C("./filters/trivial");var u=C("./filters/nested");var E=C("./filters/arrays");var G=C("./filters/dates");var B=C("./filters/texts");var s=function s(a){this.processor=new z(a);this.processor.pipe(new v("diff").append(u.collectChildrenDiffFilter,A.diffFilter,G.diffFilter,B.diffFilter,u.objectsDiffFilter,E.diffFilter).shouldHaveResult());this.processor.pipe(new v("patch").append(u.collectChildrenPatchFilter,E.collectChildrenPatchFilter,A.patchFilter,B.patchFilter,u.patchFilter,E.patchFilter).shouldHaveResult());this.processor.pipe(new v("reverse").append(u.collectChildrenReverseFilter,E.collectChildrenReverseFilter,A.reverseFilter,B.reverseFilter,u.reverseFilter,E.reverseFilter).shouldHaveResult())};s.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)};s.prototype.diff=function(a,b){return this.processor.process(new r(a,b))};s.prototype.patch=function(b,a){return this.processor.process(new H(b,a))};s.prototype.reverse=function(a){return this.processor.process(new F(a))};s.prototype.unpatch=function(b,a){return this.patch(b,this.reverse(a))};s.prototype.clone=function(a){return t(a)};w.DiffPatcher=s},{"./clone":6,"./contexts/diff":8,"./contexts/patch":9,"./contexts/reverse":10,"./filters/arrays":14,"./filters/dates":15,"./filters/nested":17,"./filters/texts":18,"./filters/trivial":19,"./pipe":21,"./processor":22}],13:[function(d,h,f){f.isBrowser=typeof window!=="undefined"},{}],14:[function(M,S,C){var T=M("../contexts/diff").DiffContext;var G=M("../contexts/patch").PatchContext;var F=M("../contexts/reverse").ReverseContext;var A=M("./lcs");var P=3;var K=(typeof Array.isArray==="function")?Array.isArray:function(a){return a instanceof Array};var E=typeof Array.prototype.indexOf==="function"?function(b,a){return b.indexOf(a)}:function(b,c){var d=b.length;for(var a=0;a<d;a++){if(b[a]===c){return a}}return -1};function O(d,h,j,a){for(var b=0;b<j;b++){var f=d[b];for(var c=0;c<a;c++){var i=h[c];if(b!==c&&f===i){return true}}}}function N(f,h,l,a,d){var j=f[l];var k=h[a];if(j===k){return true}if(typeof j!=="object"||typeof k!=="object"){return false}var i=d.objectHash;if(!i){return d.matchByPosition&&l===a}var b;var c;if(typeof l==="number"){d.hashCache1=d.hashCache1||[];b=d.hashCache1[l];if(typeof b==="undefined"){d.hashCache1[l]=b=i(j,l)}}else{b=i(j)}if(typeof b==="undefined"){return false}if(typeof a==="number"){d.hashCache2=d.hashCache2||[];c=d.hashCache2[a];if(typeof c==="undefined"){d.hashCache2[a]=c=i(k,a)}}else{c=i(k)}if(typeof c==="undefined"){return false}return b===c}var Q=function J(X){if(!X.leftIsArray){return}var k={objectHash:X.options&&X.options.objectHash,matchByPosition:X.options&&X.options.matchByPosition};var h=0;var f=0;var r;var u;var w;var b=X.left;var c=X.right;var p=b.length;var q=c.length;var s;if(p>0&&q>0&&!k.objectHash&&typeof k.matchByPosition!=="boolean"){k.matchByPosition=!O(b,c,p,q)}while(h<p&&h<q&&N(b,c,h,h,k)){r=h;s=new T(X.left[r],X.right[r]);X.push(s,r);h++}while(f+h<p&&f+h<q&&N(b,c,p-1-f,q-1-f,k)){u=p-1-f;w=q-1-f;s=new T(X.left[u],X.right[w]);X.push(s,w);f++}var n;if(h+f===p){if(p===q){X.setResult(undefined).exit();return}n=n||{_t:"a"};for(r=h;r<q-f;r++){n[r]=[c[r]]}X.setResult(n).exit();return}if(h+f===q){n=n||{_t:"a"};for(r=h;r<p-f;r++){n["_"+r]=[b[r],0,0]}X.setResult(n).exit();return}delete k.hashCache1;delete k.hashCache2;var t=b.slice(h,p-f);var v=c.slice(h,q-f);var l=A.get(t,v,N,k);var a=[];n=n||{_t:"a"};for(r=h;r<p-f;r++){if(E(l.indices1,r-h)<0){n["_"+r]=[b[r],0,0];a.push(r)}}var d=true;if(X.options&&X.options.arrays&&X.options.arrays.detectMove===false){d=false}var z=false;if(X.options&&X.options.arrays&&X.options.arrays.includeValueOnMove){z=true}var o=a.length;for(r=h;r<q-f;r++){var m=E(l.indices2,r-h);if(m<0){var i=false;if(d&&o>0){for(var j=0;j<o;j++){u=a[j];if(N(t,v,u-h,r-h,k)){n["_"+u].splice(1,2,r,P);if(!z){n["_"+u][0]=""}w=r;s=new T(X.left[u],X.right[w]);X.push(s,w);a.splice(j,1);i=true;break}}}if(!i){n[r]=[c[r]]}}else{u=l.indices1[m]+h;w=l.indices2[m]+h;s=new T(X.left[u],X.right[w]);X.push(s,w)}}X.setResult(n).exit()};Q.filterName="arrays";var B={numerically:function(b,a){return b-a},numericallyBy:function(a){return function(b,c){return b[a]-c[a]}}};var U=function V(a){if(!a.nested){return}if(a.delta._t!=="a"){return}var m,h;var f=a.delta;var j=a.left;var b=[];var l=[];var n=[];for(m in f){if(m!=="_t"){if(m[0]==="_"){if(f[m][2]===0||f[m][2]===P){b.push(parseInt(m.slice(1),10))}else{throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+f[m][2])}}else{if(f[m].length===1){l.push({index:parseInt(m,10),value:f[m][0]})}else{n.push({index:parseInt(m,10),delta:f[m]})}}}}b=b.sort(B.numerically);for(m=b.length-1;m>=0;m--){h=b[m];var k=f["_"+h];var c=j.splice(h,1)[0];if(k[2]===P){l.push({index:k[1],value:c})}}l=l.sort(B.numericallyBy("index"));var o=l.length;for(m=0;m<o;m++){var p=l[m];j.splice(p.index,0,p.value)}var d=n.length;var q;if(d>0){for(m=0;m<d;m++){var i=n[m];q=new G(a.left[i.index],i.delta);a.push(q,i.index)}}if(!a.children){a.setResult(a.left).exit();return}a.exit()};U.filterName="arrays";var D=function D(d){if(!d||!d.children){return}if(d.delta._t!=="a"){return}var c=d.children.length;var b;for(var a=0;a<c;a++){b=d.children[a];d.left[b.childName]=b.result}d.setResult(d.left).exit()};D.filterName="arraysCollectChildren";var R=function I(c){if(!c.nested){if(c.delta[2]===P){c.newName="_"+c.delta[1];c.setResult([c.delta[0],parseInt(c.childName.substr(1),10),P]).exit()}return}if(c.delta._t!=="a"){return}var a,b;for(a in c.delta){if(a==="_t"){continue}b=new F(c.delta[a]);c.push(b,a)}c.exit()};R.filterName="arrays";var H=function(i,k,a){if(typeof k==="string"&&k[0]==="_"){return parseInt(k.substr(1),10)}else{if(K(a)&&a[2]===0){return"_"+k}}var j=+k;for(var b in i){var c=i[b];if(K(c)){if(c[2]===P){var h=parseInt(b.substr(1),10);var f=c[1];if(f===+k){return h}if(h<=j&&f>j){j++}else{if(h>=j&&f<j){j--}}}else{if(c[2]===0){var d=parseInt(b.substr(1),10);if(d<=j){j++}}else{if(c.length===1&&b<=j){j--}}}}}return j};var L=function L(f){if(!f||!f.children){return}if(f.delta._t!=="a"){return}var d=f.children.length;var b;var c={_t:"a"};for(var h=0;h<d;h++){b=f.children[h];var a=b.newName;if(typeof a==="undefined"){a=H(f.delta,b.childName,b.result)}if(c[a]!==b.result){c[a]=b.result}}f.setResult(c).exit()};L.filterName="arraysCollectChildren";C.diffFilter=Q;C.patchFilter=U;C.collectChildrenPatchFilter=D;C.reverseFilter=R;C.collectChildrenReverseFilter=L},{"../contexts/diff":8,"../contexts/patch":9,"../contexts/reverse":10,"./lcs":16}],15:[function(l,k,h){var j=function i(a){if(a.left instanceof Date){if(a.right instanceof Date){if(a.left.getTime()!==a.right.getTime()){a.setResult([a.left,a.right])}else{a.setResult(undefined)}}else{a.setResult([a.left,a.right])}a.exit()}else{if(a.right instanceof Date){a.setResult([a.left,a.right]).exit()}}};j.filterName="dates";h.diffFilter=j},{}],16:[function(p,o,k){var l=function(c,d,a,b){return c[a]===d[b]};var m=function(a,b,h,t){var i=a.length;var s=b.length;var c,f;var d=[i+1];for(c=0;c<i+1;c++){d[c]=[s+1];for(f=0;f<s+1;f++){d[c][f]=0}}d.match=h;for(c=1;c<i+1;c++){for(f=1;f<s+1;f++){if(h(a,b,c-1,f-1,t)){d[c][f]=d[c-1][f-1]+1}else{d[c][f]=Math.max(d[c-1][f],d[c][f-1])}}}return d};var n=function(d,i,a,f,h,b){if(f===0||h===0){return{sequence:[],indices1:[],indices2:[]}}if(d.match(i,a,f-1,h-1,b)){var c=n(d,i,a,f-1,h-1,b);c.sequence.push(i[f-1]);c.indices1.push(f-1);c.indices2.push(h-1);return c}if(d[f][h-1]>d[f-1][h]){return n(d,i,a,f,h-1,b)}else{return n(d,i,a,f-1,h,b)}};var j=function(f,h,b,a){a=a||{};var c=m(f,h,b||l,a);var d=n(c,f,h,f.length,h.length,a);if(typeof f==="string"&&typeof h==="string"){d.sequence=d.sequence.join("")}return d};k.get=j},{}],17:[function(A,B,v){var r=A("../contexts/diff").DiffContext;var F=A("../contexts/patch").PatchContext;var D=A("../contexts/reverse").ReverseContext;var z=function z(c){if(!c||!c.children){return}var b=c.children.length;var a;var f=c.result;for(var d=0;d<b;d++){a=c.children[d];if(typeof a.result==="undefined"){continue}f=f||{};f[a.childName]=a.result}if(f&&c.leftIsArray){f._t="a"}c.setResult(f).exit()};z.filterName="collectChildren";var t=function t(b){if(b.leftIsArray||b.leftType!=="object"){return}var c,a,d=b.options.propertyFilter;for(c in b.left){if(!Object.prototype.hasOwnProperty.call(b.left,c)){continue}if(d&&!d(c,b)){continue}a=new r(b.left[c],b.right[c]);b.push(a,c)}for(c in b.right){if(!Object.prototype.hasOwnProperty.call(b.right,c)){continue}if(d&&!d(c,b)){continue}if(typeof b.left[c]==="undefined"){a=new r(undefined,b.right[c]);b.push(a,c)}}if(!b.children||b.children.length===0){b.setResult(undefined).exit();return}b.exit()};t.filterName="objects";var u=function E(b){if(!b.nested){return}if(b.delta._t){return}var c,a;for(c in b.delta){a=new F(b.left[c],b.delta[c]);b.push(a,c)}b.exit()};u.filterName="objects";var s=function s(c){if(!c||!c.children){return}if(c.delta._t){return}var b=c.children.length;var a;for(var d=0;d<b;d++){a=c.children[d];if(Object.prototype.hasOwnProperty.call(c.left,a.childName)&&a.result===undefined){delete c.left[a.childName]}else{if(c.left[a.childName]!==a.result){c.left[a.childName]=a.result}}}c.setResult(c.left).exit()};s.filterName="collectChildren";var C=function q(b){if(!b.nested){return}if(b.delta._t){return}var c,a;for(c in b.delta){a=new D(b.delta[c]);b.push(a,c)}b.exit()};C.filterName="objects";var w=function w(d){if(!d||!d.children){return}if(d.delta._t){return}var c=d.children.length;var a;var b={};for(var f=0;f<c;f++){a=d.children[f];if(b[a.childName]!==a.result){b[a.childName]=a.result}}d.setResult(b).exit()};w.filterName="collectChildren";v.collectChildrenDiffFilter=z;v.objectsDiffFilter=t;v.patchFilter=u;v.collectChildrenPatchFilter=s;v.reverseFilter=C;v.collectChildrenReverseFilter=w},{"../contexts/diff":8,"../contexts/patch":9,"../contexts/reverse":10}],18:[function(A,C,z){var q=2;var w=60;var E=null;var B=function(a){if(!E){var h;if(typeof diff_match_patch!=="undefined"){h=typeof diff_match_patch==="function"?new diff_match_patch():new diff_match_patch.diff_match_patch()}else{if(typeof A==="function"){try{var b="diff_match_patch_uncompressed";var f=A("../../public/external/"+b);h=new f.diff_match_patch()}catch(c){h=null}}}if(!h){if(!a){return null}var d=new Error("text diff_match_patch library not found");d.diff_match_patch_not_found=true;throw d}E={diff:function(j,i){return h.patch_toText(h.patch_make(j,i))},patch:function(l,k){var m=h.patch_apply(h.patch_fromText(k),l);for(var i=0;i<m[1].length;i++){if(!m[1][i]){var j=new Error("text patch failed");j.textPatchFailed=true}}return m[0]}}}return E};var r=function t(b){if(b.leftType!=="string"){return}var d=(b.options&&b.options.textDiff&&b.options.textDiff.minLength)||w;if(b.left.length<d||b.right.length<d){b.setResult([b.left,b.right]).exit();return}var c=B();if(!c){b.setResult([b.left,b.right]).exit();return}var a=c.diff;b.setResult([a(b.left,b.right),0,q]).exit()};r.filterName="texts";var s=function v(b){if(b.nested){return}if(b.delta[2]!==q){return}var a=B(true).patch;b.setResult(a(b.left,b.delta[0])).exit()};s.filterName="texts";var F=function(h){var m,d,c,b,l,k=null,i=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,n,f,a;c=h.split("\n");for(m=0,d=c.length;m<d;m++){b=c[m];var j=b.slice(0,1);if(j==="@"){k=i.exec(b);n=m;f=null;a=null;c[n]="@@ -"+k[3]+","+k[4]+" +"+k[1]+","+k[2]+" @@"}else{if(j==="+"){f=m;c[m]="-"+c[m].slice(1);if(c[m-1].slice(0,1)==="+"){l=c[m];c[m]=c[m-1];c[m-1]=l}}else{if(j==="-"){a=m;c[m]="+"+c[m].slice(1)}}}}return c.join("\n")};var D=function u(a){if(a.nested){return}if(a.delta[2]!==q){return}a.setResult([F(a.delta[0]),0,q]).exit()};D.filterName="texts";z.diffFilter=r;z.patchFilter=s;z.reverseFilter=D},{}],19:[function(r,t,q){var p=(typeof Array.isArray==="function")?Array.isArray:function(a){return a instanceof Array};var m=function o(a){if(a.left===a.right){a.setResult(undefined).exit();return}if(typeof a.left==="undefined"){if(typeof a.right==="function"){throw new Error("functions are not supported")}a.setResult([a.right]).exit();return}if(typeof a.right==="undefined"){a.setResult([a.left,0,0]).exit();return}if(typeof a.left==="function"||typeof a.right==="function"){throw new Error("functions are not supported")}a.leftType=a.left===null?"null":typeof a.left;a.rightType=a.right===null?"null":typeof a.right;if(a.leftType!==a.rightType){a.setResult([a.left,a.right]).exit();return}if(a.leftType==="boolean"||a.leftType==="number"){a.setResult([a.left,a.right]).exit();return}if(a.leftType==="object"){a.leftIsArray=p(a.left)}if(a.rightType==="object"){a.rightIsArray=p(a.right)}if(a.leftIsArray!==a.rightIsArray){a.setResult([a.left,a.right]).exit();return}if(a.left instanceof RegExp){if(a.right instanceof RegExp){a.setResult([a.left.toString(),a.right.toString()]).exit()}else{a.setResult([a.left,a.right]).exit();return}}};m.filterName="trivial";var n=function v(b){if(typeof b.delta==="undefined"){b.setResult(b.left).exit();return}b.nested=!p(b.delta);if(b.nested){return}if(b.delta.length===1){b.setResult(b.delta[0]).exit();return}if(b.delta.length===2){if(b.left instanceof RegExp){var a=/^\/(.*)\/([gimyu]+)$/.exec(b.delta[1]);if(a){b.setResult(new RegExp(a[1],a[2])).exit();return}}b.setResult(b.delta[1]).exit();return}if(b.delta.length===3&&b.delta[2]===0){b.setResult(undefined).exit();return}};n.filterName="trivial";var u=function s(a){if(typeof a.delta==="undefined"){a.setResult(a.delta).exit();return}a.nested=!p(a.delta);if(a.nested){return}if(a.delta.length===1){a.setResult([a.delta[0],0,0]).exit();return}if(a.delta.length===2){a.setResult([a.delta[1],a.delta[0]]).exit();return}if(a.delta.length===3&&a.delta[2]===0){a.setResult([a.delta[0]]).exit();return}};u.filterName="trivial";q.diffFilter=m;q.patchFilter=n;q.reverseFilter=u},{}],20:[function(r,s,p){var o=r("./environment");var m=r("./diffpatcher").DiffPatcher;p.DiffPatcher=m;p.create=function(a){return new m(a)};p.dateReviver=r("./date-reviver");var u;p.diff=function(){if(!u){u=new m()}return u.diff.apply(u,arguments)};p.patch=function(){if(!u){u=new m()}return u.patch.apply(u,arguments)};p.unpatch=function(){if(!u){u=new m()}return u.unpatch.apply(u,arguments)};p.reverse=function(){if(!u){u=new m()}return u.reverse.apply(u,arguments)};p.clone=function(){if(!u){u=new m()}return u.clone.apply(u,arguments)};if(o.isBrowser){p.homepage="{{package-homepage}}";p.version="{{package-version}}"}else{var n="../package.json";var t=r(n);p.homepage=t.homepage;p.version=t.version;var v="./formatters";var q=r(v);p.formatters=q;p.console=q.console}},{"./date-reviver":11,"./diffpatcher":12,"./environment":13}],21:[function(j,i,f){var h=function h(a){this.name=a;this.filters=[]};h.prototype.process=function(m){if(!this.processor){throw new Error("add this pipe to a processor before using it")}var n=this.debug;var a=this.filters.length;var c=m;for(var d=0;d<a;d++){var b=this.filters[d];if(n){this.log("filter: "+b.filterName)}b(c);if(typeof c==="object"&&c.exiting){c.exiting=false;break}}if(!c.next&&this.resultCheck){this.resultCheck(c)}};h.prototype.log=function(a){console.log("[jsondiffpatch] "+this.name+" pipe, "+a)};h.prototype.append=function(){this.filters.push.apply(this.filters,arguments);return this};h.prototype.prepend=function(){this.filters.unshift.apply(this.filters,arguments);return this};h.prototype.indexOf=function(b){if(!b){throw new Error("a filter name is required")}for(var c=0;c<this.filters.length;c++){var a=this.filters[c];if(a.filterName===b){return c}}throw new Error("filter not found: "+b)};h.prototype.list=function(){var a=[];for(var c=0;c<this.filters.length;c++){var b=this.filters[c];a.push(b.filterName)}return a};h.prototype.after=function(b){var c=this.indexOf(b);var a=Array.prototype.slice.call(arguments,1);if(!a.length){throw new Error("a filter is required")}a.unshift(c+1,0);Array.prototype.splice.apply(this.filters,a);return this};h.prototype.before=function(b){var c=this.indexOf(b);var a=Array.prototype.slice.call(arguments,1);if(!a.length){throw new Error("a filter is required")}a.unshift(c,0);Array.prototype.splice.apply(this.filters,a);return this};h.prototype.clear=function(){this.filters.length=0;return this};h.prototype.shouldHaveResult=function(b){if(b===false){this.resultCheck=null;return}if(this.resultCheck){return}var a=this;this.resultCheck=function(c){if(!c.hasResult){console.log(c);var d=new Error(a.name+" failed");d.noResult=true;throw d}};return this};f.Pipe=h},{}],22:[function(f,j,h){var i=function i(a){this.selfOptions=a||{};this.pipes={}};i.prototype.options=function(a){if(a){this.selfOptions=a}return this.selfOptions};i.prototype.pipe=function(b,a){if(typeof b==="string"){if(typeof a==="undefined"){return this.pipes[b]}else{this.pipes[b]=a}}if(b&&b.name){a=b;if(a.processor===this){return a}this.pipes[a.name]=a}a.processor=this;return a};i.prototype.process=function(n,c){var d=n;d.options=this.options();var b=c||n.pipe||"default";var m,a;while(b){if(typeof d.nextAfterChildren!=="undefined"){d.next=d.nextAfterChildren;d.nextAfterChildren=null}if(typeof b==="string"){b=this.pipe(b)}b.process(d);a=d;m=b;b=null;if(d){if(d.next){d=d.next;b=a.nextPipe||d.pipe||m}}}return d.hasResult?d.result:undefined};h.Processor=i},{}],23:[function(f,j,h){var i=f("./utils-editor");i.blur=(function(){var n=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var a=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function d(z,l,B,k){var A=z.naturalWidth;var u=z.naturalHeight;var w=document.getElementById(l);w.style.width=A+"px";w.style.height=u+"px";w.width=A;w.height=u;var v=w.getContext("2d");v.clearRect(0,0,A,u);v.drawImage(z,0,0);if(isNaN(B)||B<1){return}if(k){b(l,0,0,A,u,B)}else{m(l,0,0,A,u,B)}}function b(aT,ap,ar,a0,aY,k){if(isNaN(k)||k<1){return}k|=0;var az=aT.getContext("2d");var aH=az.getImageData(ap,ar,a0,aY);var aU=aH.data;var p,aj,aD,aJ,aG,aA,aO,aW,aV,at,aM,aI,aq,av,aZ,am,l,aE,aK,aQ,aC,ay,ax,an;var aB=k+k+1;var al=a0<<2;var aL=a0-1;var aN=aY-1;var aR=k+1;var aP=aR*(aR+1)/2;var ao=new c();var au=ao;for(aD=1;aD<aB;aD++){au=au.next=new c();if(aD==aR){var aS=au}}au.next=ao;var aF=null;var ak=null;aO=aA=0;var aw=n[k];var aX=a[k];for(aj=0;aj<aY;aj++){am=l=aE=aK=aW=aV=at=aM=0;aI=aR*(aQ=aU[aA]);aq=aR*(aC=aU[aA+1]);av=aR*(ay=aU[aA+2]);aZ=aR*(ax=aU[aA+3]);aW+=aP*aQ;aV+=aP*aC;at+=aP*ay;aM+=aP*ax;au=ao;for(aD=0;aD<aR;aD++){au.r=aQ;au.g=aC;au.b=ay;au.a=ax;au=au.next}for(aD=1;aD<aR;aD++){aJ=aA+((aL<aD?aL:aD)<<2);aW+=(au.r=(aQ=aU[aJ]))*(an=aR-aD);aV+=(au.g=(aC=aU[aJ+1]))*an;at+=(au.b=(ay=aU[aJ+2]))*an;aM+=(au.a=(ax=aU[aJ+3]))*an;am+=aQ;l+=aC;aE+=ay;aK+=ax;au=au.next}aF=ao;ak=aS;for(p=0;p<a0;p++){aU[aA+3]=ax=(aM*aw)>>aX;if(ax!=0){ax=255/ax;aU[aA]=((aW*aw)>>aX)*ax;aU[aA+1]=((aV*aw)>>aX)*ax;aU[aA+2]=((at*aw)>>aX)*ax}else{aU[aA]=aU[aA+1]=aU[aA+2]=0}aW-=aI;aV-=aq;at-=av;aM-=aZ;aI-=aF.r;aq-=aF.g;av-=aF.b;aZ-=aF.a;aJ=(aO+((aJ=p+k+1)<aL?aJ:aL))<<2;am+=(aF.r=aU[aJ]);l+=(aF.g=aU[aJ+1]);aE+=(aF.b=aU[aJ+2]);aK+=(aF.a=aU[aJ+3]);aW+=am;aV+=l;at+=aE;aM+=aK;aF=aF.next;aI+=(aQ=ak.r);aq+=(aC=ak.g);av+=(ay=ak.b);aZ+=(ax=ak.a);am-=aQ;l-=aC;aE-=ay;aK-=ax;ak=ak.next;aA+=4}aO+=a0}for(p=0;p<a0;p++){l=aE=aK=am=aV=at=aM=aW=0;aA=p<<2;aI=aR*(aQ=aU[aA]);aq=aR*(aC=aU[aA+1]);av=aR*(ay=aU[aA+2]);aZ=aR*(ax=aU[aA+3]);aW+=aP*aQ;aV+=aP*aC;at+=aP*ay;aM+=aP*ax;au=ao;for(aD=0;aD<aR;aD++){au.r=aQ;au.g=aC;au.b=ay;au.a=ax;au=au.next}aG=a0;for(aD=1;aD<=k;aD++){aA=(aG+p)<<2;aW+=(au.r=(aQ=aU[aA]))*(an=aR-aD);aV+=(au.g=(aC=aU[aA+1]))*an;at+=(au.b=(ay=aU[aA+2]))*an;aM+=(au.a=(ax=aU[aA+3]))*an;am+=aQ;l+=aC;aE+=ay;aK+=ax;au=au.next;if(aD<aN){aG+=a0}}aA=p;aF=ao;ak=aS;for(aj=0;aj<aY;aj++){aJ=aA<<2;aU[aJ+3]=ax=(aM*aw)>>aX;if(ax>0){ax=255/ax;aU[aJ]=((aW*aw)>>aX)*ax;aU[aJ+1]=((aV*aw)>>aX)*ax;aU[aJ+2]=((at*aw)>>aX)*ax}else{aU[aJ]=aU[aJ+1]=aU[aJ+2]=0}aW-=aI;aV-=aq;at-=av;aM-=aZ;aI-=aF.r;aq-=aF.g;av-=aF.b;aZ-=aF.a;aJ=(p+(((aJ=aj+aR)<aN?aJ:aN)*a0))<<2;aW+=(am+=(aF.r=aU[aJ]));aV+=(l+=(aF.g=aU[aJ+1]));at+=(aE+=(aF.b=aU[aJ+2]));aM+=(aK+=(aF.a=aU[aJ+3]));aF=aF.next;aI+=(aQ=ak.r);aq+=(aC=ak.g);av+=(ay=ak.b);aZ+=(ax=ak.a);am-=aQ;l-=aC;aE-=ay;aK-=ax;ak=ak.next;aA+=a0}}az.putImageData(aH,ap,ar)}function m(p,aq,at,aW,aV,l,az){if(isNaN(l)||l<1){return}l|=0;var am=p.getContext("2d");var aT=az?az.getContext("2d"):am;var aH=aT.getImageData(aq,at,aW,aV);var aQ=aH.data;var ai,aj,aD,aJ,aG,aA,aM,aS,aR,au,aK,ar,aw,an,ah,aE,aN,aC,ay,ao;var aB=l+l+1;var al=aW<<2;var aI=aW-1;var aL=aV-1;var aO=l+1;var k=aO*(aO+1)/2;var ap=new c();var av=ap;for(aD=1;aD<aB;aD++){av=av.next=new c();if(aD==aO){var aP=av}}av.next=ap;var aF=null;var ak=null;aM=aA=0;var ax=n[l];var aU=a[l];for(aj=0;aj<aV;aj++){an=ah=aE=aS=aR=au=0;aK=aO*(aN=aQ[aA]);ar=aO*(aC=aQ[aA+1]);aw=aO*(ay=aQ[aA+2]);aS+=k*aN;aR+=k*aC;au+=k*ay;av=ap;for(aD=0;aD<aO;aD++){av.r=aN;av.g=aC;av.b=ay;av=av.next}for(aD=1;aD<aO;aD++){aJ=aA+((aI<aD?aI:aD)<<2);aS+=(av.r=(aN=aQ[aJ]))*(ao=aO-aD);aR+=(av.g=(aC=aQ[aJ+1]))*ao;au+=(av.b=(ay=aQ[aJ+2]))*ao;an+=aN;ah+=aC;aE+=ay;av=av.next}aF=ap;ak=aP;for(ai=0;ai<aW;ai++){aQ[aA]=(aS*ax)>>aU;aQ[aA+1]=(aR*ax)>>aU;aQ[aA+2]=(au*ax)>>aU;aS-=aK;aR-=ar;au-=aw;aK-=aF.r;ar-=aF.g;aw-=aF.b;aJ=(aM+((aJ=ai+l+1)<aI?aJ:aI))<<2;an+=(aF.r=aQ[aJ]);ah+=(aF.g=aQ[aJ+1]);aE+=(aF.b=aQ[aJ+2]);aS+=an;aR+=ah;au+=aE;aF=aF.next;aK+=(aN=ak.r);ar+=(aC=ak.g);aw+=(ay=ak.b);an-=aN;ah-=aC;aE-=ay;ak=ak.next;aA+=4}aM+=aW}for(ai=0;ai<aW;ai++){ah=aE=an=aR=au=aS=0;aA=ai<<2;aK=aO*(aN=aQ[aA]);ar=aO*(aC=aQ[aA+1]);aw=aO*(ay=aQ[aA+2]);aS+=k*aN;aR+=k*aC;au+=k*ay;av=ap;for(aD=0;aD<aO;aD++){av.r=aN;av.g=aC;av.b=ay;av=av.next}aG=aW;for(aD=1;aD<=l;aD++){aA=(aG+ai)<<2;aS+=(av.r=(aN=aQ[aA]))*(ao=aO-aD);aR+=(av.g=(aC=aQ[aA+1]))*ao;au+=(av.b=(ay=aQ[aA+2]))*ao;an+=aN;ah+=aC;aE+=ay;av=av.next;if(aD<aL){aG+=aW}}aA=ai;aF=ap;ak=aP;for(aj=0;aj<aV;aj++){aJ=aA<<2;aQ[aJ]=(aS*ax)>>aU;aQ[aJ+1]=(aR*ax)>>aU;aQ[aJ+2]=(au*ax)>>aU;aS-=aK;aR-=ar;au-=aw;aK-=aF.r;ar-=aF.g;aw-=aF.b;aJ=(ai+(((aJ=aj+aO)<aL?aJ:aL)*aW))<<2;aS+=(an+=(aF.r=aQ[aJ]));aR+=(ah+=(aF.g=aQ[aJ+1]));au+=(aE+=(aF.b=aQ[aJ+2]));aF=aF.next;aK+=(aN=ak.r);ar+=(aC=ak.g);aw+=(ay=ak.b);an-=aN;ah-=aC;aE-=ay;ak=ak.next;aA+=aW}}am.putImageData(aH,aq,at)}function c(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}return{image:d,canvasRGB:m,canvasRGBA:b}}());j.exports=i},{"./utils-editor":98}],24:[function(f,j,h){var i={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var d=0;d<a.length;d++){var c=a[d].string;var b=a[d].prop;this.versionSearchString=a[d].versionSearch||a[d].identity;if(c){if(c.indexOf(a[d].subString)!=-1){return a[d].identity}}else{if(b){return a[d].identity}}}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(b==-1){return}return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};j.exports=i},{}],25:[function(f,j,h){var i=window.location&&(location.origin==="file://"||location.origin==="null"||location.protocol!=="https:");j.exports=i},{}],26:[function(f,j,h){var i={maxSyncRetryCount:2,syncDown:function(m,c,a,d){if($.isFunction(c)){d=arguments[2];a=arguments[1];c=false}var n=$.isArray(m);var b={t:"syncDown",objectId:n?m.join(","):m,multiple:n};if(c){b.unloaded=true}$.ajax({url:"./index.php",type:"POST",data:b,success:a,error:d||i.syncError})},syncError:function(c,a,b,d,l){},apiCall:function(r,c,t,p,q,d){var b={},a=p;if(p instanceof Blob){var s=new FormData();s.append("file",p);p=s;c="post";b={processData:false,contentType:false};fluid.main.fire("ajaxapicall",t,r)}$.ajax($.extend(b,{url:this.apiObjectUrl(r,t),type:c?c.toUpperCase():"POST",data:p,success:function(l,k,m){if(c=="post"){var n=fluid.main.account.findUpload(t);if(n){n.upload.s=true;fluid.main.fire("uploadsynced",t)}}if($.isFunction(q)){q(l,t,a)}},error:function(m,k,l){i.syncError(m,k,l,r,t);if($.isFunction(d)){d(p,t,a)}},complete:function(l,k){fluid.main.fire("ajaxapicallcomplete",t)}}))},apiObjectUrl:function(b,a){return"data/"+b+(a?"/"+a:"")},generalRequest:function(c,d,a,b){var l=b?$.extend({t:d},c):{t:d,data:JSON.stringify(c)};$.ajax({url:"index.php",type:"POST",data:l,success:function(k,p,o){if($.isFunction(a)){a(k)}},error:function(o,p,k){if($.isFunction(a)){a(null,k)}}})}};j.exports=i},{}],27:[function(r,s,p){var o=r("./class-storage");var l=r("./utils");var m=r("./class-ajax");var q=(function(){var A={},f={iPadRetina:{width:1024,height:768,pixelRatio:2,icon:152,splashP:"1536x2008",splashL:"2048x1496"},iPad:{width:768,height:1024,pixelRatio:1,icon:152,splashP:"768x1004",splashL:"1024x748"},iPhone5:{width:320,height:568,pixelRatio:2,icon:120,splashP:"640x1096",splashL:"1096x640"},iPhone4:{width:320,height:480,pixelRatio:2,icon:120,splashP:"640x920",splashL:"920x640"},iPhone:{width:320,height:480,pixelRatio:1,icon:120,splashP:"320x480",splashL:"480x320"},iPhone6:{width:375,height:667,pixelRatio:2,icon:120,splashP:"750x1334",splashL:"1334x750"},"iPhone6+":{width:414,height:736,pixelRatio:3,icon:180,splashP:"1242x2208",splashL:"2208x1242"}},j={splashPiPad:[{x:768,y:1004},{x:1536,y:2008}],splashLiPad:[{x:1024,y:748},{x:2048,y:1496}],splashiPhone5:[{x:640,y:1096}],splashLiPhone6:[{x:750,y:1334}],splashPiPhone6:[{x:1334,y:750}],"splashiPhone6+":[{x:640,y:1096}],splashiPhone:[{x:320,y:460},{x:640,y:920}]},B={};function d(){var v,u;for(v in f){if(f.hasOwnProperty(v)&&screen.width===f[v].width&&screen.height===f[v].height&&window.devicePixelRatio===f[v].pixelRatio){u=v;break}}return u?{device:u,screen:f[u]}:{device:"",screen:{splashP:"",splashL:""}}}function a(R,T,V,u){u=u||o.get(q.lastSelectedId||fluid.main.project.id)||fluid.main.project.toJSON();var S=u.id||q.lastSelectedId||fluid.main.project.id;if(R){if(A[R]!==null&&A[R]!==undefined){var w=R+"Branding",Q=(u.id!==fluid.main.project.id),Y=Q?u:{};if(A[R]){var U=j[R]&&j[R].length,Z=0;if(U){Y[w]=u[w]||{};for(;Z<U;Z++){var P=j[R][Z],v=l.guid("j"),W=t(n(A[R].dataUrl,P.x,P.y),{type:"image/png"}),z=[P.x+"x"+P.y],X=Q?Y[w]:fluid.main.project.get(w);B[v]={remove:(X instanceof Object)?X[z]:X,key:R,onSuccess:T,onError:V,proj:u};m.apiCall("img","post",v,W,C,k);Y[w][z]=v}}else{var v=l.guid("i");B[v]={remove:Q?Y[w]:fluid.main.project.get(w),key:R,onSuccess:T,onError:V,proj:u};m.apiCall("img","post",v,A[R].file,C,k);Y[w]=v}A[R]=null}else{Y[w]="";A[R]=null}fluid.main.fire("branding.uploadComplete",{projectId:S,uploadId:v,needSync:Q,projectObj:Y})}return}for(R in A){if(A.hasOwnProperty(R)){a(R,T,V,u)}}}function C(w,v){var u=B[v],z=u&&u.proj||o.get(q.lastSelectedId||fluid.main.project.id);if(u&&u.remove){m.apiCall("img","delete",u.remove)}B[v]=null;typeof u.onSuccess==="function"&&u.onSuccess.apply(this,arguments)}function k(z,v){var u=B[v],G=u&&u.proj||o.get(q.lastSelectedId||fluid.main.project.id),w=(G.id!==fluid.main.project.id),H=w?G:{};notification.add("alert",b(u.key)+" branding image could not be uploaded. Please try again.");if(u&&u.remove){if(u.details){H[u.key+"Branding"]=H[key+"Branding"]||{};H[u.key+"Branding"][details]=u.remove}else{H[u.key+"Branding"]=u.remove}typeof u.onError==="function"&&u.onError.apply(this,arguments)}fluid.main.fire("branding.uploadError",{projectId:G.id,uploadId:v,needSync:w,projectObj:H});B[v]=null}function D(z,u,v){var w=(v?v:o.get(q.lastSelectedId||fluid.main.project.id))[z+"Branding"];if(w instanceof Object){if(u===undefined||u===null||u===""){u=j[z]&&j[z][0].x+"x"+j[z][0].y}w=w[u]}return w?m.apiObjectUrl("img",w):""}function c(z,u,v){var w=(v?v:o.get(q.lastSelectedId||fluid.main.project.id))[z+"Branding"];if(w instanceof Object){if(u===undefined||u===null||u===""){u=j[z]&&j[z][0];return w[u]||w}return w[u]}return w}function b(u){if(/icon/.test(u)){return"App Icon"}if(/iPhone/.test(u)){return"Loading image"}if(/splashP/.test(u)){return"Portrait Splash image"}if(/splashL/.test(u)){return"Landscape Splash image"}}function i(F,w,v,z){if(w){if(!/^image\/(png|jpeg)$/i.test(w.type)){notification.add("alert","You may only upload JPEG and PNG images");return}var u=new FileReader();u.onloadend=function(E){if(E.target.readyState===FileReader.DONE){A[F]={file:w,dataUrl:E.target.result};if(typeof v==="function"){v(E.target.result)}}else{if(typeof z==="function"){z(E)}}};u.onerror=z;u.readAsDataURL(w)}else{A[F]=""}}function h(u){if(u){A[u]=null}else{for(u in A){if(A.hasOwnProperty(u)){A[u]=null}}}}return{changeImage:i,resetChange:h,update:a,getUrl:D,get:c,screens:f,sizes:j,getTitle:b,deviceScreen:d}}());fluid.main.on("projectSettings.lastSelectedChange",function(b,a){q.lastSelectedId=a});function n(c,i,k,a,b,v,d){var f=document.createElement("canvas"),j=f.getContext("2d");f.width=i;f.height=k;if(typeof c==="string"){var h=document.createElement("img");h.src=c;c=h}if(c instanceof Element){if(typeof a==="number"&&typeof b==="number"){j.drawImage(c,a,b,v,d,0,0,i,k)}else{j.drawImage(c,0,0,i,k)}return f.toDataURL()}}function t(f,a){var c=atob(f.split(",")[1]),d=[];for(var b=0;b<c.length;b++){d.push(c.charCodeAt(b))}return new Blob([new Uint8Array(d)],a)}s.exports=q},{"./class-ajax":26,"./class-storage":46,"./utils":99}],28:[function(i,m,j){var k=i("./utils-editor");var n=i("./class-grid");var l={setContainment:function(){var b=k.getTLWH("#viewport");var c=k.getTLWH("#canvas");var a=10;return[b.left+b.width-c.width-a,b.top+b.height-c.height-a,b.left+a,b.top+a]},setScreenContainment:function(){var a=$("#canvasPages .screen");if(a.length==0){return}var b=k.getTLWH("#canvas");var c=fluid.zoom.getCurrentScale();a.each(function(){l.setPageContainment(this,b,c)})},setPageContainment:function(b,d,f){if(!$(b).data("initDraggable")){return}d=d||k.getTLWH("#canvas");f=fluid.zoom.getCurrentScale();var c=k.getTLWH(b);var a=[d.left,d.top,d.left+Math.floor((d.width))-(c.width*f),d.top+Math.floor((d.height))-(c.height*f)];$(b).draggable("option","containment",a)},dragStart:function(a){if($("#canvas").data("zooming")){return false}fluid.main.fire("cm:place","hide");if(fluid.zoom.isEditMode()){$("#canvasLinks").hide()}var b=document.getElementById("canvas");b.style.cursor="-webkit-grabbing";b.style.cursor="-moz-grabbing";b.style.cursor="grabbing"},drag:function(a){},dragStop:function(a){l.setScreenContainment();$("#canvasLinks").fadeIn(200);fluid.main.fire("cm:place");document.getElementById("canvas").style.cursor="";fluid.main.fire("canvasdragstop")},isEditorVisible:function(){return $("#canvas").hasClass("editing")},setEditorVisibility:function(a){if(a){$("#canvas").addClass("editing");fluid.main.fire("canvasFirstPage");n.selectBackground()}else{$("#canvas").removeClass("editing");fluid.controllers.bin.hide()}},redraw:function(a){$("#canvas").draggable("option","containment",l.setContainment());if(fluid.zoom.getCtx()==="project"){fluid.zoom.zoomToAllDebounced2()}else{fluid.zoom.zoomToPage(fluid.zoom.getActivePageId())}}};fluid.main.on("afterzoomaction",function(){$("#canvas").draggable("option","containment",l.setContainment()).css({"-webkit-transition":"none","-moz-transition":"none"}).data("zooming",false)});fluid.main.on("needscreencontainmentset",function(){l.setScreenContainment()});fluid.main.on("beforeusersetingopen",function(){l.setEditorVisibility(false)});fluid.main.on("canvas2.setPageContainment",l.setPageContainment);fluid.main.on("projectLoadingForOpening",function(){$("#canvas-buttons-wrapper").hide()});fluid.main.on("project.close",function(){$("#canvas-buttons-wrapper").show();$("#createNewPageButton, #preview, #zoomOut").addClass("hud-hidden")});m.exports=l},{"./class-grid":31,"./utils-editor":98}],29:[function(n,m,p){var l=n("./browserdetect");var k=n("./reloader");var o=n("./checkHost");var j={dbAvailable:null,db:null,readyListeners:[],versionNumber:55,onReady:function(a){if(j.db||j.dbAvailable===false){a()}else{j.readyListeners.push(a)}},getObjectStore:function(d,a){var c;try{c=j.db.transaction(d,a)}catch(b){if(b&&b.message){Logger({key:"dbsTransErr",error:true,message:b.message,group:"IDBTransactions"})}return false}return c.objectStore(d)},clear:function(){return new Promise(function(a,b){var c=window.indexedDB.deleteDatabase("fluidDB");c.onsuccess=a;c.onerror=b})},set:function(c,b,a){return new Promise(function(f,h){if(b.length===undefined){b=[b]}if(b.length===0||j.dbAvailable===false){if(a){a()}return}var r=j.getObjectStore(c,"readwrite");for(var i=0;i<b.length;i++){if(r&&r.put){if(!b[i].id){continue}var d=r.put(b[i]);d.onsuccess=function(){if(i===b.length){if(a){a({success:true})}f()}};d.onerror=function(){Logger({key:"dbsPutErr",error:true,message:d.error,group:"IDBTransactions"});if(i===b.length){if(a){a({success:false})}h(d.error)}}}else{h();Logger({key:"dbsPutErr",error:true,message:"store.put is not a function (most probably db was closed)",group:"IDBTransactions"})}}})},remove:function(c,b,a){return new Promise(function(f,h){if(b.length===undefined){b=[b]}if(b.length===0||j.dbAvailable===false){if(a){a()}return}var r=j.getObjectStore(c,"readwrite");var d;for(var i=0;i<b.length;i++){d=r["delete"](b[i]);d.onsuccess=function(v,q,u){if(v===q.length-1){if(u){u()}f()}}.bind(this,i,b,a);d.onerror=function(){h(d.error);Logger({key:"dbsRemFail",error:true,group:"IDBTransactions",message:"dbStorage remove failed"})}}})},list:function(b,a){return new Promise(function(h,i){var c=j.db.transaction(b);var r=c.objectStore(b);var d=[];var f=r.openCursor();f.onsuccess=function(t){var q=t.target.result;if(q){d.push(q.value);q["continue"]()}else{if(a){a(d)}h(d)}};f.onerror=function(){i(f.error)}})},get:function(c,b,a){return new Promise(function(f,h){var u={failed:[],fetched:[],resultsArr:[],resultsObj:{}};if(b.length===undefined||typeof(b)==="string"){b=[b]}if(b.length===0||j.dbAvailable===false){if(a){a(u)}return f(u)}var v=j.db.transaction(c);var i=v.objectStore(c);var t;for(var d=0;d<b.length;d++){if(typeof b[d]!=="string"){t=i.get("invalid_id_passed")}else{t=i.get(b[d])}t.onsuccess=function(r,q){if(this.result){u.fetched.push(r);u.resultsObj[r]=this.result}else{u.failed.push(r);u.resultsObj[r]=null}u.resultsArr.push(u.resultsObj[r]);if(u.resultsArr.length===b.length){if(a){a(u)}f(u)}}.bind(t,b[d]);t.onerror=function(){h(t.error);Logger({key:"dbsGetFail",group:"IDBTransactions",error:true,message:"dbStorage get failed"})}}})},init:function(){return new Promise(function(a,b){l.init();if(o){j.dbAvailable=false;clearTimeout(j.timeoutToClearWhenResolved);return a()}Logger({key:"idbInitStart",group:"IDBInit",message:"idb initialization started"});var d;var c=localStorage.getItem("forceWebSQL");if(window.indexedDB&&l.browser!=="Safari"&&!c){d=window.indexedDB.open("fluidDB",j.versionNumber)}else{if(window.shimIndexedDB){d=window.shimIndexedDB.open("fluidDB",j.versionNumber)}else{b("unrecoverableDbFail");fluid.main.fire("unrecoverableDbFail")}}d.onupgradeneeded=function(f){Logger({key:"idbOnupgrNeeded",group:"IDBInit",message:"onupgradeneeded fired"});j.dbAvailable=true;var h;if(this.result.objectStoreNames.contains("rastPages")){this.result.deleteObjectStore("rastPages")}if(!this.result.objectStoreNames.contains("rastPages")){h=this.result.createObjectStore("rastPages",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data");h.createIndex("by_project","project")}if(this.result.objectStoreNames.contains("uploads")){this.result.deleteObjectStore("uploads")}if(!this.result.objectStoreNames.contains("uploads")){h=this.result.createObjectStore("uploads",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("projects")){this.result.deleteObjectStore("projects")}if(!this.result.objectStoreNames.contains("projects")){h=this.result.createObjectStore("projects",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("libs")){this.result.deleteObjectStore("libs")}if(!this.result.objectStoreNames.contains("libs")){h=this.result.createObjectStore("libs",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("libWidgets")){this.result.deleteObjectStore("libWidgets")}if(!this.result.objectStoreNames.contains("libWidgets")){h=this.result.createObjectStore("libWidgets",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("uiIcons")){this.result.deleteObjectStore("uiIcons")}if(!this.result.objectStoreNames.contains("uiIcons")){h=this.result.createObjectStore("uiIcons",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("uploadThumbs")){this.result.deleteObjectStore("uploadThumbs")}if(!this.result.objectStoreNames.contains("uploadThumbs")){h=this.result.createObjectStore("uploadThumbs",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("uploadHeaders")){this.result.deleteObjectStore("uploadHeaders")}if(!this.result.objectStoreNames.contains("uploadHeaders")){h=this.result.createObjectStore("uploadHeaders",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("wdgDefinitions")){this.result.deleteObjectStore("wdgDefinitions")}if(!this.result.objectStoreNames.contains("wdgDefinitions")){h=this.result.createObjectStore("wdgDefinitions",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}if(this.result.objectStoreNames.contains("incrementalQueue")){this.result.deleteObjectStore("incrementalQueue")}if(!this.result.objectStoreNames.contains("incrementalQueue")){h=this.result.createObjectStore("incrementalQueue",{keyPath:"id"});h.createIndex("by_id","id",{unique:true})}if(this.result.objectStoreNames.contains("accounts")){this.result.deleteObjectStore("accounts")}if(!this.result.objectStoreNames.contains("accounts")){h=this.result.createObjectStore("accounts",{keyPath:"id"});h.createIndex("by_id","id",{unique:true});h.createIndex("by_data","data")}};d.onsuccess=function(t){Logger({key:"idbInitSuccess",group:"IDBInit",message:"idb initialization succeeded",processEnded:true});j.dbAvailable=true;j.db=this.result;if(localStorage.getItem("account.loginStarted")==="true"&&localStorage.getItem("account.loginEnded")===null){localStorage.clear();localStorage.setItem("indexedDBreloaded",true);var h=[];var s;for(var i=0;i<j.db.objectStoreNames.length;i++){s=j.getObjectStore(j.db.objectStoreNames[i],"readwrite");h.push(s.clear())}Promise.all(h).then(f,b)}else{localStorage.setItem("indexedDBreloaded",false);f()}function f(){for(var q=0;q<j.readyListeners.length;q++){j.readyListeners[q]()}clearTimeout(j.timeoutToClearWhenResolved);return a()}};d.onerror=function(h){Logger({key:"dbsInitFail",group:"IDBInit",message:"idb initialization failed, "+l.OS+", "+l.browser+": "+l.version+", error: "+d.error,error:true});j.dbAvailable=false;b(h);if(!localStorage.getItem("clearedIndexedDb")){localStorage.clear();localStorage.setItem("clearedIndexedDb",true);var f=window.indexedDB.deleteDatabase("fluidDB");f.onsuccess=function(){k.reload("successfuly cleared idb, restarting editor")};f.onerror=function(){localStorage.setItem("forceWebSQL",true);k.reload("idb not working properly, defaulting to websql")};f.onblocked=function(){localStorage.setItem("forceWebSQL",true);k.reload("idb is blocked, defaulting to websql")}}else{localStorage.removeItem("clearedIndexedDb")}if(h.target.error.name&&localStorage.getItem("indexedDBreloaded")==="false"){setTimeout(function(){j.clear();localStorage.clear();localStorage.setItem("indexedDBreloaded",true);k.reload("indexedDBreloaded")},5000)}};d.onblocked=function(f){j.dbAvailable=false;b("dbStorage blocked")};j.timeoutToClearWhenResolved=setTimeout(function(){if(!j.db){fluid.main.fire("dbStorage.failed")}b("dbStorage failed to init")},20000)})}};fluid.main.on("dbStorage.get",function(d,c,b,a){j.get(c,b,a)});fluid.main.on("dbStorage.set",function(d,c,b,a){j.set(c,b,a)});fluid.main.on("dbStorage.onReady",function(b,a){j.onReady(a)});fluid.main.on("dbStorage.list",function(c,b,a){j.list(b,a)});fluid.main.on("dbStorage.clear",function(a){j.clear()});m.exports=j},{"./browserdetect":24,"./checkHost":25,"./reloader":97}],30:[function(j,i,f){var h={lastEvent:"",lastTrigger:new Date().getTime(),triggerEditor:function(c,a,b){h._trigger($("#canvas"),c,a,b)},bindEditor:function(b,a){h._bind($("#canvas"),b,a)},triggerPreview:function(c,a,b){h._trigger($("#home"),c,a,b)},_trigger:function(d,p,b,c){var n=false;var o=new Date().getTime();var a=c||false;if((h.lastEvent!=p)||(o-h.lastTrigger>500)||a){n=true}if(n){d.trigger(p,b);h.lastEvent=p;h.lastTrigger=o}},_bind:function(b,c,a){b.live(c,a)}};i.exports=h},{}],31:[function(i,m,j){var k=i("./utils-editor");var l=i("./class-page");var n={toggle:function(){var a=fluid.main.account.get("gridStatus");(a=="on")?n.hideGridSettingsMenu():n.showGridSettingsMenu();return false},updateGridSettingsMenu:function(){$("#gridControls").addClass("menuHidden");$("#gridSwitch").removeClass("sg-toggleButtonChanged");if(fluid.main.account.get("gridStatus")==="on"){$("#gridControls").removeClass("menuHidden");n.getGridSpacing()}else{$("#gridSwitch").addClass("sg-toggleButtonChanged")}},hideGridSettingsMenu:function(){n.updateGridSettingsMenu();n.hideGrid();fluid.main.fire("gridmenuhide")},showGridSettingsMenu:function(){n.updateGridSettingsMenu();n.getGridSpacing();n.showGrid();fluid.main.fire("gridmenushow")},changeGridSpacing:function(a,b){fluid.main.account.set({gridSpacing:b.value});n.drawGrid();$("#gridSpaceSlider").find(".ui-slider-handle").text(b.value+"px");fluid.main.fire("gridspacingchanged")},getGridSpacing:function(){var a=fluid.main.account.get("gridSpacing");fluid.main.fire("snapandgridalgin");n.updateSliderPos(a)},updateSliderPos:function(a){$("#gridSpaceSlider").slider("value",a).find(".ui-slider-handle").text(a+"px")},pageDims:false,currentPageID:false,currentPageGridHolder:false,getPageProps:function(){var a=fluid.zoom.getActivePageId();if(!a){return false}var c=$("#"+a).find(".page").find(".widgetHolder");n.currentPageID=a;n.currentPageGridHolder=c;var b=fluid.main.project.pages.get(a).get("width");var d=fluid.main.project.pages.get(a).get("height");n.pageDims={width:b,height:d};return c},showGrid:function(c,d){if(fluid&&fluid.main&&fluid.main.project&&fluid.main.project.isReadOnly()){return false}else{if(!fluid.main.project){return false}}$("#gridSquares").remove();var a=n.getPageProps();var b=a.find(".backgroundWidget").attr("id");if(b){$("#tmplGrid").tmpl(n.pageDims).appendTo("#"+b)}else{$("#tmplGrid").tmpl(n.pageDims).prependTo(a)}n.drawGrid()},drawGrid:function(){function d(){f.beginPath();f.strokeStyle="rgb(127,185,240)";f.lineWidth=h;for(var o=(a*5);o<n.pageDims.height;o+=(a*5)){f.moveTo(0,o);f.lineTo(n.pageDims.width,o)}for(var o=(a*5);o<n.pageDims.width;o+=(a*5)){f.moveTo(o,0);f.lineTo(o,n.pageDims.height)}f.stroke()}if(fluid.main.account.get("gridStatus")!="on"){return}var a=fluid.main.account.get("gridSpacing");var c=$("#gridSquares");if(c.size()==0){return}var f=(c[0]).getContext("2d");f.clearRect(0,0,n.pageDims.width,n.pageDims.height);if(a<4){f.clearRect(0,0,n.pageDims.width,n.pageDims.height);return}var h=1;f.beginPath();f.strokeStyle="rgb(176,217,255)";f.lineWidth=h;for(var b=a;b<n.pageDims.height;b+=a){f.moveTo(0,b);f.lineTo(n.pageDims.width,b)}for(var b=a;b<n.pageDims.width;b+=a){f.moveTo(b,0);f.lineTo(b,n.pageDims.height)}f.stroke();d(a)},hideGrid:function(){$("#gridSquares").remove()},selectBackground:function(){if(fluid.zoom.isEditMode()){var a=fluid.main.account.get("gridStatus");if(a=="on"){n.showGrid()}}},zoomIn:function(){if(!fluid.main.project.get("active")){return}var a=fluid.main.account.get("gridStatus");if(a=="on"){n.showGridSettingsMenu()}else{if(a=="off"){n.hideGridSettingsMenu()}}}};fluid.main.on("pageactivated",function(){n.updateGridSettingsMenu();n.zoomIn()});fluid.main.on("afteroptionsmenuupdated wdgselection",n.selectBackground);fluid.main.on("showGridSettingsMenu",function(){n.updateGridSettingsMenu();if(fluid.zoom.getCtx()!=="project"){n.showGridSettingsMenu()}});fluid.main.on("hideGridSettingsMenu",function(){n.updateGridSettingsMenu();if(fluid.zoom.getCtx()!=="project"){n.hideGridSettingsMenu()}});fluid.main.on("updateGridMenu",function(){n.updateGridSettingsMenu()});fluid.main.on("showGrid",function(){n.showGrid()});fluid.main.on("page.drawDetailed",function(d,a,b,c){if(fluid.main.account.get("gridStatus")==="on"){n.showGrid()}});m.exports=n},{"./class-page":34,"./utils-editor":98}],32:[function(r,p,k){var m=r("./class-storage");var q=r("./functions");var o=r("./class-widget");var l=r("./utils");var n={drawExisting:function(a){function h(F,j){for(var A in j){var E=j[A];var C=_.last(E);if(F==C){var B=n.getCommonArray(A,j);var D=_.last(B);if(A==D){n.draw(A,j)}}}}n.erase();if(fluid.zoom.isEditMode()){var a=(a)?a:$("#canvasPages").find(".screen.active").attr("id");if(!a){return}var c=$.extend({},m.get(a));var d=c.widgets;if(!d){return}var i=fluid.main.project.get("widgetGroups");for(var b=0;b<d.length;b++){var f=d[b];h(f,i)}}},enableGroupBtns:function(v){var v=v.not(".backgroundWidget,.lockedWidget");var a=v.length;var d=fluid.main.project.get("widgetGroups");var c=(a>1)?true:false;if(d){var f=n.createSelArray(v,d);var u=[];for(var j=0;j<f.length;j++){var i=f[j];if(i.charAt(0)=="g"){var h=n.getCommonArray(i,d);var b=_.last(h);u.push(b)}else{if(i.charAt(0)=="w"){u.push(i)}}}var u=_.uniq(u);if(u.length>=1){if(u.length==1){var c=(u[0].charAt(0)=="w")?false:"ungroup"}else{var c=true}}}return c},calculateAlign:function(a,f){var R=fluid.main.project.get("widgetGroups");var T={left:0,right:0,top:0,bottom:0};for(var O in R){var P=R[O];var J=P.indexOf(a);if(J>-1){var b=$("#"+O);var M=_.last(P);var h=parseFloat($("#"+M).css("top"));var j=parseFloat($("#"+M).css("left"));var i=parseFloat(b.css("width"));var c=parseFloat(b.css("height"));var K=j+parseFloat(b.css("left"));var Q=h+parseFloat(b.css("top"));var I=c+h;var L=i+K;var N=parseFloat(f.css("left"));var t=parseFloat(f.css("top"));var S=parseFloat(f.css("width"))+N;var d=parseFloat(f.css("height"))+t;T.left=N-K;T.top=t-Q;T.right=L-S;T.bottom=I-d;T.height=c;T.width=i;T.groupLeft=K;T.groupTop=Q}}return T},copyGroups:false,allGroups:false,select:function(j){n.deselect();var b=fluid.main.project.get("widgetGroups");if(b){var a=$("#"+fluid.selection.getSelectionModel().getRoots().getIds().join(", #"));var c=j||n.createSelArray(a,b);for(var i=0;i<c.length;i++){var h=c[i];if(h.charAt&&h.charAt(0)=="g"){var f=n.getCommonArray(h,b);var t=_.last(f);if(h==t){var d=$("#"+h);if(d){d.addClass("selectedGroup")}}}}}return fluid.selection.getSelectedEls()},createSelFromArray:function(a){var b=$([]);for(var c=0;c<a.length;c++){b=b.add($("#"+a[c]))}return b},store:function(){return JSON.stringify(fluid.main.project.get("widgetGroups"))},selArray:[],deleteIds:[],createSelArray:function(c,b){var c=c.not(".backgroundWidget,.lockedWidget");n.selArray=[];n.deleteIds=[];c.each(function(){var i=$(this);var f=i.attr("id");n.selArray.push(f);for(var j in b){var t=b[j];var h=t.indexOf(f);if(h>-1){n.selArray.push(j);n.deleteIds.push(f)}}});var d=_.uniq(n.selArray);var a=_.uniq(n.deleteIds);d=_.difference(d,a);return d},getCommonArray:function(b,h){f=[];var h=(!h)?fluid.main.project.get("widgetGroups"):h;var a=h[b];for(var c in h){var d=_.intersection(a,h[c]);if(d.length>0){f.push(c)}}var f=_.uniq(f);return f},draw:function(F,L){function f(v){var s=$([]);for(var t=0;t<v.length;t++){var u=$("#"+v[t]);s=s.add(u)}return s}var h=F;var G=L[h];var H=f(G);var J=H.last();var M=o.getLockTos(J);var d=(M.length>0)?M:J;var b=_.map(H,function(s){return $(s).attr("id")});var i=fluid.main.project.widgets.getByIds(b).getBox({returnMode:"ltrbObj"});var E=i.right-i.left;var I=i.bottom-i.top;var j=parseInt(d.css("top"));var a=parseInt(d.css("left"));var c=(j-i.top)*-1;var K=(a-i.left)*-1;var N={top:c,left:K,width:E,height:I,groupId:h};$("#tmplWidgGroup").tmpl(N).appendTo("#"+d.attr("id"))},addWidgets:function(c){function a(){var f=$(this);var d=f.attr("id");b.push(d)}var b=new Array;var c=c.not(".backgroundWidget,.lockedWidget");c.each(a);return b},createGroupIndex:function(d){(d)?d:fluid.main.project.get("widgetGroups");for(var a in d){var b=a}var f=b.replace("g","");var c=parseInt(f);c="g"+(c+1);return c},erase:function(){$("#canvasPages .groupWidgetHolder").remove()},deselect:function(){$("#canvasPages .groupWidgetHolder").removeClass("selectedGroup")},getIdFromGroup:function(f,d){var h=false;for(var a in f){var c=f[a];var b=_.difference(c,d);if(b.length<1){h=a}}return h}};if(!fluid.main.isNode()){fluid.main.on("closeallpopups",n.deselect);fluid.main.on("widgetsAdded",function(c,b,a){n.drawExisting(b);n.select()});fluid.main.on("widgetremoved",function(a){n.drawExisting()});fluid.main.on("widgetMoved",function(b,a){n.drawExisting(a.toPage)});fluid.main.on("afterWidgetsGrouped",function(c,a,d){var b=$("#"+a.join(", #"));$(".groupWidgetHolder").removeClass("groupWithoutBorder");$("#multiSelBox").remove();n.drawExisting();$("#"+d).addClass("selectedGroup");fluid.main.fire("contextMenu:hide");fluid.main.fire("contextMenu:place");q.updateTLWH();o.drawMultiSelBox(b);fluid.selection.select(a);n.select()});fluid.main.on("afterWidgetsUngrouped",function(c,b){var a=$("#"+b.join(", #"));n.drawExisting();$("#multiSelBox").remove();fluid.main.fire("contextMenu:hide");fluid.main.fire("contextMenu:place");q.updateTLWH();o.drawMultiSelBox(a)});fluid.main.on("drawExistingGroups",function(b,a){n.drawExisting(a)})}p.exports=n},{"./class-storage":46,"./class-widget":49,"./functions":91,"./utils":99}],33:[function(k,q,l){var r=k("./functions");var n=k("./browserdetect");var m={config:{displayDuration:4500,alertDisplayDuration:9000,alertTypes:["alert","testAlert"],alertResumeThreshold:1000,messageExpiration:2000,pageSize:3,expandMessageDelay:30,fadeInDuration:300,fadeOutDuration:150,openDuration:300,closeDuration:150,moveDuration:300,summaryOrientation:"horizontal",summaryShowDuration:1000,summaryFadeInDuration:150},messages:[],alerts:[],summaries:{total:{count:0}},expandedType:null,expandedPage:0,currentMessage:null,currentPage:0,messageTimeout:null,summaryTimeout:null,interrupted:false,init:function(){$("#tmplNotifications").tmpl({}).appendTo("body");var a=$("#notifications > .summaries");a.mouseover(function(){m._stopSummaries()}).mouseout(function(){if(!m.expandedType){m._hideSummariesDelayed()}})},add:function(b,a,f,c){if($.isPlainObject(f)){c=f;f=undefined}else{c|={}}var d={type:b,message:a,scope:c.scope,detailedInfo:c.detailedInfo?c.detailedInfo:null,permanent:Boolean(c.permanent),stopBuggingCallBack:c.stopBuggingCallBack,noCloseButton:c.noCloseButton,duration:c.duration};if(d.stopBuggingCallBack!=undefined){m.removeAll(b,d.scope)}if($.inArray(b,this.config.alertTypes)>-1){this.alerts.push(d);this._drawAlerts()}else{this._stopSummaries();this.messages.push($.extend(d,{info:f||c.info}));if(this.summaries.hasOwnProperty(b)){this.summaries[b].count++}else{this.summaries[b]={count:1}}this._updateTotal();this._drawMessages();this._drawSummaries()}},remove:function(a){if(!a.removed){if(this.currentMessage&&this.currentMessage===a){this._stopMessages()}this._stopMessageExpiration(a);var c=$.inArray(a.type,m.config.alertTypes)>-1;if(c){this.alerts.splice($.inArray(a,this.alerts),1)}else{this.messages.splice($.inArray(a,this.messages),1);this.summaries[a.type].count--}this._updateTotal();a.removed=true;if(a.element.is(":visible")){a.element.fadeOut(this.config.fadeOutDuration,function(){a.element.remove();if(c){if(m.alerts.length==0){m._continueInterrupted()}}else{if(!m.expandedType){m._drawNextCollapsed()}}});if(this.alerts.length>0){m._drawAlerts()}}else{a.element.remove()}if(!c){if(this.expandedType&&this.alerts.length==0){var b=this._pageOfType(this.expandedType,this.currentPage);$(b).map(function(){return this.element}).not(":visible").fadeIn(this.config.fadeInDuration);this._drawMessages()}this._drawSummaries();if(this.expandedType&&this.summaries[this.expandedType].count==0){this.expandedType=null;this._hideSummariesDelayed()}}}},removeAll:function(h,i){if(i&&!$.isArray(i)){i=[i]}var b;if(h){b=[$.inArray(h,this.config.alertTypes)>-1?this.alerts:this.messages]}else{b=[this.messages,this.alerts]}for(var a=0;a<b.length;a++){var f=b[a];for(var c=f.length-1;c>=0;c--){var d=f[c];if(!i||$.inArray(d.scope,i)>-1){this.remove(d)}}}},expand:function(a){if(this.alerts.length==0){this._stopMessages();this._stopSummaries();if(this.expandedType){this.collapse(function(){m.expand(a)})}else{this.expandedType=a;this.currentPage=0;if(this.currentMessage){function b(){m.currentMessage=null;window.setTimeout(function(){m._showMessages(a)},10)}if(this.currentMessage.element.data("stopped")){this.currentMessage.element.queue(b)}else{this.currentMessage.element.fadeOut(this.config.fadeOutDuration,b)}}else{this._showMessages(a)}}}},_showMessages:function(h,f,a,c){if(!f){this._drawPager();var b=this._pageCount();c=b>1?-1*$("#notifications .pager").outerHeight(true):0;if(this.currentPage>=b){this.currentPage=b-1}f=this._pageOfType(h,this.currentPage);a=0}var d=f[a];this._drawMessage(d,c);c-=d.element.outerHeight();this.messageTimeout=new Timeout(this.config.expandMessageDelay,function(){if(a<f.length-1){m._showMessages(h,f,a+1,c)}})},_pageOfType:function(d,j){var h=[];var f=j*this.config.pageSize;var b=f+this.config.pageSize-1;if(!d||d=="total"){var c=this.messages.length-b-1;h=this.messages.slice(Math.max(c,0),c+this.config.pageSize)}else{var a=0;for(var t=this.messages.length-1;t>=0;t--){var i=this.messages[t];if(i.type==d){if(a>=f){h.unshift(i)}if(a==b){break}a++}}}return h},collapse:function(a){this._stopMessages();this.expandedType=null;this._hideMessages(a);this._hideSummariesDelayed()},_hideMessages:function(d,f,a){if(a===undefined&&typeof f=="boolean"){a=f;f=undefined}if(!f){f=this._prevVisible()}var c=$(f.element);var b=m._prevVisible(f);if(!b&&!a){c=c.add("#notifications .pager")}$.when(c.fadeOut(this.config.fadeOutDuration)).then(function(){if(f.expanded){m._toggleInfo(f)}if(!b&&d){f.element.queue(function(){f.element.dequeue();d.call(m)})}});if(b){this.messageTimeout=new Timeout(this.config.expandMessageDelay,function(){m._hideMessages(d,b,a)})}},_prevVisible:function(a){var f;var b=a?$.inArray(a,this.messages):this.messages.length;for(var c=b-1;c>=0;c--){var d=this.messages[c];if(d.element&&d.element.is(":visible")){f=d;break}}return f},_drawMessages:function(){if(this.alerts.length==0){if(this.expandedType){this._drawExpanded()}else{this._drawCollapsed()}}},_drawExpanded:function(j,b){var d;if(b){d={idx:0,next:function(){return this.idx<m.alerts.length?m.alerts[this.idx++]:null}}}else{d={page:this._pageOfType(this.expandedType,this.currentPage),idx:0,next:function(){return this.idx<this.page.length?this.page[this.idx++]:null}}}var t=0;var a=j||0;this._drawPager();if(this._pageCount()>1){a-=$("#notifications .pager").outerHeight(true)}var i,c;while((t<this.config.pageSize)&&(i=d.next())){if(!c){c=i}if(!i.removed){if(i.shown){var f=a-i.element.outerHeight();var h=i.element.is(":visible");if(f!=i.element.position().top){if(h){i.element.animate({top:f},this.config.moveDuration)}else{i.element.css({top:f}).fadeIn(this.config.fadeInDuration)}}else{if(!h){i.element.fadeIn(this.config.fadeInDuration)}}a=f}else{this._drawMessage(i,a);if(b&&!i.permanent){i.timeout=new r.Timeout(i.duration||this.config.alertDisplayDuration,(function(s){return function(){m.remove(s)}})(i))}a-=i.element.outerHeight()}}t++}if(!b){i=c;while(i=this._prevVisible(i)){i.element.fadeOut(this.config.fadeOutDuration)}}},_drawCollapsed:function(){if(!this.currentMessage&&(!this.messageTimeout||this.messageTimeout.complete())){for(var b=0,c=this.messages.length;b<c;b++){var a=this.messages[b];if(!a.removed&&!a.shown){this.currentMessage=a;break}}if(this.currentMessage){this._drawMessage(this.currentMessage,0);this.messageTimeout=new Timeout(this.currentMessage.duration||this.config.displayDuration,function(){m._drawNextCollapsed()})}else{this._hideSummariesDelayed()}}},_drawNextCollapsed:function(){if(this.currentMessage&&this.currentMessage.element&&!this.interrupted){if(this.currentMessage.element.is(":visible")){this.currentMessage.element.fadeOut(this.config.fadeOutDuration,function(){var a=m.currentMessage;m.currentMessage=null;if(!a||!a.element||!a.element.data("stopped")){m._drawCollapsed()}})}else{m.currentMessage=null;m._drawCollapsed()}}},_drawAlerts:function(){var b=0;var a=this._expandedMessage();if(a){b=-1*a.element.outerHeight();if(a.element.position().top!=b){a.element.animate({top:b+"px"},this.config.moveDuration)}}this._interrupt(function(){m._drawExpanded(b,true)})},_drawMessage:function(a,c){var b=$("#notifications .messages ul");if(!a.element){a.element=$("#tmplNotification").tmpl({type:a.type,text:typeof a.message=="string"?a.message:$(a.message).html(),info:typeof a.info=="string"?a.info:$(a.info).html(),stopBugging:false,noCloseButton:a.noCloseButton}).addClass("collapsed").click((function(d){if($.inArray(d.type,m.config.alertTypes)==-1){return function(f){m._toggleInfo(d)}}else{return function(){}}})(a)).prependTo(b);a.element.find(".close").click((function(d){return function(f){m.remove(d)}})(a));a.element.find("input[type=submit], input[type=button], button").click((function(d){return function(f){fluid.main.fire("upgradepromptclicked",d);m.remove(d)}})(a))}else{a.element.show()}fluid.main.fire("promptdisplayed",a);a.element.stop(true,true).dequeue().css({width:a.element.closest("div").width()-a.element.outerWidth()+a.element.width()}).css({top:c-a.element.outerHeight()}).hide().fadeIn(this.config.fadeInDuration);a.shown=true},_pageCount:function(){return this.expandedType?Math.ceil(this.summaries[this.expandedType].count/this.config.pageSize):1},_drawPager:function(){var a=$("#notifications .pager");var b=a.find(".pager-page");var f=this._pageCount();if(b.size()!=f){a.empty();for(var c=0;c<f;c++){var d=$("#tmplNotificationPage").tmpl({}).click((function(h){return function(){m._toPage(h)}})(c)).appendTo(a);if(c==this.currentPage){d.addClass("active")}}}else{b.filter(".active").removeClass("active");b.eq(this.currentPage).addClass("active")}if(f>1){a.fadeIn(this.config.fadeInDuration)}else{a.fadeOut(this.config.fadeOutDuration)}},_toPage:function(a){this._hideMessages(function(){this.currentPage=a;this._showMessages(this.expandedType)},true)},_updateTotal:function(){this.summaries.total.count=0;for(var a in this.summaries){if(a!="total"){this.summaries.total.count+=this.summaries[a].count}}},_drawSummaries:function(){var h=$("#notifications .summaries ul");var f=0;var d=this.config.summaryOrientation!="vertical";for(var i in this.summaries){var j=this.summaries[i];if(j.element){if(j.count>0){j.element.children(".summary").text(j.count.toString());var c=j.element.is(":visible");var b=j.element.position();if(f!=(d?b.left:b.top)){var a=d?{left:f}:{top:f};if(!c){j.element.css({opacity:0.001}).show();a.opacity=1}j.element.animate(a,this.config.moveDuration)}else{if(!c){j.element.fadeIn(this.config.fadeInDuration)}}if(i=="total"&&j.element.hasClass("totalHidden")){j.element.switchClass("totalHidden","",this.config.fadeInDuration)}}else{j.element.fadeOut(this.config.fadeOutDuration)}}else{if(j.count>0){j.element=$("#tmplNotificationSummary").tmpl({type:i,text:j.count.toString()}).css(d?{left:f}:{top:f}).click((function(u,v){return function(s){if(v=="total"&&u.element.hasClass("totalHidden")){m._showSummaries()}else{if(m.expandedType==v){m.collapse()}else{m.expand(v)}}}})(j,i)).hide().appendTo(h).fadeIn(this.config.fadeInDuration)}}if(j.count>0&&j.element){f+=d?j.element.outerWidth():j.element.outerHeight()}}},_toggleInfo:function(d){this._stopMessages();var i=d.element.find(".message .content");var h;if(this.expandedType&&!this.interrupted){var f=this._pageOfType(this.expandedType,this.currentPage);h=$(f).map(function(){return this.element[0]}).not(d.element)}if(d.expanded){if(d.element.is(":visible")){if(h){h.fadeIn(this.config.fadeInDuration)}var b=d.element.outerHeight()-i.height();i.animate({height:d.height},{duration:this.config.closeDuration,complete:function(){m._hideInfo(d);if(!m.expandedType){m._drawNextCollapsed()}}});d.element.animate({top:this.alerts.length>0?-1*(d.height+b):d.top},this.config.closeDuration)}else{m._hideInfo(d)}d.expanded=false;m._startMessageExpiration(d)}else{if(h){h.fadeOut(this.config.fadeOutDuration)}d.top=d.element.position().top;d.height=i.height();d.element.removeClass("collapsed").addClass("expanded");i.find(".info").show();var c=-1*d.element.outerHeight();if(this._pageCount()>0){c-=$("#notifications .pager").outerHeight(true)}if(c<d.top){d.element.animate({top:c},this.config.openDuration)}var a=i.height();i.css({height:d.height+"px"}).animate({height:a},this.config.openDuration);d.expanded=true}if(this.alerts.length>0){d.element.fadeOut(this.config.fadeOutDuration);this._drawAlerts()}},_interrupt:function(d){var a=this.interrupted;if(!a){this.interrupted=true;if(this.messageTimeout&&!this.messageTimeout.complete()&&!this.messageTimeout.paused()){this.messageTimeout.pause();for(var b=0,c=this.messages.length;b<c;b++){var f=this.messages[b];if(f.expirationTimeout){f.expirationTimeout.pause()}}}if(this.expandedType){a=Boolean(this._expandedMessage());if(!a){this._hideMessages(function(){d.call()})}}else{if(this.currentMessage&&!this.currentMessage.expanded&&!this.currentMessage.removed){this.currentMessage.element.fadeOut(this.config.fadeOutDuration,function(){d.call()})}else{a=true}}}if(a){d.call()}},_continueInterrupted:function(){var a=true;this.interrupted=false;if(this.messageTimeout&&!this.messageTimeout.complete()&&this.messageTimeout.paused()){if(this.messageTimeout.timeRemaining()>=this.config.alertResumeThreshold){this.messageTimeout.resume()}else{this.messageTimeout.exec();a=false}}for(var b=0,c=this.messages.length;b<c;b++){var d=this.messages[b];if(d.expirationTimeout&&d.expirationTimeout.paused()){d.expirationTimeout.resume()}}if(this.expandedType){if(!this._expandedMessage()){this._showMessages(this.expandedType)}}else{if(this.currentMessage&&a){if(this.currentMessage.removed){this._drawNextCollapsed()}else{this.currentMessage.element.fadeIn(this.config.fadeInDuration)}}}},_startMessageExpiration:function(a){this._stopMessageExpiration(a);a.expirationTimeout=new Timeout(this.config.messageExpiration,function(){a.element.addClass("expired")})},_stopMessageExpiration:function(a){if(a.expirationTimeout){a.expirationTimeout.stop();a.expirationTimeout=null}},_hideInfo:function(a){var b=a.element.find(".message .content");b.find(".info").hide();b.css({height:""});a.element.removeClass("expanded").addClass("collapsed")},_expandedMessage:function(){var a;for(var b=0,c=this.messages.length;b<c;b++){var d=this.messages[b];if(d.expanded&&!d.removed){a=d;break}}return a},_stopMessages:function(){if(this.messageTimeout&&!this.messageTimeout.complete()){this.messageTimeout.stop()}else{if(this.currentMessage&&this.currentMessage.element&&this.currentMessage.element.is(":animated")){this.currentMessage.element.data("stopped",true)}}},_showSummaries:function(){this._stopSummaries();for(var a in this.summaries){var b=this.summaries[a];if(b.element){if(a=="total"){b.element.switchClass("totalHidden","",this.config.summaryFadeInDuration)}else{if(b.count>0){b.element.fadeIn(this.config.summaryFadeInDuration)}}}}},_hideSummaries:function(){this._stopSummaries();var a=$("#notifications > .summaries");a.find("li.total").switchClass("visible","totalHidden",this.config.fadeOutDuration);a.find("li").filter(":not(.total)").fadeOut(this.config.fadeOutDuration)},_hideSummariesDelayed:function(){this._stopSummaries();this.summaryTimeout=new Timeout(this.config.summaryShowDuration,function(){m._hideSummaries();m.summaryTimeout=null})},_stopSummaries:function(){if(this.summaryTimeout){this.summaryTimeout.stop();this.summaryTimeout=null}}};fluid.main.on("editor.afterLogout connectionProblemOff",function(){m.removeAll()});fluid.main.on("dbStorage.failed",function(){});function p(d,a,c,b){m.removeAll();m.add("alert",d,{permanent:true,noCloseButton:true});$("#lock-overlay").show();fluid.main.fire("updateCountdown",a);$(".inlineLink.overlayActionButton").on("click",c);if(b){$(".inlineLink.secondaryActionButton").on("click",b)}$(".closeButton").hide()}function o(){$(".inlineLink.secondaryActionButton").off("click");$(".inlineLink.overlayActionButton").off("click");m.removeAll();$("#lock-overlay").hide();if(m.countdown){clearTimeout(m.countdown);m.countdown=null}}fluid.main.on("outOfDatePromptNeeded",function(){p('This tab is out of date. Please refresh to start working from here. <span class="inlineLink overlayActionButton">Refresh</span>',false,function(){if(fluid.main.project){fluid.main.project.synced=true}location.reload()})});fluid.main.on("logInAgainPromptNeeded",function(){p('This session has timed out. Please sign in again to continue. <span class="inlineLink overlayActionButton">Sign In</span>',false,function(){if(fluid.main.project){fluid.main.project.synced=true}location.reload()})});fluid.main.on("newVersionPromptNeeded",function(){p('Hi, we just released a newer version of Fluid UI. <br>Your work is saved, please refresh to update to a better Fluid UI.  <span class="inlineLink overlayActionButton">Refresh</span>',false,function(){if(fluid.main.project){fluid.main.project.synced=true}location.reload()})});fluid.main.on("setMasterPromptNeeded",function(c,d,a){if(fluid.main.account.get("loggedIn")==="no"||$(".setMasterSessionBtn").length){return}var b='A newer session has been found. Only one session for an account can be open at a time.  <span class="inlineLink overlayActionButton setMasterSessionBtn">Work from here</span>';if(d){b='A newer version of this project has been found. <span class="inlineLink overlayActionButton">Update project</span>'}if(!fluid.main.project){d=false;b='A newer session has been found. Only one session for an account can be open at a time.  <span class="inlineLink overlayActionButton setMasterSessionBtn">Work from here</span>'}p(b,false,a)});fluid.main.on("hideLock",function(){o()});fluid.main.on("connectionProblem",function(c,a){var b='Connection lost. <span style="display: none;" id="reconnectingText">Reconnecting...</span> <span id="countdownText">Attempting to reconnect in <span id="countdown">'+a.nextCheckIn+'</span> seconds<span class="inlineLink overlayActionButton">Try again</span></span>';p(b,a.nextCheckIn,_.debounce(function(){if(m.countdown){clearTimeout(m.countdown);m.countdown=null}$("#countdownText").hide();$("#reconnectingText").show();fluid.main.fire("serverStatus:forceCheck")},300,true))});fluid.main.on("connectionProblemOff",function(){o()});fluid.main.on("updateCountdown",function(b,a){if(!a){return}$("#countdown").text(a);if(m.countdown){clearTimeout(m.countdown)}m.countdown=setTimeout(function(){a=a-1;if(a===0){$("#countdownText").hide();$("#reconnectingText").show();fluid.main.fire("serverStatus:forceCheck")}else{fluid.main.fire("updateCountdown",a)}},1000)});fluid.main.on("startCountdown",function(){$("#countdownText").show();$("#reconnectingText").hide()});fluid.main.on("unrecoverableDbFail",function(){var a="We're really sorry, but Fluid UI was unable to load due to an error in Firefox. Please try Fluid UI in normal (non-private) mode or in Chrome.";var b="We're really sorry, but Fluid UI was unable to load due to an error in Chrome. Please close all windows and restart Chrome to continue.";var f="We're really sorry, but Fluid UI was unable to load due to an error in Safari. Please close all windows and restart Safari to continue.";var c="We're really sorry, but Fluid UI was unable to load due to an error. Please close all windows and restart your Browser to continue.";var d;switch(n.browser){case"Chrome":d=b;break;case"Firefox":d=a;break;case"Safari":d=f;break;default:d=c;break}p(d,null,$.noop)});fluid.main.on("showNotificationAboutConnectionLost",function(){var a='Connection lost. Please refresh to continue. <span class="inlineLink overlayActionButton">Refresh</span></span>';p(a,null,location.reload.bind(location))});fluid.main.on("showNotificationAboutUpdatingProject",function(){m.removeAll();m.add("alert","Updating your project...",{permanent:true,noCloseButton:true})});fluid.main.on("addNotification",function(c,a,f,d,b){m.add(a,f,d,b)});fluid.main.on("notification:removeAll",function(b,a){m.removeAll(a)});q.exports=m},{"./browserdetect":24,"./functions":91}],34:[function(r,t,q){var o=r("./class-storage");var p=r("./class-widget");var m=r("./class-group");var l=r("./functions");var s=r("./utils-editor");r("./class-wdgRenderer");var n={frame:null,frameVisible:false,menu:null,displayingMenu:false,resizeAfterOrient:function(){var c=$(this);var b=c.attr("id");var a=[n.get(b,"width"),n.get(b,"height")];c.css({width:a[0],height:a[1]});c.find(".page").css({width:a[0],height:a[1]});c.find(".page").children(".widgetHolder").css({width:a[0],height:a[1]});if(fluid.zoom.isEditMode()&&c.hasClass("active")){if($("#"+b).hasClass("active")){n.drawDetailed(b,"init")}}else{n.draw(b,"init")}fluid.main.fire("afterpageorientationchange",c)},updateOptionsMenu:function(){function f(){var u=$("#startPageSwitch");u.removeClass("sg-toggleButtonChanged").removeClass("isStartPage");if(J=="homePageOff"){u.addClass("sg-toggleButtonChanged")}else{u.addClass("isStartPage")}}function c(){var u=$("#pageOrientationSwitcher");u.removeClass("sg-toggleButtonChanged");if(j=="Portrait"){u.addClass("sg-toggleButtonChanged");u.attr("data-for","Landscape")}else{u.attr("data-for","Portrait")}}var k=$("#canvasPages > .screen.active").first().attr("id");if(typeof k==="undefined"){return}var G=fluid.main.project.get("pageWH");var i=fluid.main.project.get("homepage");var j=n.get(k,"orientation");var I=fluid.main.project.get("orientation");var H=$("#pageMenu");var J=i==k?"homePageOn":"homePageOff";var E=n.get(k,"name");var F=fluid.main.account.get("zoomMode");E=E==undefined?"":E;f();H.find(".pageSize.rangeWidget.width>input").val(n.get(k,"width"));H.find(".pageSize.rangeWidget.height>input").val(n.get(k,"height"));H.find(".orientationSelector2").find("[value='"+I+"']").attr("selected","selected");c();$(".inputPageTitle").val(E);$("#smartCamToggle").attr("data-for",F);var D=fluid.main.project.get("deviceModel");var b=$("#DeviceSizeTmpl");var a=$("#deviceModelTemplate");if(D){$("option[data-type='"+D+"']",b).attr("selected","selected");$("option[data-type='"+D+"']",a).attr("selected","selected")}else{var d=fluid.main.project.get("pageWH");var h=false;$.each(b.children(),function(z,u){if($(u).val()!="Custom"){var w=$(u).val().split(",");if(((d[0]==w[0])&&(d[1]==w[1]))||((d[0]==w[1])&&(d[1]==w[0]))){$(u).attr("selected","selected");var v=$(u).attr("data-type");$("option[data-type='"+v+"']",a).attr("selected","selected");h=true;return false}}});if(!h){$("option[data-type='Custom']",b).attr("selected","selected");$("option[data-type='Custom']",a).attr("selected","selected")}}l.updateTLWH();fluid.main.fire("afteroptionsmenuupdated")},click:function(c){if($(c.target).parents(".pageWidget").length){return}m.deselect();if(!fluid.zoom.isZoomingNow()&&c.target.tagName!=="TEXTAREA"){var a=$(this).closest(".screen").attr("id");if(!a){a=$(this).closest(".scaled-screen").attr("id").split("-")[1]}var b=c.originalEvent&&$(c.originalEvent.target);if(b&&(b.hasClass("track")||b.hasClass("thumb"))){return}if(fluid.zoom.getCtx()==="project"||a!==$(".screen.active").attr("id")){fluid.zoom.zoomToPage({pageId:a,clientX:c.clientX,clientY:c.clientY,shiftKey:c.shiftKey||c.ctrlKey})}fluid.main.fire("bin:show")}},makeHome:function(a){var b=$("#scaled-"+a.newHomepage);if(b.hasClass("template")){return}n.updateOptionsMenu();$(".scaled-screen").removeClass("homePage");b.addClass("homePage")},removeHome:function(b,a){if(a){$("#scaled-"+a+".scaled-screen").addClass("homePage")}n.updateOptionsMenu()},hideOptionsMenu:function(d){n.pageMenuClick();$("#snapSettingsPanel, #pageAddNote, #pageMenu").removeClass("showing").parent().removeClass("showing");var a=$("#smartCamToggle").attr("data-for");var c=$(".screen.active");if(a!==undefined&&c.length&&a!==fluid.main.account.get("zoomMode")){fluid.main.account.set({zoomMode:a});fluid.zoom.zoomToPageDebounced({pageId:c.attr("id"),forceZoom:true})}var b=parseInt($("#zoomToInput").val(),10);if(b&&c.length&&b!==fluid.main.account.get("zoomTo")){fluid.main.account.set({zoomTo:b});fluid.zoom.zoomToPageDebounced({pageId:c.attr("id"),forceZoom:true})}},toggleOptionsMenu:function(a){var b=$("#pageMenu"),c;var c=b.hasClass("showing");if(!b){return}n.pageMenuClick();n.updateOptionsMenu();n.toggleMenus();if(!c){b.addClass("showing").parent().addClass("showing")}},updateSettingsMenu:function(){var c=fluid.zoom.getActivePageId();var i=fluid.main.project.get("pageWH");var h=n.get(c,"orientation");var f=fluid.main.project.get("orientation");var a=fluid.main.project.get("deviceModel");var b=$('#deviceModelTemplate option[device-type="'+a+'"]');if(b.size()==0){b=$("#deviceModelTemplate option[device-type=Custom]")}b.prop("selected",true);var d=$("#deviceSettingsMenu").find(".buttonSwitchContainer");d.children().removeClass("activeOption");d.find("[data-for='"+f+"']").addClass("activeOption")},toggleSnapSettings:function(){var b=$("#snapSettingsPanel");var a=b.hasClass("showing");if(a){n.hideOptionsMenu()}else{n.showDefaultSnapOptions()}},showDefaultSnapOptions:function(){function d(){var h=$("#mouseZoomSwitch");h.removeClass("sg-toggleButtonChanged");if(b=="ScrollOff"){h.addClass("sg-toggleButtonChanged");h.attr("data-for","ScrollOff")}else{h.attr("data-for","ScrollOn")}}function f(){$("#snapSwitch").removeClass("sg-toggleButtonChanged");if(fluid.main.account.get("snapToWidget")=="off"){$("#snapSwitch").addClass("sg-toggleButtonChanged")}}n.pageMenuClick();n.toggleMenus();$("#snapSettingsPanel").addClass("showing").parent().addClass("showing");fluid.main.fire("updateGridMenu");f();var a=fluid.main.account.get("zoomMode");var b=fluid.main.account.get("zoomScroll");if(!a||a==="Smart"){$("#smartCamToggle").removeClass("sg-toggleButtonChanged")}else{$("#smartCamToggle").addClass("sg-toggleButtonChanged")}var c=parseInt(fluid.main.account.get("zoomTo"),10);if(!c){c="100"}$("#zoomToInput").val(c+"%");d()},onRangeWidgetTemporaryChange:function(a,h){var c=fluid.zoom.getActivePageId();var b=fluid.main.project.get("pageWH");if(a==="pageWidthInput"){a="width";if(h<b[0]){h=b[0]}}if(a==="pageHeightInput"){a="height";if(h<b[1]){h=b[1]}}var d={};d[a]=h;var f="#page_"+c;$(f+", #"+c+", "+f+" > .widgetHolder, "+f+" .backgroundWidget").css(d)},resize:function(d,f,a){var b=fluid.main.project.get("pageWH");var h=fluid.main.project.get("orientation");var i=n.get(d,"orientation");if(i!=h){b=[b[1],b[0]]}if((f<b[0])||(isNaN(f))){f=b[0]}else{if(f>b[0]){$(".pageSize").filter(".width").val(f)}}if((a<b[1])||(isNaN(a))){a=b[1]}else{if(a<b[1]){$(".pageSize").filter(".height").val(a)}}var c=$("#"+d+" .page");c.parent(".screen").css({width:f,height:a});c.css({width:f,height:a});c.children(".widgetHolder").css({width:f,height:a});n.autoWidth(c.parent(".screen"));fluid.main.fire("showGrid");fluid.main.fire("pageresized",c);return false},get:function(b,c){if(typeof b!="string"){return""}var a=o.get(b);if(typeof a==="undefined"||!a){return""}return a[c]},updateDragPos:function(b){var a=$(b);var j=fluid.zoom.getCurrentScale();var d=a.attr("id").indexOf("scaled-")!==-1;var f=d?a.attr("id").split("-")[1]:a.attr("id");if(!a.data().draggable){return}var k=d?a.data().draggable.position.top:Math.round(a.data().draggable.position.top/j);var h=d?a.data().draggable.position.left:Math.round(a.data().draggable.position.left/j);a.data().draggable.position.top=k;a.data().draggable.position.left=h;var i=fluid.main.project.get(f,{returnModel:true});var c=i.getBox();c[0]=h/fluid.zoom.getCurrentScale();c[1]=k/fluid.zoom.getCurrentScale();i.set({box:c},{silent:true});fluid.main.fire("pagedragged",a);if(l.intersectTrash(a)==true){$("#trash").addClass("droppableStyle")}else{$("#trash").removeClass("droppableStyle")}},dragStart:function(a){if(fluid.main.project.isReadOnly()||fluid.zoom.isZoomingNow()){return false}if(fluid.zoom.isEditMode()){$("#canvasLinks").hide()}fluid.main.fire("closeallpopups",a)},drag:function(){n.updateDragPos(this)},dragStop:function(D){var a=$(this);var A=a.position();var b=a.attr("id").indexOf("scaled-")!==-1;var c=b?a.attr("id").split("-")[1]:a.attr("id");var f=$("#scaled-"+c);var B=o.get(c);var C=fluid.main.project.toJSON();var d=C.canvasWidth-B.width;var h=C.canvasHeight-B.height;var k=fluid.zoom.getCurrentScale();var i=Math.min(Math.max(Math.round(A.left/k),0),d);var j=Math.min(Math.max(Math.round(A.top/k),0),h);fluid.command.create("move",{id:c,x:i,y:j}).dispatchTo("fluid.controllers.page");a.appendTo(a.parent("#canvasPages"));f.appendTo(f.parent("#zoomedOutPages"));fluid.zoom.updatePagesBounding();if(fluid.zoom.getCtx()==="page"){fluid.zoom.zoomToPage(c)}if(A.top<0){a.css({top:0})}else{if(A.top/k>h){a.css({top:(C.canvasHeight-B.height)*k})}}if(A.left<0){a.css({left:0})}else{if(A.left/k>d){a.css({left:(C.canvasWidth-B.width)*k})}}fluid.main.fire("afterpagedragged",c)},selectStart:function(a){if(fluid.main.project.isReadOnly()){a.preventDefault();a.stopPropagation();return false}},selectStop:function(a){var b=document.querySelectorAll("#canvasPages .ui-selected");fluid.main.fire("dragselection",{selected:b});if(fluid.selection.getSelectionModel().models.length){fluid.zoom.onSelectionChangedDebounced(a,null,{sourceEvt:"dragselection"})}},updatePageName:function(){fluid.command.create("setName",{pageId:$(this).parents(".screen").attr("id"),name:$(this).val()}).dispatchTo("fluid.controllers.page")},template:function(a){var i=$("#tmplPage").tmpl(a).appendTo("#canvasPages");var c=fluid.zoom.getCurrentScale();if(a.id===fluid.main.project.get("homepage")){i.addClass("homePage")}var d="",f=fluid.main.project.threads.getByPageId(a.id).length;if(f){d=" commented"}c=fluid.zoom.getAllPagesParams().newScale;var h=$('<div id="scaled-'+a.id+'" class="scaled-screen'+d+'" data-commentsCount="'+f+'"></div>').appendTo($("#zoomedOutPages")).css({top:a.y*c,left:a.x*c,width:a.width*c,height:a.height*c});var b=$('<div class="scaled-screen-title"></div>').text(n.get(a.id,"name"));if(fluid.main.project.get("showPageNames")==="yes"){b.addClass("shown")}b.appendTo(h)},updatePagePreviewButton:function(){var c=$("#pagePreview"),d=fluid.zoom.getCurrentScale(),a=$(".canvasObject.active").attr("id"),b=o.get(a).width*d;pageButtonsWidth=243;if(a&&o.get(a).widgets.length===0){c.parent().hide()}else{c.parent().show()}},toggleMenus:function(){n.hideOptionsMenu();$("#pageMenus").show()},activate:function(i,a,c,h){var b;if(typeof(i)==="string"){b=i;i=$("#"+i)[0]}else{if($(i).hasClass("scaled-screen")){b=$(i).attr("id").split("-")[1];i=$("#"+b)[0]}else{b=$(i).attr("id");i=$("#"+b)[0]}}n.deactivate({activatingId:b});fluid.main.fire("activatingPage",b);if(fluid.zoom.getCtx()==="project"){return}$("#canvasPages .screen.active").not($(i)).add(h).removeClass("active").each(function(){var j=$(this).attr("id");n.draw(j,"init")});$(i).addClass("active");var f=document.querySelector("#canvasPages .active");if(fluid.main.project&&!fluid.main.project.isReadOnly()&&f){n.attachFrameTo(f)}n.updateOptionsMenu();var d=a==undefined?true:a;n.displayMenu(d);if($(i).find(".page-preview").length){n.drawDetailed($(i).attr("id"),"init")}if(c==="wdgDrag"){p.afterSelectionChange()}m.drawExisting(b);fluid.main.fire("pageactivated",b)},deactivate:function(b){var c=$("#canvasPages .screen.active");p._stopEditingText();$("#multiSelBox").remove();var a=[];c.each(function(){if(!b||!b.activatingId||$(this).attr("id")!==b.activatingId){$(this).removeClass("active");if($(this).selectable){$(this).selectable("destroy").removeData("initSelectable")}if($(this).draggable){$(this).draggable("destroy").removeData("initDraggable")}var d=$(this).attr("id");a.push(d);var f=fluid.main.project.pages.get(d);if(f){if(f.attributes.imgData){n.draw(d,"useCache")}else{n.draw(d,"init")}}$(this).find(".comment-annotation.new").remove()}});n.detachFrame();p.resetCache();fluid.main.fire("pageDeactivated",a)},detachFrame:function(){if(n.frameVisible){n.frame.parentNode.removeChild(n.frame);if(n.menu&&n.menu.parentNode){n.menu.parentNode.removeChild(n.menu);$(n.menu).appendTo(document.body)}n.frameVisible=n.displayingMenu=false;n.frame.style.display="none"}},attachFrameTo:function(a){n.frame=n.frame||document.getElementById("pageFrame");n.menu=n.menu||document.getElementById("pageMenus");n.frame.style.display="none";if(n.menu){a.appendChild(n.menu)}a.querySelector(".page").appendChild(n.frame);n.adjustPageFrameScale(a);n.frameVisible=n.displayingMenu=true;n.updatePagePreviewButton()},adjustPageFrameScale:function(h){if(!n.frame){return}var d=fluid.zoom.getCurrentScale();var b=$(n.frame).closest(".screen").attr("id");if(!b&&h&&h.id){var a=$(h).find(".page");a.append(n.frame);b=h.id}if(!b){return}n.applyPageFrameScale(d,b);var f=$("#pageMenu").add("#snapSettingsPanel");f.show();$("#"+n.focusedInputId).focus().select();$(n.frame).fadeIn(250);var c=$("[data-component-id=commentsDropdown]").attr("data-current");$(h).find(".commentsHolder").css({transform:"scale("+(1/d)+")"}).removeClass("resolved").removeClass("unresolved");if(c!=="all"){$(h).find(".commentsHolder").addClass(c)}},applyPageFrameScale:function(j,f,b){var c=o.get(f);var w=c.width*j;var k=243;var z=41;var d=50/j;var i=50;n.updatePagePreviewButton();var h=0;$("#pageSettingsMenu li").each(function(){if($(this).css("display")!=="none"){h++}});k=z*h;var a=["#pageSettingsMenuContainer",".pageBackground",".pageDragHandle",n.frame,"#pageMenus"];if(b){a.forEach(function(v){var u=$(v);u.css("transition","all "+b+"ms ease-out");setTimeout(function(){u.css("transition","")},b+1)})}$("#pageSettingsMenuContainer").width(k+z);if(w<k){i=i+(k-w)/4;d=((w+2*i-k)/2+1)/j}else{if(c.widgets.length){$("#pageSettingsMenu li").show()}else{$("#pageSettingsMenu li > a:not(#pagePreview)").parent().show()}}$(".pageBackground").css({"border-radius":(6/j)+"px"});$(".pageDragHandle").css({height:26/j,"border-bottom-width":1/j+"px","border-radius":(6/j)+"px "+(6/j)+"px 0 0"});$(n.frame).css({top:((-86)/j),bottom:(-50/j),left:(-i/j),right:(-i/j)});$("#pageMenus").css({transform:"scale("+(1/j)+")","transform-origin":"left top",left:(-i/j)+"px",top:(-78/j)+"px"});$("#pageMenus").children().each(function(){$(this).css({left:(d*j)})})},displayMenu:function(a){var d=a==undefined?true:a;var c=true;if((!fluid.main.project||fluid.main.project.isReadOnly()||(fluid.zoom.getCtx()==="project"))){c=false}if(c){n.updatePagePreviewButton()}if(d&&c){function f(){if((n.displayingMenu)&&($("#pageSettingsMenuContainer").css("display")=="none")){$("#pageSettingsMenuContainer").fadeIn(300)}n.displayingMenu=false}n.displayingMenu=true;n.displayMenuTimer=setTimeout(f,200)}else{if(c){var b=fluid.selection.getSelectionModel().getRoots().getElements();if((b.length==1)&&($(".ui-selected").hasClass("backgroundWidget"))){n.displayMenu();return}}n.displayingMenu=false;$("#pageSettingsMenuContainer").stop(true,true).hide()}},drawRasterised:function(c,d,b,f){n.checkIntegrity(c);var a=n.calculateWdgPositions(c);this.renderer.afterPageRendered=d;if(!a||a.widgets===0){return}this.renderer.renderPage(a,b,f)},draw:function(i,F){if(!i){return}n.checkIntegrity(i);var C=n.calculateWdgPositions(i);if(this.renderer.renderingQueue[C.id]&&this.renderer.renderingQueue[C.id].length){return}this.renderer.afterPageRendered=null;var D=$("#"+i);if(D.length===0){fluid.main.fire("pageTemplateNeeded",_.extend({id:i},C));D=$("#"+i)}else{var j=D.find(".pageWidget");setTimeout(function(){j.remove()},650)}var h=D.find(".widgetHolder");var E="",k=fluid.main.project.threads.getByPageId(i).length;if($("#scaled-"+i).length===0){if(k){E=" commented"}$("#zoomedOutPages").append('<div id="scaled-'+i+'" class="scaled-screen'+E+'" data-commentsCount="'+k+'"></div>');var B=fluid.zoom.getAllPagesParams().newScale;$("#scaled-"+i).css({top:o.get(i).y*B,left:o.get(i).x*B,width:o.get(i).width*B,height:o.get(i).height*B})}var f=o.get(i,{returnModel:true}).get("imgData");if(F==="useCache"&&f){D.find(".page-preview, .pageWidget").remove();var b=new Image();var c=new Image();b.src=f;c.src=f;h.append(b);h.find("img").addClass("page-preview");$("#scaled-"+i+" img").remove();$("#scaled-"+i).append(c);return}if(!C){return}else{if(C.widgets.length===0){$("#scaled-"+i+" img").remove();return}}var a=this.renderer.renderPage(C);m.erase();D.find(".page-preview").remove();if(a.length){var d;if(a[0].$shapeRendition){d=a[0].$shapeRendition}else{if(a[0].$textRendition){d=a[0].$textRendition}else{if(a.length&&a[0].segments){d=a[0].segments[0].$shapeRendition}}}if(d){d.addClass("page-preview");h.append(d)}}},calculateWdgPositions:function(c){if(!this.renderer){this.renderer=new fluid.wdgRenderer()}var b=o.get(c);if(b.widgets&&b.widgets.length>0){var d={};for(var a=0;a<b.widgets.length;a++){d[b.widgets[a]]=p.get(b.widgets[a])}}b.widgets=d||[];b.id=c;this.renderer.canvasSize=[b.width,b.height];return b},drawDetailed:function(c,d,h){n.calculateWdgPositions(c);var i=$.extend({},o.get(c));if(!i){return false}var b=$();var a=$("#"+c);if(a.length===0){n.template(i,c,d)}else{b=a.find(".pageWidget")}if(i.widgets.length>0){p.load(c,i.widgets);l.updateTLWH()}var f=$("#"+c).find(".page-preview");setTimeout(function(){f.remove()},200);b.remove();if(h&&h.restoreSelection){if(!$.isArray(h.restoreSelection)){h.restoreSelection=[h.restoreSelection]}fluid.selection.onSelectionReset();fluid.selection.select(h.restoreSelection)}fluid.main.fire("page.drawDetailed",c,d,h)},updateView:function(b,a){if(!a){a={}}var c=true;if(a&&a.zoomedOutOnly){c=false}if(c&&fluid.zoom.isEditMode()&&($("#"+b).hasClass("active")||a.force===true)){n.drawDetailed(b,"init")}else{if(!fluid.zoom.isEditMode()){n.draw(b,"init")}}},enableSelectableWidgetHolder:function(b){if($(".selectArea").data("selectable")){var c=$(".selectArea").selectable("option","cancel").split(/\s*,\s*/);var a=c.indexOf(".widgetHolder");if(b||b===undefined){if(a>-1){c.splice(a,1);$(".selectArea").selectable("option","cancel",c.join(","))}}else{if(a==-1){c.push(".widgetHolder");$(".selectArea").selectable("option","cancel",c.join(","))}}}},isLinked:function(a,c){var f=fluid.main.project.links.toJSON();var b=n.get(a,"widgets");var d;for(var h=0;h<b.length;h++){d=f.linkOrigin.indexOf(b[h]);if(d!=-1){if(f.linkDest[d]==c){return f.linkCanvId[d]}}}return false},checkIntegrity:function(a){if(a){var c=n.get(a,"widgets");if(c){var b=o.get(a);$.each(c,function(f,d){if(!p.checkIntegrity(d,b)){return false}})}}},autoWidth:function(a){var f=$(a).children(".page");var c=$(a).attr("id");var v=f.children(".widgetHolder");var d=v.children(".rootWidget");for(var b=0;b<d.length;b++){var j=$(d[b]);var h=j.attr("id");var k=o.get(h);if((typeof(k.tlwh[0])==="string")||(typeof(k.tlwh[1])==="string")||(typeof(k.tlwh[2])==="string")||(typeof(k.tlwh[3])==="string")){var i=p._setTMPLVars(h,k,[0,0,f.width(),f.height()]);j.css({top:i.absTLWH[0],left:i.absTLWH[1],width:i.absTLWH[2],height:i.absTLWH[3]})}}},createNew:function(a){console.trace("deprecated")},postCreate:function(a,b){console.trace("deprecated")},navigateWithKeys:function(a){if(fluid.zoom.getCtx()==="project"||!$("#canvas").hasClass("editing")){return true}var v=a!=undefined?s.getNavigationKeyDirection(a.keyCode):"right";if(v==""){return true}var h=$(".ui-selected");if(h.size()>0){return}var f=fluid.main.project.pages.getIds();if(f<2){return}var c={distance:Number.MAX_VALUE,id:""};var d={distance:0,id:""};var b=$(".screen.active").attr("id");var j={x:n.get(b,"x"),y:n.get(b,"y")};$.each(f,function(B,C){if(b!=C){var u={x:n.get(C,"x"),y:n.get(C,"y")};var D=n._getNavigationDistanceFrom(j,u,v);if((D>=0)&&(D<c.distance)){c={distance:D,id:C}}else{if((D<0)&&(D<d.distance)){d={distance:D,id:C}}}}});var i=c.id!=""?c.id:d.id;if(i!=""){var k=$("#"+i);$(".screen").removeClass("active").filter(k).addClass("active");fluid.zoom.zoomToPage(k);n.activate(k);p.resetSelection()}},_getNavigationDistanceFrom:function(b,c,d){if(b==c){return -1}var a=0;if((d=="left")||(d=="right")){a=c.x-b.x}else{a=c.y-b.y}if(((d=="left")||(d=="top"))&&(a<0)){return Math.abs(a)}else{if(((d=="right")||(d=="bottom"))&&(a>0)){return a}}return Math.abs(a)*-1},pageMenuClick:function(){$("input","#pageMenus").blur()},renderBlurs:function(a){a=a||((a=document.querySelector(".canvasObject.active"))&&a.id);if(!a){return}n.calculateWdgPositions(a);o.get(a).widgets.forEach(function(b){var c=document.getElementById(b);if(!c){return}if(o.get(b).blur){p.blurLayers[b]=p.renderBlurLayer(b,a);p.setBlurBG(c)}})},refreshByWdgId:function(c){if(fluid.zoom.getCtx()==="project"){var a=fluid.main.project.widgets.get(c),b;if(a){b=a.getPage();if(b){n.draw(b.id)}}}},renderer:new fluid.wdgRenderer()};fluid.main.on("afterzoomaction",function(){n.hideOptionsMenu()});fluid.main.on("beforezoomout",function(b,c,a){if(!c.keepActivePage&&c.newCtx==="project"){n.deactivate()}else{if(c.newCtx==="project"){fluid.zoom.setSelectedBeforeZoomOut($("#canvasPages .ui-selected").attr("id"));n.draw(a,"init")}}n.hideOptionsMenu();if(c.newScale!==c.oldScale){n.detachFrame()}});fluid.main.on("beforeWidgetAdd",function(a,c){var b=fluid.main.project.pages.get(c);if(b&&b.get("widgets").length===0&&fluid.main.project.widgets.length===0){$("#previewView, #preview, #pagePreview, #shareMenu").removeClass("hud-hidden");$("#pagePreview").parent().show()}n.hideOptionsMenu()});fluid.main.on("homepageChanged",function(b,a){n.makeHome(a)});fluid.main.on("wdgselection librarywdgdragstart",function(){if($("#pageMenu").is(":visible")){n.hideOptionsMenu()}});fluid.main.on("widgetDropped widgetDroppedUndone",function(){n.adjustPageFrameScale($(".screen.active"))});fluid.main.on("widgetdragstart",n.hideOptionsMenu);fluid.main.on("afterzoomedtoselection",n.adjustPageFrameScale);fluid.main.on("afterzoomedonselectioreset",function(b,a){if(a.oldScale!==a.newScale){n.activate($(".screen.active").attr("id"))}else{n.displayMenu()}});fluid.main.on("widgetdragstart",function(){n.displayMenu(false)});fluid.main.on("zalignmentchange",function(b,a){if(a.renderBlurs){n.renderBlurs(a.pageId)}});fluid.main.on("page:renderBlurs",function(b,a){n.renderBlurs(a)});fluid.main.on("beforelogout",function(){n.detachFrame()});fluid.main.on("linkdragstart",function(b,a){n.calculateWdgPositions(a)});fluid.main.on("project.orientantionchanged",function(){n.updateSettingsMenu()});fluid.main.on("fluidmenutoggled beforepreviewopen beforesharetoggle libmousedown",function(){n.hideOptionsMenu()});fluid.main.on("closeallpopups",function(b,a){if(a&&a.target&&$(a.target).parents("#pageSettingsMenu").length){return}if($("#pageSettingsMenu").find(".menuMain.showing").length&&["pageMenuToggle","snapSettings","pageAddNote"].indexOf(a.target.id)===-1){n.hideOptionsMenu()}});fluid.main.on("triggerUpdateOptionsMenu",function(){n.updateOptionsMenu()});fluid.main.on("page.orientantionchanged",function(b,a){var c=$("#"+a.pageId);c.each(n.resizeAfterOrient);n.updateOptionsMenu();n.updateSettingsMenu()});fluid.main.on("pageResized",function(b,a){if($("#"+a.pageId).hasClass("active")){n.resize(a.pageId,a.newWidth,a.newHeight)}n.updateOptionsMenu();if(fluid.zoom.getCtx()==="page"){fluid.zoom.zoomToPageDebounced({pageId:a.pageId,forceZoom:true})}else{if(fluid.zoom.getCtx()==="project"){fluid.zoom.zoomToAllDebounced()}}n.updateView(a.pageId)});fluid.main.on("pageCloned",function(b,a){if(fluid.zoom.getCtx()==="project"){n.draw(a,"init")}else{n.drawDetailed(a)}});fluid.main.on("page:removeHome",n.removeHome);fluid.main.on("page:detachFrame",n.detachFrame);fluid.main.on("pageadded",function(a,c){var b=fluid.main.project.pages.get(c);if(b&&b.get("widgets").length){if(fluid.zoom.getCtx()==="project"){n.draw(c,"init")}else{n.hideOptionsMenu();n.drawDetailed(c)}}});fluid.main.on("pageRedrawNeeded",function(b,a){if(fluid.zoom.getCtx()==="project"){n.draw(a.id,"init")}else{n.drawDetailed(a.id)}});fluid.main.on("pageTemplateNeeded",function(b,a){n.template(a)});fluid.main.on("widgetremoved",function(b,a){for(var c=0;c<a.id.length;c++){if(a.id[c] in p.blurLayers){delete p.blurLayers[a.id[c]];delete p.blurOffsets[a.id[c]]}}n.renderBlurs(a.pageId);n.updateView(a.pageId)});fluid.main.on("widgetMoved",function(b,a){if(a.fromPage!==a.toPage){n.updateView(a.toPage,{force:true});n.updateView(a.fromPage);if(fluid.zoom.getCtx()!=="project"){n.activate(a.toPage)}}else{if(a.needViewUpdate){n.updateView(a.toPage)}}n.renderBlurs(a.toPage)});fluid.main.on("widgetResized widgetBgColorChanged widgetBorderColorChanged widgetColorChanged widgetOpacityChanged segmentadded",function(b,a){if(a.needViewUpdate&&a.ids){if(fluid.zoom.getCtx()==="project"||$(".screen.active").attr("id")!==a.pageId){n.draw(a.pageId)}}n.renderBlurs(a.pageId)});fluid.main.on("afterWidgetTextSet",function(b,a,d,c){$("#"+d+" .widgetText > span").text(c);n.renderBlurs(a);n.updateView(a,{zoomedOutOnly:true})});fluid.main.on("afterWidgetsAlign widgetAdded",function(b,a){n.renderBlurs(a)});fluid.main.on("widgetAdded",function(b,a){n.renderBlurs(a)});fluid.main.on("keyup",function(b,a){if($("#canvas").hasClass("editing")){n.navigateWithKeys(a)}});fluid.main.on("editor.loaded",function(){$("#zoomToInput").val(fluid.main.account.get("zoomTo")||"100%")});fluid.main.on("pageNameSet",function(b,a){n.updateOptionsMenu();$("#scaled-"+a.pageId+" .scaled-screen-title").text(a.name)});fluid.main.on("showPageNames",function(b,a){if(a){$(".scaled-screen-title").addClass("shown").removeClass("hidden")}else{$(".scaled-screen-title").removeClass("shown").addClass("hidden")}});fluid.main.on("widgetPropertyApplied",function(b,c,d,f,a){n.refreshByWdgId(a)});fluid.main.on("textAlignSet",function(b,a){n.refreshByWdgId(a.id)});fluid.main.on("rangeWidgetChange",function(b,a){n.onRangeWidgetTemporaryChange(a.id,a.value)});t.exports=n},{"./class-group":32,"./class-storage":46,"./class-wdgRenderer":48,"./class-widget":49,"./functions":91,"./utils-editor":98}],35:[function(k,j,h){var i=k("./class-event");var l={isWorking:false,lastSubmitButton:null,hideTimeOut:null,errors:{"default":"Something went wrong... Please try again!",defaultShort:"ERROR!",emailUsed:"Your new email is already being used.",passInvalid:"The password is not valid.",oldPassInvalid:"The old password is not valid.",passNotChanged:"The new password cannot be equal to the old one.",upgradeFreeWrongPass:"Your password is not valid.  Please try again.",resetNoEmail:"No account was found for that email address.",resetCantSendEmail:"Error sending email. Please try again...",resetPasswordMatch:"The two passwords you entered don't match. Please try again...",resetLinkExpired:"This link has expired (for security reasons, password recovery attempts expire after 1 hour)."},messages:{"default":"Your changes have been applied successfully.",defaultShort:"Changes applied!",resetPass:"We have sent an e-mail to your account with your password",promoCode:"The code has been applied to your account!",contact:"Thanks!  We will contact you soon!",recoverySuccess:"Success. Please check the email we just sent you to continue.",resetSuccess:"Your password has been updated successfully. You can now sign in.",projectClone:"Project Cloned Successfully",projectTransfer:"Project Teleported Successfully",projectRestore:"Project Restore Successful",projectBranding:"Project Branding Changed"},processingMessages:{"default":"Processing...",projectClone:"Cloning...",projectTransfer:"Teleporting..."},hideMessages:function(){l.hideErrors();l.hideSuccessMessage()},hideErrors:function(){clearTimeout(l.hideTimeOut);$(".messageError").fadeOut(250,l.placeMessageReset);l.enableLastButton(true)},displayError:function(b){var a=l.errors["default"];if(b!=undefined){a=l.errors[b]!=undefined?l.errors[b]:b}function c(){$(".userSettingsMessageContainer.messageError").text(a).fadeIn(250)}l.placeMessage(l.lastSubmitButton,c);l.enableLastButton(true);l.hideTimeOut=setTimeout(l.hideErrors,3000)},enableLastButton:function(d,n){if(!l.lastSubmitButton){return}var c=$(l.lastSubmitButton);if((d)||(d==undefined)){if(c.attr("data-label")!=undefined){l.changeButtonLabel(c,c.attr("data-label"))}c.removeAttr("disabled")}else{c.attr("disabled","disabled");var f=c.prop("tagName")=="INPUT"?c.val():c.text();var a=n==undefined?"default":n;var b=l.processingMessages[a]?l.processingMessages[a]:l.processingMessages["default"];c.attr("data-label",f);l.changeButtonLabel(c,b)}},isLastButtonDisabled:function(){if(l.lastSubmitButton==null){return false}var a=$(l.lastSubmitButton);return a.attr("disabled")=="disabled"},hideSuccessMessage:function(){$(".userSettingsMessageContainer.messageSuccess").fadeOut(250,l.placeMessageReset);l.setSuccessMessage()},setSuccessMessage:function(a,c){var d=$(".userSettingsMessageContainer.messageSuccess");if(!a){d.text("").fadeOut(250,l.placeMessageReset);return}var b=l.messages[a]!=undefined?l.messages[a]:a;d.text(b);if(!c.length){c=l.lastSubmitButton}l.placeMessage(c);setTimeout(l.displaySuccessMessage,400)},displaySuccessMessage:function(){clearTimeout(l.hideTimeOut);if($(".userSettingsMessageContainer.messageSuccess").text()!=""){$(".userSettingsMessageContainer.messageSuccess").fadeIn(250);l.hideTimeOut=setTimeout(l.hideSuccessMessage,3000)}else{l.hideSuccessMessage()}},placeMessage:function(a,c){if(a==undefined||a.length===0){$(".userSettingsMessageWrapper").css({top:10,left:0,height:30,width:499});return}var q=a.attr("type")=="submit"||a.hasClass("toAlert")?0:0;var f=a.offset().top+q-3;var r=a.offset().left-2;var b=a.innerHeight()+8;var s=a.innerWidth()+7;var d=a.css("padding");d=a.attr("type")=="text"?"6px":d;d=isNaN(parseInt(d,10))?"6px":parseInt(d,10)<6?"6px":d;var t=$(".userSettingsMessageWrapper");t.css({top:f,left:r,height:b,width:s});t.children().css({padding:d});if($.isFunction(c)){c()}},placeMessageReset:function(){$(".userSettingsMessageWrapper").children().hide();$(".userSettingsMessageWrapper").css({height:0,width:0})},changeButtonLabel:function(a,b){if(a.prop("tagName")=="INPUT"){a.val(b)}else{a.text(b)}},getCloseExternalWindowButtonLabel:function(){var a="Close";if(top!=self){a=window.parent.userSettings.isOpen?"Back":a}return a},display:function(d,c,a){if(l.isWorking){return}l.isWorking=true;function b(){if(d.attr("id")==="projectSettingsPanelSettings"&&fluid.main.account.get("accType")==="Free"){$("#projectSettingsSwitchActivate").addClass("locked")}else{$("#projectSettingsSwitchActivate").removeClass("locked")}d.parent().transition({width:d.innerWidth(),height:"auto",complete:function(){d.css({height:"auto"}).slideDown((c/2)+100);d.children().transition({opacity:1},c/4);l.isWorking=false;var f=$(".scrollbar",d);if(f.size()>0){l.adjustScroll(f.parent())}if($.isFunction(a)){a()}}},c*3/4)}if(d.parent().hasClass("hiding")){setTimeout(b,c*1.3)}else{setTimeout(b,100)}},hide:function(c,b,a){if(c.size()>0){c.parent().addClass("hiding");c.children().transition({opacity:0},b/4);c.parent().css({height:c.innerHeight(),width:c.innerWidth()});c.parent().delay(b/4).transition({height:0,width:0,complete:function(){c.hide();$(this).removeClass("hiding");if($.isFunction(a)){a()}}},b*3/4)}else{if($.isFunction(a)){a()}}if(window.page){page.updateSettingsMenu()}},adjustScroll:function(c){function a(){c.tinyscrollbar();setTimeout(b,300)}function b(){var d=c.data("plugin_tinyscrollbar");if(d){d.update("top")}}setTimeout(a,100)},rateEditor:function(a){var b=$(a.currentTarget);$("#experienceRating").val(b.data("exp"));$(".experienceType").removeClass("selected");b.addClass("selected")},submitFree:function(){var d=$("#submitButtonFreeUpgrade");if(d.attr("disabled")=="disabled"){return false}var f=$("#cancelReason").val().length;var b=parseInt($("#experienceRating").val());if((b!==0&&b!==1&&b!==-1)||f<1){fluid.main.fire("hidePauseBillingErrors");$("#pauseBillingSubmitError").show();return false}l.lastSubmitButton=d;d.attr("disabled","disabled").data("origVal",d.val()).val("Applying changes");var c=fluid.main.account.get("email");var a={t:"upgradeFree",accountEmail:c,rating:$("#experienceRating").val(),cancelReason:$("#cancelReason").val(),password:$("#confirmPass").val()};$.ajax({url:"upgrade.php",type:"POST",data:a,complete:l.pauseComplete,error:l.pauseError});return false},pauseComplete:function(b,p){function q(){var m="Your account was paused successfully.";i.triggerEditor("closeModalWindow",{successMsg:m},true);fluid.main.fire("deferReloadRelease")}function f(){l.display($("#upgradeError"),400)}try{var d=JSON.parse(b.responseText)}catch(a){fluid.main.fire("accountpausefail");$("#pauseBillingSystemError").show();return}if(d.r=="s"){$(".experienceType.selected").removeClass("selected");l.hide($("#userSettingsPanelPauseBilling"),400,q);fluid.main.fire("accountpausecomplete",d)}else{fluid.main.fire("accountpausefail");$("#pauseBillingPasswordError").show();var c=$("#submitButtonFreeUpgrade");c.removeAttr("disabled");c.val("Pause Billing")}},pauseError:function(b,a){userSettings.hidePauseBillingScreens();userSettings.hidePauseBillingErrors();userSettings.showPauseBillingFirstStep();$("#pauseBillingSystemError").show()}};fluid.main.on("editor.loaded",function(){l.placeMessageReset()});j.exports=l},{"./class-event":30}],36:[function(l,k,h){var i=l("./jsvat");var j={creditCardLength:{VISA:16,MC:16,AMEX:15},cvvLength:{VISA:3,MC:3,AMEX:4},diacriticsMap:[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}],replaceDiacritics:function(a){var b=j.diacriticsMap;for(var c=0,d=b.length;c<d;c++){a=a.replace(b[c].letters,b[c].base)}return a},getCreditCardType:function(a){var b={VISA:/^4[0-9]{12}(?:[0-9]{3})?$/,MC:/^5[1-5][0-9]{14}$/,AMEX:/^3[47][0-9]{13}$/,DINERS:/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/,DISCOVER:/^6(?:011|5[0-9]{2})[0-9]{12}$/,JCB:/^(?:2131|1800|35\d{3})\d{11}$/};for(var d in b){if(b.hasOwnProperty(d)){var c=b[d];if(c.test(a)){return d}}}return""},luhnCheck:function(f){if(/[^0-9-\s]+/.test(f)){return false}var b=0,c=0,n=false;f=f.replace(/\D/g,"");for(var a=f.length-1;a>=0;a--){var d=f.charAt(a),c=parseInt(d,10);if(n){if((c*=2)>9){c-=9}}b+=c;n=!n}return(b%10)==0},populateCardYears:function(a,b){var o=new Date();var d=o.getFullYear();a.append('<option selected disabled hidden value="">Year</option>');for(var c=d;c<(d+b);c++){var f=c.toString().substr(2);a.append('<option value="'+f+'">'+c+"</option>")}},isVATApplicable:function(b){var a=["DK","EE","FI","FR","DE","GR","AT","BE","BG","CY","CZ","HR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"];return $.inArray(b,a)>-1},getMoss:function(b){var a={BE:0.21,BG:0.2,CZ:0.21,DK:0.25,DE:0.19,EE:0.2,GR:0.23,ES:0.21,FR:0.2,HR:0.25,IE:0.23,IT:0.22,CY:0.19,LV:0.21,LT:0.21,LU:0.17,HU:0.27,MT:0.18,NL:0.21,AT:0.2,PL:0.23,PT:0.23,RO:0.24,SI:0.22,SK:0.2,FI:0.24,SE:0.25,GB:0.2};if(a.hasOwnProperty(b)){return a[b]}else{return 0}},getVatAmount:function(c,a){var b=0;if(j.isVATApplicable(c)){if(c=="IE"||!a){b=j.getMoss(c)}}return b},validation:{init:function(b){$("#month, #year").on("change",function(){$(this).trigger("blur")});$(b.elem.form).data("validationConfig",b);function c(d){return $(d.form).data("validationConfig")}$.validator.addMethod("creditcardValid",function(t,d){var f=c(d);var v=j.getCreditCardType(t);var u=j.creditCardLength[v]!=undefined?j.creditCardLength[v]:0;var r=j.luhnCheck(t);var s=u>0&&r;f.elem.type.val(v);if(s){$("#cardNumberSection .icon-card").hide();$("#cardNumberSection .icon-card."+v.toLowerCase()).show();f.elem.cvv.attr("maxlength",j.cvvLength[v])}else{f.elem.cvv.attr("maxlength",3)}return s});$.validator.addMethod("cardexpirefield",function(u,d){var s=$(d).parent().parent().parent().find("[name=year]"),r=$(d).parent().parent().parent().find("[name=month]");var t=new Date();var v=!!((s.val()>t.getFullYear()-2000&&r.val()!=="")||(parseInt(s.val(),10)===t.getFullYear()-2000&&r.val()>=t.getMonth()+1));if($(d).attr("id")==="year"){var f=$('.error[for="month"][generated="true"]');f.text("Please enter valid expiration date");f[(v?"hide":"show")]()}if($(d).attr("id")==="userSettingsCardYear"){if(v){$('[for="'+r.attr("id")+'"]').hide()}else{$('[for="'+r.attr("id")+'"]').show()}$('[for="'+s.attr("id")+'"]').hide()}return v},"Invalid date");$.validator.addMethod("cvvLength",function(r,d){var q=c(d);var t=q.elem.type.val();var s=j.cvvLength[t]?j.cvvLength[t]:3;var f=q.elem.form.data("validator");f.settings.messages.cvv.cvvLength=$.validator.format(f.settings.messages.cvv.cvvLengthTmpl,s);return r.length==s});$.validator.addMethod("alphabeticChars",function(d,f){d=j.replaceDiacritics(d).replace(/[^\sa-zA-Z]/g,"");$(f).val(d);return(d.search(/[^\sa-zA-Z]/)===-1)});$.validator.addMethod("requiredForVAT",function(p,d){var f=c(d);var o=$("#billingVATSection").is(":visible")||$("#userSettingsVATSection").is(":visible");return !o||!f.elem.billingVAT.val()||Boolean(p)});$.validator.addMethod("validVATNumber",function(f,w){var A=c(w);var z=$("#billingVATSection").is(":visible")||$("#userSettingsVATSection").is(":visible"),t=A.elem.billingCountry.get(0),v=t.options[t.selectedIndex].value,d=true;if(z&&f){for(var u=2;u>0;u--){var B=i.checkVATNumber(f,v);d=B.valid_country&&B.valid_vat;if(d){$(w).val(B.number);break}else{f=v+f}}}return d});var a=b.elem.form.validate({onsubmit:false,onkeyup:false,focusCleanup:true,ignore:":hidden",rules:{loginEmail:{required:true,email:true},loginPassword:{required:true},name:{required:true,alphabeticChars:true},number:{required:true,digits:true,creditcardValid:true},month:{cardexpirefield:true},year:{cardexpirefield:true},cvv:{required:true,digits:true,cvvLength:true},billingCountry:{required:true},billingAddress:{required:true},billingCompany:{requiredForVAT:true},billingVAT:{validVATNumber:true}},messages:{loginEmail:{required:"Please enter your login email address",email:"Please enter a valid email address"},loginPassword:{required:"Please enter your password"},name:{required:"Please enter the name on the card",alphabeticChars:"Please only use alphabetic characters"},number:{required:"Please enter the card number",digits:"Please enter digits only",creditcardValid:"Invalid card number or card not accepted"},month:{cardexpirefield:"Please enter valid expiration date"},year:{cardexpirefield:"Please enter valid expiration date"},cvv:{required:"Please enter security code from the back of the card",digits:"Please enter digits only",cvvLengthTmpl:"Please enter exactly {0} digits"},billingCountry:{required:"Please select your country of residence"},billingAddress:{required:"Please enter your billing address"},billingCompany:{requiredForVAT:"Please enter your company name"},billingVAT:{validVATNumber:"Invalid VAT number"}},invalidHandler:b.handler.invalidHandler,errorPlacement:b.handler.errorPlacement,success:b.handler.success})},reset:function(a){var b=a.data("validator");if(b){b.resetForm()}$("input, select",a).removeClass("error");this.stopValidateAll()},stopValidateAll:function(a){$("input, select",a).not("input[name=cvv]").unbind("blur")}}};k.exports=j},{"./jsvat":96}],37:[function(H,L,v){var z=H("./class-storage");var u=H("./utils-editor");var w=H("./utils");var F=H("./class-branding");var I=H("./class-widget");var D=H("./browserdetect");var A=H("./class-scrollview");var K=H("./class-canvas");var B=H("./class-share");var G=H("./class-previewMenu");var M=H("./class-userSettings");var N=H("./class-event");var C=H("./checkHost");var E={url:null,printURL:null,embedURL:null,pageTransitioning:false,multiOrientations:false,projectWH:[320,480],delayStart:1000,loaded:false,pageScale:1,pageRotation:0,pageTranslation:[0,0],viewportScaled:false,currentFrameScale:1,navigationStackBack:[],navigationStackForward:[],navigationQueueNext:[],navigationQueueFlow:[],navigationCompleted:false,navigationEnabled:false,navigationDefaultTransition:null,parentWindow:null,parentDoc:null,useZoomSlider:false,pageNotes:{},isOpen:false,exported:C,initExported:function(){if($("#previewPage").size()>0){$(window).on("message",E._crossDomainCallListener)}E._showPreviewPage(false)},scaleFrame:function(m,b,s){b=b||false;m=m||false;if(!E.loaded&&!b&&m){return}if(window.g_print||window.g_embedded){return}var f=u.getParentWindow()||window,k=f.document,p=$("#previewPage",k),d=window;if(p[0]){d=p[0].contentWindow}else{if(u.getParentWindow()){p=$("#previewPage",k)}else{if(window.parent!==window){E._crossDomainCall(window.parent,"scaleFrame",arguments);return}}}if(!m&&!p[0]){if(u.isMobileDevice()){E.scaleViewport()}return}var a,l=k.getElementById("previewZoomSlider");if(!s&&l&&d.preview&&d.preview.useZoomSlider){a=l.value}else{var o=0;var i=0;if(f.fluid&&f.fluid.main&&f.fluid.main.project&&f.fluid.main.project.get("previewShowMobileFrame")){o=60+50;i=20}var j=p.outerWidth(),t=p.outerHeight(),r=Math.max(j,t),h=(s?{width:j+i,height:t+o}:{width:r,height:r}),q=(s?{width:f.innerWidth,height:f.innerHeight}:E.availableRect),n=w.getFitSize({object:h,frame:q,expand:s});a=n.width/h.width}if(E&&!E.useZoomSlider&&l&&typeof a==="number"){var c=f.$(l);if(c){c.slider("value",a)}}if(s){if(f===window&&p[0].contentWindow&&p[0].contentWindow.preview){p[0].contentWindow.preview.useZoomSlider=true}else{if(E){E.useZoomSlider=true}}}p.parent().css({transform:"scale("+a+") translateY(-50%) translateX(-50%)",transformOrigin:"left 10px",top:"50%",left:"50%",opacity:1});E.currentFrameScale=G.currentFrameScale=a;E._showPreviewPage(true)},scaleViewport:function(f){if(!E.viewportScaled){f=f||$(".ui-page-active");var j=$(".ui-content",f);var i=window.innerWidth;var h=E.getTrueHeight();var b=i>h?[h,i]:[i,h];var d=E.projectWH[0];var a=E.projectWH[1];var c=d>a?[a,d]:[d,a];E.pageScale=Math.min(b[0]/c[0],b[1]/c[1]);if(u.hideBrowserBar()){window.scrollTo(0,1)}}},applyPageTransforms:function(b){var a=E.pageScale!==1?"scale("+E.pageScale+") ":"";var c=E.pageRotation!=0?"rotate("+E.pageRotation+"deg)":"";var f=(E.pageTranslation[0]||E.pageTranslation[1])?" translate("+E.pageTranslation[0]+"px,"+E.pageTranslation[1]+"px)":"";var d=a+c+f;$(".widgetHolder, .fixedWidgetHolderFront",b).css({"-webkit-transform":d,"-moz-transform":d,transform:d})},_showPreviewPage:function(b){if(typeof b=="undefined"){b=true}var a=$("#previewPage");if(a.size()==0){if(u.getParentWindow()){a=$("#previewPage",window.parent.document)}else{if(window.parent!==window){E._crossDomainCall(window.parent,"_showPreviewPage",[b])}}}a.css({visibility:b?"visible":"hidden",opacity:1})},updateExportUi:function(b){var i={Pages:$("#previewShareContainer .shareLinkExportImg").add("#projectSettingsShareTop .shareLinkExportImg"),Project:$("#previewShareContainer .shareLinkExportImgFull").add("#projectSettingsShareTop .shareLinkExportImgFull")};var f;var h=["Pages","Project"];var a;var c;for(var j=0,d=h.length;j<d;j++){a=b["export"+h[j]];f=i[h[j]].next(".msg");if(a&&a.snapshotId){if(a.status==="FINISHED"){f.html('<a class="export-link" rel="'+a.snapshotId+'">Download ('+a.processDate+")</a>");c=f.find(".export-link");c.click(function(k){window.open(document.location.origin+document.location.pathname+"snapshot/"+k,"_snapshot")}.bind(c,a.snapshotId));f.removeClass("pulsing")}else{if(a.status==="STARTED"||(a.status==="NEW"&&a.queue===0)){f.html("exporting...");f.addClass("pulsing");B.startExportPolling(a.snapshotId)}else{if(a.status==="NEW"){f.html("queued ("+a.queue+")...");f.addClass("pulsing");B.startExportPolling(a.snapshotId)}else{if(a.status==="FAILED"){f.html("export failed...");f.removeClass("pulsing")}}}}}else{f.html("");f.removeClass("pulsing")}}},open:function(a,h,i,d){if(E.isOpen){return}var b;$(document.body).addClass("previewing previewLoading");fluid.main.fire("beforepreviewopen");E.hideNotes();if(i){d=[320,568];c(h,d)}else{h=fluid.main.project.get("id");b=fluid.main.project.bundle(h);f()}function f(){fluid.main.off("incrementalsSynced",f);K.setEditorVisibility(false);$("#previewPage").contents().find("body").remove();fluid.command.create("hideButton").dispatchTo("fluid.controllers.timeline");E.hideMenu();E.hideNotes();E.getNotesElement().style.display="none";E._showPreviewPage(false);fluid.main.fire("projectIntegrityCheckNeeded");if(fluid.main.project.get("previewShowLinks")){iFrame=document.getElementById("previewPage");var l=$("#previewShowLinks");if(l.length){l.removeClass("sg-toggleButtonChanged");l.get(0).checked=true}iFrame.addEventListener("load",function(){iFrameWindow=iFrame.contentWindow;var r=$(iFrameWindow.document.body);if(r.length){r.addClass("highlight-links")}})}if(fluid.main.project.get("previewShowMobileFrame")){var m=$("#previewFrameParent");var k=$("#previewShowMobileFrame");if(m.length&&k.length){m.addClass("mobileFrame");k.removeClass("sg-toggleButtonChanged");k.get(0).checked=true}}var n=fluid.main.project.get("pageWH");var p=fluid.main.project&&fluid.main.project.isMultiOrientation();if(a&&(a.currentTarget.id=="preview"||a.currentTarget.id==="pagePreview")){var j=(document.location.href).split("?");var o=h+"."+fluid.main.project.get("updated");B.init(h);E.embedURL=j[0]+"embed/"+o;var q=$("#tmplEmbedCode").tmpl({url:E.embedURL,width:p?Math.max(n[0],n[1]):n[0]+64,height:p?Math.max(n[0],n[1]):n[1],multiorient:p}).html();$("#embedCode").html(q)}c(h,n)}function c(j,k){$("#previewShareContainer").hide();$("#previewPage").css({width:k[0],height:k[1]}).attr("src",(document.location.href.indexOf("?")==-1?"?":"&")+"p="+j+"&preview=y");$("#previewPage").css({width:k[0],height:k[1]}).attr("src","project/"+j);$("#previewPage").load(function(){$("#previewFrameParent, #previewPage").css({opacity:1})});$("#previewHolder").addClass("loadingComplete");$(document.body).removeClass("previewLoading").addClass("previewLoadingComplete");$("#previewFrameParent").removeClass("to-landscape to-portrait");E.setAvailableRect(E.calcAvailableRect());E.centerFrame();E.isOpen=true;fluid.main.fire("preview")}},close:function(){$(document.body).removeClass("previewing previewLoadingComplete");K.setEditorVisibility(true);fluid.command.create("showButton").dispatchTo("fluid.controllers.timeline");$("#previewPage").find(".widgetHolder").empty();$("#previewShareContainer").show();$("#previewHolder").removeClass("loadingComplete");$("#previewFrameParent").css("opacity","");$(".messageError").hide();fluid.main.fire("previewclosed");E.isOpen=false},parseDownload:function(b,h,j){var c="Couldn't download correctly (has it been deleted/made inactive?)";try{var f=JSON.parse(b)}catch(a){try{var f=JSON.parse(j.responseText)}catch(a){$("body").html("Unable to parse download - unknown error (1)");throw ("Error Downloading "+item+"Caller:"+arguments.callee.caller+" Second level:"+arguments.callee.caller.caller+"loadSate"+loading_Stage_Check)}}if(f.r!="s"){E.displayErrorMessageOnLoad(c);return false}try{var d=JSON.parse(f.t.toString())}catch(a){E.displayErrorMessageOnLoad("Unable to download the mockup - download was interrupted.")}if(!fluid.main.project&&g_preview){var i=new fluid.models.Project(d,{parse:true,projectId:g_preview,syncOnChange:false});fluid.main.setMainProject(i)}var f=d[g_preview];if(f&&(f.active===false||f.removed===true)){var k=(C)?window:top;E.displayErrorMessageOnLoad("");E._crossDomainCall(window.parent,"setFrameSize",[324,500]);$("#projectInactive").tmpl().appendTo("body");return false}if(E.exported){E.afterPreviewLoad(d)}else{return d}},displayErrorMessageOnLoad:function(a){$("body").html(a);E.scaleFrame(true,true)},afterPreviewLoad:function(l){if(l===false){return}var n=l[window.g_preview]||l;var f=[];var b=$("#homePage");if(innerWidth===300&&n&&n.pageWH){f=n.pageWH;if(fluid&&fluid.main&&fluid.main.project){var a=fluid.main.project.pages.get(n.homepage);if(!a&&fluid.main.project.length){a=fluid.main.project.pages.first()}f=a&&[a.get("width"),a.get("height")]||n.pageWH}if(f[0]<f[1]){b.css("background-size",f[0]+"px auto")}else{b.css("background-size","auto "+f[1]+"px")}}else{if(innerWidth<innerHeight){f[0]=innerWidth+"px";f[1]="auto"}else{f[0]="auto";f[1]=innerHeight+"px"}b.css("background-size",f[0]+" "+f[1])}var h=F.deviceScreen(),m=h.device,p=h.screen,s=n.deviceModel,r,j,i=!$("#previewPage").length?f[0]>f[1]:window.innerWidth>window.innerHeight,d=document.getElementById("homePageStyle"),P='<link id="appIcon" rel="apple-touch-icon" href="'+(F.getUrl("icon",null,n)||"img/apple-touch-icon-144.png")+'" />';if(/iPhone6/.test(s)){var o="splashP";j=(F.getUrl("splashL"+s,p.splash,n)||"img/fluidLoading"+F.screens[s].splash+".png");r=(F.getUrl(o+s,p.splash,n)||"img/fluidLoading"+F.screens[s].splash+".png");P+='<link id="splashP" rel="apple-touch-startup-image" href="'+r+'" />'}else{r=F.getUrl("splashP"+s,p.splashP,n)||(p.splashP?"img/fluidLoading"+p.splashP+".png":"");j=F.getUrl("splashL"+s,p.splashL,n)||(p.splashL?"img/fluidLoading"+p.splashL+".png":"");P+='<link id="splashP" rel="apple-touch-startup-image" sizes="'+p.splashP+'" media="(orientation: portrait)" href="'+r+'" /><link id="splashL" rel="apple-touch-startup-image" sizes="'+p.splashL+'" media="(orientation: landscape)" href="'+j+'" />'}var t=n&&n.pageWH[0]||"1024px 748px;";var k=n&&n.pageWH[1]||"748px 1024px;";if(d){d.innerHTML="#homePage { background: url("+(i&&j?j:r)+") no-repeat bottom; background-size: "+(/iPad/.test(s)?(i?"1024px 748px;":"764px 1004px;"):s==="iPhone5"?"320px 568px;":s==="iPhone"?"320px 460px;":t+"px "+k+"px;}")}if(!m){if(!r&&!j){document.head.removeChild(d);$("#default-branding-links").tmpl().appendTo("head")}}$("head").append(P);try{u.getParentWindow().preview.setAvailableRect()}catch(q){E._crossDomainCall(window.parent,"setAvailableRect")}$(document).ready(function c(O){if(u.isMobileDevice()){$("body").addClass("mobile")}I.useCanvas=true;E.runDraw(l);$(window).bind("orientationchange",function(){$("body").scrollTop(0).scrollLeft(0);loading_Stage_Check="preview Loaded"})})},load:function(c,d){if(C||!frameElement){a()}else{var b=frameElement.contentDocument||frameElement.contentWindow.document;if(b&&b.readyState==="complete"){a()}else{$(frameElement).load(a)}}function a(){if(!C){$(frameElement).off("load")}var f=z.get(c);if(f&&f.unloaded!==true){if(typeof d==="function"){d(f)}if(window.g_print){E.runDraw(c)}}else{function h(k){var j=E.parseDownload.apply(this,arguments);k=JSON.parse(k);var i=JSON.parse(k.t);if(window.g_print){E.runDraw(i)}if(typeof d==="function"){d(j)}}fluid.main.fire("apiRequest","syncDown",c,false,false,h,h)}}},draw:function(c){if(!c){return false}if($.mobile){$.mobile.defaultHomeScroll=0}for(var a in c){z.setTempItem(a,c[a])}var i=c[g_preview]||c;for(var o=0;o<i.pages.length;o++){var p=z.get([i.pages[o]]);E.pageNotes[i.pages[o]]=p&&p[3]||""}E.viewportScaled=window.navigator.hasOwnProperty("standalone")&&window.navigator.standalone;E.projectWH=[i.pageWH[0],i.pageWH[1]];var q=E.viewportScaled?E.projectWH[0]:$(window).width();var m=E.viewportScaled?E.projectWH[1]:E.getTrueHeight();if(u.isMobileDevice()&&q>m&&window.screen.width<window.screen.height){var h=q;q=m;m=h}var b=E.viewportScaled?Math.min(window.screen.width/q,window.screen.height/m):1;if(/iP(hone|od|ad)/.test(navigator.platform)){var s=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);if(s&&s[1]&&s[1]==="6"){$("#metaViewport").attr("content","initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no")}}else{$("#metaViewport").attr("content","width="+q+",height="+m+",minimum-scale="+b+",maximum-scale="+b+",initial-scale="+b+",user-scalable=0")}if(u.getParentWindow()){if(!window.g_embedded){try{var Q=$("#previewPage",window.parent.document);if(Q.size()>0){Q.css({width:i.pageWH[0],height:i.pageWH[1]});$(".ui-mobile-viewport").css("overflow","hidden")}}catch(k){}}E.scaleFrame()}else{if(window.parent!==window){var d=fluid.main.project.pages.get(i.homepage);var j=[d.get("width"),d.get("height")];E._crossDomainCall(window.parent,"setFrameSize",j);E._crossDomainCall(window.parent,"scaleFrame")}}$(".pageList:not(#homePage)").css("height",E.getTrueHeight()+"px");document.title=i.name;document.projectLoaded=true;for(var o=0;o<i.pages.length;o++){if(!z.get(i.pages[o])){i.pages.splice(o,1);o--}}if(!z.get(i.homepage)){i.homepage=i.pages[0]}var r=i.orientation;E.multiOrientations=false;for(var o=0,n=i.pages.length;o<n;o++){if(z.get(i.pages[o]).orientation!=r){E.multiOrientations=true;break}}if(D.OS=="Android"&&E.multiOrientations){var f=$(window).width();var t=window.outerHeight||getTrueHeight();$(".ui-mobile-viewport").css({"min-height":Math.max(f,t)+"px"})}if(window.g_embedded&&(E.projectWH[0]>E.projectWH[1]||E.multiOrientations)){}if(window.g_print){for(var o=0,n=i.pages.length;o<n;o++){E.drawPage(i.pages[o],i)}$("#font-preloader").remove()}else{var l=(i.homepage?i.homepage:i.pages[0]);if(u.getParentWindow()&&u.getParentWindow().fluid){if(u.getParentWindow().fluid.main.previewStartPage){l=u.getParentWindow().fluid.main.previewStartPage}}E.homePage=l;E.drawPage(l,i);if(typeof g_previewMode!="undefined"&&g_previewMode==true){E.scaleViewport();E.bindMobileEvents(i.links);g_homepage=l;setTimeout(function(){E.changePage("#"+l,null,false,true)},E.delayStart)}}},showPage:function(a){$(".previewPage").hide();$("#"+a).show();if(typeof window.callPhantom==="function"){window.callPhantom({event:"shownPage",id:a})}},drawPage:function(c,a){if(!a){a=z.get(g_preview)}var i="transparent";var h=z.get(c);if(!h){return}var d=[h.width,h.height];var f={pageId:c,width:d[0],height:d[1],widthScreen:$(window).width(),heightScreen:E.getTrueHeight(),bgColor:i};if(window.g_embedded){if(E.multiOrientations){if(d[0]>d[1]){f.top=(d[0]-d[1])>>1}else{f.left=(d[1]-d[0])>>1}}else{f.left=$(".previewLogoHolder").outerWidth()}}if((window.g_print)&&(h.notes!=undefined)){f.notes=h.notes[3];f.title=h.name==undefined?"":h.name}var b=$("#tmplPreviewPage").tmpl(f).appendTo("body");E.drawWidgets(g_preview,c,a.links);E.showLinks(a.links,c);$("#"+c).bind("pageshow",E.navigateInit);if(window.g_print){if(h.width===a.pageWH[0]&&h.height===a.pageWH[1]){b.addClass("project-size")}}},changePage:function(b,a,d,j){var h=b.substr(1);if($(b).size()==0){E.drawPage(h);$(b).trigger("pageinit")}$(b).addClass("visited");var k=_.clone(a);var i=j=="undefined"?true:!j;if((!k)&&(i)){var c=E.navigationDefaultTransition.split(":");var f=(c.length>1)?true:false;k={transition:c[0],reverse:f}}E.orient(null,$(b),$(".ui-page.ui-page-active"));$.mobile.changePage(b,k);if(window.Android){Android.updateOrientation()}window.setTimeout(function(){E.preloadLinkedPages(h);E._fixNavigationStatus(h,a,d)},100)},_fixNavigationStatus:function(b,f,a){if((E.navigationStackBack.length>0)&&(a!=2)){var c=f;if(E.navigationQueueNext.length>0){if(E.navigationQueueNext[0].args){c=E.navigationQueueNext[0].args;c.reverse=!c.reverse}}E.navigationStackBack.push({pageId:b,args:c})}E.navigationQueueFlow=$.grep(E.navigationQueueFlow,function(h,i){return h.pageId!=b});var d=$("#"+b).hasClass("blank");if(!d){E.navigationQueueFlow.push({pageId:b,args:f})}E.navigationQueueNext=$.grep(E.navigationQueueNext,function(h,i){return h.pageId!=b})},_isPageVisited:function(b){var a=$("#"+b);if((a.size()>0)&&(a.hasClass("visited"))){return true}return false},preloadLinkedPages:function(c){if((E.navigationCompleted)&&(E.navigationQueueFlow.length>1)){var j=E.navigationQueueFlow.slice(0);var f=j.pop();E.navigationStackBack.push(f);return}var i=z.get(g_preview);var h=z.get(c);var d=i.links;var a=0;var b=0;$.each(d.linkOrigin,function(n,q){if(d.linkType[n]=="ahref"&&$("#"+q).closest(".page").attr("id")==c){var r=d.linkDest[n];var l=z.get(r);if(!l){return}var m=$("#"+r);if((m.size()==0)&&(l.widgets.length>0)){var k=d.transType[n].split(":");var o=(k.length>1)?true:false;var p={transition:k[0],reverse:o};E.navigationQueueNext.push({pageId:r,args:p});E.drawPage(r,i);a++}else{if(m.size()>0){if((E.navigationQueueFlow.length>0)&&(r==E.navigationQueueFlow[0].pageId)&&(!E.navigationQueueFlow[0].args)){var k=d.transType[n].split(":");var o=(k.length>1)?true:false;E.navigationQueueFlow[0].args={transition:k[0],reverse:o}}}}}if((E.navigationStackBack.length==0)&&(b<1)){if((d.linkType[n]=="ahref")&&(d.linkDest[n]==c)){var r=E.getPageIdForWidget(q);var l=z.get(r);if(!l){return}if((!E._isPageVisited(r))&&(l.widgets.length>0)){var k=d.transType[n].split(":");var o=(k.length>1)||k[0]=="none"?false:true;var p={transition:k[0],reverse:o};E.navigationStackBack.push({pageId:r,args:p});b++}}}});E.preloadNextUndisplayedPage(i);E.preloadPreviousUndisplayedPage(i)},preloadNextUndisplayedPage:function(a){return E.findUnlinkedPage(a,a.pages,E.navigationQueueNext,true)},preloadPreviousUndisplayedPage:function(c){var d=c.pages.slice(0);E.findUnlinkedPage(c,d.reverse(),E.navigationStackBack,false);if((E.navigationCompleted)&&(E.navigationQueueFlow.length>1)){var b=E.navigationQueueFlow.slice(0);var a=b.pop();E.navigationStackBack.push(a)}},findUnlinkedPage:function(b,d,a,c){if((E.navigationCompleted)||(a.length>0)){return false}var f=false;$.each(d,function(i,j){if(!E._isPageVisited(j)){var h=z.get(j);if(h.widgets.length>0){a.push({pageId:j,args:null});if(c){E.drawPage(j,b)}f=true;return false}}});if(!f){E.navigateSetCompleted()}return f},showLinks:function(b,c){var a=["ahref","page","back","home","url"];$.each(b.linkOrigin,function(d,f){if(a.indexOf(b.linkType[d])>-1&&(!c||$("#"+f).closest(".page").attr("id")==c)){$("[id="+f+"]").addClass("widgetLink")}})},drawWidgets:function(a,i,b){if(!fluid.main.project&&top&&top.fluid&&top.fluid.main.project){fluid.main.setMainProject(top.fluid.main.project)}var f=$("#"+i).find("[data-role=content]");var c=[];for(var h in b.linkDest){if(b.linkType[h]=="template"&&b.linkDest[h]==i){var j=fluid.main.project.pages.get(b.linkOrigin[h]).attributes.widgets;c=c.concat(j)}}var j=fluid.main.project.pages.get(i).get("widgets");widgetList=c.concat(j);for(var h=0;h<widgetList.length;h++){I.checkIntegrity(widgetList[h])}if(widgetList.length>0){var d=true;I.load(i,widgetList,d)}else{E.showBlankPage(i,b)}},showBlankPage:function(b,c){var a=$("#blankPage").find(".pageList").html();var d=$("#"+b).find(".widgetHolder");d.html(a);d.parent().addClass("blank");$(".blankPageBackButton",d).bind("click",E.navigateBack)},getPageIdForWidget:function(d){var a=z.get(g_preview);var c=a.pages;var b="";$.each(c,function(f,i){var h=z.get(i).widgets;$.each(h,function(j,k){if(k==d){b=i;return false}});if(b!=""){return false}});return b},orient:function(a,b,c){if(!window.g_embedded){try{if(u.isMobileDevice()){E._orientMobile(b,c)}else{E._orientParent(b,c)}E.scaleViewport(b)}catch(a){}}},_orientationData:function(j){var h;if(!j||j.length===0){h=j.selector.slice(1)}else{h=j.attr("id")}var c=z.get(g_preview);var a=z.get(h);var f=c.pageWH||[320,480];var m=a.orientation?(a.orientation!="Landscape"):(a.width<=a.height);var k=m?a.width>a.height:a.width<=a.height;var i=$.event.special.orientationchange;var d=(i&&$.isFunction(i.orientation))?i.orientation()=="portrait":window.screen.width<window.screen.height;var b=f[1]>=f[0];var l=m&&b||!m&&!b;return{portrait:m,crossOriented:d!=m,multiOriented:E.multiOrientations,projectOriented:l,width:f[0],height:f[1]}},_orientMobile:function(b,d,h){h=h||E._orientationData(b);E.pageRotation=h.crossOriented?(h.portrait?-90:90):0;var c;if((h.portrait&&h.projectOriented)||(!h.portrait&&!h.projectOriented)){c="width"}else{c="height"}E.pageTranslation=E.pageRotation?(E.pageRotation>0?[0,-h[c]]:[-h[c],0]):[0,0];E.applyPageTransforms(b);if(D.OS=="iOS"){var i=window.screen.width*(E.viewportScaled?window.devicePixelRatio:1);var f=window.screen.height*(E.viewportScaled?window.devicePixelRatio:1);var a=h.portrait!=h.crossOriented;$(document.body).css({width:(a?Math.min(i,f):Math.max(i,f))+"px"})}else{if(u.hideBrowserBar()){window.scrollTo(0,1)}}},orientPrevPage:function(b,d,f){if(!d){return}var c,a=(f.portrait&&f.projectOriented)||(!f.portrait&&!f.projectOriented);translateSide=a?"width":"height";if(f.portrait){c="rotate(90deg) translate(0,-"+f[translateSide]+"px)"}else{c="rotate(-90deg) translate(-"+f[translateSide]+"px, 0)"}$(".widgetHolder",d).css({"-webkit-transform":c,"-moz-transform":c,transform:c})},_orientParent:function(h,c,i){var f=$("#previewPage",u.getParentWindow()?frameElement.ownerDocument:document);i=i||E._orientationData(h);if(i.crossOriented){if(!u.getParentWindow()&&window.g_preview){setTimeout(function(){E.orientPrevPage(h,c,i)},0)}else{E.orientPrevPage(h,c,i)}if(f&&f.length){E.hideNotes();var d=f[0],a=d.parentNode,b={};if(i.projectOriented){b.width=i.width;b.height=i.height}else{b.width=i.height;b.height=i.width}$(".widgetHolder",h).css({"-webkit-transform":"","-moz-transform":"",transform:"",width:b.width+"px",height:b.height+"px"});d.style.width=b.width+"px";d.style.height=b.height+"px";E.centerFrame(window.parent||window);if(i.portrait){a.classList.remove("to-landscape");a.classList.add("to-portrait")}else{a.classList.remove("to-portrait");a.classList.add("to-landscape")}}else{if(window.parent!==window){E._crossDomainCall(window.parent,"_orientParent",[null,null,i])}}}N.triggerPreview("changeOrientation",{},true)},finishOrient:function(a,b,c){if(!window.g_embedded){try{if(!u.isMobileDevice()){E._finishOrient(b,c)}}catch(a){}}},clearPageOrientation:function(){E.pageRotation=0;E.pageTranslation=[0,0]},_finishOrient:function(b,c,a){var d=u.getParentWindow()&&window.parent&&$("#previewPage",window.parent.document);a=a||E._orientationData(b);if(u.getParentWindow()&&b){E.multiOrientations=a.multiOriented;E.updateNotes(b[0].id);E.debouncedPositionAndShowNotes()}if(c){E.clearPageOrientation();c.find(".widgetHolder").css({transform:"",webkitTransform:"",mosTransform:""});E.clearPageOrientation();E._crossDomainCall(window.parent,"_finishOrient",[null,null,a])}},bindMobileEvents:function(a){A.setup(a);function f(l,m){E.pageTransitioning=true;A.showPage.call(l.target,l)}function i(l,m){A.isScrolling=false;A.isDoubleTapping=false;A.isSwiping=false;E.pageTransitioning=false;E.finishOrient(l,$(l.target),m.prevPage);$(".ui-scrollview-clip",l.target).scrollview("option","rotate",E.pageRotation);setTimeout(function(){A.isTapHolding=false;if(u.hideBrowserBar()){window.scrollTo(0,1)}},350)}function b(l){E.orient(l,$.mobile.activePage);$(".ui-scrollview-clip",$.mobile.activePage).scrollview("option","rotate",E.pageRotation)}function d(l){A.isScrolling=false;A.isDoubleTapping=false;A.isTapHolding=false;A.isSwiping=true;var o={up:0,right:90,down:180,left:270};var p={0:"up",90:"right",180:"down",270:"left"};var m=l.type.substr(5);var n=p[(360+(o[m]-E.pageRotation))%360];E.handleUserInput("swipe"+n,$(l.currentTarget).attr("id"),a);return false}function j(l){l.stopImmediatePropagation();if(A.isSwiping){A.isSwiping=false}else{if(A.isScrolling){A.isScrolling=false}else{if(A.isDoubleTapping){A.isDoubleTapping=false}else{if(A.isTapHolding){A.isTapHolding=false}else{E.handleUserInput(l.type,$(l.currentTarget).attr("id"),a)}}}}}function k(l){A.isTapHolding=true;var m=$(l.currentTarget).attr("id");E.handleUserInput(l.type,m,a)}function c(l){A.isDoubleTapping=true;var m=$(l.target).parents(".pageWidget").attr("id");E.handleUserInput("doubletap",m,a)}function h(l){$(document).trigger("mouseup")}if(u.isMobileDevice()){if($.support.orientation){$(window).bind("orientationchange",b)}$(window).resize(function(){window.setTimeout(function(){E.scaleViewport($.mobile.activePage)},100)})}$("body").bind("pageinit",function(l){$(".pageWidget",l.target).doubletap(c)}).bind("pagebeforeshow",f).bind("pageshow",i).bind("vclick",function(l){if($(l.target).is(".widgetHolder")){E.pulseLinksOnce()}}).mouseleave(h);$(document).bind("touchmove",false);$(".pageWidget").live("swipeleft swiperight swipeup swipedown",d).live("vclick",function(l){l.preventDefault();j(l)}).live("taphold",k)},handleUserInput:function(b,k,m,a){if(!k){return}var h=u.getParentWindow();var i=(h&&h.fluid&&h.fluid.main&&h.fluid.main.project)?h.fluid.main.project:fluid.main.project;var m=i.get("links");if(A.isScrolling){return false}b=(b=="vclick"||b=="click")?"tap":b;var l=E.linkCheck(k,m,(b==="click"||b==="vclick")?"tap":b);if(l>-1&&m.triggerType[l]==b){E.navigateSetIncompleted();var c=i.links.get(m.linkCanvId[l]).get("transType").split(":");var d=(c.length>1)?true:false;var j,f=true;switch(m.linkType[l]){case"back":j=E.navigationStackBack.splice(-2,2)[0].pageId;break;case"home":j=fluid.main.project.get("homepage");break;case"url":f=false;window.open(m.linkDest[l]);break;default:j=m.linkDest[l]}if(f){E.changePage("#"+j,{transition:c[0],reverse:d})}}else{E.pulseLinksOnce()}},pulseLinksOnce:function(){if(fluid.main.project.get("previewShowLinks")){return}$(document.body).addClass("highlightLinksOnce");setTimeout(function(){$(document.body).removeClass("highlightLinksOnce")},500)},alertCopyEmbedCode:function(a){fluid.main.fire("addNotification","alert","Embed code copied")},showDebugInfo:function(a){var b=$("#divDebugInfo").html();if(b){a=b+a}$("#divDebugInfo").remove();$("body").append("<div id='divDebugInfo'>"+a+"<br/></div>")},getTrueHeight:function(){return(window.hasOwnProperty("innerHeight")?window.innerHeight:$(window).height())||480},linkCheck:function(a,c,f){var b=-1;_.each(c.linkOrigin,function(h,i){if(h===a&&(!f||c.triggerType[i]===f)){b=i}});var d=fluid.main.project.get(a);if(b===-1&&d.of){_.each(c.linkOrigin,function(h,i){if(h===d.of&&(!f||c.triggerType[i]===f)){b=i}})}return b},linkShowRipple:function(a,b){var c=z.get(a);if(c&&c.segments==null){if(c.of==null){return}if(b!=c.of){if(E.linkShowRipple(c.of,b)){$("#"+a).addClass("widgetLink")}}if(b==c.of){return true}}},runDraw:function(h){var k=h;var d;if(typeof(h)=="string"){h=fluid.main.project.bundle(h);d=h[g_preview];if(!d||!d.pages){fluid.main.fire("apiRequest","syncDown",previewId,false,false,E.parseDownload,E.parseDownload);return}}d=d||h[window.g_preview];E.loaded=true;E.navigationStackBack=[];E.navigationStackForward=[];E.navigationQueueNext=[];E.navigationQueueFlow=[];E.navigationCompleted=false;E.navigationDefaultTransition=d?d.defaultTransition:"none";E.draw(h);E.orient(null,$("#"+E.homePage||(h.homepage||(h[window.g_preview]&&h[window.g_preview].homepage))));if(window.g_print){var o=20,i=d.pageWH[0],j=d.pageWH[1],m="@page { size: "+d.orientation+"; margin: "+o+"px; }\n.printPageWrapper { width: "+i+"px; height: "+j+" }\n";for(var c=1;c>0;c-=0.1){c=c.toFixed(1);var a=Math.floor(i*c),l=Math.floor(j*c);m+="@media print and (max-width: "+(a+o)+"px) {\n    .project-size .page { -webkit-transform: scale("+c+"); transform: scale("+c+"); }\n    .printPageWrapper.project-size { width: "+a+"px; height: "+l+"px}\n}\n"}for(var b=0;b<d.pages.length;b++){var f=d.pages[b],n=h[f];if(n.width===i&&n.height===j){continue}m+="#print_"+f+" { width: "+n.width+"px; height: "+n.height+"px; }\n";for(var c=1;c>0;c=c-=0.1){c=c.toFixed(1);var a=Math.floor(n.width*c),l=Math.floor(n.height*c);m+="@media print and (max-width: "+(a+o)+"px) {\n    #"+f+" { -webkit-transform: scale("+c+"); transform: scale("+c+"); }\n    #print_"+f+" { width: "+a+"px; height: "+l+"px; }\n}\n"}}$("head").append('<style type="text/css">'+m+"</style>")}},restart:function(){E.changePage("#"+E.homePage,null,false,true)},hideMenu:function(){},navigateInit:function(a,b){E.navigationEnabled=true},navigateSetCompleted:function(){E.navigationQueueNext=[];E.navigationStackForward=[];E.navigationCompleted=true},navigateSetIncompleted:function(){E.navigationCompleted=false},navigateWithKeys:function(a){if((a.keyCode==27)&&(self!=top)&&(window.parent.lib!=undefined)){window.parent.lib.esc()}if(a.keyCode==69){if(self!=top&&window.parent){window.parent.fluid.main.fire("preview:close")}else{E.close()}}else{if(a.keyCode===67){if(self!=top&&window.parent){window.parent.fluid.main.fire("preview:close");window.parent.fluid.viewMgr.setView({viewName:"projectCommenting"})}else{E.close();fluid.viewMgr.setView({viewName:"projectCommenting"})}}}var b=u.getNavigationKeyDirection(a.keyCode);if(b==""){return}var c=top==self?document.getElementById("previewPage").contentWindow.preview:window.preview;if((!c)||(!c.navigationEnabled)){return}if((b=="top")||(b=="right")){c.navigateNext();return}c.navigateBack()},navigateNext:function(){if(E.navigationStackForward.length>0){var a=E.navigationStackForward.pop();E.changePage("#"+a.pageId,a.args);return}if(E.navigationQueueNext.length>0){var a=E.navigationQueueNext.shift();E.changePage("#"+a.pageId,a.args);return}if(E.navigationQueueFlow.length>0){var a=E.navigationQueueFlow.shift();E.changePage("#"+a.pageId,a.args);return}},navigateBack:function(){if(E.navigationStackBack.length>1){var h=E.navigationStackBack.pop();var i=E.navigationStackBack.pop();var d=$("#"+i.pageId).hasClass("blank");if(d){if(E.navigationStackBack.length>0){i=E.navigationStackBack.pop()}else{return}}if(E.navigationCompleted){var a=E.navigationQueueFlow.pop();E.navigationQueueFlow.splice(0,0,a);var c=E.navigationQueueFlow.pop();if(c.pageId!=i.pageId){E.navigationQueueFlow.push(c)}}else{E.navigationStackForward=$.grep(E.navigationStackForward,function(j,k){return j.pageId!=h.pageId});var f=$("#"+h.pageId).hasClass("blank");if(!f){var b={pageId:h.pageId,args:i.args};E.navigationStackForward.push(b)}}E.changePage("#"+i.pageId,i.args,1);return}if((E.navigationCompleted)&&(E.navigationQueueFlow.length>0)){var a=E.navigationQueueFlow.pop();E.changePage("#"+a.pageId,a.args,1)}},_crossDomainCall:function(a,b,c){a.postMessage(JSON.stringify({funcName:b,args:c}),"*")},_crossDomainCallListener:function(b){var a=JSON.parse(b.originalEvent.data);if($.isFunction(E[a.funcName])){E[a.funcName].apply(E,a.args)}},getNotesElement:function(a){a=a||window;var b=a.document.getElementById("inPreviewNotes");if(b){return b}try{if(a.frameElement){return E.getNotesElement(a.frameElement.ownerDocument.defaultView)}}catch(c){}return null},positionNotes:function(){var b=E.getNotesElement(),a=b&&b.clientWidth||0;if(b){var d=document.getElementById("previewPage")||window.frameElement,c=d.getClientRects()[0];if(!c){return}x=c.left;y=c.top;b.style.left=(x-a+1)+"px";b.style.top=Math.max(y,0)+"px"}},updateNotes:function(c){var b=E.getNotesElement();if(!b){return}var d=E.getNotesElement().querySelector("#previewNotesContent");var a=fluid.main.project.pages.get(c).get("notes");d.textContent=a&&a[3]||"This page has no notes"},showNotes:function(){notesElement=E.getNotesElement();notesElement&&notesElement.classList.remove("hide")},hideNotes:function(){notesElement=E.getNotesElement();notesElement&&notesElement.classList.add("hide")},toggleShare:function(){var a=document.getElementById("previewShare");a.classList.toggle("closed");E.setAvailableRect(E.calcAvailableRect());E.scaleFrame()},centerFrame:function(f){f=f||u.getParentWindow()||window;var a=f.document,h=a.getElementById("previewPage");if(!h){E._crossDomainCall(window.parent,"centerFrame");return}var c=h.parentNode,l=c.style,i=E.availableRect,j=$(h).outerWidth(),k=$(h).outerHeight(),d=i.width/2+i.left,b=i.height/2+i.top;l.left="50%";l.top="50%";l.transform="translate(-50%, -50%)";l.width=j+"px";l.height=k+"px";setTimeout(E.positionNotes,400)},calcAvailableRect:function(b){b=b||window;var a=b.document;return{width:b.innerWidth,height:b.innerHeight,left:0,top:0}},setFrameSize:function(a,b){$("#previewPage").css({width:a,height:b});E.scaleFrame()},availableRect:{width:(C)?window.innerWidth:top.innerWidth,height:(C)?window.innerHeight:top.innerHeight,top:0,left:0},setAvailableRect:function(a){a=a||E.calcAvailableRect();E.availableRect=a;if(E.canAccessFrame()&&$("#previewPage")[0].contentWindow.preview){$("#previewPage")[0].contentWindow.preview.availableRect=a}else{if($("#previewPage").length){E._crossDomainCall($("#previewPage")[0].contentWindow,"setAvailableRect",a)}}},canAccessFrame:function(){try{return !!(document.getElementById("previewPage").contentWindow.document)}catch(a){return false}},debouncedPositionAndShowNotes:J(function(){E.positionNotes();E.showNotes()},300,false)};function J(b,d,c){var a;return function(){var h=this,i=arguments;var j=function(){a=null;if(!c){b.apply(h,i)}};var f=c&&!a;clearTimeout(a);a=setTimeout(j,d);if(f){b.apply(h,i)}}}fluid.main.on("previewzoomsliderchanged previewbestfitclick previewfullscreenclick",function(b,a){if(a&&a.sliderValue){E.pageScale=a.sliderValue}E.hideNotes();E.debouncedPositionAndShowNotes();if(a&&a.bestFit){E.scaleFrame()}else{if(a&&a.fullscreen){E.scaleFrame(undefined,undefined,true)}}});fluid.main.on("previewshownoteschange",function(b,a){var a=false;if($(document.body).hasClass("externalPreviewDisplay")){a=document.getElementById("previewShowNotes").checked}else{$("#previewShowNotes").toggleClass("sg-toggleButtonChanged");if($("#previewShowNotes").hasClass("sg-toggleButtonChanged")){a=false}else{a=true}}if(a){E.getNotesElement().style.display="";$(".show-notes-icon").children().eq(0).hide().next().show();E.positionNotes()}else{E.getNotesElement().style.display="none";$(".show-notes-icon").children().eq(0).show().next().hide()}});fluid.main.on("keyup",function(b,a){if(!M.isOpen&&!$("#canvas").hasClass("editing")){E.navigateWithKeys(a)}});fluid.main.on("escpressed",function(){if($("#previewHolder").hasClass("open")){E.close()}});fluid.main.on("project.opening",function(b,a){if($("#previewHolder").is(":visible")){E.close()}});fluid.main.on("beforelogout",function(b,a){if($("#previewFrameParent").is(":visible")){E.close()}});fluid.main.on("preview:open",function(c,a,b){E.open(null,a,true,b)});fluid.main.on("preview:close",function(c,a,b){fluid.viewMgr.setView({viewName:"projectEditing"});window.parent.focus()});window.addEventListener("resize",_.throttle(function(a){if(fluid.main.project){E.multiOrientations=fluid.main.project.isMultiOrientation();if(E.isOpen){E.setAvailableRect();E.scaleFrame()}}},500));L.exports=E},{"./browserdetect":24,"./checkHost":25,"./class-branding":27,"./class-canvas":28,"./class-event":30,"./class-previewMenu":38,"./class-scrollview":43,"./class-share":44,"./class-storage":46,"./class-userSettings":47,"./class-widget":49,"./utils":99,"./utils-editor":98}],38:[function(z,C,w){var A=q(function(){preview.positionNotes();preview.showNotes()},400),v=null,D={menuElement:null,toggle:t,open:u,close:p,debouncePositionNotes:A,width:0},r=300,B=null,s=null;function t(a){var b=v.classList.contains("showing");if(b){D.close()}else{D.open();$("#qrHolder").fadeOut(450)}}function u(){v.classList.add("showing")}function p(){v.classList.remove("showing")}fluid.main.on("closeallpopups",function(b,a){if(a&&a.target&&$(a.target).parents("#togglePreviewMenu").length){p()}});function q(d,a,i){var b,h,f,c,j;return function(){f=this;h=arguments;c=new Date();var k=function(){var m=(new Date())-c;if(m<a){b=setTimeout(k,a-m)}else{b=null;if(!i){j=d.apply(f,h)}}};var l=i&&!b;if(!b){b=setTimeout(k,a)}if(l){j=d.apply(f,h)}return j}}$(document).ready(function(){v=D.menuElement=document.getElementById("previewMenu");if(!v){return}B=document.getElementById("previewPage");s=B.contentWindow;$(".show-notes-icon").children().eq(1).hide();if(B){B.addEventListener("load",function(){s=B.contentWindow;var d=false;if($(document.body).hasClass("externalPreviewDisplay")){if(document.getElementById("previewShowLinks").checked){d=true}}else{if(!$("#previewShowLinks").hasClass("sg-toggleButtonChanged")){d=true}}if(d==true){s.document.body.classList.add("highlight-links")}})}if($(this).find("body.externalPreviewDisplay").hasClass("preventDoubleLoadingHack")){return}$(this).find("body.externalPreviewDisplay").addClass("preventDoubleLoadingHack");document.getElementById("restartPreview").addEventListener("click",function(d){if(s&&s.preview){s.preview.restart()}});function c(f,d){if(!s||!s.preview){return}var h=B.parentElement;h.style.transform="scale("+d.value+") translateY(-50%) translateX(-50%)";h.style.transformOrigin="left 10px";s.preview.useZoomSlider=true;fluid.main.fire("previewzoomsliderchanged",{sliderValue:d.value})}function a(f,d){$("#previewPage").addClass("user-scaling")}function b(f,d){$("#previewPage").removeClass("user-scaling")}$("#previewZoomSlider").slider({range:"min",min:0.3,max:2,step:0.01,start:a,slide:c,change:b,stop:b});$("#previewShowLinks").click(function(d){var i;if(s){var f=$(s.document.body);var h=$("#previewShowLinks");if(f.hasClass("highlight-links")){i=false;f.removeClass("highlight-links");h.addClass("sg-toggleButtonChanged");document.getElementById("previewShowLinks").checked=false}else{i=true;f.addClass("highlight-links");h.removeClass("sg-toggleButtonChanged");document.getElementById("previewShowLinks").checked=true}if(fluid.main.project){if(s.fluid.main&&s.fluid.main.project){s.fluid.main.project.set({previewShowLinks:i},{silent:true})}fluid.command.create("setProperty",{projectId:fluid.main.project.id,newProperties:{previewShowLinks:i}}).dispatchTo("fluid.controllers.project")}}});$("#previewShowMobileFrame").click(function(f){var h;var i=$("#previewFrameParent");if(i){var d=$("#previewShowMobileFrame");if(i.hasClass("mobileFrame")){h=false;i.removeClass("mobileFrame");d.addClass("sg-toggleButtonChanged");document.getElementById("previewShowMobileFrame").checked=false}else{h=true;i.addClass("mobileFrame");d.removeClass("sg-toggleButtonChanged");document.getElementById("previewShowMobileFrame").checked=true}if(fluid.main.project){if(s.fluid.main&&s.fluid.main.project){s.fluid.main.project.set({previewShowMobileFrame:h},{silent:true})}fluid.command.create("setProperty",{projectId:fluid.main.project.id,newProperties:{previewShowMobileFrame:h}}).dispatchTo("fluid.controllers.project")}}});document.getElementById("previewBestFit").addEventListener("click",function(d){if(!s||!s.preview){return}s.preview.useZoomSlider=false;fluid.main.fire("previewbestfitclick",{bestFit:true});$("#previewZoomSlider").slider("value",D.currentFrameScale)});document.getElementById("previewFullscreen").addEventListener("click",function(d){if(!s||!s.preview){return}s.preview.useZoomSlider=false;fluid.main.fire("previewfullscreenclick",{fullscreen:true});$("#previewZoomSlider").slider("value",D.currentFrameScale)});document.addEventListener("click",function(d){if(!$(d.target).is("#previewMenu, #fluidDropdown, #previewMenu *, #togglePreviewMenu, #togglePreviewMenu *")){p()}})});C.exports=D},{}],39:[function(A,C,w){var u=A("./class-storage");var D=A("./class-event");var t=A("./class-panels");var v=A("./class-userSettings");var s=A("./class-page");var p=A("./class-staticWidgets");var q=A("./utils");var z=A("./class-branding");var B=A("./class-notification");var r={init:function(){D.bindEditor("panelGoBack",r.goToBackEnhancer);$(window).resize(r._resizeScreen)},_updateThumbnail:function(b,d,c){b.find(".preview").remove();if((!d.unloaded&&d.pages&&d.pages.length===0)){b.append($('<div class="preview empty">Project empty</div>'))}else{if(c||(d.preview&&d.preview.src)){var a=c!=undefined&&c!=null?c:d.preview.src;b.append($('<img class="preview" src="'+a+'">'))}else{b.append($('<div class="preview">Preview not available</div>'))}}},populateDeviceList:function(a){a.forEach(function(b,c){var d=$("#deviceModelTemplate option[data-type=Custom], #DeviceSizeTmpl option[data-type=Custom]");var f=$(document.createElement("optgroup")).insertBefore(d);f.attr("label",b.type);f.addClass("sg-customDropdownHeader");b.devices.forEach(function(h,j){var i=$(document.createElement("option")).appendTo(f);i.attr("value",h.width+","+h.height);i.attr("data-type",h.type);i.html(h.title);i.data("device",h);i.addClass("sg-customDropdownCategory")})})},goToBackEnhancer:function(a,b){if(!b){return}if(b.panelId=="projectList"){fluid.dialogs.projectList.lastSettingsUpdateId=null;setTimeout(fluid.dialogs.projectList.autoSelectOnOpen,800,true)}},open:function(a){var b=a?$(a.target):null;if((b)&&((b.hasClass("buttonDisabled"))||(b.parent().hasClass("buttonDisabled")))){return}fluid.dialogs.projectList.refreshListHeader();v.open(null,$("#projectList"));fluid.dialogs.projectList.adjustMainPanelSize();$("#projectSettingsFilter").hide();fluid.controllers.bin.showNonEmpty()},adjustVersionsPanelSize:function(){var a=$(".projectVersionItem").size();var b=(a*60);var c=$(window).height()-220;c=b<c?b:c;$("#projectSettingsVersionsTop").css({height:c+"px"})},actionActivateForced:function(){var a=$("#"+fluid.dialogs.projectList.lastSelectedId);project.dropToActive(a,true)},displayStatus:function(c){$(".buttonSwitch","#projectSettingsSettingsTop").removeClass("activeOption");var b=c?"projectSettingsButtonActive":"projectSettingsButtonInactive";$("."+b).addClass("activeOption");var d=$("#projectSettingsPanelSettings");var a=$(".buttonForActive",d);if(c){$(".projectThumbMedium, .projectThumbButtonOpen",d).add("#fluidDropdown .projectThumb").removeClass("inactivePrj");a.show()}else{$(".projectThumbMedium, .projectThumbButtonOpen",d).add("#fluidDropdown .projectThumb").addClass("inactivePrj");a.hide()}},_resizeScreen:function(){if(!v.isOpen){return}if($("#projectList").is(":visible")){setTimeout(r.adjustMainPanelSize,600);return}else{if($("#projectSettingsPanelVersions").is(":visible")){setTimeout(r.adjustVersionsPanelSize,600);return}}},getItemById:function(a){if(a==null){return undefined}return $("#"+a+r.lastView)},getLastSelectedItem:function(){return $("#"+fluid.dialogs.projectList.lastSelectedId+r.lastView)},getObjectById:function(a){return u.get(a)},getLastSelectedObject:function(){return r.getObjectById(fluid.dialogs.projectList.lastSelectedId)},isLastSelectedOpen:function(){if(fluid.dialogs.projectList.lastSelectedId==null){return false}return fluid.dialogs.projectList.lastSelectedId===fluid.main.project.id},getDeviceLabel:function(b){var c=$("#DeviceSizeTmpl option",s.menu);var a=c.filter("[data-type='"+b+"']").text();var d=a.replace(/\(([^\)]+)\)/,"").trim();return d},_callbackSanitize:function(c,f,h){if(c==null){if(f!=""){t.displayError(f);return null}t.displayError();return null}try{var b=JSON.parse(c)}catch(d){return null}if(b.t===true||b.t==="true"){return b}else{var a=h==undefined?b.t:h;t.displayError(a)}return null},updateThumbnail:function(a){var c=r.getObjectById(a);var b=r.getItemById(a);r._updateThumbnail(b,c)},updateThumbnailMedium:function(){var b=r.getObjectById(fluid.dialogs.projectList.lastSelectedId);var a=$(".projectThumbMedium");r._updateThumbnail(a,b)},shareWithTeam:function(){$("#shareWithTeamBtn, #shareWithTeamBtn2").toggleClass("sg-toggleButtonChanged")},shareAllProjects:function(){$("#shareAllProjectsBtn").toggleClass("sg-toggleButtonChanged")},chooseDeviceType:function(){$("#newProjectOrientationSelector").hide();var a=$("#newProjectDeviceType")[0],c=$(a.options[a.selectedIndex]),d=c.attr("value");if(d){var b=c.data("device");if(b.deviceType=="phone"||b.deviceType=="tablet"){$("#newProjectOrientationSelector").show()}}}};fluid.main.on("afterprojectstatuschange",function(c,a,b){if(b){r.displayStatus(status)}});fluid.main.on("keyup",function(b,a){if(v.isOpen&&!$("#canvas").hasClass("editing")){fluid.dialogs.projectList.navigateWithKeys(a)}});fluid.main.on("projectSettings: keydown",function(b,a){if(v.isOpen&&a.keyCode==13){fluid.dialogs.projectList.navigateWithKeys(a)}});C.exports=r},{"./class-branding":27,"./class-event":30,"./class-notification":33,"./class-page":34,"./class-panels":35,"./class-staticWidgets":45,"./class-storage":46,"./class-userSettings":47,"./utils":99}],40:[function(q,o,r){var p=q("./functions");var n=q("./class-widget");var k=q("./utils");var l=q("./jquery.colorpicker");var m={currentSelection:false,textWidgets:false,shapeWidgets:false,uploadWidgets:false,filterTextOrShape:function(){var i=fluid.selection.getSelectionModel().getElements();var v=i.length;var z=$([]);var f=$([]);var w=$([]);var d=$([]);var j=$([]);function h(){var s=$(this);var u=s.attr("id");var t=n.get(u);if(t.tc){w=w.add(s)}if(!t.tc&&!t.upload){f=f.add(s)}if(t.b){d=d.add(s)}if(t.upload&&t.upload=="y"){z=z.add(s)}if(!t.bgc&&!t.r){j=j.add(s)}}i.each(h);if(i.length<1){var a=false}else{if(w.length>0&&f.length>0){var b=(d.length>0)?"showBorder":"showBackground";var c={showDefaults:["showShapeInspector","showTextInspector"],showColorPicker:["showBackground",b,"showTextColor"]}}else{if(z.length==v){var c={showDefaults:["showShapeInspector"],showColorPicker:false}}else{if(j.length==v){var c={showDefaults:["hideInspectors"],showColorPicker:false}}else{if(w.length>0&&f.length==0){var c={showDefaults:["showTextInspector"],showColorPicker:["showTextColor"]}}else{if(w.length==0&&f.length>0){var b=(d.length>0)?"showBorder":"showBackground";var c={showDefaults:["showShapeInspector"],showColorPicker:["showBackground",b]}}}}}}}return c},updateBackgroundBorderInfo:function(f){var A=l.getWidgetForCP();var d="transparent";var i=m.defaultColor;var j=0;var w=["b","bs","bts","bls","bms","bbs","brs"];for(var c=0;c<w.length;c++){var a=A[w[c]];try{if(a.length>0){d=k.replaceRgbaAlpha(a[1],1);j=a[0];i=(j==0)?m.defaultColor:"background:none;"}}catch(b){}}var z="transparent";var h=m.defaultColor;if(A.bgc){var B=$.extend(true,[],A.bgc);B=B.toString();if(B){if(B!=="rgba(0,0,0,0.0),rgba(0,0,0,0.0)"){z=k.replaceRgbaAlpha(A.bgc[0],1);h="background:none;"}}}$("#shapeBackground").css("background-color",z);$("#noBackground").attr("style",h);$("#shapeBorder").css("background-color",d);$("#noBorder").attr("style",i);if(!f){fluid.main.fire("inspectorAdjustBorderContainer",j)}},getWidgetAmount:function(i,c,f){var d=f.length;var j=c.length;var h=i.length;var b=0;if(d>0){f.each(function(){var w=$(this);var s=w.attr("id");if(j>0){var z=$(c).find(s);b+=1}})}var t=fluid.selection.getSelectionModel().getShapeWidgets().getElements().add(fluid.selection.getSelectionModel().getUploadWidgets().getElements());var a=t.length-b;return a},_getTextPropertyValue:function(c,d,b){var a;if(d.importAction){a=m.widgetTextPropGet(d,$("#"+b))}return a},_getShapePropertyValue:function(i,t,c,b,a){t=t||m.getPropMap("shape")[i];b=b||$("#"+i);var f=$("#"+c);var h;if(!a){a=n.get(c);if(!a[t.property]&&a.segments&&a.segments.length){a=n.get(a.segments[0].id)}}if(t.property!==undefined&&t.index!==undefined){var j=a[t.property];h=j&&j[t.index];if(typeof h==="string"&&b.attr("type")=="number"){var d=f.css(t.cssProperty);h=d?parseFloat(d):0}}else{if(i=="shapeOpacitySlider"){h=100;if(a.bgc&&a.bgc[0]&&(100*k.getAlphaFromColor(a.bgc[0])<h)){h=100*k.getAlphaFromColor(a.bgc[0])}if(a.b&&a.b[1]&&(100*k.getAlphaFromColor(a.b[1])<h)){h=100*k.getAlphaFromColor(a.b[1])}}}return h},filterBackgroundTypes:function(){var a=fluid.selection.getSelectionModel().getShapeWidgets().getElements();var d=a.filter(".ui-selected").last().attr("id");var c=n.get(d);if(c.bg=="c"||c.bg=="s"||!c.bg){var b="showFlatColor"}else{var b="showGradientGallery"}return b},updateTextProps:function(){var d=null;var c=null;var a=fluid.selection.getSelectionModel().getTextWidgets();var b=a.getElements();a.each(function(i){var j=i.get("textVerticalAlign");var t=i.get("textHorizontalAlign");if(d===null){d=j}else{if(d!==j){d=""}}if(c===null){c=t}else{if(c!==t){c=""}}});$("#propContainer").find(".radio, .checkbox").removeClass("activeCheckbox");if(d){switch(d){case"top":$("#textVerticalTop").addClass("activeCheckbox");break;case"middle":$("#textVerticalMiddle").addClass("activeCheckbox");break;case"bottom":$("#textVerticalBottom").addClass("activeCheckbox");break}}if(c){switch(c){case"left":$("#textLeft").addClass("activeCheckbox");break;case"center":$("#textCenter").addClass("activeCheckbox");break;case"right":$("#textRight").addClass("activeCheckbox");break}}var f=fluid.controllers.widget.propMap.textPropMap;if(b.length>0){var h=b.last();for(property in f){if(property.match(/textVerticalTop|textVerticalMiddle|textVerticalBottom|textRight|textCenter|textLeft/)){continue}if(f[property].importAction){m[f[property].importAction+"PropImport"](b,f,property,h)}}}},getLinkProps:function(a){return this._getLinkForOriginId(a)},getSelectedLinkProps:function(){var b=fluid.selection.getSelectionModel(),c=fluid.main.project.get("links"),a=[];self=this;_.each(b.models,function(d){self._getLinkForOriginId(d.id,c,a)});return a},_getLinkForOriginId:function(a,c,b){c=c||fluid.main.project.get("links");b=b||[];_.each(c.linkOrigin,function(d,f){if(d===a){b.push({linkId:c.linkCanvId[f],linkDest:c.linkDest[f],linkOrigin:c.linkOrigin[f],linkType:c.linkType[f],transType:c.transType[f],triggerType:c.triggerType[f]})}});return b},checkboxPropImport:function(a,h,v,f){var b=$("#"+v);var u=h[v];var c=m.widgetTextPropGet(u,f);if(u.property=="top"){var d=parseInt(f.css("height"));var j=parseInt(f.find(".widgetText").css("padding-top"));var i=(j/d);if(i>0){c="0%";if(i>0.3){c="0.5%";if(i>0.7){c="1%"}}}}if(c==="700"){c="bold"}if(c==u.active){b.addClass("activeCheckbox")}else{if(c==u.inactive){b.removeClass("activeCheckbox")}}},textColorPropImport:function(a,c,f,h){var d=c[f];var b=m.widgetTextPropGet(d,h);$("#textColor").css("background-color",b)},selectPropImport:function(a,c,f,h){var i=$("#"+f);var d=c[f];var b=m.widgetTextPropGet(d,h);if(b[0]=="'"){b=b.split("'")[1]}i.val(b)},_sliderChanged:function(a,c,b){m._exportProps(a,c/100,b)},sliderInput:function(a,b){this.querySelector(".ui-slider-handle").textContent=b.value+"%"},sliderChanged:function(a,b){m._sliderChanged(this.id,b.value,false);if(a.target.id=="shapeOpacitySlider"){m.updateBackgroundBorderInfo()}},sliderPropImport:function(a,c,f,h){var d=c[f];var b=parseFloat(m.widgetTextPropGet(d,h));$("#textOpacitySlider").slider("value",b*100)},widgetTextPropGet:function(d,b){var a;if(d.property==="text-decoration"){a=m.widgetSelectText(b).find("span").css(d.property)}else{a=m.widgetSelectText(b).css(d.property)}if(a===undefined&&"inactive" in d){a=d.inactive}if(d.property=="font-size"){a=(a)?parseInt(a):10}var c=parseFloat(a);if((!isNaN(c))&&(c==parseFloat(d.active))){return d.active}return a},toggleCheckboxStyle:function(){m.updateTextProps();$(this).toggleClass("activeCheckbox");var a=fluid.controllers.widget.propMap.textPropMap;var b;if($(this).hasClass("activeCheckbox")){b=a[this.id].active}else{b=a[this.id].inactive}m._exportProps(this.id,b)},toggleRadioStyle:function(){var a=$(this).attr("id");if(a.match(/textVerticalTop|textVerticalMiddle|textVerticalBottom|textRight|textCenter|textLeft/)){return}var b=fluid.controllers.widget.propMap.textPropMap;$(this).addClass("activeCheckbox").siblings(".radio").removeClass("activeCheckbox");m._exportProps(this.id,b[this.id].active)},togglehozontalAlignment:function(){var a=fluid.controllers.widget.propMap.textPropMap;$(this).addClass("activeCheckbox").siblings(".hozontalAlignment").removeClass("activeCheckbox");m._exportProps(this.id,a[this.id].active)},numFieldInput:false,keyToggle:false,changeShapeProps:function(a){if(a.keyCode>=37&&a.keyCode<=40){return false}var b=$(this);var c=b.val();var c=Math.abs(parseInt(c));if((isNaN(c))==true){b.val("");return false}m.lastInput=$(this);m.numFieldInput=c;if(m.keyToggle=="on"){return false}m.keyToggle="on";m.launchInputTimer(b);return false},launchInputTimer:function(a){function b(){$(a).val(m.numFieldInput);var c=a;m.applyChangedField(c);m.keyToggle=false;m.numFieldInput=false}m.inputTimeout=setTimeout(b,2000)},setClickTimeout:false,targetElement:false,applyChangedField:function(f){var d=f.attr("id");var b=f.val();if(isNaN(b)||b===""){var c=f.attr("data-init-value");return f.val(c)}if(d=="shapeBorderRadius"||d=="shapeBorderWidth"){b=parseInt(b,10);var h=m.calculateBorderLimits();if(b>h){f.val(h)}}var a=f.val();if(!m||!m.pending||m.pending.id!==d||m.pending.output!==a){m.pending={id:d,output:a};m._exportProps(d,a)}p.updateTLWH();m.updateBackgroundBorderInfo();m.updateBorderLimits();m.lastInput=null},selectNumberValue:function(){$(this).select()},selectChanged:function(b){if($(this).val().length==0){return}var a=($(this).attr("type")=="number")?parseInt($(this).val()):$(this).val();if(this.id==="textSize"&&typeof a==="string"&&a.indexOf("px")===-1){a=a+"px"}m._exportProps(this.id,a);p.updateTLWH();m.updateBackgroundBorderInfo();return false},getPropMap:function(a){return fluid.controllers.widget.propMap[(a)+"PropMap"]},calculateBorderLimits:function(){function d(B){var s=B.tlwh[2];var C=B.tlwh[3];var t=Math.min(C,s);var D=parseInt(t/2);return D}var j=fluid.selection.getSelectionModel().getShapeWidgets(true).getElements();var c=false;var f=[];j.each(function(){var z=$(this);if(z.hasClass("ui-selected")){var s=z.attr("id");c=n.get(s);var t=d(c);f.push(t)}});var v=$.extend(true,[],f);var a=v.sort(function(s,t){return t-s});var b=a[0];var i=f.indexOf(b);var u=j.eq(i);c=n.get(u.attr("id"));var h=(c)?d(c):1000;return h},updateBorderLimits:function(){var a=parseInt($("#shapeBorderWidth").val());var c=parseInt($("#shapeBorderRadius").val());var f=m.increaseBorderSize;var b=m.increaseRadiusSize;var d=m.calculateBorderLimits();(a==d)?f.css({"pointer-events":"none",opacity:0.75}):f.css({"pointer-events":"auto",opacity:1});(c==d)?b.css({"pointer-events":"none",opacity:0.75}):b.css({"pointer-events":"auto",opacity:1})},_prevValues:{},_exportProps:function(B,i,C){var a=$(".shapeProps").is(":visible")&&"shape"||$(".textProps").is(":visible")&&"text"||undefined;if(!a&&B.indexOf("shape")!==-1){a="shape"}if(!a&&B.indexOf("text")!==-1){a="text"}if(!a){return}var f=m.getPropMap(a)[B];var F=({shape:m._getShapePropertyValue,text:m._getTextPropertyValue})[a];if(f&&"command" in f&&F){var j=m.lastSelectionModel;var G=j.getIds();clearTimeout(m.inputTimeout);m.keyToggle=false;if(B=="shapeBorderWidth"||B=="shapeBorderRadius"){G=j.filter(function(s){if(s.get("st")!=="b"){return s}});G=_.map(G,function(s){return s.id})}var d=fluid.zoom.getActivePageId();var D={id:G,pageId:d,propertyId:B,property:f.command.property,mode:a,from:$.map(G,function(s){var t=s+B;if(t in m._prevValues){var u=m._prevValues[t]}else{var u;if("ts" in fluid.main.project.get(s)){u=m._getTextPropertyValue(B,f,s)}else{if(B==="textOpacitySlider"){B="shapeOpacitySlider"}u=m._getShapePropertyValue(B,f,s);u/=100}}if(C){m._prevValues[t]=u}else{delete m._prevValues[t]}return u}),to:i};if(f.property==="font-size"){D.from[0]=D.from[0]+"px"}var c;for(var E=0,H=G.length;E<H;E++){c=D.from[E]!=D.to;if(c==true){break}}if(c){if(f.command.name==="resize"){if(_.isArray(D.id)){D.id=D.id[0]}var h=$("#"+D.id),b=fluid.main.project.get(D.id).tlwh;D.fromTLWH=[b[0],b[1],h.width(),h.height()];D.toTLWH=D.fromTLWH.slice(0);D.toTLWH[f.index]=parseInt(D.to);D.needViewUpdate=true}fluid.command.create(f.command.name,D).dispatchTo("fluid.controllers.widget",!Boolean(C))}}else{if(f){return m.exportProps(a,B,i)}else{return m.exportProps(a==="text"?"shape":"text",B,i)}}},widgetSelectText:function(a){if(!a.is(".widgetText")){var b=a.find(".widgetText");if(b.length===0&&a[0]){b=$(a[0]).find(".widgetText")}if(b.size()>0){a=b}else{a=$("[data-lockto="+a.attr("id")+"] .widgetText")}}return a},exportProps:function(d,Q,c,L){var R=L?$("#"+L):$("#canvasPages .ui-selected");var K=L?n.get(L):n.get(R.attr("id"));var M=m.getPropMap(d)[Q];if(Q.indexOf("text")>-1){var b=[];R.each(function(){var s=$(n.getSubTextElements(this));s.each(function(){b.push($(this))})});b.push(R);for(var j=0;j<b.length;j++){var h=b[j];var T=h.attr("id");var f=m.widgetSelectText(h);c=M.unit?c+M.unit:c;var a=parseInt(f.css("padding-top"));if(M.property=="top"&&c<=1){c=c.toString()+"%"}if(M.property=="font-size"){var J=f.css("font-size");var I=f.css("line-height");var P=Math.round(parseFloat(c,10)*1.14);f.css("font-size",parseInt(c)+"px");if(f.css("font")){var O=f.css("font")}f.css("line-height",P+"px")}else{if(M.property==="text-decoration"){f.find("span").css(M.property,c)}else{f.css(M.property,c)}}var S=f.attr("style");S+=f.find("span").attr("style");fluid.main.project.widgets.get(T).set({ts:S})}}else{if(Q.indexOf("shape")>-1){c=parseInt(c);var i=M.property;var N=M.index;if(i!=undefined&&N!=undefined){for(var j=0;j<R.length;j++){K=n.get(R.eq(j).attr("id"));if(!L){K=n.get(R.eq(j).attr("id"))}if(typeof K[i]!=="undefined"){var H;if(K.segments){H={mode:"all"}}else{if(K.segment){H={mode:"seg",segId:L}}}n._redraw(R.eq(j),K,H)}}}m.updateBackgroundBorderInfo()}}}};fluid.main.on("colorpickercolorapplied widgetBgColorChanged",function(){m.updateBackgroundBorderInfo()});fluid.main.on("widgetclicked",function(b,a){if(m.keyToggle==="on",m.lastInput){m.applyChangedField(m.lastInput)}});fluid.main.on("widgetPropertyApplied",function(c,d,f,a,b){if(fluid.zoom.getCtx()!=="project"){m.exportProps(d,f,a,b)}});fluid.main.on("textAlignSet",function(c,a){var d;switch(a.alignTo){case"top":d="textVerticalTop";break;case"middle":d="textVerticalMiddle";break;case"bottom":d="textVerticalBottom";break;case"center":d="textCenter";break;case"left":d="textLeft";break;case"right":d="textRight";break}var b=$("#"+d);b.siblings().removeClass("activeCheckbox");b.addClass("activeCheckbox");a.id.forEach(function(h){var j=fluid.main.project.widgets.get(h);var i=j.get("textHorizontalAlign");var f=j.get("textVerticalAlign");var t=$("#"+h).find(".widgetText");t.attr("class","widgetText");t.addClass("align-to-"+i);t.addClass("align-to-"+f)})});o.exports=m},{"./class-widget":49,"./functions":91,"./jquery.colorpicker":95,"./utils":99}],41:[function(j,i,f){var h=function(){var G=function(t,s){var k=236;var l=17;var Y=t;var W=d[s];var aa=null;var p=0;var V=null;var S=new Array();var o={dark:"#000",bright:"#FFF"};var r=function(I,J){p=Y*4+17;aa=function(N){var L=new Array(N);for(var K=0;K<N;K+=1){L[K]=new Array(N);for(var M=0;M<N;M+=1){L[K][M]=null}}return L}(p);U(0,0);U(p-7,0);U(0,p-7);u();T();m(I,J);if(Y>=7){X(I)}if(V==null){V=ab(Y,W,S)}q(V,J)};var U=function(J,L){for(var K=-1;K<=7;K+=1){if(J+K<=-1||p<=J+K){continue}for(var I=-1;I<=7;I+=1){if(L+I<=-1||p<=L+I){continue}if((0<=K&&K<=6&&(I==0||I==6))||(0<=I&&I<=6&&(K==0||K==6))||(2<=K&&K<=4&&2<=I&&I<=4)){aa[J+K][L+I]=true}else{aa[J+K][L+I]=false}}}};var Z=function(){var I=0;var J=0;for(var K=0;K<8;K+=1){r(true,K);var L=v.getLostPoint(o);if(K==0||I>L){I=L;J=K}}return J};var T=function(){for(var J=8;J<p-8;J+=1){if(aa[J][6]!=null){continue}aa[J][6]=(J%2==0)}for(var I=8;I<p-8;I+=1){if(aa[6][I]!=null){continue}aa[6][I]=(I%2==0)}};var u=function(){var N=v.getPatternPosition(Y);for(var K=0;K<N.length;K+=1){for(var L=0;L<N.length;L+=1){var I=N[K];var M=N[L];if(aa[I][M]!=null){continue}for(var J=-2;J<=2;J+=1){for(var O=-2;O<=2;O+=1){if(J==-2||J==2||O==-2||O==2||(J==0&&O==0)){aa[I+J][M+O]=true}else{aa[I+J][M+O]=false}}}}}};var X=function(I){var J=v.getBCHTypeNumber(Y);for(var K=0;K<18;K+=1){var L=(!I&&((J>>K)&1)==1);aa[Math.floor(K/3)][K%3+p-8-3]=L}for(var K=0;K<18;K+=1){var L=(!I&&((J>>K)&1)==1);aa[K%3+p-8-3][Math.floor(K/3)]=L}};var m=function(N,I){var J=(W<<3)|I;var K=v.getBCHTypeInfo(J);for(var L=0;L<15;L+=1){var M=(!N&&((K>>L)&1)==1);if(L<6){aa[L][8]=M}else{if(L<8){aa[L+1][8]=M}else{aa[p-15+L][8]=M}}}for(var L=0;L<15;L+=1){var M=(!N&&((K>>L)&1)==1);if(L<8){aa[8][p-L-1]=M}else{if(L<9){aa[8][15-L-1+1]=M}else{aa[8][15-L-1]=M}}}aa[p-8][8]=(!N)};var q=function(L,P){var N=-1;var R=p-1;var M=7;var Q=0;var I=v.getMaskFunction(P);for(var O=p-1;O>0;O-=2){if(O==6){O-=1}while(true){for(var J=0;J<2;J+=1){if(aa[R][O-J]==null){var K=false;if(Q<L.length){K=(((L[Q]>>>M)&1)==1)}var ac=I(R,O-J);if(ac){K=!K}aa[R][O-J]=K;M-=1;if(M==-1){Q+=1;M=7}}}R+=N;if(R<0||p<=R){R-=N;N=-N;break}}}};var n=function(an,ak){var N=0;var R=0;var aj=0;var O=new Array(ak.length);var K=new Array(ak.length);for(var ap=0;ap<ak.length;ap+=1){var ao=ak[ap].dataCount;var P=ak[ap].totalCount-ao;R=Math.max(R,ao);aj=Math.max(aj,P);O[ap]=new Array(ao);for(var am=0;am<O[ap].length;am+=1){O[ap][am]=255&an.getBuffer()[am+N]}N+=ao;var J=v.getErrorCorrectPolynomial(P);var ai=A(O[ap],J.getLength()-1);var M=ai.mod(J);K[ap]=new Array(J.getLength()-1);for(var am=0;am<K[ap].length;am+=1){var I=am+M.getLength()-K[ap].length;K[ap][am]=(I>=0)?M.get(I):0}}var al=0;for(var am=0;am<ak.length;am+=1){al+=ak[am].totalCount}var Q=new Array(al);var L=0;for(var am=0;am<R;am+=1){for(var ap=0;ap<ak.length;ap+=1){if(am<O[ap].length){Q[L]=O[ap][am];L+=1}}}for(var am=0;am<aj;am+=1){for(var ap=0;ap<ak.length;ap+=1){if(am<K[ap].length){Q[L]=K[ap][am];L+=1}}}return Q};var ab=function(N,O,J){var L=w.getRSBlocks(N,O);var M=z();for(var K=0;K<J.length;K+=1){var P=J[K];M.put(P.getMode(),4);M.put(P.getLength(),v.getLengthInBits(P.getMode(),N));P.write(M)}var I=0;for(var K=0;K<L.length;K+=1){I+=L[K].dataCount}if(M.getLengthInBits()>I*8){throw new Error("code length overflow. ("+M.getLengthInBits()+">"+I*8+")")}if(M.getLengthInBits()+4<=I*8){M.put(0,4)}while(M.getLengthInBits()%8!=0){M.putBit(false)}while(true){if(M.getLengthInBits()>=I*8){break}M.put(k,8);if(M.getLengthInBits()>=I*8){break}M.put(l,8)}return n(M,L)};o.addData=function(I){var J=H(I);S.push(J);V=null};o.isDark=function(I,J){if(I<0||p<=I||J<0||p<=J){throw new Error(I+","+J)}return aa[I][J]};o.getModuleCount=function(){return p};o.make=function(){r(false,Z())};o.createImgTag=function(I,J){I=I||2;J=(typeof J=="undefined")?I*4:J;var K=o.getModuleCount()*I+J*2;var L=J;var M=K-J;return B(K,K,function(Q,O){if(L<=Q&&Q<M&&L<=O&&O<M){var N=Math.floor((Q-L)/I);var P=Math.floor((O-L)/I);return o.isDark(P,N)?0:1}else{return 1}})};o.createDataUrl=function(I,M){I=I||200;var K=o.getModuleCount(),P=(I/K|0)||1,N=document.createElement("canvas"),O=N.getContext("2d");N.width=N.height=I;M=(I-P*K)/2|0;O.translate(M,M);for(var Q=0;Q<K;Q++){var L=Q*P;for(var J=0;J<K;J++){O.fillStyle=o.isDark(Q,J)?o.dark:o.bright;O.fillRect(J*P,L,P,P)}}return N.toDataURL()};return o};G.dataUrl=function(o,k,p,n){p=p|0>0?p|0:1;n=n||"L";try{var m=G(p,n);m.addData(o);m.make();return m.createDataUrl(k)}catch(l){if(/code length overflow/.test(l.message)){return G.dataUrl(o,k,p+1,n)}else{throw (l)}}};G.stringToBytes=function(n){var m=new Array();for(var l=0;l<n.length;l+=1){var k=n.charCodeAt(l);m.push(k&255)}return m};G.createStringToBytes=function(k,n){var l=function(){var r=E(k);var q=function(){var I=r.read();if(I==-1){throw new Error()}return I};var o=0;var N={};while(true){var t=r.read();if(t==-1){break}var u=q();var L=q();var M=q();var p=String.fromCharCode((t<<8)|u);var s=(L<<8)|M;N[p]=s;o+=1}if(o!=n){throw new Error(o+" != "+n)}return N}();var m="?".charCodeAt(0);return function(p){var r=new Array();for(var q=0;q<p.length;q+=1){var o=p.charCodeAt(q);if(o<128){r.push(o)}else{var s=l[p.charAt(q)];if(typeof s=="number"){if((s&255)==s){r.push(s)}else{r.push(s>>>8);r.push(s&255)}}else{r.push(m)}}}return r}};var c={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var d={L:1,M:0,Q:3,H:2};var C={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var v=function(){var k=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]];var m=(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0);var o=(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0);var n=(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1);var p={};var l=function(r){var q=0;while(r!=0){q+=1;r>>>=1}return q};p.getBCHTypeInfo=function(r){var q=r<<10;while(l(q)-l(m)>=0){q^=(m<<(l(q)-l(m)))}return((r<<10)|q)^n};p.getBCHTypeNumber=function(r){var q=r<<12;while(l(q)-l(o)>=0){q^=(o<<(l(q)-l(o)))}return(r<<12)|q};p.getPatternPosition=function(q){return k[q-1]};p.getMaskFunction=function(q){switch(q){case C.PATTERN000:return function(r,s){return(r+s)%2==0};case C.PATTERN001:return function(r,s){return r%2==0};case C.PATTERN010:return function(r,s){return s%3==0};case C.PATTERN011:return function(r,s){return(r+s)%3==0};case C.PATTERN100:return function(r,s){return(Math.floor(r/2)+Math.floor(s/3))%2==0};case C.PATTERN101:return function(r,s){return(r*s)%2+(r*s)%3==0};case C.PATTERN110:return function(r,s){return((r*s)%2+(r*s)%3)%2==0};case C.PATTERN111:return function(r,s){return((r*s)%3+(r+s)%2)%2==0};default:throw new Error("bad maskPattern:"+q)}};p.getErrorCorrectPolynomial=function(r){var s=A([1],0);for(var q=0;q<r;q+=1){s=s.multiply(A([1,F.gexp(q)],0))}return s};p.getLengthInBits=function(q,r){if(1<=r&&r<10){switch(q){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+q)}}else{if(r<27){switch(q){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+q)}}else{if(r<41){switch(q){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+q)}}else{throw new Error("type:"+r)}}}};p.getLostPoint=function(t){var U=t.getModuleCount();var T=0;for(var r=0;r<U;r+=1){for(var V=0;V<U;V+=1){var u=0;var P=t.isDark(r,V);for(var q=-1;q<=1;q+=1){if(r+q<0||U<=r+q){continue}for(var Q=-1;Q<=1;Q+=1){if(V+Q<0||U<=V+Q){continue}if(q==0&&Q==0){continue}if(P==t.isDark(r+q,V+Q)){u+=1}}}if(u>5){T+=(3+u-5)}}}for(var r=0;r<U-1;r+=1){for(var V=0;V<U-1;V+=1){var S=0;if(t.isDark(r,V)){S+=1}if(t.isDark(r+1,V)){S+=1}if(t.isDark(r,V+1)){S+=1}if(t.isDark(r+1,V+1)){S+=1}if(S==0||S==4){T+=3}}}for(var r=0;r<U;r+=1){for(var V=0;V<U-6;V+=1){if(t.isDark(r,V)&&!t.isDark(r,V+1)&&t.isDark(r,V+2)&&t.isDark(r,V+3)&&t.isDark(r,V+4)&&!t.isDark(r,V+5)&&t.isDark(r,V+6)){T+=40}}}for(var V=0;V<U;V+=1){for(var r=0;r<U-6;r+=1){if(t.isDark(r,V)&&!t.isDark(r+1,V)&&t.isDark(r+2,V)&&t.isDark(r+3,V)&&t.isDark(r+4,V)&&!t.isDark(r+5,V)&&t.isDark(r+6,V)){T+=40}}}var s=0;for(var V=0;V<U;V+=1){for(var r=0;r<U;r+=1){if(t.isDark(r,V)){s+=1}}}var R=Math.abs(100*s/U/U-50)/5;T+=R*10;return T};return p}();var F=function(){var m=new Array(256);var n=new Array(256);for(var l=0;l<8;l+=1){m[l]=1<<l}for(var l=8;l<256;l+=1){m[l]=m[l-4]^m[l-5]^m[l-6]^m[l-8]}for(var l=0;l<255;l+=1){n[m[l]]=l}var k={};k.glog=function(o){if(o<1){throw new Error("glog("+o+")")}return n[o]};k.gexp=function(o){while(o<0){o+=255}while(o>=256){o-=255}return m[o]};return k}();function A(l,m){if(typeof l.length=="undefined"){throw new Error(l.length+"/"+m)}var n=function(){var o=0;while(o<l.length&&l[o]==0){o+=1}var p=new Array(l.length-o+m);for(var q=0;q<l.length-o;q+=1){p[q]=l[q+o]}return p}();var k={};k.get=function(o){return n[o]};k.getLength=function(){return n.length};k.multiply=function(o){var q=new Array(k.getLength()+o.getLength()-1);for(var p=0;p<k.getLength();p+=1){for(var r=0;r<o.getLength();r+=1){q[p+r]^=F.gexp(F.glog(k.get(p))+F.glog(o.get(r)))}}return A(q,0)};k.mod=function(o){if(k.getLength()-o.getLength()<0){return k}var p=F.glog(k.get(0))-F.glog(o.get(0));var r=new Array(k.getLength());for(var q=0;q<k.getLength();q+=1){r[q]=k.get(q)}for(var q=0;q<o.getLength();q+=1){r[q]^=F.gexp(F.glog(o.get(q))+p)}return A(r,0).mod(o)};return k}var w=function(){var l=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];var m=function(q,p){var o={};o.totalCount=q;o.dataCount=p;return o};var k={};var n=function(o,p){switch(p){case d.L:return l[(o-1)*4+0];case d.M:return l[(o-1)*4+1];case d.Q:return l[(o-1)*4+2];case d.H:return l[(o-1)*4+3];default:return undefined}};k.getRSBlocks=function(o,s){var p=n(o,s);if(typeof p=="undefined"){throw new Error("bad rs block @ typeNumber:"+o+"/errorCorrectLevel:"+s)}var q=p.length/3;var u=new Array();for(var M=0;M<q;M+=1){var L=p[M*3+0];var r=p[M*3+1];var t=p[M*3+2];for(var N=0;N<L;N+=1){u.push(m(r,t))}}return u};return k}();var z=function(){var l=new Array();var m=0;var k={};k.getBuffer=function(){return l};k.get=function(n){var o=Math.floor(n/8);return((l[o]>>>(7-n%8))&1)==1};k.put=function(n,o){for(var p=0;p<o;p+=1){k.putBit(((n>>>(o-p-1))&1)==1)}};k.getLengthInBits=function(){return m};k.putBit=function(o){var n=Math.floor(m/8);if(l.length<=n){l.push(0)}if(o){l[n]|=(128>>>(m%8))}m+=1};return k};var H=function(k){var n=c.MODE_8BIT_BYTE;var m=k;var l=G.stringToBytes(k);var o={};o.getMode=function(){return n};o.getLength=function(p){return l.length};o.write=function(q){for(var p=0;p<l.length;p+=1){q.put(l[p],8)}};return o};var b=function(){var l=new Array();var k={};k.writeByte=function(m){l.push(m&255)};k.writeShort=function(m){k.writeByte(m);k.writeByte(m>>>8)};k.writeBytes=function(m,o,n){o=o||0;n=n||m.length;for(var p=0;p<n;p+=1){k.writeByte(m[p+o])}};k.writeString=function(m){for(var n=0;n<m.length;n+=1){k.writeByte(m.charCodeAt(n))}};k.toByteArray=function(){return l};k.toString=function(){var m="";m+="[";for(var n=0;n<l.length;n+=1){if(n>0){m+=","}m+=l[n]}m+="]";return m};return k};var D=function(){var l=0;var q=0;var n=0;var m="";var p={};var k=function(r){m+=String.fromCharCode(o(r&63))};var o=function(r){if(r<0){}else{if(r<26){return 65+r}else{if(r<52){return 97+(r-26)}else{if(r<62){return 48+(r-52)}else{if(r==62){return 43}else{if(r==63){return 47}}}}}}throw new Error("n:"+r)};p.writeByte=function(r){l=(l<<8)|(r&255);q+=8;n+=1;while(q>=6){k(l>>>(q-6));q-=6}};p.flush=function(){if(q>0){k(l<<(6-q));l=0;q=0}if(n%3!=0){var r=3-n%3;for(var s=0;s<r;s+=1){m+="="}}};p.toString=function(){return m};return p};var E=function(q){var n=q;var m=0;var l=0;var p=0;var o={};o.read=function(){while(p<8){if(m>=n.length){if(p==0){return -1}throw new Error("unexpected end of file./"+p)}var r=n.charAt(m);m+=1;if(r=="="){p=0;return -1}else{if(r.match(/^\s$/)){continue}}l=(l<<6)|k(r.charCodeAt(0));p+=6}var s=(l>>>(p-8))&255;p-=8;return s};var k=function(r){if(65<=r&&r<=90){return r-65}else{if(97<=r&&r<=122){return r-97+26}else{if(48<=r&&r<=57){return r-48+52}else{if(r==43){return 62}else{if(r==47){return 63}else{throw new Error("c:"+r)}}}}}};return o};var a=function(q,s){var n=q;var m=s;var p=new Array(q*s);var l={};l.setPixel=function(J,t,u){p[t*n+J]=u};l.write=function(K){K.writeString("GIF87a");K.writeShort(n);K.writeShort(m);K.writeByte(128);K.writeByte(0);K.writeByte(0);K.writeByte(0);K.writeByte(0);K.writeByte(0);K.writeByte(255);K.writeByte(255);K.writeByte(255);K.writeString(",");K.writeShort(0);K.writeShort(0);K.writeShort(n);K.writeShort(m);K.writeByte(0);var u=2;var L=o(u);K.writeByte(u);var t=0;while(L.length-t>255){K.writeByte(255);K.writeBytes(L,t,255);t+=255}K.writeByte(L.length-t);K.writeBytes(L,t,L.length-t);K.writeByte(0);K.writeString(";")};var k=function(M){var L=M;var u=0;var N=0;var t={};t.write=function(J,I){if((J>>>I)!=0){throw new Error("length over")}while(u+I>=8){L.writeByte(255&((J<<u)|N));I-=(8-u);J>>>=(8-u);N=0;u=0}N=(J<<u)|N;u=u+I};t.flush=function(){if(u>0){L.writeByte(N)}};return t};var o=function(Y){var U=1<<Y;var W=(1<<Y)+1;var S=Y+1;var u=r();for(var V=0;V<U;V+=1){u.add(String.fromCharCode(V))}u.add(String.fromCharCode(U));u.add(String.fromCharCode(W));var X=b();var Z=k(X);Z.write(U,S);var R=0;var t=String.fromCharCode(p[R]);R+=1;while(R<p.length){var T=String.fromCharCode(p[R]);R+=1;if(u.contains(t+T)){t=t+T}else{Z.write(u.indexOf(t),S);if(u.size()<4095){if(u.size()==(1<<S)){S+=1}u.add(t+T)}t=T}}Z.write(u.indexOf(t),S);Z.write(W,S);Z.flush();return X.toByteArray()};var r=function(){var u={};var J=0;var t={};t.add=function(I){if(t.contains(I)){throw new Error("dup key:"+I)}u[I]=J;J+=1};t.size=function(){return J};t.indexOf=function(I){return u[I]};t.contains=function(I){return typeof u[I]!="undefined"};return t};return l};var B=function(q,s,k,m){var n=a(q,s);var t=b();n.write(t);var l=D();var r=t.toByteArray();for(var o=0;o<r.length;o+=1){l.writeByte(r[o])}l.flush();var p="";p+="<img";p+='\u0020src="';p+="data:image/gif;base64,";p+=l;p+='"';p+='\u0020width="';p+=q;p+='"';p+='\u0020height="';p+=s;p+='"';if(m){p+='\u0020alt="';p+=m;p+='"'}p+="/>";return p};return G}();i.exports=h},{}],42:[function(l,j,h){var i=l("./class-qr");var k={setURL:function(a,b){k._setCode(document.querySelector("#qrHolder img"),a,b)},setShareURL:function(b,c){var a=document.querySelectorAll(".qrContainer");_.each(a,function(d){k._setCode(d,b,c)})},_setCode:function(b,a,c){if(b instanceof HTMLImageElement){b.src=i.dataUrl(a)}else{b.style.backgroundPosition="center";b.style.backgroundRepeat="no-repeat"}}};j.exports=k},{"./class-qr":41}],43:[function(i,n,j){var k=i("./class-storage");var l=i("./utils-editor");var m={isScrolling:false,isSwiping:false,isDoubleTapping:false,isTapHolding:false,setup:function(a){$.mobile.scrollview.prototype._handleDragStart=(function(b){var c=$.mobile.scrollview.prototype._handleDragStart;return function d(p){var h=$.inArray($(p.target).closest(".pageWidget").attr("id"),a.linkOrigin);if(h==-1){h=$.inArray($(p.target).closest(".pageWidget").data("lockto"),a.linkOrigin)}var f=h>-1&&a.triggerType[h];if(f&&(f=="taphold"||f=="doubletap"||f.substr(0,5)=="swipe")){return true}c.apply(this,arguments)}}());$.mobile.scrollview.prototype._handleDragMove=(function(b){var c=$.mobile.scrollview.prototype._handleDragMove;return function d(f){m.isScrolling=true;c.apply(this,arguments)}}());$.mobile.scrollview.prototype._handleDragStop=(function(c){var d=$.mobile.scrollview.prototype._handleDragStop;return function b(f){setTimeout(function(){m.isScrolling=false},10);d.apply(this,arguments)}}())},showPage:function(c){var d=$(this);d.find(".ui-content").attr("data-"+$.mobile.ns+"scroll","y");var f=k.get(g_preview).pageWH;var b,s=$(d).attr("id");if(s=="home"){return}b=[k.get(s).width,k.get(s).height];if(f[0]>=b[0]&&f[1]>=b[1]){return}var a=k.get(g_preview).orientation;var r=k.get(s).orientation;var h=a==r;var t="xy";if(!h){b=[b[1],b[0]]}if(b[0]==f[0]){t=h?"y":"x"}if(b[1]==f[1]){t=h?"x":"y"}d.find(":jqmData(scroll):not(.ui-scrollview-clip)").each(function(){var p=$(this);var o=p.attr("id");if(p.hasClass("ui-scrolllistview")){p.scrolllistview();return true}var w=p.jqmData("scroll")+"";var z=w&&w.search(/^[xy]p$/)!=-1;var q={direction:t||undefined,paging:z||undefined,scrollMethod:p.jqmData("scroll-method")||undefined};p.scrollview(q)});if(!h){f=[f[1],f[0]]}d.css({"min-height":l.getTrueHeight()+"px"}).children(".ui-content").css({width:f[0]+"px",height:f[1]+"px"})}};n.exports=m},{"./class-storage":46,"./utils-editor":98}],44:[function(q,s,p){var o=q("./class-storage");var r=q("./class-qrCode");var n=q("./class-page");var m=q("./class-projectSettings");var t=q("./instanceIdUtil");var l={lastProjectId:null,url:null,url2:null,downloadURL:null,printURL:null,init:function(a){l.lastProjectId=a;l.setElements(a);$("input[data-default]").click();fluid.main.on("projectOpened,projectSharingOpened",function(){$("#downloadScreenflow, #downloadScreens").siblings(".msg").find("a").remove()});fluid.main.on("editor.afterLogout",function(){$(".exportImgHolder .msg a").remove()})},setElements:function(b){var f=o.get(b);var c=(document.location.href).split("?");var a=b+"."+f.updated;l.url=c[0]+"project/"+a;l.url2=c[0]+"preview/"+a;l.downloadURL=c[0]+"export/"+a;l.printURL=c[0]+"?p="+b+"&print=y&print_inter=y";var d="Mobile mockup created with FluidUI.com from @FluidUI_Team "+l.url2;r.setShareURL(l.url,242);$(".previewExternal").attr("href",l.url2);$(".shareSendMail").find("[name=p]").val(a)},actionCopyLinkOrCode:function(a){$("#copyPreviewLink").val(l.url2);$(a.target).select();return false},actionAlertCopyLink:function(a){fluid.main.fire("addNotification","alert","Link copied");fluid.main.fire("shareLinkCopy")},actionMailSent:function(a){l.mailClear()},actionParseSnapshot:function(b,c,a){try{var f=JSON.parse(a.responseText)}catch(d){fluid.main.fire("addNotification","alert","Error starting export");return false}if(f.a==="PAGES"){$msgBox=("#projectSettingsShareTop .shareLinkExportImg").next(".msg")}else{$msgBox=("#projectSettingsShareTop .shareLinkExportImgFull").next(".msg")}if(f.r=="s"){if(f.queue===0){$msgBox.html("exporting...");$msgBox.addClass("pulsing");fluid.main.fire("addNotification","alert","Export in progress. Please stick with us, this can take up to a minute.")}else{$msgBox.html("queued ("+f.queue+")...");$msgBox.addClass("pulsing");fluid.main.fire("addNotification","alert","Project queued for export. Please wait.")}l.startExportPolling(f.snapshotId)}else{$msgBox.html("error...");$msgBox.removeClass("pulsing");fluid.main.fire("addNotification","alert","Error starting export")}},startExportPolling:function(a){if(!l.exportPollTimeout){l.exportPollTimeout=7000;l.exportPollMaxRetries=50}l.exportPollTried=0;setTimeout(l.pollExport.bind(l,a),l.exportPollTimeout)},pollExport:function(a){$.ajax({url:"./index.php",type:"POST",data:{t:"getExportStatus",snapshotId:a},success:function(b,c,d){var h=JSON.parse(b);var f;if(h.projectId!==fluid.main.project.get("id")){return}if(h.stype==="PAGES"){f=("#projectSettingsShareTop .shareLinkExportImg").next(".msg")}else{f=("#projectSettingsShareTop .shareLinkExportImgFull").next(".msg")}if(h.status==="FAILED"){l.exportPollTried=0;f.html("failed...");f.removeClass("pulsing")}else{if(h.status==="FINISHED"){fluid.main.fire("addNotification","alert",'Export done successfully. Click <a class="export-link" rel="'+h.snapshotId+'">here</a> to download');l.exportPollTried=0;f.html('<a class="export-link" rel="'+h.snapshotId+'">Download ('+h.processDate+")</a>");f.removeClass("pulsing")}else{if(h.status==="STARTED"||(h.status==="NEW"&&h.queue===0)){f.html("exporting...");f.addClass("pulsing");l.exportPollTried++;if(l.exportPollTried<l.exportPollMaxRetries){setTimeout(l.pollExport.bind(l,a),l.exportPollTimeout)}}else{if(h.status==="NEW"){f.html("queued ("+h.queue+")...");f.addClass("pulsing");l.exportPollTried++;if(l.exportPollTried<l.exportPollMaxRetries){setTimeout(l.pollExport.bind(l,a),l.exportPollTimeout)}}}}}},error:function(b,c,d){l.exportPollTried=0;$msgBox.html("error...")}})},downloadExport:function(){var a=$(this).attr("rel");window.open(document.location.origin+document.location.pathname+"snapshot/"+a,"_snapshot")},actionLogSharedProject:function(a){var b=$(a.target).attr("data-for");fluid.main.fire("apiRequest","shareLog",l.lastProjectId,b,function(){fluid.main.fire("addNotification","alert","Project shared")},function(){fluid.main.fire("addNotification","alert","Project could not be shared")})},actionLink:function(d){if($(this).hasClass("disabled")){return}var a=[];function X(v){var z=v.getHours();var u=v.getMinutes();var w=z>=12?"pm":"am";z=z%12;z=z?z:12;u=u<10?"0"+u:u;return z+":"+u+w}var c=new Date();var aq=c.getDate()+"-"+(c.getMonth()+1)+"-"+c.getFullYear()+" "+X(c);var an,aw,ae=[],ao=fluid.main.project.id,at=o.get(ao),h=at.name,ah,ay,Z=0,k,ar,am,Y,ad,f,aa=false;var aj=function(w,z){w=w.replace(/\/|\||\?|\*|\|/g,"_");var v=w;if(z){v=v||"Project"}else{var u=1;while(a.indexOf(v)!==-1){v=w+" "+u;u+=1}a.push(v)}return v};function ab(w,v){if(window.Windows&&Windows.UI){var z=new FileReader();z.onload=function(){var A=new Uint8Array(this.result);u(A,v)};z.readAsArrayBuffer(w)}else{saveAs(w,v)}function u(D,C){var B=Windows.UI.ViewManagement.ApplicationView.value;if(B===Windows.UI.ViewManagement.ApplicationViewState.snapped&&!Windows.UI.ViewManagement.ApplicationView.tryUnsnap()){return}var A=new Windows.Storage.Pickers.FileSavePicker();A.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.documentsLibrary;A.fileTypeChoices.insert("compressed file",[".zip"]);A.suggestedFileName=C||"New Project";A.pickSaveFileAsync().then(function(G){if(G){Windows.Storage.CachedFileManager.deferUpdates(G);var F=new Windows.Storage.Streams.InMemoryRandomAccessStream();var E=new Windows.Storage.Streams.DataWriter(F);var H=E.writeBytes(D);E.close();Windows.Storage.FileIO.WriteBufferAsync(G,H).done(function(){Windows.Storage.CachedFileManager.completeUpdatesAsync(G).done(function(I){if(I===Windows.Storage.Provider.FileUpdateStatus.complete){}else{}})})}})}}function ap(v){var u=new FormData();u.append("t","uploadExportForSafari");u.append("safariZip",v);u.append("iid",t());$.ajax({url:document.location.origin+document.location.pathname,data:u,cache:false,contentType:false,processData:false,type:"POST"}).done(function(w){window.location.href=document.location.origin+document.location.pathname+"?downloadExportForSafari&filename="+w}).fail(function(){throw"unknown error during download"})}var av=d.target.classList.toString().match(/shareLinkDownload|everUsedExport|shareLinkExportLocalFull|shareLinkExportLocal|shareLinkPrint/);if(!av){return}else{target=av[0]}if(fluid.main.fire("share.beforeAction",target)){var j=$(d.target);if(j.attr("id")=="downloadHTML"){if(j.hasClass("disabled")){return}window.open(l.downloadURL,"_export");fluid.main.fire("projectExport")}else{if(j.attr("id")=="printMockup"){window.g_window_print=window.open(l.printURL,"_print")}else{if(j.attr("id")=="downloadScreens"){fluid.main.fire("addNotification","alert","Export in progress. Please stick with us, this can take up to a minute.");if(window.JSZip){an=new JSZip();k=an.folder(aj(h,true));ad=function(u,v){if(u&&v){u=aj(u);u+=".png";v=v.slice(v.indexOf(",")+1);k.file(u,v,{base64:true})}else{fluid.main.fire("addNotification","alert","Baah! Something went wrong...")}};f=function(){var v=an.generate({type:"blob"});var u=aj(h,true)+" "+aq+".zip";if(window.safari){ap(v)}else{ab(v,u)}};ay=at.pages;setTimeout(function(){var u=1;var v={};var w=[];ay.forEach(function(A){var z=fluid.main.project.pages.get(A).attributes.name;var B="page "+(z||u++);if(w.indexOf(B)===-1){w.push(B)}else{if(z){B+=u++;w.push(B)}}v[A]=B;n.drawRasterised(A,function(C,D){ad(v[C],D);Z+=1;if(ay.length===Z){f()}},true,true)})},300)}else{fluid.main.fire("addNotification","alert","Baah! Something went wrong...")}}else{if(j.attr("id")=="downloadScreenflow"){fluid.main.fire("addNotification","alert","Export in progress. Please stick with us, this can take up to a minute.");Y=function(v,w){var z=v[0];var u;if(w){for(u=1;u<v.length;u++){if(v[u]>z){z=v[u]}}}else{for(u=1;u<v.length;u++){if(v[u]<z){z=v[u]}}}return z};ay=at.pages;var ac={};var al=[],ak=[],ag=[],af=[];var ai={xMin:null,yMin:null,xMax:null,yMax:null,padding:20};var i=0;var b=0;var ax=0;var au=0;ay.forEach(function(w){var v=o.get(w);var z=v.x+v.width;var u=v.y+v.height;ac[w]={x:v.x,y:v.y,width:v.width,height:v.height,data:null};al.push(v.x);ak.push(v.y);ag.push(z);af.push(u)});ai.xMin=Y(al);ai.xMax=Y(ag,true);ai.yMin=Y(ak);ai.yMax=Y(af,true);ar=function(D,M){var G="",E="",B,w,H=D[ay[0]];var L=ai.xMax-ai.xMin+2*ai.padding;var v=ai.yMax-ai.yMin+2*ai.padding;var z=function(V,S,aI){var W,Q,O,aF;var aH=0,aL=0,aM=0,aN=0,aG,aK;W=S.y+V.top+V.height/2;Q=S.x+V.left+V.width/2;O=(aI.y+aI.height/2);aF=(aI.x+aI.width/2);var R=aF-Q;var U=O-W;var N=U/R;if(Math.abs(N)>aI.height/aI.width){if(O>W){aM=R-aI.height/(2*N)}else{aM=R+aI.height/(2*N)}aN=aM*N}else{if(aF>Q){aM=R-aI.width/2}else{aM=R+aI.width/2}aN=N*aM}aH=(Q+aH);aL=(W+aL);aM=(Q+aM);aN=(W+aN);var az=Math.sqrt(Math.pow((aH-aM),2)+Math.pow((aL-aN),2));var T=20/az;var P=T*aH+(1-T)*aM;var aJ=T*aL+(1-T)*aN;return{x1:aH-ai.xMin+ai.padding,x2:P-ai.xMin+ai.padding,y1:aL-ai.yMin+ai.padding,y2:aJ-ai.yMin+ai.padding}};var A=function(W,aK,aF,aL){var az='<line stroke-linecap="butt" x1="'+W+'" y1="'+aK+'" x2="'+aF+'" y2="'+aL+'" stroke="#3fa9f5" stroke-width="10"/>\n';var aJ=6;var O=10;var R=20;var T=(W-aF);var V=(aK-aL);var U=Math.sqrt(T*T+V*V);var aG=T/U;var aI=V/U;aF=aF+(O-R)*aG;aL=aL+(O-R)*aI;var aE=aF+O*aG;var aH=aL+O*aI;var N=aE-aJ*aI;var P=aH+aJ*aG;var Q=aE+aJ*aI;var S=aH-aJ*aG;az+='<polygon points="'+aF+","+aL+" "+N+","+P+" "+Q+","+S+'" stroke="#3fa9f5" stroke-width="10"/>\n';return az};var C=at.links;var I='<marker xmlns="http://www.w3.org/2000/svg" id="triangle" viewBox="0 0 10 10" refX="3.5" refY="5" fill="#3fa9f5" markerUnits="strokeWidth" markerWidth="4" markerHeight="3" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z"/></marker>\n';G+='<?xml version="1.0" encoding="utf-8"?>\n';G+='<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n';G+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="'+L+'px" height="'+v+'px">\n';G+=I;E=G;var F=u();var J=K();function K(){var N="";N+="<g>\n";ay.forEach(function(S){var T=D[S];var O=T.x-ai.xMin+ai.padding;var Q=T.y-ai.yMin+ai.padding;var P=T.width;var R=T.height;N+='    <image xlink:href="'+T.data+'" x="'+O+'" y="'+Q+'" height="'+R+'px" width="'+P+'px"/>\n';N+='    <rect x="'+O+'" y="'+Q+'" height="'+R+'px" width="'+P+'px" stroke="black" strokeWidth="2" fill="none"/>\n'});N+="</g>\n";return N}function u(){var N="";if(C.linkOrigin&&C.linkOrigin.length){N+="<g>\n";C.linkOrigin.forEach(function(O,U){var P=o.get(C.linkDest[U]);var S=o.get(O,{returnModel:true});if(!S){return}var R=S.getBox();var Q=o.get(S.getPage().id);if(Q&&P){var T={};T.left=R[0];T.top=R[1];T.width=R[2];T.height=R[3];calcLine=z(T,Q,P);N+=A(calcLine.x1,calcLine.y1,calcLine.x2,calcLine.y2)}});N+="</g>\n"}return N}G+=J;G+=F;E+=F;E+=J;G+="</svg>";E+="</svg>";return{linksOnTop:G,normal:E}};an=new JSZip();k=an.folder(aj(h,true));ad=function(u,v){if(u&&v){u=aj(u);k.file(u,v)}else{fluid.main.fire("addNotification","alert","Baah! Something went wrong...")}};f=function(){var v=an.generate({type:"blob"});var u=aj(h,true)+" "+aq+".zip";if(window.safari){ap(v)}else{ab(v,u)}};am=function(){var z=ay[Z],u,w,v,A;n.drawRasterised(z,function(B,C){ac[B].data=C;Z+=1;if(ay[Z]){am()}else{v=ar(ac);ad((h||"Project")+" visible links.svg",v.linksOnTop);ad((h||"Project")+".svg",v.normal);f()}},true,true)};setTimeout(function(){am()},300)}}}}}},mailClear:function(b,c){if(c&&c.r==="s"){b=null}var a=$("#shareSendMailReceipients");if(b){fluid.main.fire("addNotification","alert",b)}else{var d=a.val();if($("#collaboratorPermission").val()=="sendCopy"){fluid.main.fire("addNotification","alert","Project sent successfully");a.val("")}else{fluid.main.fire("addNotification","alert","A link to your mockup has been sent"+(d?(" to "+d):""));a.val("")}}},sendMail:function(){var a=$(this).find("input[name=email]").val();var b=$(this).find("input[name=p]").val();var c=$("#shareOptionsSelector").val();if(c=="sendPreviewLink"){fluid.main.fire("apiRequest","previewMail",a,b,function(){l.mailClear()},function(){fluid.main.fire("addNotification","alert","Failed to send mockup link - please ensure you have entered a proper email address and that user has an account.")})}else{if(c=="sendCopy"){if(a.indexOf(fluid.main.account.get("email"))!==-1){l.mailClear("Use clone in project settings. Unable to send to own account.",null)}else{fluid.main.fire("apiRequest","projectTransfer",fluid.main.project.get("id"),a,l.projectTransferCallback,l.projectTransferCallback)}}else{fluid.main.fire("addNotification","alert","Failed to send - unknown action selected.")}}return false},projectTransferCallback:function(a,b){if(a&&a[0]==="{"){a=JSON.parse(a);if(a.r==="f"){b=a.t}}fluid.main.fire("projecttransfercomplete",b,a)},shareProject:function(){$("#tmplCollaboratorList").tmpl().appendTo("#collaboratorList")}};fluid.main.on("projecttransfercomplete",function(b,a,c){l.mailClear(a,c)});fluid.main.on("sharemenuopen",function(b,a){l.init(a)});fluid.main.on("project.opened",function(){l.setElements(fluid.main.project.id);l.lastProjectId=fluid.main.project.id});s.exports=l},{"./class-page":34,"./class-projectSettings":39,"./class-qrCode":42,"./class-storage":46,"./instanceIdUtil":94}],45:[function(p,o,j){var l=p("./class-storage");var m=p("./utils-editor");var n=p("./class-page");var k={initMenus:function(){k.fixedWidget=$("#fixedWidget");k.unfixedWidget=$("#unfixedWidget");k.fixedWidgetMenu=$("#fixedWidgetMenu");k.fixedWidgetsEditor=$("#contextMenuItems .fixedWidgetsEditor");k.pinnedBtn=$("#pinnedBtn");k.unpinnedBtn=$("#unpinnedBtn")},changeContextMenuIndicators:function(a){var b=k.determineStatic(a);k.unfixedWidget.hide();k.fixedWidget.hide();(b==false)?k.unfixedWidget.show():k.fixedWidget.show()},updateMenu:function(){var a=fluid.selection.getSelectionModel().getElements().not(".backgroundWidget");k.changeContextMenuIndicators(a);var c=k.staticMenuOpen;k.hideMenu();if(c==true){var b=m.findPositionOnScreen(a);if(a.length>0&&b==true){k.showMenu(a)}}},hideMenu:function(){k.staticMenuOpen=false;k.fixedWidgetsEditor.hide()},positionMenu:function(){var c=$("#staticWidgetBtn");var d=parseInt(c.css("left"));var a=parseInt(c.css("width"));var f=parseInt($("#fixedWidgMenuHolder").css("width"))+(2*(parseInt($("#fixedWidgMenuHolder").css("padding-left"))));var b=d+a-f;k.fixedWidgetMenu.css("left",(b)).css("top",45)},showMenu:function(a){k.positionMenu();k.staticMenuOpen=true;if(!a){a=fluid.selection.getSelectionModel().getElements()}k.fixedWidgetsEditor.show();var b=k.determineStatic(a);k.updateButtonStates(b,a)},updateButtonStates:function(d,b){function c(){k.pinnedBtn.hide().removeClass("pinBtnActivated");k.unpinnedBtn.removeClass("pinBtnActivated singlePinnedBtn");$("#fixedWidgMenuHolder").removeClass("smallFixedWidgMenu")}c();var a=m.findPositionOnScreen(b);if(a==true){switch(d){case (false):k.pinnedBtn.show();k.unpinnedBtn.addClass("pinBtnActivated");break;case ("front"):k.pinnedBtn.show().addClass("pinBtnActivated");break;case ("back"):k.pinnedBtn.show().addClass("pinBtnActivated");break}}else{if(d=="front"||d=="back"){k.pinnedBtn.show().addClass("pinBtnActivated")}else{$("#fixedWidgMenuHolder").addClass("smallFixedWidgMenu");k.unpinnedBtn.addClass("pinBtnActivated singlePinnedBtn");k.positionMenu()}}},staticMenuOpen:false,toggleStaticWidgetMenu:function(){if(k.staticMenuOpen==true){k.hideMenu()}else{k.showMenu();fluid.main.fire("staticwdgmenushown")}},hideStaticBoundary:function(){$("#staticBoundary1, #staticBoundary2").remove()},drawBoundaries:function(r){var a=$("#staticBoundary1, #staticBoundary2, #staticBoundary3, #staticBoundary4");a.remove();$staticBoundary1=$('<div id="staticBoundary1"></div>');$staticBoundary2=$('<div id="staticBoundary2"></div>');$staticBoundary3=$('<div id="staticBoundary3"></div>');$staticBoundary4=$('<div id="staticBoundary4"></div>');$("#"+fluid.zoom.getActivePageId()).append($staticBoundary1,$staticBoundary2,$staticBoundary3,$staticBoundary4);var c=r.pageId,h=r.pageHeight,d=r.pageWidth,b=r.deviceWidth,f=r.deviceHeight,i=1/fluid.zoom.getCurrentScale()*2;if(i<1){i=1}if(h!==f){$staticBoundary1.css({width:b,height:f,background:"linear-gradient(to right, #3FA9F5 0%, #3FA9F5 40.70588%, transparent 40.70588%)",backgroundPosition:"0 bottom",backgroundSize:"30px "+i+"px",backgroundRepeat:"repeat-x"});$staticBoundary2.css({left:15,width:b-15,height:f,background:"linear-gradient(to right, #FFFFFF 0%, #FFFFFF 40.70588%, transparent 40.70588%)",backgroundPosition:"0 bottom",backgroundSize:"30px "+i+"px",backgroundRepeat:"repeat-x"})}if(d!==b){$staticBoundary3.css({width:b,height:f,background:"linear-gradient(to bottom, #3FA9F5 0%, #3FA9F5 40.70588%, transparent 40.70588%)",backgroundPosition:"right 0",backgroundSize:i+"px 30px",backgroundRepeat:"repeat-y"});$staticBoundary4.css({top:15,width:b,height:f-15,background:"linear-gradient(to bottom, #FFFFFF 0%, #FFFFFF 40.70588%, transparent 40.70588%)",backgroundPosition:"right 0",backgroundSize:i+"px 30px",backgroundRepeat:"repeat-y"})}},zoomInBoundary:function(){if(fluid.main.project.get("active")===false){return}k.hideStaticBoundary();var a=fluid.zoom.getActivePageId();if(a){k.showStaticBoundary(a)}},hLimiter:false,vLimiter:false,currentPageId:false,showStaticBoundary:function(f){var h=fluid.main.project.pages.get(f);if(h){var c=l.get(f).width;var d=l.get(f).height;var b=fluid.main.project.get("pageWH");b=$.extend(true,[],b);var s=h.get("orientation");var i=b[0];var t=b[1];var a=(i<t)?"Portrait":"Landscape";if(s!==a){i=b[1];t=b[0]}k.drawBoundaries({pageId:f,pageHeight:d,pageWidth:c,deviceWidth:i,deviceHeight:t})}},determineStatic:function(b){allStaticWidgetsFront=[];if(b){var c=b}else{var c=fluid.selection.getSelectionModel().getElements()}c=c.not(".backgroundWidget");var a=c.length;if(a==0){d=false;return}c.each(function(){var f=$(this).attr("id");var h=l.get(f);if(h.st=="f"){allStaticWidgetsFront.push(f)}});var d=false;if(allStaticWidgetsFront.length==a){d="front"}return d},getSelection:function(){return fluid.selection.getSelectionModel().getLockTos().getElements().not(".backgroundWidget")},getSelectionIds:function(){return fluid.selection.getSelectionModel().getLockTos().withoutBackgrounds().getIds()},mapSelection:function(i){var h=$([]);for(var a=0;a<i.length;a++){var b=$("#"+i[a]);var c=b.attr("data-lockto");var d=$("#"+c);var f=widget.getLockTos($("#"+c));h=h.add(f,d)}return h},createZalignOrder:function(a){var b=[];a.each(function(){var d=$(this);var c=d.nextAll(".rootWidget").first().attr("id");b.push({id:d.attr("id"),fromNextId:c})});return b},pushToForeground:function(){var a=k.getSelection();var b=k.getSelectionIds();if(a.length==0||!a){return}var c=k.determineStatic(a);if(c=="toFront"){return}fluid.command.create("staticToForeground",{direction:"toForeground",pastState:c,ids:b,order:k.createZalignOrder(a)}).dispatchTo("fluid.controllers.widget")},removeStaticProperty:function(){var a=k.getSelection();var b=k.getSelectionIds();if(a.length==0||!a){return}var c=k.determineStatic(a);if(c==false){return}fluid.command.create("removeStaticWidgets",{pastState:c,ids:b}).dispatchTo("fluid.controllers.widget")},zAlignWidgets:function(b,f,a){var d=fluid.main.project.widgets.getRoots(b,{returnEls:true});var c=(f=="toBackground")?"cmBack":"cmFront";fluid.main.fire("zalignmentchange",{direction:c,roots:d,renderBlurs:a,pageId:fluid.zoom.getActivePageId()})},alignAll:function(i){i=i||fluid.zoom.getActivePageId();if(!i){return}var f=l.get(i);var c=f.widgets;var a=$([]);var b=false;var u;if(c){for(var h=0;h<c.length;h++){var t=c[h];var d=l.get(t);if(d.st=="f"){u=$("#"+t);b=m.findPositionOnScreen(u);if(b==true){a=a.add(u)}}}}var v=false;k.zAlignWidgets(a,"toForeground",v)},undoZalign:function(c){for(var d=c.length-1;d>=0;d--){var f=c[d];var h=$('[data-lockto="'+f.id+'"]');if(f.fromNextId){h.detach().insertBefore("#"+f.fromNextId)}else{var a=h.parent();h.detach().appendTo(a)}}var b=fluid.zoom.getActivePageId();n.renderBlurs(b)}};fluid.main.on("closeallpopups",k.hideMenu);fluid.main.on("pageactivated",k.zoomInBoundary);fluid.main.on("page.orientantionchanged pageResized",function(b,a){k.zoomInBoundary()});fluid.main.on("staticWidgets:alignAll segmentadded",function(){k.alignAll()});fluid.main.on("widgetsAdded",function(c,b,a){k.alignAll(b)});fluid.main.on("afterStaticToForeground",function(d,a){var b=$("#"+a.join(", #"));var c=k.determineStatic(b);k.changeContextMenuIndicators(b);k.updateButtonStates(c,b);k.zAlignWidgets(b)});fluid.main.on("afterRemoveStaticWidgets",function(c,h,f,d){var a=$("#"+h.join(", #"));var b=k.determineStatic(a);k.changeContextMenuIndicators(a);k.updateButtonStates(b,a);if(f){k.undoZalign(d)}});o.exports=k},{"./class-page":34,"./class-storage":46,"./utils-editor":98}],46:[function(s,t,r){s("./fluid/fluid.main");s("./class-event");var l=s("./utils-editor").getParentWindow;var p=s("./checkHost");var n={tempStorage:{},cachedUpdates:{},caching:false,lastUpdate:new Date().getTime(),get:function(a){if(n.tempStorage[a]){return n.tempStorage[a]}if(localStorage){var b=localStorage.getItem(a);if(b){n.tempStorage[a]=JSON.parse(b);return n.tempStorage[a]}}return null},tabSynchronisationCheckInterval:3000,lastTabSynchronisationCheck:null,set:function(c,f,b){if(!c||!f){return}var d=b==undefined?true:b;if(typeof(f)=="string"){f=JSON.parse(f)}q.lastUpdate=this.lastTabSynchronisationCheck=new Date().getTime();if((f)&&(d)){f.updated=q.lastUpdate}var a=JSON.stringify(f);try{if(this.caching){this.cachedUpdates[c]=f}else{q._setItem(c,a)}this.tempStorage[c]=f}catch(h){}},remove:function(a){delete this.tempStorage[a];delete this.cachedUpdates[a];localStorage.removeItem(a)},cacheStart:function(){this.caching=true},commitCache:function(){if(!this.caching){return}this.caching=false;for(var a in this.cachedUpdates){this.set(a,this.cachedUpdates[a]);delete (this.cachedUpdates[a])}},setTempItem:function(a,b){this.tempStorage[a]=b},removeItem:function(a){localStorage.removeItem(a)},clear:function(){this.tempStorage={};this.cachedUpdates={};localStorage.clear()},_setItem:function(c,b){if(c.slice(0,2)==="p_"){return}var d=false;while(!d){try{localStorage.setItem(c,b);d=true}catch(a){if(a&&(a.name=="QUOTA_EXCEEDED_ERR"||a.name=="NS_ERROR_DOM_QUOTA_REACHED"||a.code===22)){console.log("localStorage overflow")}else{throw a}}}}};var m=true;try{window.top.fluid&&window.top.fluid.main}catch(o){m=false}var q={get:function(c,i){var f=c&&c.substr?c.substr(1,1):"";var a,d,b;if(!c){return false}if(c[0]==="p"){if((!fluid.main.project||fluid.main.project.id!==c)&&fluid.main.projects){a=fluid.main.projects.get(c,i)}else{if(fluid.main.project&&fluid.main.project.id===c){a=fluid.main.project}else{if(m&&window.top.fluid&&window.top.fluid.main&&window.top.fluid.main.projects&&window.top.fluid.main.projects.get(c,i)){a=window.top.fluid.main.projects.get(c,i)}}}if(i&&i.returnModel){return a}else{return a?a.toJSON():false}}else{if(((fluid&&fluid.main&&fluid.main.project)||(window.top.fluid&&window.top.fluid.main&&window.top.fluid.main.project))&&((f==="_"&&(c[0]==="p"||c[0]==="x"||c[0]==="w"||c[0]==="l"))||((c[0]==="p"||c[0]==="x"||c[0]==="w"||c[0]==="l")&&c.length===33))){if(fluid&&fluid.main&&fluid.main.project){d=fluid.main.project.get(c,i)}else{if(window.top.fluid&&window.top.fluid.main&&window.top.fluid.main.project){d=window.top.fluid.main.project.get(c,i)}}if(d){return d}else{_.each(fluid.main.projects,function(k,z,j){var w=j.models[z].get(c,i);if(w){d=w}});return d}}else{if(fluid&&fluid.main&&fluid.main.account&&((f==="_"&&c[0]==="u")||(c[0]==="u"&&c.length===33))){d=fluid.main.account.toJSON();return d}else{if(fluid&&fluid.main&&fluid.main.uploads&&((f==="_"&&c[0]==="i")||(c[0]==="i")||c.length===33)){a=fluid.main.uploads.get(c);if(i&&i.returnModel){return a}else{return a?a.toJSON():false}}else{if(p&&window.g_preview&&l()&&window.fluid.storage){var h=window.top.fluid.storage.get(c,i);return h}}}}}b=n.get(c);if(c!=="accounts"&&c!=="bin"&&b){}if(b){return $.extend({},b)}else{return false}},set:function(c,d,a){d=_.clone(d);var f=c&&c.substr?c.substr(1,1):"";if(!c||!c.length){console.trace();return false}if(f==="_"||((c.length===33)&&(c[0]==="p"||c[0]==="x"||c[0]==="w"||c[0]==="i"||c[0]==="u"))){if(c[0]==="p"&&fluid.main.project){if(fluid.main.project.id===c){fluid.main.project.set(d);return true}else{var h=fluid.main.projects.get(c);if(h){h.set(d);return true}else{return false}}}else{if(c[0]==="u"){if(fluid.main.account&&fluid.main.account.id===c){fluid.main.account.set(d);return true}else{console.error("writing to another account: ",fluid.main.account,c);return false}}else{if(c[0]==="i"){if(!d.id){d.id=c}var b=fluid.main.uploads.get(c);if(b){b.set(d)}else{fluid.main.uploads.add(d)}delete d.id;return true}else{if(c[0]==="b"){var i=fluid.main.account.customwidgets.get(c);if(i){i.set(d)}else{fluid.main.account.customwidgets.add(d)}}else{if(fluid.main.project){fluid.main.project.setChild(c,d);return true}}}}}}n.set(c,d,a);return true},remove:function(a){var b=a.substr(0,2);if(b==="w_"){fluid.main.project.widgets.remove(a)}else{if(b==="x_"){fluid.main.project.pages.remove(a)}}return n.remove(a)},cacheStart:function(){return n.cacheStart()},commitCache:function(){return n.commitCache()},setTempItem:function(a,b){return n.setTempItem(a,b)},removeItem:function(a){return n.removeItem(a)},clear:function(){return n.clear()},_setItem:function(a,b){return n._setItem(a,b)},tempStorage:n.tempStorage};if(!fluid){fluid={}}fluid.storage=q;t.exports=q},{"./checkHost":25,"./class-event":30,"./fluid/fluid.main":68,"./utils-editor":98}],47:[function(r,s,p){var n=r("./class-panels");var q=r("./class-payments");var v=r("./class-canvas");var m=r("./functions");var t=r("./class-event");var u=r("./instanceIdUtil");var o={isOpen:false,panelStack:new Array(),startPanel:null,helpLoaded:false,openMenuAfterExit:true,placeHolders:{feedbackFix:"Tell us a little more so we can fix the bug",feedbackNew:"Tell us a little more so we add more awesome features!",feedbackOther:"Tell us a little more so we can be more Fluid!"},init:function(){$(".userSettingsDone").bind("click",fluid.util.debounce(o._backCloseAction.bind(this,o.close),500));$("#userSettingsLink").live({click:o.open});$("input.upgrade, #upgradeLink").live({click:function(){if($(this).attr("id")==="upgradeLink"){fluid.main.fire("fluidMenuUpgradeLinkClicked")}fluid.dialogs.upgrade.open()}});$(".socialLinks .feedback").live({click:o.goToContact});$("#userSettingsContainer").live({click:function(c){c.stopPropagation()}});$("#userSettingsChangeAccount").live({click:function(){fluid.main.fire("accountMenuUpgradeLinkClicked");fluid.dialogs.upgrade.open()}});$("#userSettingsChangeEmail").live({click:o.goToChangeEmail});$("#userSettingsChangePassword").live({click:o.goToChangePassword});$("#userSettingsPauseBilling").live({click:o.goToPauseBilling});$("#upgradeFormFree").submit(n.submitFree);$(".experienceType").click(n.rateEditor);$("#pauseBillingFeedback").click(o.proceedPauseBilling);$("#userSettingsBilling").live({click:o.goToBilling});$("#userSettingsBillingAddressBtn").live({click:o.goToBilling});$("#userSettingsBillingHistory").live({click:o.goToReceipts});$("#userSettingsCode").live({click:o.goToCode});$("#userSettingsRemoveAccount").live({click:o.goToRemoveAccount});$("#userSettingsRemoveAccountCancel, #userSettingsRemoveAccountConfirmCancel").live({click:o.reStart});$(".recoverPasswordSettings").live({click:o.goToResetPassword});$("#userSettingsChangeEmailForm").live({submit:o.actionChangeEmail});$("#userSettingsChangePasswordForm").live({submit:o.actionChangePassword});$("#userSettingsBillingForm").live({submit:o.actionBilling});$("#userSettingsCardYear, #userSettingsCardMonth").on("change",function(){$(this).trigger("blur")});$("#userSettingsContactForm").on("submit",o.actionContact).on("input",function(c){var d=document.getElementById("userSettingsContactMessage").value,f=document.getElementById("userSettincsContactSubmit");if(/(\s*\S\s*){3,}/.test(d)){f.removeAttribute("disabled")}else{f.setAttribute("disabled","")}});$("#userSettingsCodeForm").live({submit:o.actionCode});$("#userSettingsRemoveAccountForm").live({submit:o.actionRemoveAccount});$("#userSettingsRemoveAccountConfirmForm").live({submit:o.actionRemoveAccountConfirm});$("#userSettingsFeedbackForm").live({submit:o.actionFeedback});$("#userSettingsResetPasswordButton").live({click:o.actionResetPassword});$(".userSettingsFeedbackSetType").live({click:o.actionFeedbackSetType});$(".userSettingsMessageContainer").live({click:n.hideMessages});$("#userSettingsToggleMore").live({click:o.toggleMore});$("#updateBillingInfo").live("click",o.goToBilling);$("#userSettingsCardDetails").live("click",o.goToCardUpdate);$("#userSettingsCardSubmit").live("click",o.actionCardUpdate);$("#userSettingsBillingCountry").live("change",function(c){var d=c.target.options[c.target.selectedIndex].value;if(q.isVATApplicable(d)){$("#userSettingsVATSection").show()}else{$("#userSettingsVATSection").hide();$("#userSettingsBillingVAT").val("")}}).trigger("change");$("#monthlyEmailReceipt").live("click",function(){if(!fluid.main.account.get("emailReceiptEnabled")){fluid.main.account.set({emailReceiptEnabled:true})}else{fluid.main.account.set({emailReceiptEnabled:false})}o.toggeEmailReceiptmentForm.apply(this,arguments)});function a(f,d){var c=$(".form-error-area[data-for="+d.attr("id")+"]");if(c.size()>0){c.append(f)}}var b=$("#updateCardForm");q.validation.init({elem:{form:b,loginEmail:$("#userSettingsLoginEmail"),loginPassword:$("#userSettingsLoginPassword"),name:$("#userSettingsCardName"),number:$("#userSettingsCardNumber"),type:$("#userSettingsCardType"),logo:$("#userSettingsCardTypeLogo"),month:$("#userSettingsCardMonth"),year:$("#userSettingsCardYear"),cvv:$("#userSettingsCardCvv")},handler:{errorPlacement:function(d,c){switch(c.attr("id")){case"userSettingsCardNumber":d.insertAfter($("#userSettingsCardTypeLogo"));break;case"userSettingsCardMonth":d.insertAfter($("#userSettingsCardYear"));break;case"userSettingsCardYear":break;default:d.insertAfter(c)}}}});q.validation.init({elem:{form:$("#userSettingsBillingForm"),billingCompany:$("#userSettingsBillingCompany"),billingAddress:$("#userSettingsBillingAddress"),billingCountry:$("#userSettingsBillingCountry"),billingVAT:$("#userSettingsBillingVAT")},handler:{errorPlacement:a}});q.populateCardYears($("#userSettingsCardYear"),11);$(window).resize(o._resizeScreen);fluid.main.fire("userSettings.afterInit")},setInitialState:function(){$("#userSettingsBillingHistory, #userSettingsCardDetails, #userSettingsPauseBilling, #userSettingsBillingAddressBtn").hide();if(fluid.main.account.isFree()&&fluid.main.account.get("everUpgraded")===true){$("#userSettingsBillingHistory, #userSettingsBillingAddressBtn").show()}else{if(fluid.main.account.isFree()!==true){if((fluid.main.account.get("accType").indexOf("team")!==-1&&fluid.main.account.get("teamOwner"))||fluid.main.account.get("accType").indexOf("team")===-1){$("#userSettingsBillingHistory, #userSettingsCardDetails, #userSettingsPauseBilling, #userSettingsBillingAddressBtn").show()}}}},reStartFromOutside:function(c,d){v.setEditorVisibility(true);var b=d!=undefined&&d.successMsg?d.successMsg:"";var a=d!=undefined&&d.successMsg!=undefined;if((a)||(o.isOpen)){o.isOpen=true;var f=o.startPanel==null?$("#userSettingsMain"):o.startPanel;o.reStart(c,b,$(".backFromUpgradeContainer",f))}else{fluidMenu.show()}},reStart:function(c,b,f){if(!o.isOpen){return}o.setInitialState();var d=o.startPanel==null?$("#userSettingsMain"):o.startPanel;if(d.is(":visible")){o.close();return}function a(){n.setSuccessMessage(b,f)}$(".currentEmail").text(fluid.main.account.get("email"));if(!$("#userSettingsContainer").is(":visible")){$("#userSettingsContainer").fadeIn(100)}$(".modalWindowContentWrapper").show();o._panelDisplay(d,true,a);o.panelStack=new Array()},open:function(b,c,a){fluid.main.fire("beforeusersetingopen");fluid.main.fire("notification:removeAll","projectLimit");n.hideMessages();var d=$(".modalWindowContentFrame:visible, .modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, .modalWindowContentFrameSmall:visible");d.hide();$("#userSettingsContainer").fadeIn(100);$(".modalWindowContentWrapper").show().addClass("open");if(!o.isOpen){o.isOpen=true;o.resetMore();o.panelStack=new Array();if((c!=undefined)&&(c.size()>0)){o.startPanel=c}else{o.startPanel=null}}if((c!=undefined)&&(c.size()>0)){o._panelDisplay(c,true,undefined,a)}else{o.reStart()}},close:function(b,a){v.setEditorVisibility(true);var c=$(".modalWindowContentFrame:visible, .modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, .modalWindowContentFrameSmall:visible, #upgradeRedeem");if(c.length){if(!o.debouncedPanelHide){o.debouncedPanelHide=_.debounce(o.hide,500,true)}o._panelDisplay(c,false,o.debouncedPanelHide)}o.startPanel=null;o.isOpen=false;fluid.main.fire("userSettings.closePanels")},goBack:function(c,b,h){if(o.panelStack.length>1){var d=o.panelStack.pop();var f=o.panelStack.pop();function a(){t.triggerEditor("panelGoBack",{panelId:f.attr("id")},true);n.setSuccessMessage(b,h)}o._panelDisplay(f,true,a);return}o.reStart(c,b,h)},hide:function(){$(".modalWindowContentWrapper").hide();$("#userSettingsContainer").fadeOut(200);if(!$(".createFormBody").is(":visible")){fluid.main.fire("usersettingshidden")}},hideCurrentPanel:function(b,c){n.hideMessages();var a=$(".modalWindowContentFrame:visible, .modalWindowContentFrameLarge:visible, .modalWindowContentFrameExtraLarge:visible, .modalWindowContentFrameSmall:visible");if(a.size()>0){o._panelDisplay(a,false,b)}else{var d=c==undefined?false:c;if(d){o.close()}b()}},resetMore:function(){$("#userSettingsBottomButtons").hide();$("#userSettingsToggleMore").text("More...")},toggleMore:function(){$("#userSettingsBottomButtons").slideToggle(400);var a=$("#userSettingsToggleMore");var b=a.text().indexOf("More")>-1?"...Less":"More...";a.text(b)},goToCreateAccount:function(b,a){if(o.isOpen){o.hideCurrentPanel(function(){account.startCreate(b,a)})}else{account.startCreate(b,a)}},goToUpgrade:function(b,l,c,a){$(".tip").remove();var f={};if(!fluid.main.account.isFree()){f[fluid.main.account.get("accType")]=true}var d=fluid.util.tpl("upgradeDialogTmpl",f);var i=fluid.util.tpl("tipTemplate",{});document.getElementById("upgradeDialog").innerHTML=d;$("#upgradeDialog").parent().parent().append(i);var h=fluid.util.tpl("upgradeErrorTmpl");document.getElementById("upgradeError").innerHTML=h;if(o.isOpen){o.hideCurrentPanel(function(){fluid.main.trigger("upgrade.start");o.open(null,$("#upgradeDialog"))})}else{fluid.main.trigger("upgrade.start");$("body").keydown(m.preventDeleteBack);$("#form").show();fluid.main.trigger("upgrade.setUserData");var j=n.getCloseExternalWindowButtonLabel();var k=j=="Close"?"close":"back";$(".hud-button.userSettingsDone span.dialogs-done-label").text(j);$(".hud-button.userSettingsDone").removeClass("close back").addClass(k);o.open(null,$("#upgradeDialog"));setTimeout(function(){o._fixCloseButton(true)},500)}},goToResetPassword:function(){o._panelDisplay($("#userSettingsPanelResetPassword"),true)},actionResetPassword:function(a){o.reStart(a,"resetPass");return false},goToChangeEmail:function(){$("#userSettingsChangeEmailNew").val("");$("#userSettingsChangeEmailPass").val("");o._panelDisplay($("#userSettingsPanelChangeEmail"),true)},actionChangeEmail:function(){n.hideErrors();n.lastSubmitButton=$("#userSettingsChangeEmailSubmit");var a=$.trim($("#userSettingsChangeEmailNew").val());fluid.main.fire("apiRequest","emailRegd",a,b,b);return false;function b(c){var d=false;c=JSON.parse(c);if(c.t===true||c.t==="true"){d=true}o.actionCheckedEmail(d)}},actionCheckedEmail:function(b){if(b){return n.displayError("emailUsed")}var a=$.trim($("#userSettingsChangeEmailNew").val());var c=$.trim($("#userSettingsChangeEmailPass").val());if((a!="")&&(c!="")){fluid.main.fire("apiRequest","changeEmail",a,c,o.actionChangeEmailCallback,o.actionChangeEmailCallback)}return false},actionChangeEmailCallback:function(c,a){if(c==null){if(a!=""){n.displayError(a);return false}n.displayError();return false}var b=JSON.parse(c);if(b.t===true||b.t==="true"){var d=$.trim($("#userSettingsChangeEmailNew").val());fluid.main.account.set({email:d});o.reStart(null,"default",$("#userSettingsChangeEmail"))}else{if(b.t.indexOf("Unknown error")>-1){n.displayError()}else{n.displayError("passInvalid")}}return false},goToChangePassword:function(){$("#userSettingsChangePasswordOld").val("");$("#userSettingsChangePasswordNew").val("");o._panelDisplay($("#userSettingsPanelChangePassword"),true)},actionChangePassword:function(c){n.hideErrors();n.lastSubmitButton=$("#userSettingsChangePasswordSubmit");var a=$("#userSettingsChangePasswordOld").val();var b=$("#userSettingsChangePasswordNew").val();if(a==b){n.displayError("passNotChanged");return false}fluid.main.fire("apiRequest","changePass",a,b,o.actionChangePasswordCallback,o.actionChangePasswordCallback);return false},actionChangePasswordCallback:function(c,a){if(c==null){if(a!=""){n.displayError(a);return false}n.displayError();return false}var b=JSON.parse(c);if(b.t===true||b.t==="true"){o.reStart(null,"default",$("#userSettingsChangePassword"))}else{n.displayError("oldPassInvalid")}return false},goToCardUpdate:function(a){$("#userSettingsCardName, #userSettingsCardNumber, #userSettingsCardCvv, #userSettingsCardType").val("");$("#updateCardForm")[0].reset();$("#userSettingsCardTypeLogo").removeClass("ccTypeLogoVISA ccTypeLogoMC ccTypeLogoAMEX");$("#userSettingsCardSubmit").removeAttr("disabled");q.validation.reset($("#updateCardForm"));o._panelDisplay($("#userSettingsPanelCard"),true);return false},actionCardUpdate:function(c){function b(){fluid.main.fire("apiRequest","updateCard",{name:$("#userSettingsCardName").val(),number:$("#userSettingsCardNumber").val(),month:$("#userSettingsCardMonth").val(),year:$("#userSettingsCardYear").val(),type:$("#userSettingsCardType").val(),cvv:$("#userSettingsCardCvv").val()},o.actionCardUpdateCallback,o.actionCardUpdateCallback)}function a(){n.displayError("Sign in failed. Please check your email and password and try again.");$("#userSettingsCardSubmit").removeAttr("disabled")}if($(c.target.form).valid()){n.hideErrors();n.lastSubmitButton=$("#userSettingsCardSubmit");if(fluid.main.account.get("loggedIn")!="yes"){var d={t:"login",strict:true,uid:fluid.main.account.get("currentUserId"),instanceId:u(),email:$("#userSettingsLoginEmail").val(),password1:$("#userSettingsLoginPassword").val(),tandc:"on"};$.ajax({url:"./index.php",type:"POST",data:d,timeout:15000,success:function(h,f,i){var j=JSON.parse(i.responseText);if(j.r=="s"){signup.ajaxSuccess(h,f,i);b()}else{a()}},error:function(){a()},timeOut:function(){a()}})}else{b()}$("#userSettingsCardSubmit").attr("disabled","disabled")}return false},actionCardUpdateCallback:function(c,a){if(c==null){if(a!=""){$(".userSettingsLogin").fadeOut(200);n.displayError(a);return false}n.displayError();return false}var b=JSON.parse(c);if(b.t===true||b.t==="true"){if(fluid.main.account.get("status")=="pendingCardUpdate"){fluid.main.account.set({status:"ok"});o.showCloseButton();$("#updateCardForced").hide()}o.reStart(null,"default",$("#userSettingsCardDetails"))}else{n.displayError()}return false},goToBilling:function(){$("#userSettingsBillingCompany").val(fluid.main.account.get("billingCompany"));$("#userSettingsBillingAddress").val(fluid.main.account.get("billingAddress"));$("#userSettingsBillingCountry").val(fluid.main.account.get("billingCountry"));$("#userSettingsBillingVAT").val(fluid.main.account.get("billingVAT"));$("#userSettingsBillingCountry").trigger("change");o._panelDisplay($("#userSettingsPanelBilling"),true);return false},toggeEmailReceiptmentForm:function(){$(this).toggleClass("pressed");$("#emailReceiptsForm").toggle()},goToReceipts:function(){fluid.main.fire("apiRequest","getPayments",function(a){a=JSON.parse(a);$("#userSettingsReceiptEmail").val(fluid.main.account.get("receiptEmails"));if(fluid.main.account.get("emailReceiptEnabled")){o.toggeEmailReceiptmentForm()}if(!a.receiptAvailable){$("#downloadAllReceipts").removeClass("active")}else{$("#downloadAllReceipts").addClass("active")}var b=a.t;var j=$("#receiptList .overview");j.find(".receiptListItem, .receiptEmptyMsg").remove();if(b.length===0){j.append('<div class="receiptEmptyMsg">No payments found...</div>');$("#downloadAllReceipts").removeClass("active")}if(a.msg){j.append('<div class="receiptEmptyMsg">'+a.msg+"</div>")}var f=["January","February","March","April","May","June","July","August","September","October","November","December"];var k,i,d;for(var l=0;l<b.length;l++){k=new Date(b[l].date*1000);d=k.getDate();if(d>3){i="th"}else{if(d==3){i="rd"}else{if(d==2){i="nd"}else{if(d==1){i="st"}}}}b[l].amountIncVat=b[l].amountIncVat/100;b[l].date=k.getFullYear()+" "+f[k.getMonth()]+" "+d+i;if(!a.receiptAvailable){b[l].hiddenClass="not-available"}if(b[l].status==="SUCCESS"){$("#tmplPaymentListItem").tmpl(b[l]).appendTo(j)}}n.adjustScroll($("#receiptList"));$(".pdfReceipt").live("click",function(){if(window.invoiceUser){window.open(window.location.href+"invoice/"+$(this).parent(".receiptListItem").attr("id").split("-")[1]+"/userId/"+window.invoiceUser,"invoice")}else{window.open(window.location.href+"invoice/"+$(this).parent(".receiptListItem").attr("id").split("-")[1],"invoice")}});$("#downloadAllReceipts").on("click",function(){if(!$(this).hasClass("active")){fluid.main.fire("addNotification","alert","No receipts to download!",{stopBuggingCallBack:true})}});$("#downloadAllReceipts.active").live("click",function(){window.open(window.location.href+"invoice/all","invoice")});function c(){var B=$("#userSettingsReceiptEmail").val().split(",");var D=true;for(var C=0;C<B.length;C++){B[C]=B[C].trim();if(!h(B[C])){D=false;break}}if(D){$("#updateReceiptEmails").val("Saving...");fluid.main.account.set({receiptEmails:B.join(", ")});fluid.main.fire("submittedreceiptemail")}}function h(B){var A=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return A.test(B)}$("#updateReceiptEmails").live("click",c);$("#userSettingsReceiptEmail").live("keyup",function(z){if(z.keyCode===13){c()}});$("#updateBillingInfo").live("click",function(){o.goBack(null,"",$(this))});o._panelDisplay($("#userSettingsPanelReceipts"),true)},function(){var a=$("#receiptList .overview");a.find(".receiptListItem, .receiptEmptyMsg").remove();a.append('<div class="receiptEmptyMsg">No payments found...</div>');$("#downloadAllReceipts").removeClass("active")})},showPauseBillingFirstStep:function(){$("#pauseBillingStep1").show();$("#confirmPass").val("");$("#confirmationFree").removeAttr("checked")},hidePauseBillingErrors:function(){$("#pauseBillingEntryError,#pauseBillingSystemError,#pauseBillingPasswordError,#pauseBillingSubmitError").hide()},hidePauseBillingScreens:function(){$("#pauseBillingStep1,#pauseBillingStep2").hide()},goToPauseBilling:function(){o.hidePauseBillingScreens();o.hidePauseBillingErrors();$("#submitButtonFreeUpgrade").val("Pause Billing");$("#cancelReason").val("");if(!o.isOpen){o.open(null,$("#userSettingsPanelPauseBilling"))}$("#upgradeAccountToFreeWarning").fadeIn(500);o._panelDisplay($("#userSettingsPanelPauseBilling"),true);o.showPauseBillingFirstStep()},proceedPauseBilling:function(){var c=$("#confirmPass").val();var a=$("#confirmationFree").is(":checked");var b=$("#submitButtonFreeUpgrade");b.removeAttr("disabled");b.val("Pause Billing");if(c.length<1||a===false){o.hidePauseBillingErrors();$("#pauseBillingEntryError").show();return}$("#pauseBillingStep1").hide();$("#pauseBillingSubmitError").hide();$("#pauseBillingStep2").show();$("#pauseBillingStep2").children().show()},actionBilling:function(b){if($(b.target).valid()){var d=$("#userSettingsBillingForm");n.hideErrors();n.lastSubmitButton=$("#userSettingsBillingSubmit");var f=$("#userSettingsBillingCompany").val(),h=$("#userSettingsBillingAddress").val(),c=d.find('[name="billingCountry"]').get(0),i=c.options[c.selectedIndex].value,a=$("#userSettingsBillingVAT").val();fluid.main.fire("apiRequest","changeBilling",{company:f,address:h,country:i,vat:a},o.actionBillingCallback,o.actionBillingCallback)}return false},actionBillingCallback:function(c,a){if(c==null){if(a!=""){n.displayError(a);return false}n.displayError();return false}var b=JSON.parse(c);if(b.t===true||b.t==="true"){fluid.main.account.set({billingCompany:b.billingCompany,billingCountry:b.billingCountry,billingAddress:b.billingAddress,billingVAT:b.billingVAT});o.reStart(null,"default",$("#userSettingsBillingHistory"))}else{n.displayError()}return false},goToContact:function(){if(!o.isOpen){o.open(null,$("#userSettingsPanelContact"))}var b=$("#userSettingsContactEmailContainer");var a=$("#userSettingsContactEmail");if(fluid.main.account.get("loggedIn")=="yes"){b.hide();a.val(fluid.main.account.get("email"))}else{b.show();a.val("")}$("#userSettingsContactMessage").val("");o._panelDisplay($("#userSettingsPanelContact"),true)},actionContact:function(b){n.hideErrors();var c=$("#userSettingsContactMessage").val();var a=$("#userSettingsContactEmail").val();fluid.main.fire("apiRequest","contact",a,"Message from Contact Form",c,o.actionContactCallback,o.actionContactCallback)},actionContactCallback:function(){o.close();return false},goToCode:function(){$("#userSettingsCodeCode").val("");o._panelDisplay($("#userSettingsPanelCode"),true)},actionCode:function(a){n.hideErrors();o.reStart(a,"promoCode");return false},goToRemoveAccount:function(){$("#userSettingsRemoveAccountPassword").val("");o._panelDisplay($("#userSettingsPanelRemoveAccount"),true)},actionRemoveAccount:function(b){n.hideErrors();n.lastSubmitButton=$("#userSettingsRemoveAccountSubmit");var a=$.trim($("#userSettingsRemoveAccountPassword").val());fluid.main.fire("apiRequest","validatePass",a,o.actionRemoveAccountPassValidated,o.actionRemoveAccountPassValidated);return false},actionRemoveAccountPassValidated:function(a){if(a==null){n.displayError();return false}var b=JSON.parse(a);if(b.t===true||b.t==="true"){o._panelDisplay($("#userSettingsPanelRemoveAccount"),false);o._panelDisplay($("#userSettingsPanelRemoveAccountConfirm"),true)}else{n.displayError("passInvalid")}return false},actionRemoveAccountConfirm:function(b){n.lastSubmitButton=$("#userSettingsRemoveAccountConfirmSubmit");var a=$("#userSettingsRemoveAccountPassword").val();fluid.main.fire("apiRequest","removeAccount",fluid.main.account.get("id"),o.actionRemoveAccountConfirmCallback,o.actionRemoveAccountConfirmCallback);return false},actionRemoveAccountConfirmCallback:function(c,a){if(c==null){if(a!=""){n.displayError(a);return false}n.displayError();return false}var b=JSON.parse(c);if(b.t===true||b.t==="true"){account.logout();setTimeout(o.goToFeedback,500)}else{n.displayError()}return false},goToFeedback:function(a){$("#userSettingsFeedbackMessage").val("");o.actionFeedbackSetType();o._panelDisplay($("#userSettingsPanelFeedback"),true,null,false)},actionFeedback:function(b){n.hideErrors();var c=$("#userSettingsFeedbackType").val();var d=$("#userSettingsFeedbackMessage").val();var a="Feedback Message After Account removal - "+c;fluid.main.fire("apiRequest","contact","",a,d,o.actionFeedbackCallback,o.actionFeedbackCallback)},actionFeedbackCallback:function(){o.close();return false},actionFeedbackSetType:function(c){var d=$("#userSettingsFeedbackOther");if(c!=undefined){d=$(c.target)}var b="";var a="";switch(d.attr("id")){case"userSettingsFeedbackFix":b=o.placeHolders.feedbackFix;a="Bug";break;case"userSettingsFeedbackNew":b=o.placeHolders.feedbackNew;a="Required Feature";break;default:b=o.placeHolders.feedbackOther;var a="Other";break}$("#userSettingsFeedbackMessage").attr("placeholder",b);$("#userSettingsFeedbackType").val(a);return false},goToHelp:function(a){window.open("/guide")},esc:function(a){if(o.showing){return false}if(a.target.tagName.toLowerCase()=="input"){$(a.target).blur();a.stopPropagation();return false}$(".userSettingsDone:visible").click()},showCloseButton:function(){$(".userSettingsDone").show()},hideCloseButton:function(){$(".userSettingsDone").hide()},_fixCloseButton:function(i){var d=o.startPanel==null?$("#userSettingsMain"):o.startPanel;var b=i==undefined?true:i;var h=d.is(":visible")||!b?"Close":"Back";var a=h=="Close"?"close":"back";var c=h=="Close"?o.close:o.goBack;var f=$("#userSettingsContainer .hud-button");$("#userSettingsContainer .hud-button span.dialogs-done-label").text(h);f.removeClass("close back");f.addClass(a);f.attr("title",h);$(".userSettingsDone").unbind().bind("click",fluid.util.debounce(o._backCloseAction.bind(this,c),500))},_backCloseAction:function(a){if(fluid.dialogMgr.opening){return}if(fluid.dialogMgr.closeAllInsteadOfBack){fluid.dialogMgr.closeAllInsteadOfBack=false;fluid.dialogMgr.closeAll()}else{if(fluid.dialogMgr.dialogStack.length){return}else{if(!fluid.dialogMgr.opening){a()}}}},_panelDisplay:function(d,f,b,a){fluid.main.fire("beforepaneldisplay",d.attr("id"));o.showing=true;function c(){if(f){function h(){o.showing=false;o._fixCloseButton(a);if($.isFunction(b)){b()}}if(d.attr("id")=="userSettingsPanelCard"){if(fluid.main.account.get("loggedIn")=="yes"){$(".userSettingsLogin").hide()}else{$(".userSettingsLogin").show()}}o.panelStack.push(d);n.display(d,350,h);return}n.hideSuccessMessage();n.hide(d,400,function(){o.showing=false;b()})}if(f){o.hideCurrentPanel(c)}else{c()}},_resizeScreen:function(){if(!o.isOpen){return}if($("#userSettingsPanelHelp").is(":visible")){setTimeout(o.goToHelp,1000);return}}};fluid.main.on("userSettingsRefreshButtons",function(){o.setInitialState()});fluid.main.on("accountpausefail",function(){o.hidePauseBillingScreens();o.hidePauseBillingErrors();o.showPauseBillingFirstStep()});fluid.main.on("escpressed",function(a,b){o.esc(b)});fluid.main.on("hidePauseBillingErrors",function(){o.hidePauseBillingErrors()});s.exports=o},{"./class-canvas":28,"./class-event":30,"./class-panels":35,"./class-payments":36,"./functions":91,"./instanceIdUtil":94}],48:[function(r,q,k){var n=r("./class-widget");var m=r("./class-storage");var o=r("./browserdetect");var l=r("./utils");var p=r("./utils-editor");r("./fluid/modules/upload");if(!Function.prototype.bind){Function.prototype.bind=function(c){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var d=Array.prototype.slice.call(arguments,1),f=this,b=function(){},a=function(){return f.apply(this instanceof b&&c?this:c,d.concat(Array.prototype.slice.call(arguments)))};b.prototype=this.prototype;a.prototype=new b();return a}}if(!window.fluid){window.fluid={}}fluid.wdgProvider=function(){var a=window.widgets?$.extend(true,{},widgets):null;return{getWidgets:function(d){var b=$.extend(true,{},a.summary);if(d){for(var c in b){if(b.hasOwnProperty(c)){b[c].originId=c}}}return b},getRootWidgets:function(d,f){var c=[];for(var b in a.summary){if(a.summary.hasOwnProperty(b)&&a.summary[b].g&&(d==undefined||a.summary[b].g.indexOf(d)!=-1)){c.push(a.summary[b]);if(f){c[c.length-1].originId=b}}}return c},getWdgGroups:function(){return $.extend(true,{},a.g)},getChildWidgets:function(c,h){var i=[];var f;var d;for(var b=0;b<c.ad.length;b++){f=c.ad[b][0];if(a&&a.summary[f]){d=$.extend(true,{},a.summary[f])}else{d=$.extend(true,{},widgets.summary[f])}if(h){d.originId=f}i.push(d)}return i},getById:function(b){if(a&&a.summary[b]){return $.extend(true,{},a.summary[b])}else{return $.extend({},widgets.summary[b])}},getChildById:function(d,b){parentChildren=b&&b.ad?b.ad:null;if(parentChildren&&parentChildren.length){for(var c=0;c<parentChildren.length;c++){if(d==parentChildren[c][0]){return parentChildren[c]}}}return false}}}();fluid.widget=function(){return{handleCollection:function(d,h,f){if(d.length==undefined){var c={};d=$.extend(true,{},d);f.unshift({});for(var a in d){if(d.hasOwnProperty(a)){f[0]=d[a];c[a]=h.apply(this,f)}}return c}else{var c=[];f.unshift({});for(var b=0;b<d.length;b++){f[0]=d[b];c.push(h.apply(this,f))}return c}},setSizeLimit:function(b,a,c){return this.handleCollection(b,function(f,d,h){if(!f.wh){f.wh=[d,h]}else{if(typeof f.wh[0]=="string"){f.wh[0]=d}if(typeof f.wh[1]=="string"){f.wh[1]=h}}return f},[a,c])},setRootSizeLimit:function(b,a,c){return this.handleCollection(b,function(f,d,h){if(!f.g){return f}if(!f.wh){f.wh=[d,h]}else{if(typeof f.wh[0]=="string"){f.wh[0]=d}if(typeof f.wh[1]=="string"){f.wh[1]=h}}return f},[a,c])},hasChildWidgets:function(a){return a.ad&&a.ad.length?true:false},hasSegments:function(a){return a.sc?true:false},isTextWidget:function(a){if(a.tc){return true}else{return false}},isShapeWidget:function(a){if(a.b||a.bg||a.bgc||a.bgd||a.i){return true}else{return false}},isUploadWidget:function(a){if(a.upload==="y"){return true}else{return false}}}}();fluid.wdgRenderer=function(b,a){this.canvasSize=[b||320,a||480];this.useCanvas=true;this.renderingQueue={};this.renditions={};this.imagesToLoad={};this.uploadsToLoad={};this.imagesLoaded={};this.canvases={};this.cropping={x:12004,y:9804,x2:0,y2:0};this.renderBlur=true;this.useOneCanvas=true;this.setCropping=function(c){if(c.x<this.cropping.x){this.cropping.x=c.x}if(c.y<this.cropping.y){this.cropping.y=c.y}if(c.x+c.width>this.cropping.x2){this.cropping.x2=c.x+c.width}if(c.y+c.height>this.cropping.y2){this.cropping.y2=c.y+c.height}};this.generateCanvas=function(d,c){this.canvas=$("<canvas>").attr({width:(c&&c.width!==undefined)?c.width:this.canvasSize[0],height:(c&&c.height!==undefined)?c.height:this.canvasSize[1]});if(d){this.canvas.attr({id:"pag-"+d})}this.canvases[d]=this.canvas;this.ctx=this.canvas.get(0).getContext("2d")};this.percentToPixel=function(f,d,c){var h;if(d.wh[0].indexOf&&d.wh[0].indexOf("%")!==-1){h=parseInt(d.wh[0],10)/100;h=h*c.box[2];f[2]=h}if(d.wh[1].indexOf&&d.wh[1].indexOf("%")!==-1){h=parseInt(d.wh[1],10)/100;h=h*c.box[3];f[3]=h}return f};this.getPixelDimensions=function(f,d,c){if(d.wh&&typeof d.wh[0]=="number"){f[2]=d.wh[0]}if(d.wh&&typeof d.wh[1]=="number"){f[3]=d.wh[1]}return f};this.parseBoxValue=function(d,f){if(typeof(d)==="number"&&!isNaN(d)){return d}else{var c=(parseFloat(d||0)/100)*(f||0);return isNaN(c)?0:c}};this.calculateBox=function(d,t,c){if(!t){t={box:[0,0,this.canvasSize[0],this.canvasSize[1]]}}var i=[0,0];var h;if(d.tlwh){i=[this.parseBoxValue(d.tlwh[1],t.box[2]),this.parseBoxValue(d.tlwh[0],t.box[3]),this.parseBoxValue(d.tlwh[2],t.box[2]),this.parseBoxValue(d.tlwh[3],t.box[3])];return i}if(!d.wh){i[2]=t.box[2];i[3]=t.box[3]}else{i=this.getPixelDimensions(i,d,t);i=this.percentToPixel(i,d,t)}if(c){if(!c[3]||c[3][1]=="l"){if(typeof c[1]=="number"){i[0]=c[1]}else{if(typeof c[1]=="string"){i[0]=(parseInt(c[1],10)/100)*t.box[2]}}}else{if(c[3][1]=="c"){var j;if(typeof c[1]=="number"){j=c[1]}else{j=(parseInt(c[1],10)/100)*t.box[2]}i[0]=(t.box[2]-i[2])/2+j}else{if(typeof c[1]=="number"){i[0]=t.box[2]-i[2]-c[1]}else{if(typeof c[1]=="string"){h=(parseInt(c[1],10)/100)*t.box[3];i[0]=t.box[2]-i[2]-h}}}}if(!c[3]||c[3][0]=="t"){if(typeof c[2]=="number"){i[1]=c[2]}else{if(typeof c[2]=="string"){i[1]=(parseInt(c[2],10)/100)*t.wh[1]}}}else{if(c[3][1]=="c"){var f;if(typeof c[2]=="number"){f=c[2]}else{f=(parseInt(c[2],10)/100)*t.box[3]}i[1]=(t.box[3]-i[3])/2+f}else{if(typeof c[2]=="number"){i[1]=t.box[3]-i[3]-c[2]}else{if(typeof c[2]=="string"){h=(parseInt(c[2],10)/100)*t.wh[1];i[1]=t.wh[1]-i[3]-h}}}}}i[0]=i[0]+t.box[0];i[1]=i[1]+t.box[1];return i};this.renderUpload=function(j,i,c){$canvas=i||this.canvas;function d(s,w){if(!j.box[2]||!j.box[3]){j.box[2]=w.width;j.box[3]=w.height}var z=s.get(0).getContext("2d");z.drawImage(w,j.box[0],j.box[1],j.box[2],j.box[3]);w.onload=null;w.onerror=null}function f(s,A,z){s.addClass("failureImage");var B=s.get(0).getContext("2d");B.font="32pt Arial";B.fillText("Image",35,50);B.fillText("not found",10,115)}function t(){f();n._convertCanvasToImg($(ctx.canvas),widgEl.find("img"),tmplVars)}function h(){var s=j.data||false;if(s&&s.substr(0,5)!="data:"){s=ajax.apiObjectUrl("img",j.data)}else{if(j.id){s=ajax.apiObjectUrl("img",j.id)}}return s||f()}if(c){d($canvas,c);return this.canvas}fluid.upload.get({id:j.data||j.id,callback:function(s,z){if(z.success){if(z.image){d.call(this,s,z.image)}else{if(z.imgData){var w=new Image();w.onload=d.bind(this,s,w);w.onerror=f.bind(this,s,w);w.src=z.imgData}}}else{var w=new Image();f.call(this,s,w)}}.bind(this,$canvas),priority:fluid.upload.priority.pageZoomedOut})};this.adjustWords=function(f){var d=[];for(var c=0;c<f.length;c++){d.push(f[c])}return d};this.wrapText=function(Z,X,O,W,i,Y,j,aa){var d=document.createElement("canvas");d.width=O[2];d.height=O[3];var N=d.getContext("2d");N.font=Z.font;N.textBaseline=Z.textBaseline;N.fillStyle=Z.fillStyle;if(O[3]<0){return 0}var V=X.split(" ");var M="";var c="";var S=0;var h,f;var ab;var Q=" ";var R=0;if(j){W=Math.round(parseFloat(Y,10)*1.14)}if(isNaN(W)||!W){W=Math.round(parseFloat(Y,10)*1.14)||13}if(X.match(/[\u3131-\uCB4C]/)){Q="";V=X.split("")}for(var U=0;U<V.length;U++){h=M+V[U]+Q;f=N.measureText(h).width;f=f+Math.round(-0.285714286*parseFloat(Y)+0.075);if(f>O[2]&&V.length!==1){c=V[U]+Q;if(V[U].indexOf("-")!==-1){var T=M+V[U].substring(0,V[U].indexOf("-")+1);if(N.measureText(T).width<=O[2]){M=T;c=V[U].substring(V[U].indexOf("-")+1)+Q}}ab=N.measureText(M).width;ab=ab+Math.round(-0.285714286*parseFloat(Y)+0.075);if(ab>O[2]&&M.indexOf(" ")===M.length-1){c=Q+c}var P=0;if(i&&i[1]==="c"){P=(O[2]/2)-(ab/2);if(P<0){P=0}}else{if(i&&i[1]==="r"){P=O[2]-ab;if(P<0){P=0}}}N.fillText(M,P,R);M=c;R+=W;S++}else{M=h}}ab=N.measureText(M).width;ab=ab+Math.round(-0.285714286*parseFloat(Y)+0.075);var ac=R+W;if(i&&i[1]==="c"){N.fillText(M,(O[2]/2)-(ab/2),R)}else{if(i&&i[1]==="r"){N.fillText(M,O[2]-ab,R)}else{N.fillText(M,0,R)}}return{lineCount:S+1,localCanvas:d,box:O,textHeight:ac}};this.renderText=function(az,ar){var aB=true;var Y=az.ts.replace(/"/g,"");var an=fluid.main.project.widgets.get(az.id);var av,ag,ax;if(!an){av=az.box;ax=az.textVerticalAlign;ag=az.textHorizontalAlign}else{av=an.getBox();ax=an.get("textVerticalAlign");ag=an.get("textHorizontalAlign")}if(!this.useOneCanvas){if(this.renderingMode==="singlepage"){return $('<div class="widgetText" style="'+Y+';width: 100%;height:100%;"><span style="white-space:pre-wrap; text-decoration: inherit;">'+az.tc+"</span></div>")}else{return $('<div class="widgetText" style="'+Y+";width:"+(az.box[2]+3)+"px;height:"+az.box[3]+"px; top:"+az.box[1]+"px; left:"+az.box[0]+'px;"><span style="white-space:pre-wrap; text-decoration: inherit;">'+az.tc+"</span></div>")}}else{var af=0;var au=az.tc.replace(/&nbsp/g," ");var aj=au.split("\n");var ah;var ar=ar||this.canvas;var ak=ar.get(0).getContext("2d");var d=Y.match(/font:[a-zA-Z0-9\s:\/]*;/);var aq=Y.match(/font-size:\s?(\d+px)/);if(aq){aq=parseInt(aq[1],10)}else{if(Y.match(/font:.*?;/)){var aw=Y.match(/font:.*?;/)[0];aq=parseInt(aw.match(/\d+/)[0],10)||Y.match(/\d+/)[0]}}if(d){d=d[0];d=d.replace("font:","");d=d.replace(";","")}else{var h="normal";if(Y.indexOf("font-style")!==-1){h=Y.substring(Y.indexOf("font-style")+11,Y.indexOf(";",Y.indexOf("font-style"))).trim()}var ap="normal";if(Y.indexOf("font-variant")!==-1){ap=Y.substring(Y.indexOf("font-variant")+13,Y.indexOf(";",Y.indexOf("font-variant"))).trim()}var ae="normal";if(Y.indexOf("font-weight")!==-1){ae=Y.substring(Y.indexOf("font-weight")+12,Y.indexOf(";",Y.indexOf("font-weight"))).trim()}aq=Y.substring(Y.indexOf("font-size")+10,Y.indexOf(";",Y.indexOf("font-size"))).trim();var aC=Y.substring(Y.indexOf("font-family")+12,Y.indexOf(";",Y.indexOf("font-family"))).trim();if(Y.indexOf("line-height")===-1){ah=Math.round(parseFloat(aq,10)*1.14)}else{ah=Y.substring(Y.indexOf("line-height")+12,Y.indexOf(";",Y.indexOf("line-height"))).trim();aB=false}d=h+" "+ap+" "+ae+" "+aq+" "+aC}var ai=Y.substring(Y.indexOf("color")+6,Y.indexOf(";",Y.indexOf("color"))).trim();if(ai.indexOf("rgb(")!==-1){ai=l.rgb2hex(ai)}var ay=ag||"left";var at="";if(Y.indexOf("text-decoration")!==-1){at=Y.substring(Y.indexOf("text-decoration")+16,Y.indexOf(";",Y.indexOf("text-decoration"))).trim()}var ac=0;ak.fillStyle=ai;ak.font=d;ak.textBaseline="top";if(aB){ah=Math.round(parseFloat(aq,10)*1.14)}else{ah=parseInt(ah,10)}var aa=0;var ao=0;if(ah&&parseFloat(ah)){aa=Math.round(-0.07*parseFloat(aq)+2.66);ao=Math.round(0.5*(parseFloat(ah)-parseFloat(aq))-2.75)}else{if(d.indexOf("/")!==-1&&parseFloat(d.substring(d.indexOf("/")+1))){aa=Math.round(-0.07*parseFloat(aq)+2.66)}}var c=0;switch(ax||"top"){case"top":c=0;break;case"middle":c=av[3]/2-ah/2*aj.length;break;case"bottom":c=av[3]-ah*aj.length;break}if(o.browser==="Firefox"){aa=aa+Math.round(0.148148148*parseFloat(aq))/2}var ab=0;var aA=[az.box[0],az.box[1]+aa+ao+c+ac,az.box[2],az.box[3]];var i=az.ca||"lt";if(ay==="center"){i=i[0]+"c"}else{if(ay==="right"){i=i[0]+"r"}else{if(ay==="left"){i=i[0]+"l"}}}var am;if(aj.length==1){am=this.wrapText(ak,au,az.box,ah,i,aq,aB,ax);Z(am,ak)}else{var al=[];for(var f=0;f<aj.length;f++){am=this.wrapText(ak,aj[f],[aA[0],aA[1]+(f+ab)*ah,aA[2],aA[3]],ah,i,aq,aB,ax);ab=ab+(am.lineCount||1);al.push(am)}var j=0;var ad=0;for(f=0;f<al.length;f++){j+=al[f].textHeight;al[f].box=az.box}for(f=0;f<al.length;f++){Z(al[f],ak,j,ad);ad+=al[f].textHeight}}return ar}function Z(u,A,B,s){var t=u.textHeight;if(!B){B=t}s=s||0;var v=u.box;var z=u.localCanvas;var w=v[3];if(ax==="middle"){A.drawImage(z,v[0],v[1]+(w-B)/2+s)}else{if(ax==="bottom"){A.drawImage(z,v[0],v[1]+w-B+s)}else{A.drawImage(z,v[0],v[1]+s)}}}};this.paintCanvas=function(G,K){var c=this;if(!this.useOneCanvas){K=$("<canvas>").attr({width:this.renderingMode==="singlepage"?G.box[2]:this.canvasSize[0],height:this.renderingMode==="singlepage"?G.box[3]:this.canvasSize[1]})}else{if(!K){K=this.canvas}}var I=K.get(0).getContext("2d");var c=this;var H={blur:function(){if(G.blur){if(c.renderBlur){var v=document.createElement("img"),t=n.renderBlurLayerImmediate.call(c,G.id),z=jQuery.extend([],G.box),w,s;if(!t){return false}if(z[0]<0){z[0]=0}if(z[1]<0){z[1]=0}if(z[2]>t.width){z[2]=t.width}if(z[3]>t.height){z[3]=t.height}var u=m.get(G.id,{returnModel:true});if(u){s=u.getPage().getBox();if(z[0]+z[2]>s[2]){z[2]=s[2]-z[0]}if(z[1]+z[3]>s[3]){z[3]=s[3]-z[1]}}I.drawImage(t,z[0],z[1],z[2],z[3],z[0],z[1],z[2],z[3])}}},background:function(){I.save();function t(){var E=(G.bgc)?G.bgc:["#CAD1D7","#C4CBD3"];var C=[5,2];var D="v";if(G.bgd){D=G.bgd[0];C=[G.bgd[1],G.bgd[2]]}I.fillStyle=E[1];I.fill();I.fillStyle=E[0];if(D=="v"){for(var B=C[0];B<d;){I.fillRect(B,0,C[1],f);B+=C[0]}}else{for(var B=C[0];B<f;){I.fillRect(0,B,d,C[1]);B+=C[0]}}}if(!d){d=0}if(!f){f=0}if(G.bg=="c"){I.fillStyle=G.bgc[0];I.fill()}else{if(G.bg=="s"){t()}else{if(G.bg=="l"){var w=c.useOneCanvas?G.box[0]:0;var u=c.useOneCanvas?G.box[1]:0;var v=c.useOneCanvas?G.box[1]+G.box[3]:G.box[3];g=I.createLinearGradient(w,u,w,v);H._gradient(g,I,G)}else{if(G.bg=="lrl"){g=I.createLinearGradient(G.box[0],G.box[1],G.box[0]+G.box[2],G.box[1]);H._gradient(g,I,G)}else{if(G.bg=="ld"){g=I.createLinearGradient(G.box[0],G.box[1],G.box[0]+G.box[2],G.box[1]+G.box[3]);H._gradient(g,I,G)}else{if(G.bg=="ld2"){g=I.createLinearGradient(G.box[0]+G.box[2],G.box[1],G.box[0],G.box[1]+G.box[3]);H._gradient(g,I,G)}else{if(G.bg=="r"){var z=G.box[3]/2;var A=G.box[0]+G.box[2]/2;var s=G.box[1]+z;g=I.createRadialGradient(A,s,0,A,s,z);H._gradient(g,I,G)}}}}}}}I.restore()},border:function(s,w,v,z){var t=0,u=0;s.lineWidth=(typeof R)==="number"?R:j;s.strokeStyle=w.b[1];s.stroke();s.save()},path:function(ax,D,w,A,C,aJ,aB,E,z){ax.beginPath();var v=Math.floor(E/2);var aI=A+v;var aA=C+v;var ar=A+aB-v;var aE=C+aJ-v;var aN=aE-aA;var aP=ar-aI;var aK=["cloud","thumbsD","thumbsU"];if(z.sh&&z.sh[3]&&z.sh[2]){aI+=Math.floor(z.sh[3]-z.sh[2]/2);aA+=Math.floor(z.sh[3]-z.sh[2]/2);ar-=Math.floor(z.sh[3]+z.sh[2]/2);aE-=Math.floor(z.sh[3]+z.sh[2]/2)}if($.isArray(w)){for(var ay=0;ay<4;ay++){w[ay]=w[ay]||0}}else{w=[w,w,w,w]}if(D=="sq"){var av=Math.min((aE-aA)/2,(ar-aI)/2);w[0]=Math.min(w[0],av);w[1]=Math.min(w[1],av);w[2]=Math.min(w[2],av);w[3]=Math.min(w[3],av);ax.moveTo(aA+w[0],aI),ax.lineTo(aE-w[1],aI),ax.quadraticCurveTo(aE,aI,aE,aI+w[1]),ax.lineTo(aE,ar-w[2]),ax.quadraticCurveTo(aE,ar,aE-w[2],ar),ax.lineTo(aA+w[3],ar),ax.quadraticCurveTo(aA,ar,aA,ar-w[3]),ax.lineTo(aA,aI+w[0]),ax.quadraticCurveTo(aA,aI,aA+w[0],aI)}if(D=="arrU"){var t=(aE-aA)+(5/4);var aD=(aA+aE)/2;var aJ=aE-aA;ax.moveTo(aD,aI+E);ax.lineTo(aE-(E/2),aI+t);ax.lineTo(aD+aJ*0.15,aI+t);ax.lineTo(aD+aJ*0.15,ar);ax.lineTo(aD-aJ*0.15,ar);ax.lineTo(aD-aJ*0.15,aI+t);ax.lineTo(aA+(E/2),aI+t);ax.lineTo(aD,aI+E)}if(D=="arrD"){var t=(aE-aA)+(5/4);var aD=(aA+aE)/2;var aJ=aE-aA;var az=ar-aI;var aQ=(aE-aA)*1.5;if(az<=aQ){t=(ar-aI)/2}ax.moveTo(aD,ar-E);ax.lineTo(aE-(E/2),ar-t);ax.lineTo(aD+aJ*0.15,ar-t);ax.lineTo(aD+aJ*0.15,aI);ax.lineTo(aD-aJ*0.15,aI);ax.lineTo(aD-aJ*0.15,ar-t);ax.lineTo(aA+(E/2),ar-t);ax.lineTo((aA+aE)/2,ar)}if(D=="arrR"){var t=(ar-aI)+(5/4);var aF=(aI+ar)/2;var aB=ar-aI;var at=aE-aA;var u=(ar-aI)*1.5;if(at<=u){t=(aE-aA)/2}ax.moveTo(aE-E,(aI+ar)/2);ax.lineTo(aE-t,ar-(E/2));ax.lineTo(aE-t,aF+aB*0.15);ax.lineTo(aA,aF+aB*0.15);ax.lineTo(aA,aF-aB*0.15);ax.lineTo(aE-t,aF-aB*0.15);ax.lineTo(aE-t,aI+(E/2));ax.lineTo(aE-E,(aI+ar)/2)}if(D=="arrL"){var t=(ar-aI)+(5/4);var aF=(aI+ar)/2;var aB=ar-aI;var at=aE-aA;var u=(ar-aI)*1.5;if(at<=u){t=(aE-aA)/2}ax.moveTo(aA+E,(aI+ar)/2);ax.lineTo(aA+t,ar-(E/2));ax.lineTo(aA+t,aF+aB*0.15);ax.lineTo(aE,aF+aB*0.15);ax.lineTo(aE,aF-aB*0.15);ax.lineTo(aA+t,aF-aB*0.15);ax.lineTo(aA+t,aI+(E/2));ax.lineTo(aA+E,(aI+ar)/2)}if(D=="image"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aA,aI-Math.floor(E/2));ax.moveTo(aA,aI);ax.lineTo(aE,ar);ax.moveTo(aE,aI);ax.lineTo(aA,ar)}else{if(D=="tri"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aE,ar);ax.lineTo(aA,aI)}else{if(D=="tri"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aE,ar);ax.lineTo(aA,aI)}else{if(D=="trR"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aA,ar);ax.lineTo(aA,aI)}else{if(D=="ttrL"){ax.moveTo(aE,aI);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aE,aI)}else{if(D=="ttrR"){ax.moveTo(aA,aI);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aA,aI)}else{if(D=="triU"){ax.moveTo((aA+aE)/2,aI);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo((aA+aE)/2,aI)}else{if(D=="triD"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo((aA+aE)/2,ar);ax.lineTo(aA,aI)}else{if(D=="triR"){ax.moveTo(aA,aI);ax.lineTo(aE,(aI+ar)/2);ax.lineTo(aA,ar);ax.lineTo(aA,aI)}else{if(D=="triL"){ax.moveTo(aE,aI);ax.lineTo(aA,(aI+ar)/2);ax.lineTo(aE,ar);ax.lineTo(aE,aI)}else{if(D=="ribU"){ax.moveTo(aA,aI);ax.lineTo((aA+aE)/2,aI+(ar-aI)*0.25);ax.lineTo(aE,aI);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aA,aI)}else{if(D=="ribD"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aE,ar);ax.lineTo((aA+aE)/2,aI+0.75*(ar-aI));ax.lineTo(aA,ar);ax.lineTo(aA,aI)}else{if(D=="flagR"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aA+(4/5)*aN,(aI+ar)/2);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aA,aI)}else{if(D=="flagL"){ax.moveTo(aA,aI);ax.lineTo(aA+(1/5)*aN,(aI+ar)/2);ax.lineTo(aA,ar);ax.lineTo(aE,ar);ax.lineTo(aE,aI);ax.lineTo(aA,aI)}else{if(D=="houseU"){ax.moveTo((aA+aE)/2,aI);ax.lineTo(aE,aI+(3/7)*aP);ax.lineTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aA,aI+(3/7)*aP);ax.lineTo((aA+aE)/2,aI)}else{if(D=="houseD"){ax.moveTo((aA+aE)/2,ar);ax.lineTo(aE,aI+(4/7)*aP);ax.lineTo(aE,aI);ax.lineTo(aA,aI);ax.lineTo(aA,aI+(4/7)*aP);ax.lineTo((aA+aE)/2,ar)}else{if(D=="oct"){ax.moveTo(aA+(21/72)*aN,aI);ax.lineTo(aA+(51/72)*aN,aI);ax.lineTo(aE,aI+(21/72)*aP);ax.lineTo(aE,aI+(51/72)*aP);ax.lineTo(aA+(51/72)*aN,ar);ax.lineTo(aA+(21/72)*aN,ar);ax.lineTo(aA,aI+(51/72)*aP);ax.lineTo(aA,aI+(21/72)*aP);ax.lineTo(aA+(21/72)*aN,aI)}else{if(D=="star"){var aD=(aA+aE)/2;var aJ=aE-aA;var aB=ar-aI;ax.moveTo(aD,aI);ax.lineTo(aA+(33/54)*aJ,aI+(39/102)*aB);ax.lineTo(aE,aI+(39/102)*aJ);ax.lineTo(aA+(75/108)*aJ,aI+(63/102)*aB);ax.lineTo(aA+(87/108)*aJ,ar);ax.lineTo(aD,aI+(39/51)*aB);ax.lineTo(aA+(21/108)*aJ,ar);ax.lineTo(aA+(33/108)*aJ,aI+(63/102)*aB);ax.lineTo(aA,aI+(39/102)*aB);ax.lineTo(aA+(21/54)*aJ,aI+(39/102)*aB);ax.lineTo(aD,aI)}else{if(D=="pgL"){ax.moveTo(aA,ar);ax.lineTo(aE,ar);ax.lineTo(aE,aI);ax.lineTo(aA+(aE-aA)/3,aI);ax.lineTo(aA,aI+(ar-aI)/4);ax.lineTo(aA,ar)}else{if(D=="pgR"){ax.moveTo(aE,ar);ax.lineTo(aA,ar);ax.lineTo(aA,aI);ax.lineTo(aA+(aE-aA)*0.66,aI);ax.lineTo(aE,aI+(ar-aI)*0.25);ax.lineTo(aE,ar)}else{if(D=="pointrL"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aA+(5/7)*aN,aI+(3/7)*aP);ax.lineTo(aA+(5/7)*aN,ar);ax.lineTo(aA,aI)}else{if(D=="pointrR"){ax.moveTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aA+(2/7)*aN,ar);ax.lineTo(aA+(2/7)*aN,aI+(3/7)*aP);ax.lineTo(aA,aI)}else{if(D=="ldL"){ax.moveTo(aA,aI);ax.lineTo(aA+2,aI);ax.lineTo(aE,ar);ax.lineTo(aE-2,ar);ax.lineTo(aA,aI)}else{if(D=="ldR"){ax.moveTo(aE,aI);ax.lineTo(aE-2,aI);ax.lineTo(aA,ar);ax.lineTo(aA+2,ar);ax.lineTo(aE,aI)}else{if(D=="dropD"){ax.moveTo((aA+aE)/2,aI);ax.lineTo(aA+aN/6,(aI+ar)/2);ax.bezierCurveTo(aA-(aN*(1.5/6)),ar+(aP/6.2),aE+(aN*(1.5/6)),ar+(aP/6.2),aA+aN*(5/6),(aI+ar)/2);ax.lineTo((aA+aE)/2,aI)}else{if(D=="dropU"){ax.moveTo((aA+aE)/2,ar);ax.lineTo(aA+aN/6,(aI+ar)/2);ax.bezierCurveTo(aA-(aN*(1.5/6)),aI-(aP/6.2),aE+(aN*(1.5/6)),aI-(aP/6.2),aA+aN*(5/6),(aI+ar)/2);ax.lineTo((aA+aE)/2,ar)}else{if(D=="oval"){ax.moveTo(aA,(ar+aI)/2);ax.bezierCurveTo(aA+aN*(1/4),aI-(aP/7),aA+aN*(3/4),aI-(aP/7),aE,(ar+aI)/2);ax.bezierCurveTo(aA+aN*(3/4),ar+(aP/7),aA+aN*(1/4),ar+(aP/7),aA,(ar+aI)/2)}else{if(D=="cloud"){ax.moveTo(aA+aN*(1.5/9),ar);ax.bezierCurveTo(aA,ar,aA,aI+aP*(7/11),aA+aN*(1.6/9),aI+aP*(7/11));ax.bezierCurveTo(aA+aN/9,aI+aP/3,aA+aN/3,aI+aP/6.3,aA+aN*(4/9),aI+aP/3.2);ax.bezierCurveTo(aA+aN*(4.5/9),aI,aA+aN*(7.4/9),aI,aA+aN*(7.3/9),(ar+aI)/2);ax.bezierCurveTo(aE,(ar+aI)/2,aE,ar,aA+aN*(7.7/9),ar);ax.lineTo(aA+aN*(1.5/9),ar)}else{if(D=="person"){ax.moveTo(aA,ar);ax.bezierCurveTo((aA+aE)/16,(aI+ar)*(11/14),(aA+aE)*(3/16),(aI+ar)*(10/14),(aA+aE)*(6/16),(ar+aI)*(9/14));ax.bezierCurveTo((aA+aE)*(2.5/16),(aI+ar)*(4/7),(aA+aE)*(2.5/16),aI,(aA+aE)/2,aI);ax.bezierCurveTo((aA+aE)*(13.5/16),aI,(aA+aE)*(13.5/16),(aI+ar)*(4/7),(aA+aE)*(10/16),(ar+aI)*(9/14));ax.bezierCurveTo((aA+aE)*(13/16),(aI+ar)*(10/14),(aA+aE)*(15/16),(aI+ar)*(11/14),aE,ar);ax.lineTo(aA,ar)}else{if(D=="thumbsU"){ax.moveTo(aA,aI+aP*(16/17));ax.lineTo(aA,aI+aP*(15/34));ax.bezierCurveTo(aA+aN*(2/15),aI+aP*(7/17),aA+aN*(9/30),aI+aP*(4/17),aA+aN/3,aI+aP*(3/34));ax.bezierCurveTo(aA+aN*(5.2/15),aI,aA+aN*(9/15),aI,aA+aN*(8.5/15),aI+aP*(2/17));ax.lineTo(aA+aN*(7/15),aI+aP*(11/34));ax.bezierCurveTo(aA+aN*(9/15),aI+aP*(13/34),aA+aN*(11/15),aI+aP*(13/34),aA+aN*(12/15),aI+aP*(13/34));ax.bezierCurveTo(aE,aI+aP*(13/34),aE,aI+aP*(19/34),aA+aN*(12/15),aI+aP*(19/34));ax.bezierCurveTo(aA+aN*(14/15),aI+aP*(19/34),aA+aN*(27/30),aI+aP*(12/17),aA+aN*(23/30),aI+aP*(12/17));ax.bezierCurveTo(aA+aN*(13/15),aI+aP*(12/17),aA+aN*(25/30),aI+aP*(29/34),aA+aN*(11/15),aI+aP*(29/34));ax.bezierCurveTo(aA+aN*(25/30),aI+aP*(29/34),aA+aN*(12/15),ar,aA+aN*(8.5/15),ar);ax.bezierCurveTo((aA+aE)/2,ar,aA+aN/5,ar,aA,aI+aP*(16/17))}else{if(D=="thumbsD"){ax.moveTo(aA,aI+aP/17);ax.lineTo(aA,aI+aP*(19/34));ax.bezierCurveTo(aA+aN*(2/15),aI+aP*(10/17),aA+aN*(9/30),aI+aP*(13/17),aA+aN/3,aI+aP*(31/34));ax.bezierCurveTo(aA+aN*(5.2/15),ar,aA+aN*(9/15),ar,aA+aN*(8.5/15),aI+aP*(15/17));ax.lineTo(aA+aN*(7/15),aI+aP*(23/34));ax.bezierCurveTo(aA+aN*(9/15),aI+aP*(21/34),aA+aN*(11/15),aI+aP*(21/34),aA+aN*(12/15),aI+aP*(21/34));ax.bezierCurveTo(aE,aI+aP*(21/34),aE,aI+aP*(15/34),aA+aN*(12/15),aI+aP*(15/34));ax.bezierCurveTo(aA+aN*(14/15),aI+aP*(15/34),aA+aN*(27/30),aI+aP*(5/17),aA+aN*(23/30),aI+aP*(5/17));ax.bezierCurveTo(aA+aN*(13/15),aI+aP*(5/17),aA+aN*(25/30),aI+aP*(5/34),aA+aN*(11/15),aI+aP*(5/34));ax.bezierCurveTo(aA+aN*(25/30),aI+aP*(5/34),aA+aN*(12/15),aI,aA+aN*(8.5/15),aI);ax.bezierCurveTo(aA+aN/2,aI,aA+aN/5,aI,aA,aI+aP/17)}else{if(D=="arcL"){var aJ=aE-aA;var aB=ar-aI;var aG=(aB>=(aJ*2))?aJ:aB/2;ax.moveTo(aA+aG,aI);ax.arcTo(aA,aI,aA,aI+aG,aG);ax.arcTo(aA,aI+(2*aG),aA+aG,aI+(2*aG),aG);ax.lineTo(aA+aG,aI)}else{if(D=="arcR"){var aJ=aE-aA;var aB=ar-aI;var aG=(aB>=(aJ*2))?aJ:aB/2;ax.moveTo(aA,aI);ax.arcTo(aA+aG,aI,aA+aG,aI+aG,aG);ax.arcTo(aA+aG,aI+(2*aG),aA,aI+(2*aG),aG);ax.lineTo(aA,aI)}else{if(D=="arcU"){var aJ=aE-aA;var aB=ar-aI;var aG=(aJ>=(aB*2))?aB:aJ/2;ax.moveTo(aA,aI+aG);ax.arcTo(aA,aI,aA+aG,aI,aG);ax.arcTo(aA+(2*aG),aI,aA+(2*aG),aI+(2*aG),aG);ax.lineTo(aA,aI+aG)}else{if(D=="arcD"){var aJ=aE-aA;var aB=ar-aI;var aG=(aJ>=(aB*2))?aB:aJ/2;ax.moveTo(aA,aI);ax.arcTo(aA,aI+aG,aA+aG,aI+aG,aG);ax.arcTo(aA+(2*aG),aI+aG,aA+(2*aG),aI,aG);ax.lineTo(aA,aI)}else{if(D=="folder"){var aJ=aE-aA;var aB=ar-aI;ax.moveTo(aA+(3/8)*aJ,aI+(2/15)*aB);ax.lineTo(aE-w[1],aI+(2/15)*aB);ax.quadraticCurveTo(aE,aI+(2/15)*aB,aE,(aI+(2/15)*aB)+w[1]);ax.lineTo(aE,ar-w[2]);ax.quadraticCurveTo(aE,ar,aE-w[2],ar);ax.lineTo(aA+w[3],ar);ax.quadraticCurveTo(aA,ar,aA,ar-w[3]);ax.lineTo(aA,aI+w[0]);ax.quadraticCurveTo(aA,aI,aA+w[0],aI);ax.lineTo(aA+(5/16)*aJ,aI);ax.lineTo(aA+(3/8)*aJ,aI+(2/15)*aB)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(D=="speechRight"){ax.moveTo(aE-17,ar);ax.lineTo(aE-96,ar-13);ax.lineTo(aA,ar-13);ax.lineTo(aA,aI);ax.lineTo(aE,aI);ax.lineTo(aE,ar-13);ax.lineTo(aE-38,ar-13);ax.lineTo(aE-17,ar)}if(D=="speechLeft"){ax.moveTo(aA+17,ar);ax.lineTo(aA+96,ar-13);ax.lineTo(aE,ar-13);ax.lineTo(aE,aI);ax.lineTo(aA,aI);ax.lineTo(aA,ar-13);ax.lineTo(aA+38,ar-13);ax.lineTo(aA+17,ar)}else{if(D=="bubr"){right=C+aJ-1;bottom=A+aB-2;tailSize=7;if(G.b){A=A+G.b[0]/2;C=C+G.b[0]/2;right=right-G.b[0]/2;bottom=bottom-G.b[0]/2}ax.moveTo(right-tailSize,bottom-7);ax.lineTo(right-tailSize,A+w[1]);ax.quadraticCurveTo(right-tailSize,A,right-w[1]-tailSize,A);ax.lineTo(C+w[0],A);ax.quadraticCurveTo(C,A,C,A+w[0]);ax.lineTo(C,bottom-w[3]);ax.quadraticCurveTo(C,bottom,C+w[3],bottom);ax.lineTo(right-19,bottom);ax.quadraticCurveTo(right-15,bottom-1,right-14,bottom-2);ax.quadraticCurveTo(right-7,bottom+1,right-1,bottom-2);ax.quadraticCurveTo(right-tailSize,bottom-3,right-tailSize,bottom-7)}else{if(D=="bubl"){right=C+aJ-1;bottom=A+aB-2;tailSize=7;if(G.b){A=A+G.b[0]/2;C=C+G.b[0]/2;right=right-G.b[0]/2;bottom=bottom-G.b[0]/2}ax.moveTo(right,bottom-w[2]);ax.lineTo(right,A+w[1]);ax.quadraticCurveTo(right,A,right-w[1],A);ax.lineTo(C+w[0]+tailSize,A);ax.quadraticCurveTo(C+tailSize,A,C+tailSize,A+w[0]);ax.lineTo(C+tailSize,bottom-6);ax.quadraticCurveTo(C+4,bottom-1,C+1,bottom-2);ax.quadraticCurveTo(C+2,bottom+2,C+13,bottom-2);ax.quadraticCurveTo(C+15,bottom,C+19,bottom);ax.lineTo(right-w[2],bottom);ax.quadraticCurveTo(right,bottom,right,bottom-w[2])}else{if(D=="arrowL"||D=="arrowR"||D=="arrowU"||D=="arrowD"){var F=2;if(z.aCurve){F=z.aCurve}var s=12;if(z.aSize){s=z.aSize}if(D=="arrowL"){ax.moveTo(aA+s,aI);ax.lineTo(aE-w[1],aI);ax.quadraticCurveTo(aE,aI,aE,aI+w[1]);ax.lineTo(aE,ar-w[2]);ax.quadraticCurveTo(aE,ar,aE-w[2],ar);ax.lineTo(aA+s,ar);ax.bezierCurveTo(aA+s-F,ar,aA,((ar+aI)/2)+F,aA,(ar+aI)/2);ax.bezierCurveTo(aA,((ar+aI)/2)-F,s-F+aA,aI,aA+s,aI)}else{if(D=="arrowR"){ax.moveTo(aA+w[0],aI);ax.lineTo(aE-s,aI);ax.bezierCurveTo(aE-s+F,aI,aE,((aI+ar)/2)-F,aE,(aI+ar)/2);ax.bezierCurveTo(aE,((aI+ar)/2)+F,aE-s+F,ar,aE-s,ar);ax.lineTo(aA+w[3],ar);ax.quadraticCurveTo(aA,ar,aA,ar-w[3]);ax.lineTo(aA,aI+w[0]);ax.quadraticCurveTo(aA,aI,aA+w[0],aI)}else{if(D=="arrowD"){var aq=(z.aW)?z.aW:aq;var aH=(aA+aE)/2;var aC=aq/2;ax.moveTo(aA+w[0],aI);ax.lineTo(aE-w[1],aI);ax.quadraticCurveTo(aE,aI,aE,aI+w[1]);ax.lineTo(aE,ar-s-w[2]);ax.quadraticCurveTo(aE,ar-s,aE-w[2],ar-s);ax.lineTo(aH+aC,ar-s);ax.lineTo(aH,ar);ax.lineTo(aH-aC,ar-s);ax.lineTo(aA+w[3],ar-s);ax.quadraticCurveTo(aA,ar-s,aA,ar-s-w[3]);ax.lineTo(aA,aI+w[0]);ax.quadraticCurveTo(aA,aI,aA+w[0],aI)}else{if(D=="arrowU"){var aq=(z.aW)?z.aW:20;var aH=(aA+aE)/2;var aC=aq/2;ax.moveTo(aA+w[0],aI+s);ax.lineTo(aH-aC,aI+s);ax.lineTo(aH,aI);ax.lineTo(aH+aC,aI+s);ax.lineTo(aE-w[1],aI+s);ax.quadraticCurveTo(aE,aI+s,aE,aI+s+w[1]);ax.lineTo(aE,ar-w[2]);ax.quadraticCurveTo(aE,ar,aE-w[2],ar);ax.lineTo(aA+w[2],ar);ax.quadraticCurveTo(aA,ar,aA,ar-w[3]);ax.lineTo(aA,aI+s+w[0]);ax.quadraticCurveTo(aA,aI+s,aA+w[3],aI+s)}}}}}else{if(D=="c"){var aL=aJ/2,aM=aB/2,B=Math.min(aL,aM),aO=Math.min(E|0,B),aG=B-aO/2;R=aO;ax.arc(C+aL,A+aM,aG,0,Math.PI*2,true)}else{if(D==="ell"){var aL=aJ/2,aM=aB/2,B=Math.min(aL,aM),aO=Math.min(E|0,B),au=(aJ-aO)/2,aw=(aB-aO)/2;if(au<0){au=0}if(au<0){au=0}R=aO;if(au>0&&aw>0){ax.ellipse(C+aL,A+aM,au,aw,0,0,2*Math.PI)}}}}}}}ax.closePath()},_gradient:function(t,A,w){var z=["#ffffff","#000000"];var u=[0,1];if(w.bgc&&w.bgd){z=w.bgc;u=w.bgd}for(var v=0;v<z.length&&v<u.length;v++){try{t.addColorStop(u[v],z[v])}catch(s){}}A.fillStyle=t;A.fill()},_glaze:function(w,A){var s=5,v=c.useOneCanvas?2+A.box[1]:2,B=c.useOneCanvas?10+A.box[0]:10,C=A.box[2]-27,t=10,D=0,u=7;if(A.s=="bubl"){B+=u}H.path(w,"sq",s,v,B,C,t,D,A);var z=w.createLinearGradient(0,v+t,0,v);z.addColorStop(0,"rgba(231, 231, 231, 0.2)");z.addColorStop(0.59,"rgba(240, 240, 240, 0.25)");z.addColorStop(1,"rgba(249, 249, 249, 0.3)");w.fillStyle=z;w.fill();w.restore()},_shadow:function(s,t){s.shadowColor=t.sh[0];s.shadowOffsetX=t.sh[1];s.shadowOffsetY=t.sh[2];s.shadowBlur=t.sh[3]},_effect:function(w,E){var ab=E.fx;for(var D=0;D<ab.length;D++){var B=ab[D];if(B[0]=="dots"){var s=B[1];var A=B[2];var t=B[3];w.fillStyle=B[4];var Z=E.box[2];var aa=E.box[3];var v=s+A;var C=s+t;var u=parseInt(Z/v)+1;var z=parseInt(aa/C)+1;var F=0;for(var X=0;X<z;X++){F=(F)?0:s;for(var Y=0;Y<u;Y++){w.beginPath();w.arc((Y*v)+F,(X*C),s/2,0,2*Math.PI);w.closePath();w.fill()}}}}},_setImage:function(s,u){try{s.drawImage(s.canvas,0,0)}catch(t){}}};var M=this.renderingMode==="singlepage"?0:G.box[0];var i=this.renderingMode==="singlepage"?0:G.box[1];var d=G.box[2];var f=G.box[3];var j=0;var O=0;var N=G.b;var R=null;if(N){j=N[0];O=N.length>3?N.slice(2):N[2]}var P=G.s?G.s:"sq";I.save();if(!this.skipImages&&m.get(G.id)){H.blur()}H.path(I,P,O,i,M,d,f,j,G);if(G.sh){H._shadow(I,G)}if(G.bg){H.background(I,G)}I.restore();if(N&&j>0){H.border(I,G,d,f)}if(G.glaze&&G.glaze=="y"){H._glaze(I,G)}if(G.fx&&G.fx.length>0){H._effect(I,G)}if(G.i){for(var L=0;L<G.i.length;L++){var J=G.i[L];var h=new Image();function Q(){var s=J[5];if(typeof(s)=="string"&&s.search("%")!=-1){s=(d*parseInt(s)/100)-J[3]/2}else{if(s<0){s=parseInt(d)+J[5]-J[3]}}var t=J[6];if(typeof(t)=="string"&&t.search("%")!=-1){t=(f*parseInt(t)/100)-J[4]/2}else{if(t<0){t=parseInt(f)+J[6]-J[4]}}if(c.imagesLoaded[J[0]]){I.drawImage(c.imagesLoaded[J[0]],J[1],J[2],G.box[2],G.box[3],s+M,t+i,G.box[2],G.box[3])}else{h.onload=function(){try{I.drawImage(h,J[1],J[2],G.box[2],G.box[3],s+M,t+i,G.box[2],G.box[3]);if(I.canvas.hasOwnProperty("onchange")){I.canvas.onchange()}}catch(u){}};h.src=J[0]}}$(h).ready(Q)}}else{}if(!this.useCanvas){K=this.canvasToImg(K)}return K};this.canvasToImg=function(d){var c=d.get(0).toDataURL("image/png");return $('<img src="'+c+'">')};this.renderOne=function(c,d,i){var f={$rendition:{},childWidgets:[]};if(!c.box){c.box=this.calculateBox(c,d,i)}if(fluid.widget.isShapeWidget(c)){f.$shapeRendition=this.paintCanvas(c)}if(fluid.widget.isUploadWidget(c)){}if(fluid.widget.isTextWidget(c)){f.$textRendition=this.renderText(c)}if(fluid.widget.hasChildWidgets(c)){var h=fluid.wdgProvider.getChildWidgets(c,true);for(var j=0;j<h.length;j++){f.childWidgets.push(this.renderOne(h[j],c,c.ad[j]))}}if(fluid.widget.hasSegments(c)){f.segments=this.renderSegments(c)}if(!f.childWidgets.length){delete f.childWidgets}return f};this.renderSegments=function(h){var f=[];var c=[];for(var d=0;d<h.sc;d++){if(h.segments&&h.segments.length){f.push({wdgObj:m.get(h.segments[d].id),box:[]})}else{f.push({wdgObj:fluid.wdgProvider.getById(h.seg[d%h.seg.length]),box:[]})}}for(d=0;d<f.length;d++){if(f[d].wdgObj.wh){f[d].wdgObj.tlwh=[0,0,f[d].wdgObj.wh[0],f[d].wdgObj.wh[1]]}if(f[d].wdgObj.tlwh&&typeof(f[d].wdgObj.tlwh[2])==="number"){f[d].box[2]=f[d].wdgObj.tlwh[2]}else{if(f[d].wdgObj.tlwh){if(f[d].wdgObj.tlwh&&f[d].wdgObj.tlwh[2]==="a"){f[d].box[2]=h.box[2]/h.sc}else{if(f[d].wdgObj.tlwh[2].indexOf("%")!==-1){f[d].box[2]=(parseFloat(f[d].wdgObj.tlwh[2])/100)*h.box[2]}}}}if(f[d].wdgObj.tlwh&&typeof(f[d].wdgObj.tlwh[3])==="number"){f[d].box[3]=f[d].wdgObj.tlwh[3]}else{if(f[d].wdgObj.tlwh){if(f[d].wdgObj.tlwh&&f[d].wdgObj.tlwh[3]==="a"){f[d].box[3]=h.box[3]/h.sc}else{if(f[d].wdgObj.tlwh[3].indexOf("%")!==-1){f[d].box[3]=(parseFloat(f[d].wdgObj.tlwh[3])/100)*h.box[3]}}}}}if(h.sl=="h"){if(h.sa=="tl"||!h.sa){for(d=0;d<f.length;d++){f[d].box[0]=(d*(h.box[2]/h.sc));f[d].box[1]=0+h.sp[1]}}else{if(h.sa=="d"){for(d=0;d<f.length;d++){f[d].box[0]=(d*(h.box[2]/h.sc))+Math.max(h.box[2]/h.sc-f[d].box[2],0)/2;f[d].box[1]=(h.box?h.box[1]:0)+h.sp[1]}}}}else{for(d=0;d<f.length;d++){f[d].box[0]=h.box?h.box[0]:0;f[d].box[1]=(h.box?h.box[1]:0)+(d*f[d].box[3])}}for(d=0;d<f.length;d++){if(d===0&&f[d].wdgObj.bts){f[d].wdgObj.b=f[d].wdgObj.bts}else{if(d===f.length-1&&f[d].wdgObj.bbs){f[d].wdgObj.b=f[d].wdgObj.bbs}else{if(f[d].wdgObj.bms&&h.sl==="v"){f[d].wdgObj.b=f[d].wdgObj.bms}}}if(d===0&&f[d].wdgObj.bls){f[d].wdgObj.b=f[d].wdgObj.bls}else{if(d===f.length-1&&f[d].wdgObj.brs){f[d].wdgObj.b=f[d].wdgObj.brs}else{if(f[d].wdgObj.bms&&h.sl==="h"){f[d].wdgObj.b=f[d].wdgObj.bms}}}f[d].wdgObj.box=f[d].box;c.push(this.renderOne(f[d].wdgObj))}return c};this.renderRecursive=function(i,d){var f={};if(i.length){var c=[];for(var h=0;h<i.length;h++){this.generateCanvas(i[h].originId);f=this.renderOne(i[h],d);c.push(f)}}else{this.generateCanvas(i.originId);f=this.renderOne(i,d)}return c||f};this.onPageRenderFinish=function(i){this.renderingQueue[i]=null;if(this.afterPageRendered){var d=this.canvases[i].get(0).toDataURL("image/png");this.afterPageRendered(i,d,1,false)}else{var h=[];var j=fluid.main.project.id;var d=this.canvases[i].get(0).toDataURL("image/jpeg",0.5);var f=$("#"+i+"canvas.page-preview");var t=m.get(i);var c=m.get(i,{returnModel:true});if(!c){return}c.set({imgData:d},{silent:true});h.push({id:i,data:d,project:j});requestAnimationFrame(function(){if(!m.get(i)||!m.get(i).widgets||m.get(i).widgets.length===0){return}var v=$('<img class="page-preview" src="'+d+'">');var s=new Image();s.src=d;v.insertAfter(f);setTimeout(function(){f.remove()}.bind(f),650);s.onload=function(){var u=$("#scaled-"+i);var z=fluid.zoom.getAllPagesParams().newScale;if(u.length){u.html(s)}else{Logger({key:"missing page model",group:"other",message:"tried to get page that doesnt exist"})}}.bind(this)}.bind(this))}};this.onRenderFinish=function(){if(typeof window.callPhantom==="function"){$("#canvas").css({top:(-this.cropping.y+15)+"px",left:(-this.cropping.x+15)+"px"});window.callPhantom({event:"finishedrendering",cropping:this.cropping})}else{if(!this.afterPageRendered){var d=[];var c=fluid.main.project.id;$("canvas.page-preview").each(function(){var h=$(this).parents(".screen").attr("id");var i=m.get(h);if(!i||!i.widgets||!i.widgets.length){return}var f=$(this).get(0).toDataURL("image/jpeg",0.5);var j=m.get(h,{returnModel:true});j.set({imgData:f});requestAnimationFrame(function(){var t=$('<img class="page-preview" src="'+f+'">');t.insertAfter($(this));setTimeout(function(){$(this).remove()}.bind(this),500)}.bind(this))})}}};this.countRemainingLoads=function(h){var f=0;if(h){for(var d in this.imagesToLoad[h]){f++}for(var d in this.uploadsToLoad[h]){f++}return f}else{for(var h in this.imagesToLoad){if(this.imagesToLoad.hasOwnProperty(h)){for(var c in this.imagesToLoad[h]){if(this.imagesToLoad[h].hasOwnProperty(c)){f++}}}}for(var h in this.uploadsToLoad){if(this.uploadsToLoad.hasOwnProperty(h)){for(var c in this.uploadsToLoad[h]){if(this.uploadsToLoad[h].hasOwnProperty(c)){f++}}}}return f}};this.onImgLoadErr=function(j,d,u){if(!u.src||u.src.indexOf("data/img")!==-1){if(this.imagesToLoad[j][d]){delete this.imagesToLoad[j][d]}if(this.uploadsToLoad[j][d]){delete this.uploadsToLoad[j][d]}var h=this.countRemainingLoads(j);if(h===0){for(var i=0;i<this.renderingQueue[j].length;i++){var v=this.renderingQueue[j][i];if(fluid.widget.isShapeWidget(v)){this.paintCanvas(v,this.canvases[j])}if(fluid.widget.isUploadWidget(v)){this.renderUpload(v,this.canvases[j],this.imagesLoaded[v.data])}if(fluid.widget.isTextWidget(v)){this.renderText(v,this.canvases[j])}}if(this.countRemainingLoads()===0){this.onRenderFinish()}}var c=this.countRemainingLoads();fluid.main.fire("image.loaded",{step:c,countdown:true});if(c==0){fluid.main.fire("images.loaded");this.onPageRenderFinish(j)}return}var f=new Image();f.onload=this.onImgLoad.bind(this,j,d);f.onerror=this.onImgLoadErr.bind(this,j,d);f.src="data/img/"+d};this.onImgLoad=function(h,j,B){this.imagesLoaded[j]=B;if(this.imagesToLoad[h][j]){delete this.imagesToLoad[h][j]}if(this.uploadsToLoad[h][j]){delete this.uploadsToLoad[h][j]}var f=this.countRemainingLoads(h);if(f===0){for(var c=0;c<this.renderingQueue[h].length;c++){var d=this.renderingQueue[h][c];if(fluid.widget.isShapeWidget(d)){this.paintCanvas(d,this.canvases[h])}if(fluid.widget.isUploadWidget(d)){this.renderUpload(d,this.canvases[h],this.imagesLoaded[d.data])}if(fluid.widget.isTextWidget(d)){this.renderText(d,this.canvases[h])}}this.onPageRenderFinish(h);if(this.countRemainingLoads()===0){this.onRenderFinish()}}var A=fluid.main.uploads&&fluid.main.uploads.get(j);var z=fluid.main.project;if(A&&j.indexOf("i_")===0&&window.uploadsCache&&!window.uploadsCache[j]){if(!fluid.main.project.uploadCanvas||p.isTaintedCanvas(z.uploadCanvas)){z.uploadCanvas=document.createElement("canvas")}z.uploadCanvas.width=B.naturalWidth;z.uploadCanvas.height=B.naturalHeight;z.uploadCanvasCtx=z.uploadCanvas.getContext("2d");z.uploadCanvasCtx.drawImage(evt.target,0,0);var i=z.uploadCanvas.toDataURL("image/png");if(A&&i){A.set({imgData:i})}}var w=this.countRemainingLoads();fluid.main.fire("image.loaded",{step:w,countdown:true});if(w==0){fluid.main.fire("images.loaded")}};this.pageRenderOne=function(i){var d={$rendition:{}};if(!this.skipImages){var j=this.countRemainingLoads()==0;if(!this.imagesToLoad[this.pageId]){this.imagesToLoad[this.pageId]={}}if(!this.uploadsToLoad[this.pageId]){this.uploadsToLoad[this.pageId]={}}var h=false;if(i.i&&!this.imagesToLoad[this.pageId][i.i[0][0]]){h=true}if(i.upload==="y"&&!this.uploadsToLoad[this.pageId][i.data]){h=true}if(h||this.renderingQueue[this.pageId].length>0){if(i.i&&!this.imagesToLoad[this.pageId][i.i[0][0]]){var c=new Image();this.imagesToLoad[this.pageId][i.i[0][0]]=true;c.onload=this.onImgLoad.bind(this,this.pageId,i.i[0][0],c);c.onerror=this.onImgLoadErr.bind(this,this.pageId,i.i[0][0],c);c.src=i.i[0][0];if(j){fluid.main.fire("images.loading")}}else{if(i.upload==="y"&&!this.uploadsToLoad[this.pageId][i.data]){var f=m.get(i.data);this.uploadsToLoad[this.pageId][i.data]=i.id;if(window.uploadsCache&&window.uploadsCache[i.data]){c.src=uploadsCache[i.data]}else{fluid.upload.get({id:i.data,callback:function(J,E,D){if(D.success){var H=new Image();H.onload=this.onImgLoad.bind(this,J,E,H);H.onerror=this.onImgLoadErr.bind(this,J,E,H);var G=atob(D.imgData.split(";base64,")[1]);var F=new Array(G.length);for(var I=0;I<G.length;I++){F[I]=G.charCodeAt(I)}var K=new Uint8Array(F);var L=new Blob([K],{type:"image/png"});H.src=URL.createObjectURL(L);if(j){fluid.main.fire("images.loading")}}else{var H=new Image();this.onImgLoadErr.call(this,J,E,H)}}.bind(this,this.pageId,i.data),priority:fluid.upload.priority.pageZoomedOut})}}}this.renderingQueue[this.pageId].push(i);d.$shapeRendition=this.canvas;return d}}if(fluid.widget.isShapeWidget(i)||i.segments){d.$shapeRendition=this.paintCanvas(i)}if(!this.skipImages&&fluid.widget.isUploadWidget(i)){d.$shapeRendition=this.renderUpload(i)}if(fluid.widget.isTextWidget(i)){d.$textRendition=this.renderText(i)}return d};this.calculatePageBox=function(c,d){return m.get(d,{returnModel:true}).getBox()};this.exceedsPage=function(d,c){if(d.box==undefined){return false}if(d.box[0]<0||d.box[1]<0){return true}if(d.box[0]+d.box[2]>c.width){return true}if(d.box[1]+d.box[3]>c.height){return true}return false};this.renderPage=function(t,c,i){if(this.renderingQueue[t.id]&&this.renditions[t.id]){return this.renditions[t.id]}else{this.renderingQueue[t.id]=[]}if(this.finishTimeout){clearTimeout(this.finishTimeout);delete this.finishTimeout}var f={};var j=[];var h=[];for(var d in t.widgets){t.widgets[d].id=d;t.widgets[d].box=this.calculatePageBox(t,d);if(!i){if(this.useOneCanvas&&this.exceedsPage(t.widgets[d],t)){h.push(d)}}}this.setCropping(t);this.generateCanvas(t.id);this.pageId=t.id;f=this.pageRenderOne({st:"b",ca:"tl",bg:"c",bgc:["#ffffff"],box:[0,0,this.canvasSize[0],this.canvasSize[1]],wg:[1],id:"dummy-bg-"+(new Date().getTime())});j.push(f);for(var d in t.widgets){if(t.widgets[d].st&&t.widgets[d].st==="b"){f=this.pageRenderOne(t.widgets[d]);f.id=d;f.lockTo=t.widgets[d].lockTo;f.box=t.widgets[d].box;j.push(f)}}for(var d in t.widgets){if((!t.widgets[d].st||t.widgets[d].st!=="b")&&!(c&&t.widgets[d].dm==="t")){if(t.widgets[d].ts){if($("#"+d+" span").css("")==="underline"){t.widgets[d].ts+=" text-decoration: underline;"}}f=this.pageRenderOne(t.widgets[d]);f.id=d;f.lockTo=t.widgets[d].lockTo;f.box=t.widgets[d].box;j.push(f)}}if(this.countRemainingLoads(t.id)===0){this.onPageRenderFinish(t.id)}if(this.countRemainingLoads()===0){this.finishTimeout=setTimeout(this.onRenderFinish.bind(this),200)}this.renditions[t.id]=j;return j};this.preparePage=function(d){var f=$.extend({id:d},m.get(d));f.widgets=f.widgets.reduce(function(h,i){h[i]=$.extend({},m.get(i));h[i].id=i;return h},{});for(var c in f.widgets){f.widgets[c].box=this.calculatePageBox(f,c)}return f},this.renderWdg=function(d,i){var c;var f=[0,0];i=$.extend({},i);i.widgets={};this.renderingQueue[d]=[];this.pageId=d;for(var t=0;i.ad&&t<i.ad.length;t++){c=i.ad[t][0];if(widgets.summary[c]){var j={wh:[widgets.summary[c].wh[0],widgets.summary[c].wh[1]]};(j.wh[0]=="a")&&(j.wh[0]="100%");(j.wh[1]=="a")&&(j.wh[1]="100%");j.tlwh=[i.ad[t][2],i.ad[t][1],j.wh[0],j.wh[1]];i.widgets[c]={id:c,box:this.calculateBox(j)};i.widgets[c]=$.extend(i.widgets[c],widgets.summary[c]);delete i.widgets[c].blur;f[0]=Math.max(f[0],i.widgets[c].box[0]+i.widgets[c].box[2]);f[1]=Math.max(f[1],i.widgets[c].box[1]+i.widgets[c].box[3])}}var h=Math.max(f[0],f[1]);this.generateCanvas(d,{width:h,height:h});for(var t=0;i.ad&&t<i.ad.length;t++){if(i.widgets[i.ad[t][0]]){this.renderSubWdg(i.widgets[i.ad[t][0]])}}if(this.countRemainingLoads(d)===0){this.onPageRenderFinish(d)}},this.renderSubWdg=function(h){this.pageRenderOne(h);if(h.ad&&h.ad.length){var f,c;for(var d=0;d<h.ad.length;d++){f=h.ad[d][0];c=$.extend({},widgets.summary[f]);c.id=f;c.box=this.calculateBox(c,h,h.ad[d]);c.blur=false;this.renderSubWdg(c)}}else{if(h.sc){this.renderSegments(h)}}};this.renderWidgetsBelow=function(h,d,B){d=d||this.preparePage(this.pageId);var i=0,w=m.get(d.id).widgets,f=w.length,j=this.ctx;for(;i<f;i++){if(w[i]===h){break}var A=d.widgets[w[i]];if(!A.dm){if((fluid.widget.isUploadWidget(A)||A.i)&&B){var c=document.getElementById(w[i]),z=c?(c.querySelector("img")||c.querySelector("canvas")):null;if(z){j.drawImage(z,A.box[0],A.box[1],A.box[2],A.box[3])}}else{this.pageRenderOne(A)}}}if(this.countRemainingLoads(d.id)===0){this.onPageRenderFinish(d.id)}if(this.countRemainingLoads()===0){this.finishTimeout=setTimeout(this.onRenderFinish.bind(this),200)}};this.onProjectUnloaded=function(c){if(!this.canceledPreview){this.canceledPreview=[]}this.canceledPreview.push(c)};this.renderProjectPreview=function(X,U,j){X=$.extend({},X);if(this.currentProjectId&&X[this.currentProjectId]){return}this.previewSize={width:238,height:163};var f=$("<canvas></canvas>");var Y=f.get(0).getContext("2d");this.canvas=f;var S=$('<canvas class="project-preview" width="'+this.previewSize.width+'" height="'+this.previewSize.height+'"></canvas>').css({position:"relative"});var T=S.get(0).getContext("2d");var W;var h;var af={};var i={};for(var aa in X){if(X.hasOwnProperty(aa)){if(aa.indexOf("w_")===0||(aa.indexOf("w")===0&&aa.length==33)){i[aa]=$.extend({},X[aa])}else{if(aa.indexOf("x_")===0||(aa.indexOf("x")===0&&aa.length==33)){af[aa]=$.extend({},X[aa])}else{if(aa.indexOf("p_")===0||(aa.indexOf("p")===0&&aa.length==33)){W=$.extend({},X[aa]);h=aa}}}}}this.lastProjectId=h;this.currentProjectId=h;var O=W.pages;if(!O){U.call(this,h,S);this.currentProjectId=null;return}var ae;var d={x:W.canvasWidth,y:W.canvasHeight,x2:0,y2:0};for(var Q=0;Q<O.length;Q++){ae=af[O[Q]];if(!ae){continue}if(ae.x<d.x){d.x=ae.x}if(ae.y<d.y){d.y=ae.y}if(ae.x+ae.width>d.x2){d.x2=ae.x+ae.width}if(ae.y+ae.height>d.y2){d.y2=ae.y+ae.height}}var c={x:this.previewSize.width/(d.x2-d.x),y:this.previewSize.height/(d.y2-d.y)};c.x=Math.min(c.x,c.y);c.y=Math.min(c.x,c.y);this.skipImages=true;var ac=[];for(var Q=0;Q<O.length;Q++){if(!af[O[Q]]){continue}var ae=$.extend({},af[O[Q]]);ac.push(ae);if(ae.widgets&&ae.widgets.length>0){var N={};for(var R=0;R<ae.widgets.length;R++){N[ae.widgets[R]]=i[ae.widgets[R]]}}ae.widgets=ae.widgets.length>0?N:[];ae.id=O[Q];this.canvasSize=[ae.width||320,ae.height||480];if(!this.widgetsCache){this.widgetsCache={}}if(!this.pagesCache){this.pagesCache={}}for(var aa in ae.widgets){if(ae.widgets.hasOwnProperty(aa)&&ae.widgets[aa]){ae.widgets[aa].id=aa;ae.widgets[aa].box=this.calculatePageBox(ae,aa);this.widgetsCache[aa]=ae.id}}this.pagesCache[ae.id]=ae}var ad=$.extend({},W.links);var V;var P;var ab;for(var Q=0;Q<ad.linkDest.length;Q++){if(!this.pagesCache||!this.pagesCache[ad.linkDest[Q]]){continue}V=this.widgetsCache[ad.linkOrigin[Q]];if(V===undefined){continue}P={x:this.pagesCache[V].x+this.pagesCache[V].width*0.5,y:this.pagesCache[V].y+this.pagesCache[V].height*0.5};P.x=(P.x-d.x)*c.x;P.y=(P.y-d.y)*c.y;ab={x:this.pagesCache[ad.linkDest[Q]].x+this.pagesCache[ad.linkDest[Q]].width*0.5,y:this.pagesCache[ad.linkDest[Q]].y+this.pagesCache[ad.linkDest[Q]].height*0.5};ab.x=(ab.x-d.x)*c.x;ab.y=(ab.y-d.y)*c.y;T.beginPath();T.strokeStyle="#009ecc";T.moveTo(P.x,P.y);T.lineTo(ab.x,ab.y);T.stroke()}function Z(u){if(!fluid.main.project||fluid.main.project.pages.length===0){return}ae=ac[u];f.attr({width:ae.width,height:ae.height});Y.fillStyle="#ffffff";Y.fillRect(0,0,ae.width,ae.height);this.canvasSize=[ae.width||320,ae.height||480];for(var s in ae.widgets){if(ae.widgets.hasOwnProperty(s)&&ae.widgets[s]){ae.widgets[s].id=s;ae.widgets[s].box=this.calculatePageBox(ae,s)}}T.fillStyle="#ffffff";T.fillRect((ae.x-d.x)*c.x,(ae.y-d.y)*c.y,ae.width*c.x,ae.height*c.y);var w=m.get(ac[u].id,{returnModel:true});var t=w?w.get("imgData"):null;if(!w||!t){for(var s in ae.widgets){if(ae.widgets.hasOwnProperty(s)&&ae.widgets[s]){if(ae.widgets[s].st&&ae.widgets[s].st==="b"){this.pageRenderOne(ae.widgets[s])}}}for(var s in ae.widgets){if(ae.widgets.hasOwnProperty(s)&&ae.widgets[s]){if(!ae.widgets[s].st||ae.widgets[s].st!=="b"){if(!w||!w.getBox()){page.calculateWdgPositions(ae.id)}this.pageRenderOne(ae.widgets[s])}}}}var v=new Image();if(!w||!t){v.src=f.get(0).toDataURL("image/jpeg")}else{v.src=t}v.onload=(function(z,B,E,F,C,A){T.drawImage(z,B,E,F,C);if(this.canceledPreview&&this.canceledPreview.indexOf(h)!==-1){var D=this.canceledPreview.indexOf(h);this.canceledPreview[D]=null}else{if(u<ac.length-1){setTimeout(Z.bind(this,u+1),100)}else{fluid.main.fire("thumbnailReady",h,S.get(0));U.call(this,h,S);this.currentProjectId=null}}}).bind(this,v,(ae.x-d.x)*c.x,(ae.y-d.y)*c.y,ae.width*c.x,ae.height*c.y,ae.id)}if(ac.length>0){setTimeout(Z.bind(this,0),200)}else{U.call(this,h,S);this.currentProjectId=null}return S};this.flattenRenditions=function(f){if(f.length){var d=[];for(var c=0;c<f.length;c++){d.push(this.flattenRendition(f[c]))}return d}else{return[this.flattenRendition(f)]}};this.flattenRendition=function(i){var d=[];var f=i.childWidgets;var c=i.segments;d.push(i.$rendition);if(f&&f.length){for(var h=0;h<f.length;h++){d=d.concat(this.flattenRendition(f[h]))}}if(c&&c.length){for(h=0;h<c.length;h++){d=d.concat(this.flattenRendition(c[h]))}}return d}}},{"./browserdetect":24,"./class-storage":46,"./class-widget":49,"./fluid/modules/upload":90,"./utils":99,"./utils-editor":98}],49:[function(j,o,k){var l=j("./class-storage");var m=j("./utils-editor");var n=j("./class-widgetNewDraw");j("./StackBlur");var p={widgetOffset:null,locked:null,currSelection:null,useCanvas:false,get:function(a){var b;if(typeof widgets!=="undefined"){b=widgets.summary&&widgets.summary[a]&&$.extend(true,{id:a},widgets.summary[a])}if(b==undefined){b=l.get(a)}return b||false},getSubTextElements:function(f){var b,c,a=[],d;d=f.id;b=l.get(d,{returnModel:true}).getSubTextElements();b.forEach(function(h){a.push(h.id)});c=$("#"+a.join(", #"));return c},getSegmentRoots:function(a){var b=[],c,d;$(a).each(function(){c=l.get(this.id,{returnModel:true});d=c.getSegmentRoot();if(d){b.push(d.id)}});b=$("#"+b.join(", #"));return b},getLockTos:function(a){var c=fluid.main.project.widgets.getRoots(a);var b=Array.prototype.reduce.call(c,function(f,d){_.forEach(document.querySelectorAll('[data-lockto="'+d.id+'"]'),function(h){if(f.indexOf(h)===-1){f.push(h)}});return f},[]);return $(b)},getSelectedOnly:function(a){function c(d){a.each(function(){if($(this).attr("data-segment")==$(this).attr("id")){if($(this).attr("data-lockto")==d){b=b.add($(this))}}})}var b=$([]);a.each(function(){if($(this).hasClass("ui-selected")){var d=n.get($(this).attr("id"));if(d.sc&&!d.bg){var f=$(this).attr("id");c(f)}else{b=b.add($(this))}}});return b},getDependentsCache:[],getDependents:function(c,f,b){var a=[],h,i=[];if(b&&n.getDependentsCache[c]){return n.getDependentsCache[c]}if(!b){n.getDependentsCache=[]}if(f){f.each(function(){i.push(l.get(this.id,{returnModel:true}))});f=i}else{f=l.get(c,{returnModel:true}).getLockTos()}for(var r=0,d=f.length;r<d;r++){if(f[r].get("of")===c){a.push(f[r].id)}}h=$("#"+a.join(", #"));n.getDependentsCache[c]=h;return h},resetCache:function(){n.getDependentsCache=[]},getAbsDimension:function(a,b){if(typeof a=="string"){if(a=="a"){return b||0}else{return(parseFloat(a||0)/100)*(b||0)}}else{return a}},saveTempFile:function(a,b){l.setTempItem(a+"_file",b)},getTempFile:function(a){return l.get(a+"_file")},removeTempFile:function(a){l.remove(a+"_file")},autoWidth:function(b,a){var d=[b.tlwh[2],b.tlwh[3]];var c=a!="library"?$("#"+fluid.zoom.getActivePageId()).find(".widgetHolder").width():320;var c=a!="library"?$("#"+fluid.zoom.getActivePageId()).find(".widgetHolder").width():320;if(c==null&&d[0]=="a"){d[0]=320}else{if(d[0]=="a"){d[0]=c}}return d},addUploads:function(){var a=fluid.main.uploads.models;a.forEach(function(b){widgets.summary[b.id]=b.attributes})},_redraw:function(a,b,c){var d=$(".screen.active").attr("id");var f=n._setTMPLVars(a.attr("id"),b,[0,0,parseInt(fluid.main.project.pages.get(d).get("width")),parseInt(fluid.main.project.pages.get(d).get("height"))]);n._drawCanvasOrImage(a,f)},hasOwnColorProperties:function(a){if(typeof a=="string"){a=n.get(a)}return !a.srps&&Boolean(a.bg||a.bgc)},checkIntegrity:function(a,c){var b=n.get(a);if(!b){return true}if(!b.tlwh){n.fixTLWH(a,b,c)}return true},load:function(i,h,b){var v=$("#"+i).find(".widgetHolder");var u=[0,0,v.outerWidth(),v.outerHeight()];if(b==true){var c=$("#"+i).find(".fixedWidgetHolderFront");var d=v}for(var f=0;f<h.length;f++){if(b==true){var w=n.get(h[f]);v=d;var a=false;if(w.st=="f"){a=m.findPositionOnScreen($([]),h[f],b);if(a==true){v=c}}}n._draw(h[f],v,u,false,false,h[f].insertAfterId)}},fixTLWH:function(f,i,b){if(!i.wh){return false}var c=i.top.toString();var a=i.left.toString();if(c.indexOf("%")>-1){c=c.substring(0,c.indexOf("%")+1)}if(a.indexOf("%")>-1){a=a.substring(0,a.indexOf("%")+1)}if((i.lockTo!=f)&&(c.indexOf("%")==-1)){var d=n.get(i.lockTo);var h=(!d||isNaN(d.tlwh[0]))?0:d.tlwh[0];c=i.top-h}if((i.lockTo!=f)&&(a.indexOf("%")==-1)){var d=n.get(i.lockTo);var h=(!d||isNaN(d.tlwh[1]))?0:d.tlwh[1];a=i.left-h}if(c.toString().indexOf("%")==-1){c=parseFloat(c)}if(a.toString().indexOf("%")==-1){a=parseFloat(a)}if((i.wh[0]).toString().indexOf("%")==-1){i.wh[0]=parseFloat(i.wh[0])}if((i.wh[1]).toString().indexOf("%")==-1){i.wh[1]=parseFloat(i.wh[1])}if(i.st!="b"){var r=[c,a,i.wh[0],i.wh[1]];i.tlwh=r}i.ca="tl";delete i.top;delete i.left;delete i.wh;delete i.id;delete i.title;delete i.dp;delete i.x;l.set(f,i)},getBlurBox:function(h,t,d){var f,v,b,a;a=l.get(h,{returnModel:true});if(a&&a.getPage){b=a.getPage().getBox()}else{var c=l.get(t);b=[0,0,c.width,c.height]}if(a&&a.getBox){v=a.getBox().slice(0)}else{if(h.indexOf("helper-")===0){v=[0,0,b[2],b[3]]}else{v=[0,0,1,1]}}var u=d*2;v[0]-=d;v[1]-=d;v[2]+=u;v[3]+=u;f=v;for(var i=0;i<2;i++){if(v[i]<0){f[i]=0;f[i+2]=f[i+2]+f[i]}}for(var i=2;i<=3;i++){if(v[i-2]+v[i]>b[i]){f[i]=b[i]-f[i-2]}}return f},renderBlurLayer:function(c,f,A,C){f=f||l.get(c,{returnModel:true}).getPage().id;var D=l.get(f),i=document.createElement("canvas"),a=i.getContext("2d"),w=(w=c.match(/^helper-(.+)/))&&w[1],b=(w?widgets.summary[w].blur:n.get(c).blur),B=n.getBlurBox(c,f,b);if(B[2]<=0||B[3]<=0){return null}var h=B[0]+B[2],d=B[1]+B[3],z=new fluid.wdgRenderer(h,d);D=z.preparePage(f);i.width=h;i.height=d;z.renderBlur=false;z.useOneCanvas=true;z.pageId=f;z.renderingQueue[f]=[];z.generateCanvas(f);z.ctx.fillStyle="white";z.ctx.fillRect(0,0,z.canvasSize[0],z.canvasSize[1]);z.afterPageRendered=function(r,q){a.drawImage(z.canvas[0],0,0);m.blur.canvasRGB(i,B[0],B[1],B[2],B[3],b);if(A){try{return A(i.toDataURL(0,0))}catch(s){return C?C(s):s}}};z.renderWidgetsBelow(c,D,!A);a.drawImage(z.canvas[0],0,0);m.blur.canvasRGB(i,B[0],B[1],B[2],B[3],b);return i.toDataURL()},renderBlurLayerImmediate:function(i,b){b=b||l.get(i,{returnModel:true}).getPage().id;var c=l.get(b),d=document.createElement("canvas"),a,f=(f=i.match(/^helper-(.+)/))&&f[1],h=(f?widgets.summary[f].blur:n.get(i).blur);d.width=c.width;d.height=c.height;a=n.getBlurBox(i,b,h);if(a[2]<=0||a[3]<=0){return null}if(this.canvases[b]){m.blur.canvasRGB(d,a[0],a[1],a[2],a[3],h,this.canvases[b].get(0))}else{m.blur.canvasRGB(d,a[0],a[1],a[2],a[3],h)}return d},setBlurBG:function(f,c,d){var b=n.blurLayers[f.id];if(b){var a=n.blurOffsets[f.id];if(!a){a=n.blurOffsets[f.id]={left:0,top:0}}if(typeof c!=="number"){c=0;d=0;a.left=parseInt(f.style.left,10);a.top=parseInt(f.style.top,10)}f.style.backgroundImage="url("+b+")";f.style.backgroundPosition=-(a.left+c)+"px "+-(a.top+d)+"px";f.style.backgroundRepeat="no-repeat"}else{f.style.backgroundImage="none"}},blurLayers:{},blurOffsets:{}};if(!fluid.main.isNode()){fluid.main.on("uploaddone",function(b,f,i){n.removeTempFile(f);var c=fluid.main.uploads.get(f).get("wh");if(i.destination==="page"&&i.pageId){var a=fluid.main.project.get(i.pageId),d=c[0]>a.width?0:i.x-Math.round(c[0]/2),h=c[1]>a.height?0:i.y-Math.round(c[1]/2);fluid.command.create("create",{widgetId:f,offsetX:d,offsetY:h,pageId:i.pageId}).dispatchTo("fluid.controllers.widget")}});fluid.main.on("widgetBgColorChanged widgetBorderColorChanged widgetColorChanged widgetOpacityChanged",function(d,f){var c;if(fluid.zoom.getCtx()!=="project"&&f.pageId===$(".screen.active").attr("id")){for(var b=0;b<f.ids.length;b++){c=fluid.main.project.get(f.ids[b]);if("ts" in c){c=fluid.main.project.get(f.ids[b]);var a=c.insertAfterId;fluid.main.fire("widget:draw",f.ids[b],a,f.pageId)}else{n._redraw($("#"+f.ids[b]),c)}}}});fluid.main.on("afterWidgetResized",function(c,f){if(fluid.zoom.getCtx()!=="project"){var r;for(var a=0;a<f.ids.length;a++){r=$("#"+f.ids[a]);if(r.length){n._redraw(r,fluid.main.project.get(f.ids[a]));var h=n.getLockTos(r),b=fluid.main.project.widgets.get(f.ids[a]),d=b.getPage(),i=[0,0,d.get("width"),d.get("height")];n._updateDependents(f.ids[a],i,h,false,false)}}}})}o.exports=_.extend(n,p)},{"./StackBlur":23,"./class-storage":46,"./class-widgetNewDraw":50,"./utils-editor":98}],50:[function(r,t,q){var p=r("./class-widgetNewSegments");var n=r("./checkHost");var m=r("./browserdetect");var o=r("./class-storage");var s=r("./utils-editor");p._drawFromRoot=function(d,h,k,L,G){L=L||p.get(d);if(L.st=="g"){var j=L.ad;for(var I=0,b=j.length;I<b;I++){var H=j[I],K=H[0],a=p.get(K);p._drawFromRoot(K,h,k,a,[H[2],H[1],H[3]])}}else{var i=p._draw(d,h,k,L,G);if(L.seg&&L.sc){var E=fluid.controllers.widget.getSegmentParams(L);for(var f=0,b=E.segmentsObj.length;f<b;f++){var c=E.segmentsObj[f];var F=[c.tlwh[0],c.tlwh[1],k[2],k[3]];p._drawFromRoot(E.segmentsOrigin[f],h,F,c,[i.absTLWH[0],i.absTLWH[1]])}}if(!(L.ad&&L.ad.length)){return i}for(var f=0,b=L.ad.length;f<b;f++){var K=(i.ad[f])[0];var J=(i.ad[f])[3]||"tl";var G=[(i.ad[f])[2],(i.ad[f])[1],J];var a=false;p._drawFromRoot(K,h,i.absTLWH,a,G)}}return i};p._draw=function(c,j,a,b,d,h){var b=b||p.get(c);if(!b){return false}var i=p._setTMPLVars(c,b,a,d);if(i.isHelperWidget&&i.upload&&i.upload==="y"){i.data=c}i.isFirefox=m.browser==="Firefox";var f=$("#tmplWidget2").tmpl(i);p._drawCanvasOrImage(f,i);if(j){if(c.slice(0,2)==="w_"){$("#"+c).remove()}if(b.st=="b"){j.prepend(f)}else{if(h){if(h==="first"){j.prepend(f)}else{f.insertAfter($("#"+h))}}else{j.append(f)}}}return i};p.adjustHandlesScale=function(){var d=fluid.zoom.getCurrentScale();var c=Math.round(6/d),i=Math.round(5/d),j=Math.ceil(4/d),h=Math.round(6/d),a=Math.round(5/d),f=Math.round(1/d),b=$(".ui-selected .ui-resizable-handle");f=Math.max(f,1);requestAnimationFrame(function(){b.filter(".ui-resizable-n").css({top:-i,"margin-left":-j,height:c,width:c});b.filter(".ui-resizable-s").css({bottom:-i,"margin-left":-j,height:c,width:c});b.filter(".ui-resizable-e").css({right:-i,width:c,height:c,"margin-top":-j});b.filter(".ui-resizable-w").css({left:-i,width:c,height:c,"margin-top":-j});b.filter(".ui-resizable-ne").css({top:-a,right:-a,width:h,height:h,"outline-width":f});b.filter(".ui-resizable-nw").css({top:-a,left:-a,width:h,height:h,"outline-width":f});b.filter(".ui-resizable-se").css({bottom:-a,right:-a,width:h,height:h,"outline-width":f});b.filter(".ui-resizable-sw").css({bottom:-a,left:-a,width:h,height:h,"outline-width":f});b.show();p.adjustNEWSHandlesVisibility(b)})};p.adjustNEWSHandlesVisibility=function(b){var f=fluid.zoom.getCurrentScale(),b=b.length?b:$(".ui-selected .ui-resizable-handle"),a=fluid.selection.getSelectionModel().getBox(),h=[a[2]*fluid.zoom.getCurrentScale(),a[3]*fluid.zoom.getCurrentScale()],c=(h[0]<18)?"none":"block",d=(h[1]<18)?"none":"block";b.filter(".ui-resizable-n").css({display:c});b.filter(".ui-resizable-s").css({display:c});b.filter(".ui-resizable-e").css({display:d});b.filter(".ui-resizable-w").css({display:d})};p.adjustNEWSHandlesVisibilityDebounced=_.debounce(p.adjustNEWSHandlesVisibility,100);p._setTMPLVarsCache=[];p._setTMPLVars=function(H,d,c,L,k){var i=fluid.main.project.widgets.get(H);var f=i&&i.getBox();if(k&&p._setTMPLVarsCache[H]){return p._setTMPLVarsCache[H]}if(!k){p._setTMPLVarsCache=[]}var J=$.extend(true,{},d);J.id=H;J.useCanvas=p.useCanvas;J.includeCanvasOrImage=(((J.b||J.bg)&&!J.srps)||J.upload||J.i)?true:false;J.isRootwidget=(H==J.lockTo)?true:false;J.isSegmentRoot=Boolean(J.seg&&J.sc);J.isLibaryWidget=(J.lockTo!=undefined)?true:false;J.of=(J.of)?J.of:J.lockTo;J.isText=(d.ts||d.tc)?true:false;J.isBackgroundWidget=(d.st=="b")?true:false;J.isLockedWidget=i&&i.getRoot().get("locked");J.isStaticWidgetForeground=(d.st=="f")?true:false;if(d.ts){var h=d.ts.match(/width:\s*100\%;\s*height:\s*100%;\s*white-space:\s*pre-wrap/g);if(h&&h.length){J.addWH=false}else{J.addWH=true}var O;var N="";if(J.ts.indexOf("font-size")!==-1){O=J.ts.substring(d.ts.indexOf("font-size")+10,J.ts.indexOf(";",J.ts.indexOf("font-size"))).trim();O=parseFloat(O)}else{var K=J.ts.match(/font:[^;]*;/g);if(K.length){var P=K[0].match(/[0-9]*px/g);if(P.length){O=parseFloat(P[0])}if(P.length&&P.length>1){N=P[1]}}}if(N===""&&J.ts.indexOf("line-height")!==-1){N=J.ts.substring(J.ts.indexOf("line-height")+12,J.ts.indexOf(";",J.ts.indexOf("line-height"))).trim()}if(O&&N.indexOf("normal")!==-1){if(J.ts.indexOf("line-height")!==-1){J.ts=J.ts.replace(/line-height:\s*normal/g,"line-height: "+Math.round(O*1.14)+"px")}else{J.ts=J.ts.replace(/[0-9]*px\/[0-9]px/g,O+"px/"+Math.round(O*1.14)+"px")}}else{if(O&&N===""){J.ts=J.ts+"; line-height: "+Math.round(O*1.14)+"px;"}}J.isUnderline=!!J.ts.match(/text-decoration:\s?underline;/);if(J.isUnderline){J.ts=J.ts.replace(/text-decoration:\s?underline;/,"")}var a,b,j;if(!d.textVerticalAlign&&i){j=d.ts.match(/top:\s?([0-9\.]+%)/);if(j&&j[1]==="0.5%"){a="middle"}else{if(j&&j[1]==="0%"){a="top"}else{if(j&&j[1]=="1%"){a="bottom"}else{j=d.ts.match(/padding-top\:\s?([A-Za-z0-9\.\,]+)/);if(j){var M=parseFloat(j[1],10);if(isNaN(M)){a="top"}else{var G=(M+O)/f[3];if(G>0.3){a="middle";if(G>0.5){a="bottom"}}}}else{a="top"}}}}J.textVerticalAlign=a;i.set({textVerticalAlign:a})}J.ts=J.ts.replace(/padding-top\:\s?[A-Za-z0-9\.\,]+;/,"");J.ts=J.ts.replace(/top\:\s?[A-Za-z0-9\.\,]+%;/,"");if(!d.textHorizontalAlign&&i){j=d.ts.match(/text-align\:\s?(\w+)/);if(j){if(j[1]==="left"){b="left"}else{if(j[1]==="center"){b="center"}else{if(j[1]==="right"){b="right"}else{b="left"}}}}else{b="left"}J.textHorizontalAlign=b;i.set({textHorizontalAlign:b})}J.textVerticalAlign=J.textVerticalAlign||"top";J.textHorizontalAlign=J.textHorizontalAlign||"left"}if(!J.tlwh){var I=J.wh||[c[2],c[3]];J.tlwh=[0,0,I[0],I[1]]}J.ca=(L)?L[2]||"tl":J.ca||"tl";J.absTLWH=p._getAbsTLWH(H,J,c,L);if(k){p._setTMPLVarsCache[H]=J}return J};p._getAbsTLWH=function(a,d,j,T){if(fluid.main.project.widgets.get(a)){var J=fluid.main.project.widgets.get(a).getBox(true);return[J[1],J[0],J[2],J[3]]}function N(v,u){var w=parseFloat(v);return Math.round(w*u/100)}if(!d.of||a==d.of){var h=$.extend([],j)}else{var h=$.extend([],j);var S=p.get(d.of);if(S){h=p._getAbsTLWH(d.of,S,j,false)}}var L,M;var V=Boolean(d.segment&&S&&S.sp);var b=V?S.sp[0]+S.sp[3]:0;var O=V?S.sp[1]+S.sp[2]:0;if(!d.tlwh){d.tlwh=[0,0,d.wh[0],d.wh[1]]}if((d.seg||d.segments)&&(d.tlwh[2]=="a"||d.tlwh[3]=="a")){var P=fluid.controllers.widget.getSegmentParams(p.get(a),{containerTLWH:j}).rootTLWH;L=P[2];M=P[3]}else{var L=(d.tlwh[2]==="a")?"100%":d.tlwh[2];var M=(d.tlwh[3]==="a")?"100%":d.tlwh[3]}L=(typeof(L)==="string")?N(L,h[2]-b):L;M=(typeof(M)==="string")?N(M,h[3]-O):M;var c=(T)?T[0]:d.tlwh[0];var U=(T)?T[1]:d.tlwh[1];var K=(typeof(c)==="string")?N(c,h[3]-O):c;var R=(typeof(U)==="string")?N(U,h[2]-b):U;var Q=d.ca||"tl";try{var f=(Q[0]=="b")?h[3]-M-K:K;var i=(Q[1]=="r")?h[2]-L-R:R}catch(k){var f=0;var i=0}f=(Q[0]=="c")?K+h[3]/2-M/2:f;i=(Q[1]=="c")?R+h[2]/2-L/2:i;f+=h[0];i+=h[1];return[Math.round(f),Math.round(i),Math.round(L),Math.round(M)]};p._drawCanvasOrImage=function(c,f){if(!f.includeCanvasOrImage){return false}var a={width:f.absTLWH[2],height:f.absTLWH[3]};var d=$("<canvas>").attr(a);var b=d[0].getContext("2d");p._paintCanvas(c,b,f);return true};p.getImageData=function(c,a){var d=o.get(c);var b=c||false;if(b&&b.substr(0,5)!="data:"){if(a&&(!d||!d.storage||d.storage=="cloud")){b=imgCloudUrl+c+".png"}else{b=l("img",c)}}else{if(tmplVars.id){if(a&&(!d||!d.storage||d.storage=="cloud")){b=imgCloudUrl+tmplVars.id+".png"}else{b=l("img",tmplVars.id)}}}return b};p._drawPreviewImageUpload=function(c,b){c.get(0).innerHTML='<img class="preview-upload-image">';$imgEl=c.find("img");$imgEl.get(0).onerror=function(){if(this.src.indexOf("/data/img")===-1){this.onerror=function(){};this.src=p.getImageData(b.data,false)}};if(n){var a="";switch(b.type){case"image/svg+xml":a=".svg";break;default:a=".png";break}$imgEl.get(0).src="img/"+b.data+a}else{$imgEl.get(0).src=p.getImageData(b.data,true)}};p._drawImageUpload=function(k,d){var h={width:d.absTLWH[2],height:d.absTLWH[3]};var f=k.find("canvas");var c=f.size()>0?f:$("<canvas/>");c.attr(h);var j=c[0].getContext("2d");function a(u,E,v,D){if(!E.tlwh[2]||!E.tlwh[3]){E.tlwh[2]=this.width;E.tlwh[3]=this.height;u.css({width:E.tlwh[2],height:E.tlwh[3]});$(v.canvas).attr({width:E.tlwh[2],height:E.tlwh[3]});p.scale(u.closest(".widgetParts"),E)}if(D){var F=new Image();F.src=D;F.onload=function(){v.drawImage(F,0,0,E.tlwh[2],E.tlwh[3])}}else{v.drawImage(this,0,0,E.tlwh[2],E.tlwh[3])}}function w(B,v){if(this.src.indexOf("/data/img")===-1){var u=new Image();u.src=z(false);u.onload=a;img=u;u.onerror=function(){$(j.canvas).addClass("failureImage");j.font="32pt Arial";j.fillText("Image",35,50);j.fillText("not found",10,115)}}else{$(j.canvas).addClass("failureImage");j.font="32pt Arial";j.fillText("Image",35,50);j.fillText("not found",10,115)}this.onerror=null}function i(){if(this.src.indexOf("/data/img")===-1){delete this.crossOrigin;this.removeAttribute("crossorigin");this.src=z(false)}else{w.apply(this,arguments);p._convertCanvasToImg($(j.canvas),k.find("img"),d)}this.onerror=null}function z(B){var u=o.get(d.data);var v=d.data||false;if(v&&v.substr(0,5)!="data:"){if(B&&(!u||!u.storage||u.storage=="cloud")){v=imgCloudUrl+d.data+".png"}else{v=l("img",d.data)}}else{if(d.id){if(B&&(!u||!u.storage||u.storage=="cloud")){v=imgCloudUrl+d.id+".png"}else{v=l("img",d.id)}}}return v||w()}if((f.length||k.find("img"))&&d.simpleUploadResize){return}var b=k.find("img").get(0);fluid.upload.get({id:d.data||d.id,image:b,callback:function(D,u,C,v){if(D.find("img").length===0&&v.imgData){a.call(v.image,D,u,C,v.imgData)}}.bind(this,k,d,j),priority:fluid.upload.priority.pageZoomedIn});return};p._convertCanvasToImg=function(c,d,a){function b(){var f=c[0].toDataURL("image/png");if(f!="data:,"){d.attr("src",f)}}b()};p._paintCanvas=function(b,H,h){var f={blur:function(){if(h.blur&&!((m.browser==="Chrome"||m.browser==="Safari")&&document.domain==="")){var u=b[0],A,z;if(window.g_preview||!o.get(h.id)){A=o.get(window.g_preview||fluid.main.project.get("id")).pages;for(var w=0,B=A.length;w<B;w++){var v=A[w];if(o.get(v).widgets.indexOf(h.id)!==-1){z=v;break}}z=z||document.querySelector(".canvasObject.active").id}else{z=o.get(h.id,{returnModel:true}).getPage().id}p.renderBlurLayer(u.id,z,function(C){p.blurLayers[u.id]=C;p.setBlurBG(u)});if(p.blurLayers[u.id]){p.setBlurBG(u)}}},background:function(){H.save();function u(){var A=(h.bgc)?h.bgc:["#CAD1D7","#C4CBD3"];var w=[5,2];var z="v";if(h.bgd){z=h.bgd[0];w=[h.bgd[1],h.bgd[2]]}H.fillStyle=A[1];H.fill();H.fillStyle=A[0];if(z=="v"){for(var v=w[0];v<k;){H.fillRect(v,0,w[1],c);v+=w[0]}}else{for(var v=w[0];v<c;){H.fillRect(0,v,k,w[1]);v+=w[0]}}}if(!k){k=0}if(!c){c=0}if(h.bg=="c"){H.fillStyle=h.bgc[0];H.fill()}else{if(h.bg=="s"){u()}else{if(h.bg=="l"){g=H.createLinearGradient(0,0,0,c);f._gradient(g,H,h)}else{if(h.bg=="lrl"){g=H.createLinearGradient(0,0,k,0);f._gradient(g,H,h)}else{if(h.bg=="ld"){g=H.createLinearGradient(0,0,k,c);f._gradient(g,H,h)}else{if(h.bg=="ld2"){g=H.createLinearGradient(k,0,0,c);f._gradient(g,H,h)}else{if(h.bg=="r"){g=H.createRadialGradient(k/2,c/2,0,k/2,c/2,c/2);f._gradient(g,H,h)}}}}}}}H.restore()},border:function(u,A,z,B){var v=0,w=0;u.lineWidth=(typeof I)==="number"?I:E;u.strokeStyle=A.b?A.b[1]:A.bms[1];u.stroke();u.save()},path:function(aF,C,A,ay,aE,aW,aS,aG,av){aF.beginPath();var aR=ay+Math.floor(aG/2);var aJ=aE+Math.floor(aG/2);var aC=ay+aS-Math.floor(aG/2);var aO=aE+aW-Math.floor(aG/2);if(av.sh&&av.sh[3]&&av.sh[2]){aR+=Math.floor(av.sh[3]-av.sh[2]/2);aJ+=Math.floor(av.sh[3]-av.sh[2]/2);aC-=Math.floor(av.sh[3]+av.sh[2]/2);aO-=Math.floor(av.sh[3]+av.sh[2]/2)}if($.isArray(A)){for(var aH=0;aH<4;aH++){A[aH]=A[aH]||0}}else{A=[A,A,A,A]}if(C=="sq"){var aD=Math.min((aO-aJ)/2,(aC-aR)/2);A[0]=Math.min(A[0],aD);A[1]=Math.min(A[1],aD);A[2]=Math.min(A[2],aD);A[3]=Math.min(A[3],aD);aF.moveTo(aJ+A[0],aR),aF.lineTo(aO-A[1],aR),aF.quadraticCurveTo(aO,aR,aO,aR+A[1]),aF.lineTo(aO,aC-A[2]),aF.quadraticCurveTo(aO,aC,aO-A[2],aC),aF.lineTo(aJ+A[3],aC),aF.quadraticCurveTo(aJ,aC,aJ,aC-A[3]),aF.lineTo(aJ,aR+A[0]),aF.quadraticCurveTo(aJ,aR,aJ+A[0],aR)}if(C=="arrU"){var v=(aO-aJ)+(5/4);aQ=aC-aR,a1=(aO-aJ)*1.5;if(aQ<=a1){v=(aC-aR)/2}var aV=[s.Vector((aJ+aO)/2,aR+aG),s.Vector(aO-(aG/2),aR+v),s.Vector((aJ+aO)*0.65,aR+v),s.Vector((aJ+aO)*0.65,aC),s.Vector((aJ+aO)*0.35,aC),s.Vector((aJ+aO)*0.35,aR+v),s.Vector(aJ+(aG/2),aR+v)];s.drawVectors(aF,aV,A)}if(C=="arrD"){var v=(aO-aJ)+(5/4);var aQ=aC-aR;var a1=(aO-aJ)*1.5;if(aQ<=a1){v=(aC-aR)/2}var aV=[s.Vector((aJ+aO)/2,aC-aG),s.Vector(aO-(aG/2),aC-v),s.Vector((aJ+aO)*0.65,aC-v),s.Vector((aJ+aO)*0.65,aR),s.Vector((aJ+aO)*0.35,aR),s.Vector((aJ+aO)*0.35,aC-v),s.Vector(aJ+(aG/2),aC-v),s.Vector((aJ+aO)/2,aC)];s.drawVectors(aF,aV,A)}if(C=="arrR"){var v=(aC-aR)+(5/4);var aK=aO-aJ;var w=(aC-aR)*1.5;if(aK<=w){v=(aO-aJ)/2}var aV=[s.Vector(aO-aG,(aR+aC)/2),s.Vector(aO-v,aC-(aG/2)),s.Vector(aO-v,(aR+aC)*0.65),s.Vector(aJ,(aR+aC)*0.65),s.Vector(aJ,(aR+aC)*0.35),s.Vector(aO-v,(aR+aC)*0.35),s.Vector(aO-v,aR+(aG/2)),s.Vector(aO-aG,(aR+aC)/2)];s.drawVectors(aF,aV,A)}if(C=="arrL"){var v=(aC-aR)+(5/4);var aK=aO-aJ;var w=(aC-aR)*1.5;if(aK<=w){v=(aO-aJ)/2}var aV=[s.Vector(aJ+aG,(aR+aC)/2),s.Vector(aJ+v,aC-(aG/2)),s.Vector(aJ+v,(aR+aC)*0.65),s.Vector(aO,(aR+aC)*0.65),s.Vector(aO,(aR+aC)*0.35),s.Vector(aJ+v,(aR+aC)*0.35),s.Vector(aJ+v,aR+(aG/2)),s.Vector(aJ+aG,(aR+aC)/2)];s.drawVectors(aF,aV,A)}if(C=="image"){aF.moveTo(aJ,aR);aF.lineTo(aO,aR);aF.lineTo(aO,aC);aF.lineTo(aJ,aC);aF.lineTo(aJ,aR);aF.moveTo(aJ,aR);aF.lineTo(aJ+1,aR);aF.lineTo(aO,aC-1);aF.lineTo(aO,aC);aF.lineTo(aO-1,aC);aF.lineTo(aJ,aR-1);aF.lineTo(aJ,aR);aF.moveTo(aO-1,aR);aF.lineTo(aO,aR);aF.lineTo(aO,aR-1);aF.lineTo(aJ+1,aC);aF.lineTo(aJ,aC);aF.lineTo(aJ,aC-1);aF.lineTo(aO-1,aR)}else{if(C=="tri"){var aV=[s.Vector(aJ,aR),s.Vector(aO,aR),s.Vector(aO,aC)];s.drawVectors(aF,aV,A)}else{if(C=="trR"){var aV=[s.Vector(aJ,aR),s.Vector(aO,aR),s.Vector(aJ,aC)];s.drawVectors(aF,aV,A)}else{if(C=="ttrL"){var aV=[s.Vector(aO,aR),s.Vector(aO,aC),s.Vector(aJ,aC)];s.drawVectors(aF,aV,A)}else{if(C=="ttrR"){var aV=[s.Vector(aJ,aR),s.Vector(aO,aC),s.Vector(aJ,aC)];s.drawVectors(aF,aV,A)}else{if(C=="triU"){var aV=[s.Vector((aJ+aO)/2,aR),s.Vector(aO,aC),s.Vector(aJ,aC)];s.drawVectors(aF,aV,A)}else{if(C=="triD"){var aV=[s.Vector(aJ,aR),s.Vector(aO,aR),s.Vector((aJ+aO)/2,aC)];s.drawVectors(aF,aV,A)}else{if(C=="triR"){var aV=[s.Vector(aJ,aR),s.Vector(aO,(aR+aC)/2),s.Vector(aJ,aC)];s.drawVectors(aF,aV,A)}else{if(C=="triL"){var aV=[s.Vector(aO,aR),s.Vector(aJ,(aR+aC)/2),s.Vector(aO,aC)];s.drawVectors(aF,aV,A)}else{if(C=="ribU"){aF.moveTo(aJ,aR);aF.lineTo((aJ+aO)/2,(aR+aC)/4);aF.lineTo(aO,aR);aF.lineTo(aO,aC);aF.lineTo(aJ,aC);aF.lineTo(aJ,aR)}else{if(C=="ribD"){aF.moveTo(aJ,aR);aF.lineTo(aO,aR);aF.lineTo(aO,aC);aF.lineTo((aJ+aO)/2,(3/4)*(aR+aC));aF.lineTo(aJ,aC);aF.lineTo(aJ,aR)}else{if(C=="flagR"){aF.moveTo(aJ,aR);aF.lineTo(aO,aR);aF.lineTo((4/5)*(aJ+aO),(aR+aC)/2);aF.lineTo(aO,aC);aF.lineTo(aJ,aC);aF.lineTo(aJ,aR)}else{if(C=="flagL"){aF.moveTo(aJ,aR);aF.lineTo((1/5)*(aJ+aO),(aR+aC)/2);aF.lineTo(aJ,aC);aF.lineTo(aO,aC);aF.lineTo(aO,aR);aF.lineTo(aJ,aR)}else{if(C=="houseU"){var aV=[s.Vector(aO,(3/7)*(aR+aC)),s.Vector(aO,aC),s.Vector(aJ,aC),s.Vector(aJ,(3/7)*(aR+aC)),s.Vector((aJ+aO)/2,aR)];s.drawVectors(aF,aV,A)}else{if(C=="houseD"){var aV=[s.Vector((aJ+aO)/2,aC),s.Vector(aO,(4/7)*(aR+aC)),s.Vector(aO,aR),s.Vector(aJ,aR),s.Vector(aJ,(4/7)*(aR+aC))];s.drawVectors(aF,aV,A)}else{if(C=="oct"){var ax=21/72,aA=51/72,B=aJ+aO,D=aR+aC,aV=[s.Vector(ax*B,aR),s.Vector(aA*B,aR),s.Vector(aO,ax*D),s.Vector(aO,aA*D),s.Vector(aA*B,aC),s.Vector(ax*B,aC),s.Vector(aJ,aA*D),s.Vector(aJ,ax*D)];s.drawVectors(aF,aV,A)}else{if(C=="star"){var aV=[s.Vector((aJ+aO)/2,aR),s.Vector((33/54)*(aJ+aO),(39/102)*(aC+aR)),s.Vector(aO,(39/102)*(aC+aR)),s.Vector((75/108)*(aJ+aO),(63/102)*(aC+aR)),s.Vector((87/108)*(aJ+aO),aC),s.Vector((aJ+aO)/2,(39/51)*(aC+aR)),s.Vector((21/108)*(aJ+aO),aC),s.Vector((33/108)*(aJ+aO),(63/102)*(aC+aR)),s.Vector(aJ,(39/102)*(aC+aR)),s.Vector((21/54)*(aJ+aO),(39/102)*(aC+aR))];s.drawVectors(aF,aV,A)}else{if(C=="pgL"){var aV=[s.Vector(aJ,aC),s.Vector(aO,aC),s.Vector(aO,aR),s.Vector((aJ+aO)/3,aR),s.Vector(aJ,(aR+aC)/4)];s.drawVectors(aF,aV,A)}else{if(C=="pgR"){var aV=[s.Vector(aO,aC),s.Vector(aJ,aC),s.Vector(aJ,aR),s.Vector((2/3)*(aJ+aO),aR),s.Vector(aO,(aR+aC)/4)];s.drawVectors(aF,aV,A)}else{if(C=="pointrL"){var aV=[s.Vector(aJ,aR),s.Vector(aO,aR),s.Vector((5/7)*(aJ+aO),(3/7)*(aR+aC)),s.Vector((5/7)*(aJ+aO),aC),s.Vector(aJ,aR)];s.drawVectors(aF,aV,A)}else{if(C=="pointrR"){var aV=[s.Vector(aJ,aR),s.Vector(aO,aR),s.Vector((2/7)*(aJ+aO),aC),s.Vector((2/7)*(aJ+aO),(3/7)*(aR+aC)),s.Vector(aJ,aR)];s.drawVectors(aF,aV,A)}else{if(C=="ldL"){aF.moveTo(aJ,aR);aF.lineTo(aJ+2,aR);aF.lineTo(aO,aC);aF.lineTo(aO-2,aC);aF.lineTo(aJ,aR)}else{if(C=="ldR"){aF.moveTo(aO,aR);aF.lineTo(aO-2,aR);aF.lineTo(aJ,aC);aF.lineTo(aJ+2,aC);aF.lineTo(aO,aR)}else{if(C=="dropD"){aF.moveTo((aJ+aO)/2,aR);aF.lineTo((aJ+aO)/6,(aR+aC)/2);aF.bezierCurveTo(aJ-((aJ+aO)*(1.5/6)),aC+((aC+aR)/6.2),aO+((aJ+aO)*(1.5/6)),aC+((aC+aR)/6.2),(aJ+aO)*(5/6),(aR+aC)/2);aF.lineTo((aJ+aO)/2,aR)}else{if(C=="dropU"){aF.moveTo((aJ+aO)/2,aC);aF.lineTo((aJ+aO)/6,(aR+aC)/2);aF.bezierCurveTo(aJ-((aJ+aO)*(1.5/6)),aR-((aC+aR)/6.2),aO+((aJ+aO)*(1.5/6)),aR-((aC+aR)/6.2),(aJ+aO)*(5/6),(aR+aC)/2);aF.lineTo((aJ+aO)/2,aC)}else{if(C=="oval"){aF.moveTo(aJ,(aC+aR)/2);aF.bezierCurveTo((aJ+aO)*(1/4),aR-((aC+aR)/7),(aJ+aO)*(3/4),aR-((aC+aR)/7),aO,(aC+aR)/2);aF.bezierCurveTo((aJ+aO)*(3/4),aC+((aC+aR)/7),(aJ+aO)*(1/4),aC+((aC+aR)/7),aJ,(aC+aR)/2)}else{if(C=="cloud"){aF.moveTo((aJ+aO)*(1.5/9),aC);aF.bezierCurveTo(aJ,aC,aJ,(aR+aC)*(7/11),(aJ+aO)*(1.6/9),(aC+aR)*(7/11));aF.bezierCurveTo((aJ+aO)/9,(aC+aR)/3,(aJ+aO)/3,(aC+aR)/6.3,(aJ+aO)*(4/9),(aC+aR)/3.2);aF.bezierCurveTo((aJ+aO)*(4.5/9),aR,(aJ+aO)*(7.4/9),aR,(aJ+aO)*(7.3/9),(aC+aR)/2);aF.bezierCurveTo(aO,(aC+aR)/2,aO,aC,(aJ+aO)*(7.7/9),aC);aF.lineTo((aJ+aO)*(1.5/9),aC)}else{if(C=="person"){aF.moveTo(aJ,aC);aF.bezierCurveTo((aJ+aO)/16,(aR+aC)*(11/14),(aJ+aO)*(3/16),(aR+aC)*(10/14),(aJ+aO)*(6/16),(aC+aR)*(9/14));aF.bezierCurveTo((aJ+aO)*(2.5/16),(aR+aC)*(4/7),(aJ+aO)*(2.5/16),aR,(aJ+aO)/2,aR);aF.bezierCurveTo((aJ+aO)*(13.5/16),aR,(aJ+aO)*(13.5/16),(aR+aC)*(4/7),(aJ+aO)*(10/16),(aC+aR)*(9/14));aF.bezierCurveTo((aJ+aO)*(13/16),(aR+aC)*(10/14),(aJ+aO)*(15/16),(aR+aC)*(11/14),aO,aC);aF.lineTo(aJ,aC)}else{if(C=="thumbsU"){aF.moveTo(aJ,(aR+aC)*(16/17));aF.lineTo(aJ,(aR+aC)*(15/34));aF.bezierCurveTo((aJ+aO)*(2/15),(aR+aC)*(7/17),(aJ+aO)*(9/30),(aR+aC)*(4/17),(aJ+aO)/3,(aC+aR)*(3/34));aF.bezierCurveTo((aJ+aO)*(5.2/15),aR,(aJ+aO)*(9/15),aR,(aJ+aO)*(8.5/15),(aR+aC)*(2/17));aF.lineTo((aJ+aO)*(7/15),(aR+aC)*(11/34));aF.bezierCurveTo((aJ+aO)*(9/15),(aR+aC)*(13/34),(aJ+aO)*(11/15),(aR+aC)*(13/34),(aJ+aO)*(12/15),(aR+aC)*(13/34));aF.bezierCurveTo(aO,(aR+aC)*(13/34),aO,(aR+aC)*(19/34),(aJ+aO)*(12/15),(aR+aC)*(19/34));aF.bezierCurveTo((aJ+aO)*(14/15),(aR+aC)*(19/34),(aJ+aO)*(27/30),(aR+aC)*(12/17),(aJ+aO)*(23/30),(aR+aC)*(12/17));aF.bezierCurveTo((aJ+aO)*(13/15),(aR+aC)*(12/17),(aJ+aO)*(25/30),(aR+aC)*(29/34),(aJ+aO)*(11/15),(aR+aC)*(29/34));aF.bezierCurveTo((aJ+aO)*(25/30),(aR+aC)*(29/34),(aJ+aO)*(12/15),aC,(aJ+aO)*(8.5/15),aC);aF.bezierCurveTo((aJ+aO)/2,aC,(aJ+aO)/5,aC,aJ,(aR+aC)*(16/17))}else{if(C=="thumbsD"){aF.moveTo(aJ,(aR+aC)/17);aF.lineTo(aJ,(aR+aC)*(19/34));aF.bezierCurveTo((aJ+aO)*(2/15),(aR+aC)*(10/17),(aJ+aO)*(9/30),(aR+aC)*(13/17),(aJ+aO)/3,(aC+aR)*(31/34));aF.bezierCurveTo((aJ+aO)*(5.2/15),aC,(aJ+aO)*(9/15),aC,(aJ+aO)*(8.5/15),(aR+aC)*(15/17));aF.lineTo((aJ+aO)*(7/15),(aR+aC)*(23/34));aF.bezierCurveTo((aJ+aO)*(9/15),(aR+aC)*(21/34),(aJ+aO)*(11/15),(aR+aC)*(21/34),(aJ+aO)*(12/15),(aR+aC)*(21/34));aF.bezierCurveTo(aO,(aR+aC)*(21/34),aO,(aR+aC)*(15/34),(aJ+aO)*(12/15),(aR+aC)*(15/34));aF.bezierCurveTo((aJ+aO)*(14/15),(aR+aC)*(15/34),(aJ+aO)*(27/30),(aR+aC)*(5/17),(aJ+aO)*(23/30),(aR+aC)*(5/17));aF.bezierCurveTo((aJ+aO)*(13/15),(aR+aC)*(5/17),(aJ+aO)*(25/30),(aR+aC)*(5/34),(aJ+aO)*(11/15),(aR+aC)*(5/34));aF.bezierCurveTo((aJ+aO)*(25/30),(aR+aC)*(5/34),(aJ+aO)*(12/15),aR,(aJ+aO)*(8.5/15),aR);aF.bezierCurveTo((aJ+aO)/2,aR,(aJ+aO)/5,aR,aJ,(aR+aC)/17)}else{if(C=="arcL"){var aW=aO-aJ;var aS=aC-aR;var aP=(aS>=(aW*2))?aW:aS/2;aF.moveTo(aJ+aP,aR);aF.arcTo(aJ,aR,aJ,aR+aP,aP);aF.arcTo(aJ,aR+(2*aP),aJ+aP,aR+(2*aP),aP);aF.lineTo(aJ+aP,aR)}else{if(C=="arcR"){var aW=aO-aJ;var aS=aC-aR;var aP=(aS>=(aW*2))?aW:aS/2;aF.moveTo(aJ,aR);aF.arcTo(aJ+aP,aR,aJ+aP,aR+aP,aP);aF.arcTo(aJ+aP,aR+(2*aP),aJ,aR+(2*aP),aP);aF.lineTo(aJ,aR)}else{if(C=="arcU"){var aW=aO-aJ;var aS=aC-aR;var aP=(aW>=(aS*2))?aS:aW/2;aF.moveTo(aJ,aR+aP);aF.arcTo(aJ,aR,aJ+aP,aR,aP);aF.arcTo(aJ+(2*aP),aR,aJ+(2*aP),aR+(2*aP),aP);aF.lineTo(aJ,aR+aP)}else{if(C=="arcD"){var aW=aO-aJ;var aS=aC-aR;var aP=(aW>=(aS*2))?aS:aW/2;aF.moveTo(aJ,aR);aF.arcTo(aJ,aR+aP,aJ+aP,aR+aP,aP);aF.arcTo(aJ+(2*aP),aR+aP,aJ+(2*aP),aR,aP);aF.lineTo(aJ,aR)}else{if(C=="folder"){var aY=A[0],aW=aO-aR,aS=aC-aR,z={x:(3/8)*(aO+aJ),y:(2/15)*(aR+aC)},aw={x:(5/16)*(aO+aJ),y:aR},aZ={x:aw.x+(z.x-aw.x)/2,y:aR+(z.y-aR)/2},az=Math.sqrt(aZ.x*aZ.x+aZ.y*aZ.y);A[1]=Math.min(aY,(aW-z.x)/2,aS/2);A[2]=Math.min(aY,(aC-z.y)/2,(z.x-aR)/2);A[4]=Math.min(aY,aS/2,(aw.x-aJ)/2),A[1]=A[4]=Math.min(A[1],A[4]);A[3]=Math.min(A[4],A[2]);A[0]=Math.min(aY,az,A[4]);A[5]=A[0];aF.moveTo(z.x+A[0],z.y);aF.lineTo(aO-A[1],z.y);aF.quadraticCurveTo(aO,z.y,aO,z.y+A[1]);aF.lineTo(aO,aC-A[2]);aF.quadraticCurveTo(aO,aC,aO-A[2],aC);aF.lineTo(aJ+A[3],aC);aF.quadraticCurveTo(aJ,aC,aJ,aC-A[3]);aF.lineTo(aJ,aR+A[4]);aF.quadraticCurveTo(aJ,aR,aJ+A[4],aR);aF.lineTo(aw.x-A[5],aw.y);aF.quadraticCurveTo(aw.x,aw.y,aZ.x,aZ.y);aF.quadraticCurveTo(z.x,z.y,z.x+A[0],z.y)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(C=="speechRight"){aF.moveTo(aO-17,aC);aF.lineTo(aO-96,aC-13);aF.lineTo(aJ,aC-13);aF.lineTo(aJ,aR);aF.lineTo(aO,aR);aF.lineTo(aO,aC-13);aF.lineTo(aO-38,aC-13);aF.lineTo(aO-17,aC)}if(C=="speechLeft"){aF.moveTo(aJ+17,aC);aF.lineTo(aJ+96,aC-13);aF.lineTo(aO,aC-13);aF.lineTo(aO,aR);aF.lineTo(aJ,aR);aF.lineTo(aJ,aC-13);aF.lineTo(aJ+38,aC-13);aF.lineTo(aJ+17,aC)}else{if(C=="bubr"){right=aW-1;bottom=aS-2;tailSize=7;if(av.b){ay=ay+av.b[0]/2;aE=aE+av.b[0]/2;right=right-av.b[0]/2;bottom=bottom-av.b[0]/2}aF.moveTo(right-tailSize,bottom-7);aF.lineTo(right-tailSize,ay+A[1]);aF.quadraticCurveTo(right-tailSize,ay,right-A[1]-tailSize,ay);aF.lineTo(aE+A[0],ay);aF.quadraticCurveTo(aE,ay,aE,ay+A[0]);aF.lineTo(aE,bottom-A[3]);aF.quadraticCurveTo(aE,bottom,aE+A[3],bottom);aF.lineTo(right-19,bottom);aF.quadraticCurveTo(right-15,bottom-1,right-14,bottom-2);aF.quadraticCurveTo(right-7,bottom+1,right-1,bottom-2);aF.quadraticCurveTo(right-tailSize,bottom-3,right-tailSize,bottom-7)}else{if(C=="bubl"){right=aW-1;bottom=aS-2;tailSize=7;if(av.b){ay=ay+av.b[0]/2;aE=aE+av.b[0]/2;right=right-av.b[0]/2;bottom=bottom-av.b[0]/2}aF.moveTo(right,bottom-A[2]);aF.lineTo(right,ay+A[1]);aF.quadraticCurveTo(right,ay,right-A[1],ay);aF.lineTo(aE+A[0]+tailSize,ay);aF.quadraticCurveTo(aE+tailSize,ay,aE+tailSize,ay+A[0]);aF.lineTo(aE+tailSize,bottom-6);aF.quadraticCurveTo(aE+4,bottom-1,aE+1,bottom-2);aF.quadraticCurveTo(aE+2,bottom+2,aE+13,bottom-2);aF.quadraticCurveTo(aE+15,bottom,aE+19,bottom);aF.lineTo(right-A[2],bottom);aF.quadraticCurveTo(right,bottom,right,bottom-A[2])}else{if(C=="arrowL"||C=="arrowR"||C=="arrowU"||C=="arrowD"){var au=2;if(av.aCurve){au=av.aCurve}var u=12;if(av.aSize){u=av.aSize}if(C=="arrowL"){aF.moveTo(aJ+u,aR);aF.lineTo(aO-A[1],aR);aF.quadraticCurveTo(aO,aR,aO,aR+A[1]);aF.lineTo(aO,aC-A[2]);aF.quadraticCurveTo(aO,aC,aO-A[2],aC);aF.lineTo(aJ+u,aC);aF.bezierCurveTo(aJ+u-au,aC,aJ,((aC+aR)/2)+au,aJ,(aC+aR)/2);aF.bezierCurveTo(aJ,((aC+aR)/2)-au,u-au,aR,aJ+u,aR)}else{if(C=="arrowR"){aF.moveTo(aJ+A[0],aR);aF.lineTo(aO-u,aR);aF.bezierCurveTo(aO-u+au,aR,aO,((aR+aC)/2)-au,aO,(aR+aC)/2);aF.bezierCurveTo(aO,((aR+aC)/2)+au,aO-u+au,aC,aO-u,aC);aF.lineTo(aJ+A[3],aC);aF.quadraticCurveTo(aJ,aC,aJ,aC-A[3]);aF.lineTo(aJ,aR+A[0]);aF.quadraticCurveTo(aJ,aR,aJ+A[0],aR)}else{if(C=="arrowD"){var aI=(av.aW)?av.aW:aI;var aU=(aJ+aO)/2;var aM=aI/2;aF.moveTo(aJ+A[0],aR);aF.lineTo(aO-A[1],aR);aF.quadraticCurveTo(aO,aR,aO,aR+A[1]);aF.lineTo(aO,aC-u-A[2]);aF.quadraticCurveTo(aO,aC-u,aO-A[2],aC-u);aF.lineTo(aU+aM,aC-u);aF.lineTo(aU,aC);aF.lineTo(aU-aM,aC-u);aF.lineTo(aJ+A[3],aC-u);aF.quadraticCurveTo(aJ,aC-u,aJ,aC-u-A[3]);aF.lineTo(aJ,aR+A[0]);aF.quadraticCurveTo(aJ,aR,aJ+A[0],aR)}else{if(C=="arrowU"){var aI=(av.aW)?av.aW:20;var aU=(aJ+aO)/2;var aM=aI/2;aF.moveTo(aJ+A[0],aR+u);aF.lineTo(aU-aM,aR+u);aF.lineTo(aU,aR);aF.lineTo(aU+aM,aR+u);aF.lineTo(aO-A[1],aR+u);aF.quadraticCurveTo(aO,aR+u,aO,aR+u+A[1]);aF.lineTo(aO,aC-A[2]);aF.quadraticCurveTo(aO,aC,aO-A[2],aC);aF.lineTo(aJ+A[2],aC);aF.quadraticCurveTo(aJ,aC,aJ,aC-A[3]);aF.lineTo(aJ,aR+u+A[0]);aF.quadraticCurveTo(aJ,aR+u,aJ+A[3],aR+u)}}}}}else{if(C=="c"){var aT=aW/2,aX=aS/2,aB=Math.min(aT,aX),a0=Math.min(aG|0,aB),aP=aB-a0/2;if(aP<0){aP=0}I=a0;aF.arc(aT,aX,aP,0,Math.PI*2,true)}else{if(C==="ell"){var aT=aW/2,aX=aS/2,aB=Math.min(aT,aX),a0=Math.min(aG|0,aB),aL=(aW-a0)/2,aN=(aS-a0)/2;if(aL<0){aL=0}if(aL<0){aL=0}I=a0;if(aL>0&&aN>0){aF.ellipse(aT,aX,aL,aN,0,0,2*Math.PI)}}}}}}}aF.closePath()},_gradient:function(w,u,A){var C=["#ffffff","#000000"];var z=[0,1];if(A.bgc&&A.bgd){C=A.bgc;z=A.bgd}for(var B=0;B<C.length&&B<z.length;B++){try{w.addColorStop(z[B],C[B])}catch(v){}}u.fillStyle=w;u.fill()},_glaze:function(A,D){var u=5,z=2,C=10,O=D.absTLWH[2]-27,v=10,P=0,w=7;if(D.s=="bubl"){C+=w}f.path(A,"sq",u,z,C,O,v,P,D);var B=A.createLinearGradient(0,z+v,0,z);B.addColorStop(0,"rgba(231, 231, 231, 0.2)");B.addColorStop(0.59,"rgba(240, 240, 240, 0.25)");B.addColorStop(1,"rgba(249, 249, 249, 0.3)");A.fillStyle=B;A.fill();A.restore()},_shadow:function(u,v){u.shadowColor=v.sh[0];u.shadowOffsetX=v.sh[1];u.shadowOffsetY=v.sh[2];u.shadowBlur=v.sh[3]},_effect:function(A,ac){var ad=ac.fx;for(var W=0;W<ad.length;W++){var D=ad[W];if(D[0]=="dots"){var u=D[1];var C=D[2];var v=D[3];A.fillStyle=D[4];var aa=ac.absTLWH[2];var ab=ac.absTLWH[3];var z=u+C;var V=u+v;var w=parseInt(aa/z)+1;var B=parseInt(ab/V)+1;var X=0;for(var Y=0;Y<B;Y++){X=(X)?0:u;for(var Z=0;Z<w;Z++){A.beginPath();A.arc((Z*z)+X,(Y*V),u/2,0,2*Math.PI);A.closePath();A.fill()}}}}},_setImage:function(w,u,A){try{if(A.useCanvas){var D={width:A.absTLWH[2],height:A.absTLWH[3]};var C=w.find("canvas").attr(D);var z=C[0].getContext("2d");z.drawImage(u.canvas,0,0)}else{var B=w.find("img");p._convertCanvasToImg($(u.canvas),B,A)}}catch(v){}}};if(!b[0].classList.contains("ui-resizable-resizing")){f.blur()}if(typeof h.upload==="string"&&h.upload=="y"){if(window.g_preview){p._drawPreviewImageUpload(b,h)}else{p._drawImageUpload(b,h)}return}var j=0,d=0;var k=h.absTLWH[2];var c=h.absTLWH[3];var E=0;var i=0;var a=h.b||h.bms;var I=null;if(a){E=a[0];i=a.length>3?a.slice(2):a[2]}var J=h.s?h.s:"sq";H.save();f.path(H,J,i,j,d,k,c,E,h);if(h.sh){f._shadow(H,h)}if(h.bg){f.background(H,h)}H.restore();if(a&&E>0){f.border(H,h,k,c)}if(h.glaze&&h.glaze=="y"){f._glaze(H,h)}if(h.fx&&h.fx.length>0){f._effect(H,h)}if(h.i){for(var K=0;K<h.i.length;K++){var G=h.i[K];var L=new Image();function F(){var u=G[5];if(typeof(u)=="string"&&u.search("%")!=-1){u=(k*parseInt(u)/100)-G[3]/2}else{if(u<0){u=parseInt(k)+G[5]-G[3]}}var v=G[6];if(typeof(v)=="string"&&v.search("%")!=-1){v=(c*parseInt(v)/100)-G[4]/2}else{if(v<0){v=parseInt(c)+G[6]-G[4]}}L.onload=function(){try{H.drawImage(L,G[1],G[2],G[3],G[4],u+d,v+j,G[3],G[4]);f._setImage(b,H,h);if(H.canvas.hasOwnProperty("onchange")){H.canvas.onchange()}}catch(w){}};L.src=G[0]}$(L).ready(F)}}else{f._setImage(b,H,h)}};p.scale=function(c,b){var h=10;var d;if(b.ls){d=b.ls}else{if(typeof b.wh==="undefined"){d=66/80}else{if(b.wh[0]=="a"||b.wh[1]=="a"){d=66/320}else{if(b.wh[0]=="100%"||b.wh[1]=="100%"){d=66/320}else{if(typeof(b.wh[0])==="string"||typeof(b.wh[1])==="string"){var f=parseInt(b.wh[0])/640;var a=parseInt(b.wh[1])/640;d=Math.max(f,a)}else{d=Math.min(1,66/b.wh[0],66/b.wh[1])}}}}}if(d<1){$(c).css({"-webkit-transform":"scale("+d+")","-moz-transform":"scale("+d+")"})}};t.exports=p;function l(a,c){var b="data/"+a+(c?"/"+c:"");return b}fluid.main.on("widgetsAdded",function(b,j,d,f){if(fluid.zoom.getCtx()!=="project"&&$(".screen.active").attr("id")===j){var c=$("#"+j+" .widgetHolder");var a=fluid.main.project.get(j);var h=[0,0,a.width,a.height];for(var i=0;i<d.length;i++){p._draw(d[i],c,h)}if(f&&f.length){$("#"+f.join(", #")).remove()}}});fluid.main.on("widget:draw",function(b,f,c,d){var i=$("#"+d);var a=i.find(".widgetHolder");var h=[0,0,a.outerWidth(),a.outerHeight()];p._draw(f,a,h,false,false,c)});fluid.main.on("resizewdgdrag",function(b,a){p.adjustNEWSHandlesVisibilityDebounced(a.$dragEl.find(".ui-resizable-handle"))})},{"./browserdetect":24,"./checkHost":25,"./class-storage":46,"./class-widgetNewSegments":51,"./utils-editor":98}],51:[function(n,m,i){var l=n("./class-widget");var k=n("./class-storage");var j=n("./utils");l._isMultiSegment=function(a){if(a==""){return false}function b(c){var d=k.get(c),f=d&&d.seg;return f&&f.length>0}return b(a)||b($("#"+a).attr("data-segment-root"))};l.redrawMultisegment=function(c){if(!c){return}var r=fluid.main.project.widgets.get(c);if(!r||!r.collection){return}var h=r.getPage()?r.getPage().id:null;if(!h){return}var s=$("#"+h).find(".widgetHolder");if(!h){return}if(s.length){var a=[0,0,s.outerWidth(),s.outerHeight()],d=r.getLockTos(),b;for(var f=0;f<d.length;f++){b=$("#"+d[f].id);l._draw(d[f].id,s,a,false,false);b.remove()}}fluid.selection.select(fluid.selection.getSelectedIds())};l.redrawMultisegmentDebounced=_.debounce(l.redrawMultisegment,200);l._getSegmentPosition=function(d){var b=$(d).attr("id");var c=k.get($(d).attr("data-segment-root"));var a=0;for(var f=c.segments.length;a<f;a++){if(c.segments[a].id==b){break}}return a};fluid.main.on("triggerSegmentSetup",function(d,a,c){if(!fluid.main.project){return}var f,b=fluid.main.project.widgets.get(a),c;if($("#"+a).length){c=b.toJSON();f=l._setupSegments(c,null,null,null,a);l._updateSegments(c,f,{redraw:"all"})}});fluid.main.on("segmentremoved segmentadded segmentResized",function(b,a){if(a&&a.srcEvent&&a.srcEvent==="dragResize"){l.redrawMultisegment(a.rootId)}else{l.redrawMultisegment(a.rootId)}});fluid.main.on("widgetAdded",function(b,a,c){if(c){l.redrawMultisegment(c)}});m.exports=l},{"./class-storage":46,"./class-widget":49,"./utils":99}],52:[function(F,G,B){var J=F("./collections/bin");var w=F("./collections/customWidgets");var u=F("./collections/libs");var z=F("./collections/libWidgets");var v=F("./collections/links");var s=F("./collections/pages");var H=F("./collections/projects");var C=F("./collections/uploads");var D=F("./collections/widgetGroups");var A=F("./collections/widgets");var E=F("./collections/comments");var I=F("./collections/commentThreads");G.exports.init=function t(){if(!fluid.collections){fluid.collections={}}fluid.collections.Bin=J;fluid.collections.CustomWidgets=w;fluid.collections.Libs=u;fluid.collections.LibWidgets=z;fluid.collections.Links=v;fluid.collections.Pages=s;fluid.collections.Projects=H;fluid.collections.Uploads=C;fluid.collections.WidgetGroups=D;fluid.collections.Widgets=A;fluid.collections.Comments=E;fluid.collections.CommentThreads=I}},{"./collections/bin":53,"./collections/commentThreads":54,"./collections/comments":55,"./collections/customWidgets":56,"./collections/libWidgets":57,"./collections/libs":58,"./collections/links":59,"./collections/pages":60,"./collections/projects":61,"./collections/uploads":62,"./collections/widgetGroups":63,"./collections/widgets":64}],53:[function(n,m,i){var l=n("../fluid.collection");var k=n("../../class-storage");var j=l.extend({initialize:function(){},store:function(a){a=a||this.id;if(a){k.set(a,this);this.trigger("change")}return this},fetch:function(a){a=a||this.id;var c=k.get(a);if(c){for(var b in c){this[b]=c[b]}}return this}});m.exports=j},{"../../class-storage":46,"../fluid.collection":65}],54:[function(n,m,i){var l=n("../fluid.collection");var j=n("../models/commentThread");var k=l.extend({model:j,initialize:function(a,b){if(!b){b={}}if(b.projectModel){this.projectModel=b.projectModel}},deserialize:function(a){var b,c,f,h,d;for(h in a){if(a.hasOwnProperty(h)){c=_.omit(a[h],["comments"]);b=a[h].comments;this.add(c);f=this.get(c.id);for(d in b){if(b.hasOwnProperty(d)){f.comments.add(b[d])}}}}},toJSON:function(a){var b={};this.forEach(function(c){if(c.comments.length){b[c.attributes[c.idAttribute]]=c.toJSON(a)}});return b},getByPageId:function(b){var a=new fluid.collections.CommentThreads();this.each(function(c){if(c.get("pageId")===b){a.add(c)}});return a}});m.exports=k},{"../fluid.collection":65,"../models/commentThread":76}],55:[function(i,n,j){var m=i("../fluid.collection");var l=i("../models/comment");var k=m.extend({model:l,initialize:function(a,b){this.threadModel=b.threadModel;this.on("all",function(){this.threadModel.fire.apply(this.threadModel,arguments)})}});n.exports=k},{"../fluid.collection":65,"../models/comment":75}],56:[function(i,n,j){var m=i("../fluid.collection");var l=i("../models/customWidget");var k=m.extend({model:l,initialize:function(a,b){this.accountModel=b.accountModel}});n.exports=k},{"../fluid.collection":65,"../models/customWidget":77}],57:[function(m,l,i){var k=m("../fluid.collection");var n=m("../models/libWidget");var j=k.extend({model:n,initialize:function(a,b){},parse:function(a,b){var c=[];_.each(a,function(d,f,h){d.id=f;c.push(d)});return c},save:function(a){fluid.main.fire("dbStorage.set","libWidgets",this.toJSON(),_.debounce(function(){if(a&&a.call){a()}}.bind(this),200))},toJSON:function(a){var b=[];this.each(function(c){b.push({id:c.id,data:c.toJSON()})});return b}});l.exports=j},{"../fluid.collection":65,"../models/libWidget":79}],58:[function(i,m,j){var k=i("../fluid.collection");var l=i("../models/lib");var n=k.extend({model:l,initialize:function(a,b){},save:function(a){fluid.main.fire("dbStorage.set","libs",this.toJSON(),_.debounce(function(){if(a&&a.call){a()}}.bind(this),200))},toJSON:function(a){var b=[];var c;this.each(function(d,f){c=d.toJSON();b.push({id:c.id,data:c})});return b}});m.exports=n},{"../fluid.collection":65,"../models/lib":78}],59:[function(n,m,j){var l=n("../fluid.collection");var i=n("../models/link");var k=l.extend({model:i,linkProps:["linkCanvId","linkDest","linkOrigin","linkType","transType","triggerType"],initialize:function(a,b){},toJSON:function(a){var c={};for(var d=0,b=this.linkProps.length;d<b;d++){c[this.linkProps[d]]=[]}this.forEach(function(h){for(var f=0,r=this.linkProps.length;f<r;f++){c[this.linkProps[f]].push(h.attributes[this.linkProps[f]])}},this);return c},deserialize:function(v){var d=(typeof v==="string")?JSON.parse(v):v;var w=[],b,a,f,h,c,u;for(f=0,u=d.linkCanvId.length;f<u;f++){b={};for(h=0,c=this.linkProps.length;h<c;h++){b[this.linkProps[h]]=d[this.linkProps[h]][f]}w.push(b)}this.set(w,{merge:true})}});m.exports=k},{"../fluid.collection":65,"../models/link":80}],60:[function(i,m,j){var l=i("../fluid.collection");var n=i("../models/page");var k=l.extend({model:n,initialize:function(a,b){this.projectModel=b.projectModel},getIds:function(){return this.map(function(a){return a.id})}});m.exports=k},{"../fluid.collection":65,"../models/page":81}],61:[function(i,n,j){var l=i("../fluid.collection");var k=i("../models/project");var m=l.extend({model:k,initialize:function(a,b){},getIds:function(){return this.map(function(a){return a.id})},getLatestActiveProject:function(){var a=this.filter(function(b){if(b.get("active")!==false&&!b.get("removed")){return b}else{return false}});if(a.length){return a[a.length-1].get("id")}else{return false}},activeProjectCount:function(){var a=this.filter(function(c,d,b){if(c.get("active")===false||c.get("removed")===true){return false}return true});return a.length},archivedProjectCount:function(){var a=this.filter(function(c,d,b){if(c.get("active")===false){return true}return false});return a.length},deletedProjectCount:function(){var a=this.filter(function(c,d,b){if(c.get("removed")===true){return true}return false});return a.length}});n.exports=m},{"../fluid.collection":65,"../models/project":82}],62:[function(n,m,i){var l=n("../fluid.collection");var j=n("../models/upload");var k=l.extend({model:j,comparator:function(a,b){return b.attributes.uploadedTimestamp-a.attributes.uploadedTimestamp},_type:"upload",initialize:function(a,b){this.on("all",this.onChange,this)},afterInit:function(a,b){if(b&&b.saveAfterInit){this.save()}},onChange:function(){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,300)}this.debouncedSave.apply(this)},save:function(){fluid.main.fire("dbStorage.set","uploadHeaders",{id:fluid.main.account.id,data:this.toJSON()})}});m.exports=k},{"../fluid.collection":65,"../models/upload":83}],63:[function(n,m,j){var l=n("../fluid.collection");var i=n("../models/widgetGroup");var k=l.extend({model:i,initialize:function(a,b){},getCommonGroup:function(b){var a=this.find(function(c){if(_.intersection(c.get("widgets"),b).length===b.length){return true}else{return false}});return a?a.id:false}});m.exports=k},{"../fluid.collection":65,"../models/widgetGroup":85}],64:[function(n,m,j){var l=n("../fluid.collection");var k=n("../models/widget");var i=l.extend({model:k,initialize:function(a,b){if(b&&b.projectModel){this.projectModel=b.projectModel}},getIds:function(){return this.map(function(a){return a.id})},getByIds:function(b){var a=new fluid.collections.Widgets();if(typeof b==="string"){b=[b]}this.each(function(c){if(b.indexOf(c.id)!==-1){a.add(c)}});return a},getElements:function(){return $("#"+this.getIds().join(", #"))},getRootsCollection:function(){var a=new fluid.collections.Widgets();this.each(function(c,d,b){a.add(c.getRoot())});return a},getLockTos:function(){var a=this.getRoots();var c=new fluid.collections.Widgets();var b;a.each(function(d){b=fluid.main.project.widgets.where({lockTo:d.get("lockTo")});c.add(b)});return c},getBox:function(a){var b=[Infinity,Infinity,-Infinity,-Infinity],c;if(!a){a={}}this.each(function(d){c=d.getBox();b[0]=Math.min(b[0],c[0]);b[1]=Math.min(b[1],c[1]);b[2]=Math.max(b[2],c[0]+c[2]);b[3]=Math.max(b[3],c[1]+c[3])});if(!a.returnMode||a.returnMode==="box"){return[b[0],b[1],b[2]-b[0],b[3]-b[1]]}else{if(a.returnMode==="tlwh"){return[b[1],b[0],b[2]-b[0],b[3]-b[1]]}else{if(a.returnMode==="ltrb"){return b}else{if(a.returnMode==="ltrbObj"){return{left:b[0],top:b[1],right:b[2],bottom:b[3]}}else{if(a.returnMode==="tlwhObj"){return{left:b[0],top:b[1],width:b[2]-b[0],height:b[3]-b[1]}}}}}}},getDependentsIds:function(a){var b=[];this.each(function(c){if(c.get("lockTo")===c.id){b=b.concat(_.map(c.getLockTos(),function(d){return d.id}))}else{b.push(c.id);if(c.getOfs().length){b=b.concat(c.getOfs().getDependentsIds())}}});return _.uniq(b)},withoutBackgrounds:function(){var a=new fluid.collections.Widgets();this.forEach(function(b){if(b.get("st")!=="b"){a.add(b)}});return a},withoutLocked:function(){var a=new fluid.collections.Widgets();this.forEach(function(b){if(!b.get("locked")){a.add(b)}});return a},getShapeWidgets:function(b){var c=new fluid.collections.Widgets(),a,d;this.models.forEach(function(f){if(!f.get("tc")&&f.get("upload")!=="y"){c.add(f);if(b&&(f.get("seg")||f.get("segment"))){a=f.getOfs();if(a.length){d=a.getShapeWidgets();if(d.length){c.add(d.models)}}}}});return c},getTextWidgets:function(){var a=new fluid.collections.Widgets();this.each(function(b){if(b.get("tc")!=undefined&&b.get("ts")!=undefined){a.add(b)}else{a.add(b.getSubTextElements())}});return a},getUploadWidgets:function(){var a=new fluid.collections.Widgets();this.each(function(b){if(b.get("upload")==="y"){a.add(b)}});return a},getRootsOnly:function(a){if(!a){a=this.getIds()}return a.filter(function(b){var c=fluid.main.project.widgets.get(b);return c&&c.get("lockTo")===b})},getRoots:function(f,s){if(!s){s={}}if(!f){return this.getRootsCollection()}if(f.jquery){f=$.map(f,function(o){return o.id});s.returnEls=true}var h=[],a,c,b,r,d;for(var r=0;r<f.length;r++){a=fluid.main.project.widgets.get(f[r]);c=a.getRoot();if(c){h.push(a.getRoot().id)}else{b=a.collection.where({lockTo:a.get("lockTo")});b=_.reject(b,function(o){return !o.getParent()});for(r=0;d=b.length,r<d;r++){h.push(b[r].id)}}}if(s&&s.returnEls){h=$("#"+h.join(", #"))}else{h=_.uniq(h)}return h},containsText:function(a){if(!a){return false}if(a.jQuery){a=$.map(a,function(){return this.id})}var c;for(var b=0;b<a.length;b++){c=this.get(a[b],{returnModel:true}).containsText();if(c){return true}}return false},getBox:function(a){var b=[Infinity,Infinity,-Infinity,-Infinity],c;if(!a){a={}}this.each(function(d){c=d.getBox();b[0]=Math.min(b[0],c[0]);b[1]=Math.min(b[1],c[1]);b[2]=Math.max(b[2],c[0]+c[2]);b[3]=Math.max(b[3],c[1]+c[3])});if(!a.returnMode||a.returnMode==="box"){return[b[0],b[1],b[2]-b[0],b[3]-b[1]]}else{if(a.returnMode==="tlwh"){return[b[1],b[0],b[2]-b[0],b[3]-b[1]]}else{if(a.returnMode==="ltrb"){return b}else{if(a.returnMode==="ltrbObj"){return{left:b[0],top:b[1],right:b[2],bottom:b[3]}}else{if(a.returnMode==="tlwhObj"){return{left:b[0],top:b[1],width:b[2]-b[0],height:b[3]-b[1]}}}}}}}});m.exports=i},{"../fluid.collection":65,"../models/widget":84}],65:[function(w,B,t){var o=w("./lib/underscore");var s=[];var q=s.push;var p=s.slice;var v=s.splice;var z=w("./fluid.model");var u=function(a,b){fluid.event.mixinTo(this);b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}if(b.noModelBinding){this.noModelBinding=true}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,o.extend({silent:true},b))}this.afterInit.apply(this,arguments)};u.prototype.setOptions={add:true,remove:true,merge:false};u.prototype.addOptions={add:true,remove:false};u.prototype.afterInit=function(){};u.prototype.add=function(a,b){return this.set(a,o.extend({merge:false},b,this.addOptions))};u.prototype.set=function(h,M){M=o.defaults({},M,this.setOptions);if(M.parse){h=this.parse(h,M)}if(!o.isArray(h)){h=h?[h]:[]}var n,L,K,c,i,j;var l=M.at;var N=this.comparator&&(l==null)&&M.sort!==false;var m=o.isString(this.comparator)?this.comparator:null;var d=[],a=[],f={};var k=M.add,I=M.merge,b=M.remove;var J=!N&&k&&b?[]:false;for(n=0,L=h.length;n<L;n++){if(!(K=this._prepareModel(c=h[n],M))){continue}i=this.get(K);if(i){if(b){f[i.cid]=true}if(I){c=c===K?K.attributes:M._attrs;i.set(c,M);if(N&&!j&&i.hasChanged(m)){j=true}}}else{if(k){d.push(K);if(!this.noModelBinding){K.on("all",this._onModelEvent,this)}this._byId[K.cid]=K;if(K.id!=null){this._byId[K.id]=K}}}if(J){J.push(i||K)}delete M._attrs}if(b){for(n=0,L=this.length;n<L;++n){if(!f[(K=this.models[n]).cid]){a.push(K)}}if(a.length){this.remove(a,M)}}if(d.length||(J&&J.length)){if(N){j=true}this.length+=d.length;if(l!=null){v.apply(this.models,[l,0].concat(d))}else{if(J){this.models.length=0}q.apply(this.models,J||d)}}if(j){this.sort({silent:true})}if(M.silent){return this}for(n=0,L=d.length;n<L;n++){(K=d[n]).trigger("add",K,this,M)}if(j||(J&&J.length)){this.trigger("sort",this,M)}if(d.length||a.length){this.trigger("update",this,M)}return this};u.prototype.get=function(a){if(a==null){return void 0}return this._byId[a.id]||this._byId[a.cid]||this._byId[a]};u.prototype.reset=function(a,c){c||(c={});for(var b=0,d=this.models.length;b<d;b++){this._removeReference(this.models[b])}c.previousModels=this.models;this._reset();this.add(a,o.extend({silent:true},c));if(!c.silent){this.trigger("reset",this,c)}return this};u.prototype._reset=function(){this.length=0;this.models=[];this._byId={}};u.prototype.sort=function(b){var c=this.comparator;if(!c){throw new Error("Cannot sort a set without a comparator")}b||(b={});var a=c.length;if(o.isFunction(c)){c=o.bind(c,this)}if(a===1||o.isString(c)){this.models=this.sortBy(c)}else{this.models.sort(c)}if(!b.silent){this.trigger("sort",this,b)}return this};u.prototype._prepareModel=function(a,b){if(a instanceof z){if(!a.collection){a.collection=this}return a}b||(b={});b.collection=this;var c=new this.model(a,b);if(!c.validationError){return c}this.trigger("invalid",this,a,b);return false};u.prototype._onModelEvent=function(b,c,a,d){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(c,d)}if(c&&b==="change:"+c.idAttribute){delete this._byId[c.previous(c.idAttribute)];if(c.id!=null){this._byId[c.id]=c}}this.trigger.apply(this,arguments)};u.prototype._removeReference=function(a){if(this===a.collection){delete a.collection}if(!this.noModelBinding){a.off("all",this._onModelEvent,this)}};u.prototype.toJSON=function(a){var b={};this.forEach(function(c){b[c.attributes[c.idAttribute]]=c.toJSON(a)});return b};u.prototype.allToJSON=function(a){var b={};this.forEach(function(c){b[c.attributes[c.idAttribute]]=c.allToJSON(a)});return b};var A=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sortBy"];o.each(A,function(a){u.prototype[a]=function(){var b=p.call(arguments);b.unshift(this.models);return o[a].apply(o,b)}});u.prototype.remove=function(a,c){a=o.isArray(a)?a.slice():[a];c||(c={});var b,h,d,f;for(b=0,h=a.length;b<h;b++){f=this.get(a[b]);if(!f){continue}delete this._byId[f.id];delete this._byId[f.cid];d=this.indexOf(f);this.models.splice(d,1);this.length--;if(!c.silent){c.index=d;f.trigger("remove",f,this,c)}this._removeReference(f);this.trigger("remove",f,this,c)}return this};u.prototype.where=function(b,a){if(o.isEmpty(b)){return a?void 0:[]}return this[a?"find":"filter"](function(d){for(var c in b){if(b[c]!==d.get(c)){return false}}return true})};u.prototype.at=function(a){if(a<0){a+=this.length}return this.models[a]};u.prototype.clone=function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})};var r=function(f,c){var d=this;var a;if(f&&o.has(f,"constructor")){a=f.constructor}else{a=function(){return d.apply(this,arguments)}}o.extend(a,d,c);var b=function(){this.constructor=a};b.prototype=d.prototype;a.prototype=new b;if(f){o.extend(a.prototype,f)}a.__super__=d.prototype;return a};u.extend=r;B.exports=u},{"./fluid.model":69,"./lib/underscore":72}],66:[function(f,i,h){var j=f("./fluid.module");j.define("fluid.event",function(a){a.mixinTo=function(d){var c={};var n=typeof d=="object";function m(q,l){q=q.split(/,\s*|\s+/);for(var r=0,k=q.length;r<k;r++){l.call(d,q[r])}}d.bind=d.on=function(l,p,k){m(l,function(o){var r=c[o]||(c[o]=[]);if(b(r,p)==-1){r.push({h:p,c:k||this,evtName:o})}});return this};d.unbind=d.off=function(l,p,k){m(l,function(o){var s=c[o];if(s&&p){var t=b(s,p,k);if(t>-1){s.splice(t,1)}}else{c[o]=[]}});return this};d.trigger=d.fire=function(){var t;var u,v=arguments[0],w=c[v],l=c.all;if(w){u=Array.prototype.slice.call(arguments,1);if(n){u.unshift(this)}for(var z=0,k=w.length;z<k;z++){t=w[z];if(t&&t.h.apply(t.c,u)===false){return false}}if(n){u.shift()}}if(l){for(z=0,k=l.length;z<k;z++){t=l[z];if(t.h.apply(t.c,arguments)===false){return false}}}return true}};function b(n,c,d){for(var o=0,p=n.length;o<p;o++){if(n[o].h===c&&(!d||d===n[o].c)){return o}}return -1}})},{"./fluid.module":70}],67:[function(f,i,h){var j=f("./fluid.module");window.fluid=window.fluid||{};window.fluid.module=j;f("./fluid.util");f("./fluid.event");f("./fluid.main");f("./modules/api");f("./fluid.collection");f("./fluid.model")},{"./fluid.collection":65,"./fluid.event":66,"./fluid.main":68,"./fluid.model":69,"./fluid.module":70,"./fluid.util":71,"./modules/api":86}],68:[function(d,h,f){(function(a){var c=d("./fluid.module");var b=d("./fluid.event");c.define("fluid.main",function(j){fluid.event.mixinTo(j);j.listProjects=function(){if(!fluid.main.projects.length){console.info("no projects found...")}fluid.main.projects.each(function(p,q,t){var r=p.pages.getIds(),i=p.get("unloaded"),s=p.get("id")})};j.setMainProject=function(m){if(j.project&&j.lastPageActivatedHandler){j.off("pageactivated",j.lastPageActivatedHandler)}var i=fluid.main.project?fluid.main.project.id:-1;var n=m?m.id:-1;j.project=m;fluid.main.fire("mainProjectSet");if(i!==n&&n!==null){fluid.main.fire("projectIdChanged")}};j.getActiveProjects=function(){return fluid.main.projects.filter(function(i){if(i.get("active")!==false&&i.get("removed")!==true){return true}else{return false}})};j.getNotDeletedProjects=function(){return fluid.main.projects.filter(function(i){if(i.get("removed")){return false}else{return true}})};j.getStacktrace=function(){var i=new Error();return i.stack};j.isNode=function(){return(typeof a==="object"&&a+""==="[object process]")}});fluid.main.on("beforepreviewopen",function(){if($(".screen.active").length){fluid.main.previewStartPage=document.querySelector(".canvasObject.active").id}else{fluid.main.previewStartPage=null}});fluid.main.on("previewclosed",function(){fluid.main.previewStartPage=null});h.exports=fluid.main}).call(this,d("_process"))},{"./fluid.event":66,"./fluid.module":70,_process:5}],69:[function(r,p,l){var q=r("./fluid.module");var k=r("./lib/underscore");var n=function(c,a){var d;fluid.event.mixinTo(this);var b=c||{};a||(a={});this.cid=k.uniqueId("c");this.attributes={};if(a.collection){this.collection=a.collection}if(a.parse){b=this.parse(b,a)||{}}if(d=k.result(this,"defaults")){b=k.defaults({},b,d)}this.set(b,a);this.initialize.apply(this,arguments)};n.prototype.idAttribute="id";n.prototype.attrBlackList=[];n.prototype.parse=function(a,b){return a};n.prototype.toJSON=function(b){var c={};for(var a in this.attributes){if(this.attributes.hasOwnProperty(a)){c[a]=k.clone(this.attributes[a])}}if(b&&b.getAll){return c}return k.omit(c,this.attrBlackList)};n.prototype.allToJSON=function(a){return k.clone(this.attributes)};n.prototype._validate=function(a,b){return true};n.prototype.get=function(a){return this.attributes[a]},n.prototype.set=function(D,i,j){var a,C,B,E,b,A,f,c;if(D==null){return this}if(typeof D==="object"){C=D;j=i}else{(C={})[D]=i}j||(j={});if(!this._validate(C,j)){return false}B=j.unset;b=j.silent;E=[];A=this._changing;this._changing=true;if(!A){this._previousAttributes=k.clone(this.attributes);this.changed={}}c=this.attributes,f=this._previousAttributes;if(this.idAttribute in C){this.id=C[this.idAttribute]}for(a in C){i=C[a];if(!k.isEqual(c[a],i)){E.push(a)}if(!k.isEqual(f[a],i)){this.changed[a]=i}else{delete this.changed[a]}B?delete c[a]:c[a]=i}if(!b){if(E.length){this._pending=true}for(var d=0,h=E.length;d<h;d++){this.trigger("change:"+E[d],this,c[E[d]],j)}}if(A){return this}if(!b){while(this._pending){this._pending=false;this.trigger("change",this,j)}}this._pending=false;this._changing=false;return this};n.prototype.unset=function(b,a){return this.set(b,void 0,k.extend({},a,{unset:true}))};n.prototype.hasChanged=function(a){if(a==null){return !k.isEmpty(this.changed)}return k.has(this.changed,a)};n.prototype.changedAttributes=function(a){if(!a){return this.hasChanged()?k.clone(this.changed):false}var d,f=false;var b=this._changing?this._previousAttributes:this.attributes;for(var c in a){if(k.isEqual(b[c],(d=a[c]))){continue}(f||(f={}))[c]=d}return f};n.prototype.previous=function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]};n.prototype.previousAttributes=function(){return k.clone(this._previousAttributes)};var o=["keys","values","pairs","invert","pick","omit"];k.each(o,function(a){n.prototype[a]=function(){var b=Array.prototype.slice.call(arguments);b.unshift(this.attributes);return k[a].apply(k,b)}});var m=function(c,a){var b=this;var d;if(c&&k.has(c,"constructor")){d=c.constructor}else{d=function(){return b.apply(this,arguments)}}k.extend(d,b,a);var f=function(){this.constructor=d};f.prototype=b.prototype;d.prototype=new f;if(c){k.extend(d.prototype,c)}d.__super__=b.prototype;return d};n.extend=m;p.exports=n},{"./fluid.module":70,"./lib/underscore":72}],70:[function(f,i,h){var j={};j.define=function(d,o,a){var r;if(d){var c=d.split(".");r=window;for(var p=0,q=c.length;p<q;p++){var b=c[p];r=r[b]||(r[b]={})}}if(o){o.call(a,r)}return r};j.resolve=function(c){var a;if(c){var b=c.split(".");a=window;for(var d=0,l=b.length;d<l;d++){a=a[b[d]];if(!a){break}}}return a};i.exports=j},{}],71:[function(f,i,h){var j=f("./fluid.module");j.define("fluid.util",function(a){a.debounce=function(c,d){var b;return function(){var m=new Date().getTime();var n;if(!b||m-b>d){n=c.apply(this,arguments);b=m}return n||false}};a.md5=function(m){function E(F,k){return(F<<k)|(F>>>(32-k))}function C(k,H){var G,Z,ae,F,I;ae=(k&2147483648);F=(H&2147483648);G=(k&1073741824);Z=(H&1073741824);I=(k&1073741823)+(H&1073741823);if(G&Z){return(I^2147483648^ae^F)}if(G|Z){if(I&1073741824){return(I^3221225472^ae^F)}else{return(I^1073741824^ae^F)}}else{return(I^ae^F)}}function l(k,F,G){return(k&F)|((~k)&G)}function d(k,F,G){return(k&G)|(F&(~G))}function c(k,F,G){return(k^F^G)}function ab(k,F,G){return(F^(k|(~G)))}function o(F,k,Z,ae,I,G,H){F=C(F,C(C(l(k,Z,ae),I),H));return C(E(F,G),k)}function T(F,k,Z,ae,I,G,H){F=C(F,C(C(d(k,Z,ae),I),H));return C(E(F,G),k)}function w(F,k,Z,ae,I,G,H){F=C(F,C(C(c(k,Z,ae),I),H));return C(E(F,G),k)}function n(F,k,Z,ae,I,G,H){F=C(F,C(C(ab(k,Z,ae),I),H));return C(E(F,G),k)}function S(F){var af;var k=F.length;var I=k+8;var ae=(I-(I%64))/64;var H=(ae+1)*16;var ag=Array(H-1);var Z=0;var G=0;while(G<k){af=(G-(G%4))/4;Z=(G%4)*8;ag[af]=(ag[af]|(F.charCodeAt(G)<<Z));G++}af=(G-(G%4))/4;Z=(G%4)*8;ag[af]=ag[af]|(128<<Z);ag[H-2]=k<<3;ag[H-1]=k>>>29;return ag}function u(I){var H="",F="",G,k;for(k=0;k<=3;k++){G=(I>>>(k*8))&255;F="0"+G.toString(16);H=H+F.substr(F.length-2,2)}return H}function B(G){G=G.replace(/rn/g,"n");var k="";for(var F=0;F<G.length;F++){var H=G.charCodeAt(F);if(H<128){k+=String.fromCharCode(H)}else{if((H>127)&&(H<2048)){k+=String.fromCharCode((H>>6)|192);k+=String.fromCharCode((H&63)|128)}else{k+=String.fromCharCode((H>>12)|224);k+=String.fromCharCode(((H>>6)&63)|128);k+=String.fromCharCode((H&63)|128)}}}return k}var v=Array();var O,V,z,p,U,ad,L,J,D;var R=7,P=12,M=17,K=22;var t=5,s=9,r=14,q=20;var ac=4,aa=11,Y=16,X=23;var A=6,b=10,Q=15,N=21;m=B(m);v=S(m);ad=1732584193;L=4023233417;J=2562383102;D=271733878;for(O=0;O<v.length;O+=16){V=ad;z=L;p=J;U=D;ad=o(ad,L,J,D,v[O+0],R,3614090360);D=o(D,ad,L,J,v[O+1],P,3905402710);J=o(J,D,ad,L,v[O+2],M,606105819);L=o(L,J,D,ad,v[O+3],K,3250441966);ad=o(ad,L,J,D,v[O+4],R,4118548399);D=o(D,ad,L,J,v[O+5],P,1200080426);J=o(J,D,ad,L,v[O+6],M,2821735955);L=o(L,J,D,ad,v[O+7],K,4249261313);ad=o(ad,L,J,D,v[O+8],R,1770035416);D=o(D,ad,L,J,v[O+9],P,2336552879);J=o(J,D,ad,L,v[O+10],M,4294925233);L=o(L,J,D,ad,v[O+11],K,2304563134);ad=o(ad,L,J,D,v[O+12],R,1804603682);D=o(D,ad,L,J,v[O+13],P,4254626195);J=o(J,D,ad,L,v[O+14],M,2792965006);L=o(L,J,D,ad,v[O+15],K,1236535329);ad=T(ad,L,J,D,v[O+1],t,4129170786);D=T(D,ad,L,J,v[O+6],s,3225465664);J=T(J,D,ad,L,v[O+11],r,643717713);L=T(L,J,D,ad,v[O+0],q,3921069994);ad=T(ad,L,J,D,v[O+5],t,3593408605);D=T(D,ad,L,J,v[O+10],s,38016083);J=T(J,D,ad,L,v[O+15],r,3634488961);L=T(L,J,D,ad,v[O+4],q,3889429448);ad=T(ad,L,J,D,v[O+9],t,568446438);D=T(D,ad,L,J,v[O+14],s,3275163606);J=T(J,D,ad,L,v[O+3],r,4107603335);L=T(L,J,D,ad,v[O+8],q,1163531501);ad=T(ad,L,J,D,v[O+13],t,2850285829);D=T(D,ad,L,J,v[O+2],s,4243563512);J=T(J,D,ad,L,v[O+7],r,1735328473);L=T(L,J,D,ad,v[O+12],q,2368359562);ad=w(ad,L,J,D,v[O+5],ac,4294588738);D=w(D,ad,L,J,v[O+8],aa,2272392833);J=w(J,D,ad,L,v[O+11],Y,1839030562);L=w(L,J,D,ad,v[O+14],X,4259657740);ad=w(ad,L,J,D,v[O+1],ac,2763975236);D=w(D,ad,L,J,v[O+4],aa,1272893353);J=w(J,D,ad,L,v[O+7],Y,4139469664);L=w(L,J,D,ad,v[O+10],X,3200236656);ad=w(ad,L,J,D,v[O+13],ac,681279174);D=w(D,ad,L,J,v[O+0],aa,3936430074);J=w(J,D,ad,L,v[O+3],Y,3572445317);L=w(L,J,D,ad,v[O+6],X,76029189);ad=w(ad,L,J,D,v[O+9],ac,3654602809);D=w(D,ad,L,J,v[O+12],aa,3873151461);J=w(J,D,ad,L,v[O+15],Y,530742520);L=w(L,J,D,ad,v[O+2],X,3299628645);ad=n(ad,L,J,D,v[O+0],A,4096336452);D=n(D,ad,L,J,v[O+7],b,1126891415);J=n(J,D,ad,L,v[O+14],Q,2878612391);L=n(L,J,D,ad,v[O+5],N,4237533241);ad=n(ad,L,J,D,v[O+12],A,1700485571);D=n(D,ad,L,J,v[O+3],b,2399980690);J=n(J,D,ad,L,v[O+10],Q,4293915773);L=n(L,J,D,ad,v[O+1],N,2240044497);ad=n(ad,L,J,D,v[O+8],A,1873313359);D=n(D,ad,L,J,v[O+15],b,4264355552);J=n(J,D,ad,L,v[O+6],Q,2734768916);L=n(L,J,D,ad,v[O+13],N,1309151649);ad=n(ad,L,J,D,v[O+4],A,4149444226);D=n(D,ad,L,J,v[O+11],b,3174756917);J=n(J,D,ad,L,v[O+2],Q,718787259);L=n(L,J,D,ad,v[O+9],N,3951481745);ad=C(ad,V);L=C(L,z);J=C(J,p);D=C(D,U)}var W=u(ad)+u(L)+u(J)+u(D);return W.toLowerCase()}})},{"./fluid.module":70}],72:[function(d,h,f){(function(){var N=this,ak=N._,ah={},q=Array.prototype,al=Object.prototype,w=Function.prototype,l=q.push,R=q.slice,o=q.concat,F=al.toString,s=al.hasOwnProperty,ai=q.forEach,T=q.map,v=q.reduce,am=q.reduceRight,p=q.filter,u=q.every,M=q.some,c=q.indexOf,n=q.lastIndexOf,b=Array.isArray,i=Object.keys,A=w.bind,a=function(z){return z instanceof a?z:this instanceof a?(this._wrapped=z,void 0):new a(z)};"undefined"!=typeof f?("undefined"!=typeof h&&h.exports&&(f=h.exports=a),f._=a):N._=a,a.VERSION="1.4.4";var j=a.each=a.forEach=function(z,G,C){if(null!=z){if(ai&&z.forEach===ai){z.forEach(G,C)}else{if(z.length===+z.length){for(var J=0,H=z.length;H>J;J++){if(G.call(C,z[J],J,z)===ah){return}}}else{for(var K in z){if(a.has(z,K)&&G.call(C,z[K],K,z)===ah){return}}}}}};a.map=a.collect=function(z,H,G){var C=[];return null==z?C:T&&z.map===T?z.map(H,G):(j(z,function(J,L,K){C[C.length]=H.call(G,J,L,K)}),C)};var O="Reduce of empty array with no initial value";a.reduce=a.foldl=a.inject=function(z,H,G,C){var J=arguments.length>2;if(null==z&&(z=[]),v&&z.reduce===v){return C&&(H=a.bind(H,C)),J?z.reduce(H,G):z.reduce(H)}if(j(z,function(K,L,P){J?G=H.call(C,G,K,L,P):(G=K,J=!0)}),!J){throw new TypeError(O)}return G},a.reduceRight=a.foldr=function(z,H,G,C){var K=arguments.length>2;if(null==z&&(z=[]),am&&z.reduceRight===am){return C&&(H=a.bind(H,C)),K?z.reduceRight(H,G):z.reduceRight(H)}var J=z.length;if(J!==+J){var L=a.keys(z);J=L.length}if(j(z,function(U,Q,P){Q=L?L[--J]:--J,K?G=H.call(C,G,z[Q],Q,P):(G=z[Q],K=!0)}),!K){throw new TypeError(O)}return G},a.find=a.detect=function(z,H,G){var C;return r(z,function(J,L,K){return H.call(G,J,L,K)?(C=J,!0):void 0}),C},a.filter=a.select=function(z,H,G){var C=[];return null==z?C:p&&z.filter===p?z.filter(H,G):(j(z,function(J,L,K){H.call(G,J,L,K)&&(C[C.length]=J)}),C)},a.reject=function(z,G,C){return a.filter(z,function(H,J,K){return !G.call(C,H,J,K)},C)},a.every=a.all=function(z,G,C){G||(G=a.identity);var H=!0;return null==z?H:u&&z.every===u?z.every(G,C):(j(z,function(J,K,L){return(H=H&&G.call(C,J,K,L))?void 0:ah}),!!H)};var r=a.some=a.any=function(z,G,C){G||(G=a.identity);var H=!1;return null==z?H:M&&z.some===M?z.some(G,C):(j(z,function(J,K,L){return H||(H=G.call(C,J,K,L))?ah:void 0}),!!H)};a.contains=a.include=function(z,C){return null==z?!1:c&&z.indexOf===c?z.indexOf(C)!=-1:r(z,function(G){return G===C})},a.invoke=function(z,H){var G=R.call(arguments,2),C=a.isFunction(H);return a.map(z,function(J){return(C?H:J[H]).apply(J,G)})},a.pluck=function(z,C){return a.map(z,function(G){return G[C]})},a.where=function(z,G,C){return a.isEmpty(G)?C?null:[]:a[C?"find":"filter"](z,function(H){for(var J in G){if(G[J]!==H[J]){return !1}}return !0})},a.findWhere=function(z,C){return a.where(z,C,!0)},a.max=function(z,H,G){if(!H&&a.isArray(z)&&z[0]===+z[0]&&65535>z.length){return Math.max.apply(Math,z)}if(!H&&a.isEmpty(z)){return -1/0}var C={computed:-1/0,value:-1/0};return j(z,function(J,L,K){var P=H?H.call(G,J,L,K):J;P>=C.computed&&(C={value:J,computed:P})}),C.value},a.min=function(z,H,G){if(!H&&a.isArray(z)&&z[0]===+z[0]&&65535>z.length){return Math.min.apply(Math,z)}if(!H&&a.isEmpty(z)){return 1/0}var C={computed:1/0,value:1/0};return j(z,function(J,L,K){var P=H?H.call(G,J,L,K):J;C.computed>P&&(C={value:J,computed:P})}),C.value},a.shuffle=function(z){var H,G=0,C=[];return j(z,function(J){H=a.random(G++),C[G-1]=C[H],C[H]=J}),C};var D=function(z){return a.isFunction(z)?z:function(C){return C[z]}};a.sortBy=function(z,H,G){var C=D(H);return a.pluck(a.map(z,function(J,K,L){return{value:J,index:K,criteria:C.call(G,J,K,L)}}).sort(function(J,P){var L=J.criteria,K=P.criteria;if(L!==K){if(L>K||L===void 0){return 1}if(K>L||K===void 0){return -1}}return J.index<P.index?-1:1}),"value")};var t=function(z,H,G,C){var K={},J=D(H||a.identity);return j(z,function(L,P){var Q=J.call(G,L,P,z);C(K,Q,L)}),K};a.groupBy=function(z,G,C){return t(z,G,C,function(H,K,J){(a.has(H,K)?H[K]:H[K]=[]).push(J)})},a.countBy=function(z,G,C){return t(z,G,C,function(H,J){a.has(H,J)||(H[J]=0),H[J]++})},a.sortedIndex=function(L,H,G,C){G=null==G?a.identity:D(G);for(var K=G.call(C,H),J=0,P=L.length;P>J;){var z=J+P>>>1;K>G.call(C,L[z])?J=z+1:P=z}return J},a.toArray=function(z){return z?a.isArray(z)?R.call(z):z.length===+z.length?a.map(z,a.identity):a.values(z):[]},a.size=function(z){return null==z?0:z.length===+z.length?z.length:a.keys(z).length},a.first=a.head=a.take=function(z,G,C){return null==z?void 0:null==G||C?z[0]:R.call(z,0,G)},a.initial=function(z,G,C){return R.call(z,0,z.length-(null==G||C?1:G))},a.last=function(z,G,C){return null==z?void 0:null==G||C?z[z.length-1]:R.call(z,Math.max(z.length-G,0))},a.rest=a.tail=a.drop=function(z,G,C){return R.call(z,null==G||C?1:G)},a.compact=function(z){return a.filter(z,a.identity)};var S=function(z,G,C){return j(z,function(H){a.isArray(H)?G?l.apply(C,H):S(H,G,C):C.push(H)}),C};a.flatten=function(z,C){return S(z,C,[])},a.without=function(z){return a.difference(z,R.call(arguments,1))},a.uniq=a.unique=function(z,H,G,C){a.isFunction(H)&&(C=G,G=H,H=!1);var K=G?a.map(z,G,C):z,J=[],L=[];return j(K,function(P,Q){(H?Q&&L[L.length-1]===P:a.contains(L,P))||(L.push(P),J.push(z[Q]))}),J},a.union=function(){return a.uniq(o.apply(q,arguments))},a.intersection=function(z){var C=R.call(arguments,1);return a.filter(a.uniq(z),function(G){return a.every(C,function(H){return a.indexOf(H,G)>=0})})},a.difference=function(z){var C=o.apply(q,R.call(arguments,1));return a.filter(z,function(G){return !a.contains(C,G)})},a.zip=function(){for(var z=R.call(arguments),H=a.max(a.pluck(z,"length")),G=Array(H),C=0;H>C;C++){G[C]=a.pluck(z,""+C)}return G},a.object=function(z,H){if(null==z){return{}}for(var G={},C=0,J=z.length;J>C;C++){H?G[z[C]]=H[C]:G[z[C][0]]=z[C][1]}return G},a.indexOf=function(z,H,G){if(null==z){return -1}var C=0,J=z.length;if(G){if("number"!=typeof G){return C=a.sortedIndex(z,H),z[C]===H?C:-1}C=0>G?Math.max(0,J+G):G}if(c&&z.indexOf===c){return z.indexOf(H,G)}for(;J>C;C++){if(z[C]===H){return C}}return -1},a.lastIndexOf=function(z,H,G){if(null==z){return -1}var C=null!=G;if(n&&z.lastIndexOf===n){return C?z.lastIndexOf(H,G):z.lastIndexOf(H)}for(var J=C?G:z.length;J--;){if(z[J]===H){return J}}return -1},a.range=function(z,H,G){1>=arguments.length&&(H=z||0,z=0),G=arguments[2]||1;for(var C=Math.max(Math.ceil((H-z)/G),0),K=0,J=Array(C);C>K;){J[K++]=z,z+=G}return J},a.bind=function(z,G){if(z.bind===A&&A){return A.apply(z,R.call(arguments,1))}var C=R.call(arguments,2);return function(){return z.apply(G,C.concat(R.call(arguments)))}},a.partial=function(z){var C=R.call(arguments,1);return function(){return z.apply(this,C.concat(R.call(arguments)))}},a.bindAll=function(z){var C=R.call(arguments,1);return 0===C.length&&(C=a.functions(z)),j(C,function(G){z[G]=a.bind(z[G],z)}),z},a.memoize=function(z,G){var C={};return G||(G=a.identity),function(){var H=G.apply(this,arguments);return a.has(C,H)?C[H]:C[H]=z.apply(this,arguments)}},a.delay=function(z,G){var C=R.call(arguments,2);return setTimeout(function(){return z.apply(null,C)},G)},a.defer=function(z){return a.delay.apply(a,[z,1].concat(R.call(arguments,1)))},a.throttle=function(L,H){var G,C,K,J,P=0,z=function(){P=new Date,K=null,J=L.apply(G,C)};return function(){var U=new Date,Q=H-(U-P);return G=this,C=arguments,0>=Q?(clearTimeout(K),K=null,P=U,J=L.apply(G,C)):K||(K=setTimeout(z,Q)),J}},a.debounce=function(z,H,G){var C,J;return function(){var L=this,P=arguments,K=function(){C=null,G||(J=z.apply(L,P))},Q=G&&!C;return clearTimeout(C),C=setTimeout(K,H),Q&&(J=z.apply(L,P)),J}},a.once=function(z){var G,C=!1;return function(){return C?G:(C=!0,G=z.apply(this,arguments),z=null,G)}},a.wrap=function(z,C){return function(){var G=[z];return l.apply(G,arguments),C.apply(this,G)}},a.compose=function(){var z=arguments;return function(){for(var G=arguments,C=z.length-1;C>=0;C--){G=[z[C].apply(this,G)]}return G[0]}},a.after=function(z,C){return 0>=z?C():function(){return 1>--z?C.apply(this,arguments):void 0}},a.keys=i||function(z){if(z!==Object(z)){throw new TypeError("Invalid object")}var G=[];for(var C in z){a.has(z,C)&&(G[G.length]=C)}return G},a.values=function(z){var G=[];for(var C in z){a.has(z,C)&&G.push(z[C])}return G},a.pairs=function(z){var G=[];for(var C in z){a.has(z,C)&&G.push([C,z[C]])}return G},a.invert=function(z){var G={};for(var C in z){a.has(z,C)&&(G[z[C]]=C)}return G},a.functions=a.methods=function(z){var G=[];for(var C in z){a.isFunction(z[C])&&G.push(C)}return G.sort()},a.extend=function(z){return j(R.call(arguments,1),function(G){if(G){for(var C in G){z[C]=G[C]}}}),z},a.pick=function(z){var G={},C=o.apply(q,R.call(arguments,1));return j(C,function(H){H in z&&(G[H]=z[H])}),G},a.omit=function(z){var G={},C=o.apply(q,R.call(arguments,1));for(var H in z){a.contains(C,H)||(G[H]=z[H])}return G},a.defaults=function(z){return j(R.call(arguments,1),function(G){if(G){for(var C in G){null==z[C]&&(z[C]=G[C])}}}),z},a.clone=function(z){return a.isObject(z)?a.isArray(z)?z.slice():a.extend({},z):z},a.tap=function(z,C){return C(z),z};var B=function(L,U,Q,H){if(L===U){return 0!==L||1/L==1/U}if(null==L||null==U){return L===U}L instanceof a&&(L=L._wrapped),U instanceof a&&(U=U._wrapped);var V=F.call(L);if(V!=F.call(U)){return !1}switch(V){case"[object String]":return L==U+"";case"[object Number]":return L!=+L?U!=+U:0==L?1/L==1/U:L==+U;case"[object Date]":case"[object Boolean]":return +L==+U;case"[object RegExp]":return L.source==U.source&&L.global==U.global&&L.multiline==U.multiline&&L.ignoreCase==U.ignoreCase}if("object"!=typeof L||"object"!=typeof U){return !1}for(var K=Q.length;K--;){if(Q[K]==L){return H[K]==U}}Q.push(L),H.push(U);var z=0,P=!0;if("[object Array]"==V){if(z=L.length,P=z==U.length){for(;z--&&(P=B(L[z],U[z],Q,H));){}}}else{var C=L.constructor,J=U.constructor;if(C!==J&&!(a.isFunction(C)&&C instanceof C&&a.isFunction(J)&&J instanceof J)){return !1}for(var G in L){if(a.has(L,G)&&(z++,!(P=a.has(U,G)&&B(L[G],U[G],Q,H)))){break}}if(P){for(G in U){if(a.has(U,G)&&!z--){break}}P=!z}}return Q.pop(),H.pop(),P};a.isEqual=function(z,C){return B(z,C,[],[])},a.isEmpty=function(z){if(null==z){return !0}if(a.isArray(z)||a.isString(z)){return 0===z.length}for(var C in z){if(a.has(z,C)){return !1}}return !0},a.isElement=function(z){return !(!z||1!==z.nodeType)},a.isArray=b||function(z){return"[object Array]"==F.call(z)},a.isObject=function(z){return z===Object(z)},j(["Arguments","Function","String","Number","Date","RegExp"],function(z){a["is"+z]=function(C){return F.call(C)=="[object "+z+"]"}}),a.isArguments(arguments)||(a.isArguments=function(z){return !(!z||!a.has(z,"callee"))}),"function"!=typeof/./&&(a.isFunction=function(z){return"function"==typeof z}),a.isFinite=function(z){return isFinite(z)&&!isNaN(parseFloat(z))},a.isNaN=function(z){return a.isNumber(z)&&z!=+z},a.isBoolean=function(z){return z===!0||z===!1||"[object Boolean]"==F.call(z)},a.isNull=function(z){return null===z},a.isUndefined=function(z){return z===void 0},a.has=function(z,C){return s.call(z,C)},a.noConflict=function(){return N._=ak,this},a.identity=function(z){return z},a.times=function(z,H,G){for(var C=Array(z),J=0;z>J;J++){C[J]=H.call(G,J)}return C},a.random=function(z,C){return null==C&&(C=z,z=0),z+Math.floor(Math.random()*(C-z+1))};var E={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};E.unescape=a.invert(E.escape);var aj={escape:RegExp("["+a.keys(E.escape).join("")+"]","g"),unescape:RegExp("("+a.keys(E.unescape).join("|")+")","g")};a.each(["escape","unescape"],function(z){a[z]=function(C){return null==C?"":(""+C).replace(aj[z],function(G){return E[z][G]})}}),a.result=function(z,G){if(null==z){return null}var C=z[G];return a.isFunction(C)?C.call(z):C},a.mixin=function(z){j(a.functions(z),function(G){var C=a[G]=z[G];a.prototype[G]=function(){var H=[this._wrapped];return l.apply(H,arguments),m.call(this,C.apply(a,H))}})};var I=0;a.uniqueId=function(z){var C=++I+"";return z?z+C:C},a.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var an=/(.)^/,ag={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},k=/\\|'|\r|\n|\t|\u2028|\u2029/g;a.template=function(L,z,Q){var J;Q=a.defaults({},Q,a.templateSettings);var C=RegExp([(Q.escape||an).source,(Q.interpolate||an).source,(Q.evaluate||an).source].join("|")+"|$","g"),K=0,G="__p+='";L.replace(C,function(Y,X,V,W,U){return G+=L.slice(K,U).replace(k,function(Z){return"\\"+ag[Z]}),X&&(G+="'+\n((__t=("+X+"))==null?'':_.escape(__t))+\n'"),V&&(G+="'+\n((__t=("+V+"))==null?'':__t)+\n'"),W&&(G+="';\n"+W+"\n__p+='"),K=U+Y.length,Y}),G+="';\n",Q.variable||(G="with(obj||{}){\n"+G+"}\n"),G="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+G+"return __p;\n";try{J=Function(Q.variable||"obj","_",G)}catch(P){throw P.source=G,P}if(z){return J(z,a)}var H=function(U){return J.call(this,U,a)};return H.source="function("+(Q.variable||"obj")+"){\n"+G+"}",H},a.chain=function(z){return a(z).chain()};var m=function(z){return this._chain?a(z).chain():z};a.mixin(a),j(["pop","push","reverse","shift","sort","splice","unshift"],function(z){var C=q[z];a.prototype[z]=function(){var G=this._wrapped;return C.apply(G,arguments),"shift"!=z&&"splice"!=z||0!==G.length||delete G[0],m.call(this,G)}}),j(["concat","join","slice"],function(z){var C=q[z];a.prototype[z]=function(){return m.call(this,C.apply(this._wrapped,arguments))}}),a.extend(a.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this)},{}],73:[function(A,D,w){var s=A("./models/lib");var E=A("./models/link");var q=A("./models/page");var t=A("./models/widget");var z=A("./models/upload");var v=A("./models/project");var B=A("./models/account");var u=A("./models/libWidget");var C=A("./models/widgetGroup");var F=A("./models/customWidget");D.exports.init=function r(){if(!fluid.models){fluid.models={}}fluid.models.Lib=s;fluid.models.Link=E;fluid.models.Page=q;fluid.models.Widget=t;fluid.models.Upload=z;fluid.models.Project=v;fluid.models.Account=B;fluid.models.LibWidget=u;fluid.models.WidgetGroup=C;fluid.models.CustomWidget=F}},{"./models/account":74,"./models/customWidget":77,"./models/lib":78,"./models/libWidget":79,"./models/link":80,"./models/page":81,"./models/project":82,"./models/upload":83,"./models/widget":84,"./models/widgetGroup":85}],74:[function(h,l,i){var j=h("../fluid.model");var k=j.extend({_type:"accountModel",attrBlackList:["accountId"],idAttribute:"accountId",separateParams:["hint","tutorialLevel","billingCompany","billingCountry","billingAddress","billingVAT","gridStatus","gridSpacing","snapToWidget","receiptEmails","emailReceiptEnabled","lastOpenProject","everCreatedPage","everZoomedIntoPage","everAddedWidget","everMadeLink","everUsedPreview","everClosedPreview","upgradePromptCount","everUpgraded","pageLimitPromptClicks","projectLimitPromptClicks","screensExportPromptClicks","screenflowExportPromptClicks","htmlExportPromptClicks","reachedUpgradeSecondSection","proceedBillingButtonClicked","failedUpgradeSecondSection","reachedUpgradeThirdSection","upgradeFrameLoadingTime","editorLoadCountBeforeUpgrade","zoomMode","zoomTo","zoomScroll","libUploads"],defaults:{email:"New",accType:"New",name:"",recurrance:"never",libraryWidth:423,loggedIn:"no",maxActiveProjects:1,maxPages:10,projectIds:[],uploads:[],lastOpenProject:"",createDate:new Date().getTime(),zoomTo:"100",zoomMode:"Smart",zoomScroll:"ScrollOn",gridStatus:"off",gridSpacing:10,snapToWidget:"on"},get:function(b){if(b==="accName"&&this.attributes[b]){var a=this.attributes[b];if(a.indexOf("Professional")!==-1){a=a.replace("Professional","Team")}else{if(a.indexOf("Standard")!==-1){a=a.replace("Standard","Pro")}else{if(a.indexOf("Lite")!==-1){a=a.replace("Lite","Solo")}}}return a}else{return this.attributes[b]}},initialize:function(b,a){this.on("all",this.onChange,this);if(!this.customwidgets){this.customwidgets=new fluid.collections.CustomWidgets(null,{accountModel:this})}if(this.get("libraryWidth")<440){this.set({libraryWidth:440})}fluid.main.on("ensureLibUploads",function(){if(!fluid.main.uploads||!fluid.main.uploads.length||fluid.main.account.get("libUploads")){return}fluid.main.account.set({libUploads:fluid.main.uploads.map(function(c){return c.id})});fluid.main.fire("accountSyncUp")})},onChange:function(a,b){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,50)}if(!this.debouncedSyncUpParams){this.debouncedSyncUpParams=_.debounce(this.syncUpParams,2000,true)}var c=b.changedAttributes();if(c.projectIds){b.set({projectIds:_.uniq(b.get("projectIds"))})}if(c.zoomTo){if(parseInt(c.zoomTo,10)>400){Logger({key:"zoomToError",group:"randomErrors",message:"zoomTo value over 400. Stacktrace: "+fluid.main.getStacktrace()})}}this.debouncedSave.apply(this,arguments);if(b.get("loggedIn")==="yes"&&_.keys(_.pick(b.changedAttributes(),b.separateParams)).length!==0){this.debouncedSyncUpParams.apply(this,arguments)}},isForever:function(){if((this.get("loggedIn")==="yes")&&(this.get("accType")==="premium1")){return true}return false},isLoggedIn:function(){return this.get("loggedIn")==="yes"},isFree:function(){return this.get("accType")==="Free"},isSolo:function(){return this.get("accType").match(/solo/i)},isPro:function(){return this.get("accType").match(/pro/i)},isTeam:function(){return this.get("accType").match(/team/i)},parse:function(q,d){if(!q){return{}}if(q.settings){try{q.everUpgraded=JSON.parse(q.settings).everUpgraded}catch(s){}}var a=["a","r","sessionId","settings","objects","intercomUserHash","lastProjectId","upgradeDate","lastPaymentDate","nextPaymentDate","lastPaymentResult"],f=["maxActiveProjects","maxPages"],r,c;r=_.omit(q,a);if(q.settings){var b=JSON.parse(q.settings);if(b.libUploads){r.libUploads=b.libUploads}}for(c=0;c<f.length;c++){if(r[f[c]]!==undefined){r[f[c]]=~~r[f[c]]}}return r},bundle:function(){return this.pick(this.separateParams)},save:function(){if(this.get("email")==="New"&&!this.get("noLoginParams")){return}var a=this.allToJSON();var b={id:this.get("accountId"),data:a};fluid.main.fire("dbStorage.set","accounts",b)},syncUpParams:function(){var a=this.bundle();fluid.main.fire("apiRequest","accountSettingsSync",a,$.noop,$.noop)},findUpload:function(a){var b;var d=this.get("uploads");for(var c=0;c<d.length;c++){if(a==d[c].id){b={index:c,upload:d[c]};break}}return b},addProjectId:function(a){var b=fluid.main.projects.getIds();if(b.indexOf&&b.indexOf(a)===-1){b=[a].concat(b);this.set({projectIds:b})}},isAnonymous:function(){return(window.location.pathname.split("/").indexOf("comment")!==-1&&this.get("loggedIn")==="no")}});l.exports=k},{"../fluid.model":69}],75:[function(h,l,i){var j=h("../fluid.model");var k=j.extend({attrBlackList:[],defaults:{type:"text"},initialize:function(b,a){if(!b.addedTime){b.addedTime=new Date().getTime()}}});l.exports=k},{"../fluid.model":69}],76:[function(l,k,h){var j=l("../fluid.model");var i=j.extend({attrBlackList:[],initialize:function(b,a){if(!this.comments){this.comments=new fluid.collections.Comments(null,{threadModel:this})}this.on("all",function(){this.collection.fire.apply(this.collection,arguments)})},toJSON:function(a){var b;if(a&&a.getAll){b=_.clone(this.attributes)}b=_.omit(this.attributes,this.attrBlackList);b.comments=this.comments.toJSON();return b}});k.exports=i},{"../fluid.model":69}],77:[function(h,l,i){var j=h("../fluid.model");var k=j.extend({attrBlackList:[],initialize:function(b,a){}});l.exports=k},{"../fluid.model":69}],78:[function(h,l,i){var j=h("../fluid.model");var k=j.extend({idAttribute:"id",defaults:{name:"My Widgets",widgets:[]},initialize:function(b,a){},parse:function(a,c){var d;var b=["name","id","updated"];d=_.pick(a,b);if(a.widgets){d.widgets=_.isArray(a.widgets)?a.widgets:_.keys(a.widgets)}return d},bundle:function(){var c=this.toJSON(),a={},d;for(var b=0;b<c.widgets.length;b++){d=fluid.main.account.libWidgets.get(c.widgets[b]);if(d){a[d.get("id")]=d.toJSON()}}c.widgets=a;return c}});l.exports=k},{"../fluid.model":69}],79:[function(l,k,i){var j=l("../fluid.model");var h=j.extend({idAttribute:"id",initialize:function(b,a){},parse:function(a,b){return a}});k.exports=h},{"../fluid.model":69}],80:[function(l,k,i){var j=l("../fluid.model");var h=j.extend({idAttribute:"linkCanvId",initialize:function(b,a){},parse:function(a,b){return a}});k.exports=h},{"../fluid.model":69}],81:[function(h,k,i){var j=h("../fluid.model");var l=j.extend({attrBlackList:["id","box","imgData"],omitedRedrawAttrs:["x","y","imgData"],initialize:function(b,a){this.on("change:x change:y change:width change:height",function(){this.clearBox()},this);this.on("change",function(d,f){var n=this.changedAttributes(),c;n=_.keys(n);c=_.difference(n,this.omitedRedrawAttrs);if(c.length>0){this.clearImgData()}},this);fluid.main.on("resolutionChanged",function(){if(!fluid.main.project||!fluid.main.project.widgets.get(this.get("id"))){return}this.clearBox();this.clearImgData();var c=this.get("widgets");fluid.main.project.widgets.each(function(d){if(c.indexOf(d.get("id"))!==-1){d.clearBox()}})},this)},clearImgData:function(){this.set({imgData:null})},clearBox:function(){this.set({box:null},{silent:true})},getBox:function(){var a=this.get("box");if(a){return a}else{a=[this.get("x"),this.get("y"),this.get("width"),this.get("height")];this.set({box:a},{silent:true});return a}}});k.exports=l},{"../fluid.model":69}],82:[function(n,m,i){var k=n("../fluid.model");var j=n("../../utils");var l=k.extend({attrBlackList:["visiblePages","uniqueUploads","activePageId","lastSync","canvasPosX","canvasPosY","mode"],silentSyncAttrs:["updated","saved","preview","canvasPosX","canvasPosY","currentZoom","visiblePages","uniqueUploads","lastSync","activePageId","mode"],silentSaveAttrs:["updated","saved","currentZoom","lastSync","activePageId"],defaults:{name:""},initialize:function(b,a){if(!this.get("id")){if(a.projectId){this.set("id",a.projectId);this.id=a.projectId}}if(!this.pages){this.pages=new fluid.collections.Pages(null,{projectModel:this})}if(!this.widgets){this.widgets=new fluid.collections.Widgets(null,{projectModel:this})}if(!this.links){this.links=new fluid.collections.Links(null,{projectModel:this})}if(!this.wdgGroups){this.wdgGroups=new fluid.collections.WidgetGroups(null,{projectModel:this})}if(!this.threads){this.threads=new fluid.collections.CommentThreads(null,{projectModel:this,comparator:false})}if(a&&a.syncOnChange!==false){this.pages.on("all",this.onChange,this);this.widgets.on("all",this.onChange,this);this.widgets.on("add",this.addUniqueUpload,this);this.widgets.on("remove",this.removeUniqueUpload,this);this.links.on("all",this.onChange,this);this.threads.on("all",this.onChange,this);this.on("all",this.onChange,this);this.on("change:uniqueUploads",this.updateLibrary,this);this.on("change:name",this.updateLibraryTab,this);this.save();fluid.main.on("incrementalsSynced",function(c,d){if(this.get("id")===d){this.synced=true}}.bind(this))}this.synced=true;fluid.main.on("thumbnailReady",function(d,c){if(c===this.id){this.modifiedSinceThumb=false}},this);if(!this.get("unloaded")){this.pages.forEach(function(p,c,d){if(p.get("notes")){var h=j.guid("t");this.threads.add({id:h,pageId:p.id,top:0,left:0});var f=this.threads.get(h);f.comments.add({text:p.get("notes")[3],id:j.guid("c"),ownerId:fluid.main.account&&fluid.main.account.id,ownerEmail:fluid.main.account&&fluid.main.account.get("email"),created:new Date().getTime()});p.unset("notes")}},this)}this.fire("projectModelInitialized",this);this.initialized=true},defaults:{uniqueUploads:[]},isSynced:function(){return this.synced},onChange:function(a,d){if(!d.changedAttributes){return}if(a==="projectModelInitialized"){return}var f=d.changedAttributes(),b,c;if(f){f=_.keys(f);b=_.difference(f,this.silentSyncAttrs);c=_.difference(f,this.silentSaveAttrs);if(b.length){if(!(b.length===1&&b[0]=="stored")){this.set({updated:new Date().getTime()},{silent:true});this.synced=false;this.modifiedSinceThumb=true;fluid.main.fire("api:projectModelChanged")}}if(c.length){if(!this.debouncedSave){this.debouncedSave=_.debounce(this.save,50)}this.debouncedSave.apply(this,arguments)}}},addUniqueUpload:function(b,d){var a=d.attributes.data;if(a){var c=_.clone(this.get("uniqueUploads"));if(c.indexOf(a)===-1){c.push(a);this.set({uniqueUploads:c})}}},removeUniqueUpload:function(d,f){var h=f.attributes.data;if(h){var a=f.id;var b=this.widgets.find(function(p){return(p.id!==a&&p.attributes.data&&p.attributes.data===h)});if(!b){var c=this.get("uniqueUploads");c=_.without(c,h);this.set({uniqueUploads:c})}}},updateLibrary:function(b){var c=b.previousAttributes().uniqueUploads;var d=b.attributes.uniqueUploads;var a;if(c.length<d.length){a=_.difference(d,c);a.forEach(function(f){fluid.main.trigger("projectTab.uploadAdded",{projectId:b.id,uploadId:f})})}else{if(c.length>d.length){a=_.difference(c,d);a.forEach(function(f){fluid.main.trigger("projectTab.uploadRemoved",{projectId:b.id,uploadId:f})})}}fluid.main.trigger("projectTab.setCounter",{projectId:b.id,count:d.length})},updateLibraryTab:function(a){fluid.main.trigger("projectTab.changeNameOfActiveTab",{id:a.attributes.id,name:a.attributes.name})},save:function(a){if(fluid.main.isNode()||this.get("mode")!=="owner"){if(a&&_.isFunction(a)){a()}return}this.set("stored",new Date().getTime(),{silent:true});var b=this.bundle({getAll:true});fluid.main.fire("dbStorage.set","projects",{id:this.id,data:b},function(){if(a&&a.call){a()}}.bind(this))},parse:function(c,S){var a;if(typeof c==="string"){c=JSON.parse(c)}if(S.projectId&&c[S.projectId]){a=c[S.projectId];a.id=S.projectId}else{var O=this.findProjectInBundle(c)[1];a=O[1];a.id=O[0]}a.mode=(S&&S.mode)?S.mode:"owner";var R=Object.keys(c).filter(function(o){return o.slice(0,2)==="x_"});var K,G=[],b=[],I,L,J,h,f,d,P,Q;if(R&&R.length){for(I=0,L=R.length;I<L;I++){f=R[I];if(!f){continue}if(c[f]){P=_.clone(c[f]);P.id=f;G.push(P);K=P.widgets;if(K&&K.length){for(J=0,h=K.length;J<h;J++){d=K[J];if(c[d]&&c[d].lockTo&&!c[c[d].lockTo]){c[d]=null}if(c[d]&&c[d].of&&!c[c[d].of]){c[d]=null}if(fluid.main.uploads&&c[d]&&c[d].data&&!c.uploads[c[d].data]&&fluid.main.uploads.get(c[d].data)){c[d]=null}if(c[d]){Q=_.clone(c[d]);Q.id=d;Q.pageId=f;b.push(Q)}else{K.splice(J,1);J--;h--}}}}else{R.splice(I,1);I--}}a.pages=R}else{a.pages=[]}c.uploads=c.uploads||{};a.uniqueUploads=_.keys(c.uploads);if(a.homepage&&!c[a.homepage]){if(G.length){a.homepage=G[0].id}else{a.homepage=false}}this.pages=new fluid.collections.Pages(G,{comparator:false,projectModel:this});this.widgets=new fluid.collections.Widgets(b,{comparator:false,projectModel:this});var M=[],N,H;for(H in a.widgetGroups){if(a.widgetGroups.hasOwnProperty(H)){N={id:H,widgets:a.widgetGroups[H]}}M.push(N)}this.wdgGroups=new fluid.collections.WidgetGroups(M,{comparator:false});this.links=new fluid.collections.Links(null,{comparator:false});if(a.links){this.links.deserialize(a.links)}this.threads=new fluid.collections.CommentThreads(null,{projectModel:this,comparator:false});if(c.threads){this.threads.deserialize(c.threads)}return a},get:function(d,p){var h=d.substr(0,1),c=p&&p.returnModel?true:false;if(!d||!_.isString(d)){Logger({key:"project.get-badParams",group:"randomErrors",message:"Bad project.get() params provided: "+fluid.main.getStacktrace()});return false}if(d.substr(1,1)!=="_"&&this.attributes[d]!==undefined){return this.attributes[d]}else{if(h==="x"){var f=this.pages.get(d);if(!f){return false}return c?f:f.toJSON(p)}else{if(h==="w"){var a=this.widgets.get(d);if(!a){return false}return c?a:a.toJSON(p)}else{if(h==="l"){var b=this.links.get(d);if(!b){return false}return c?b:b.toJSON(p)}else{if(h==="p"){return c?this:this.toJSON(p)}}}}}},setChild:function(h,r){var f=h.substr(0,1);var d,a;if(f==="x"){a=this.pages;r.id=h;d=this.pages.get(h)}else{if(f=="w"){a=this.widgets;r.id=h;d=this.widgets.get(h)}else{if(f=="l"){a=this.links;d=this.links.get(h)}}}if(d){var b=_.clone(d.attributes);for(var q in b){if(typeof r[q]==="undefined"&&b.hasOwnProperty(q)){var c=["id","pageId","box","imgData"];if(c.indexOf(q)!==-1){d.unset(q,{silent:true})}}}d.set(r)}else{a.add(r)}},isEmpty:function(){return this.pages.length===0},isReadOnly:function(){return this.get("active")===false?true:false},isMultiOrientation:function(){var b=this.pages&&this.pages.models;var a=this.get("orientation");var c=false;_.each(b,function(d){if(d.attributes.orientation!==a){c=true}});return c},hasLinks:function(){return(this.links&&this.links.length)?true:false},findProjectInBundle:function(b){for(var a in b){if(b.hasOwnProperty(a)&&a.substr(0,2)==="p_"){return[a,b[a]]}}return false},bundle:function(a){var b={};b[this.attributes.id]=this.toJSON(a);if(this.links){_.extend(b[this.attributes.id],{links:this.links.toJSON(a)})}_.extend(b,this.pages?this.pages.toJSON(a):{});_.extend(b,this.widgets?this.widgets.toJSON(a):{});b.uploads={};if(this.widgets){this.widgets.each(function(d,f,h){if(!d.attributes.upload){return}var p=d.toJSON(),c;if(fluid.main.uploads.get(p.data)){c=fluid.main.uploads.get(p.data).toJSON()}else{c={}}b.uploads[p.data]=_.pick(c,"type","wh","title")},this)}b.threads=this.threads.toJSON();return b},getNextPageNumber:function(){var a=(this.get("nextPageNumber")||0)+1;return a}});m.exports=l},{"../../utils":99,"../fluid.model":69}],83:[function(l,k,h){var j=l("../fluid.model");var i=j.extend({attrBlackList:["imgData"],initialize:function(b,a){this.on("change",function(){var c=_.keys(this.changedAttributes());if(c.indexOf("imgData")!==-1){fluid.main.fire("dbStorage.set","uploads",{id:this.id,data:this.get("imgData")})}},this);this.projects=new fluid.collections.Projects(null)},parse:function(a,b){return a}});k.exports=i},{"../fluid.model":69}],84:[function(h,l,i){var j=h("../fluid.model");var k=j.extend({attrBlackList:["id","pageId","box","imgData"],initialize:function(b,a){this.on("change:tlwh",function(){this.clearBox()});this.collection.projectModel.on("change:pageWH",function(){if(!this.collection){return}this.clearBox()},this);if(this.collection.projectModel.initialized){this.watchContainer()}else{this.collection.projectModel.on("projectModelInitialized",function(){this.watchContainer()},this)}this.on("change",function(){if(!this.collection){return}this.getPage().clearImgData()},this)},watchContainer:function(){this.container=(this.get("of"))?this.collection.projectModel.widgets.get(this.get("of")):this.getPage();if(this.container&&this.container.id[0]==="x"){this.container.on("change:width change:height",this.afterContainerChanged,this)}else{if(this.container&&this.container.id[0]==="w"){this.container.on("change:tlwh",this.afterContainerChanged,this)}}},afterContainerChanged:function(a){this.clearBox()},_validate:function(a,b){if(!a.ts){return true}a.ts=this.sanitizeTs(a.ts);return true},sanitizeTs:function(c){var d=c.split(";"),E=_.find(d,function(m){return m.indexOf("font-size:")!==-1}),G=_.find(d,function(m){return m.indexOf("line-height:")!==-1}),b=_.find(d,function(m){return m.indexOf("font-family:")!==-1}),f=_.find(d,function(m){return m.indexOf("font-style:")!==-1}),H=_.find(d,function(m){return m.indexOf("font-weight:")!==-1}),A=_.find(d,function(m){return m.indexOf("color:")!==-1}),C=_.find(d,function(m){return m.indexOf("textAlign:")!==-1});if(E){E=E.replace("font-size:","")}if(G){G=G.replace("font-size:","")}if(b){b=b.replace("font-family:","")}if(f){f=f.replace("font-style:","")}if(H){H=H.replace("font-weight:","")}if(A){A=A.replace("color:","")}if(C){C=C.replace("color:","")}var w;var B=_.find(d,function(n,m){if(n.indexOf("font:")!==-1){w=m;return true}else{return false}});if(!B){return c}B=B.replace("font:","");var D=B.split(" ");D=_.filter(D,function(m){return m!==""});var a;if(!E||!G){E=_.find(D,function(n,m){a=n.indexOf("px");if(a!==-1){a=m;return true}else{return false}});if(E.indexOf("/")!==-1){var z=E.split("/");E=z[0];G=z[1]}}if(!b&&a!==undefined){b=D.slice(a+1);b=b.join(" ")}if(!f||!H){var F=D.slice(0,a);if(!f){f="normal";if(F.length===2){f=F[0]}else{if(F.length===1&&F[0]==="italic"){f="italic"}}}if(!H){H="normal";if(F.length===2){H=F[1]}else{if(F.length===1&&F[0]==="bold"){H="bold"}}}}c="font-size: "+E+"; "+(G?("line-height: "+G+"; "):"")+"font-family: "+b+"; font-weight: "+H+"; font-style: "+f+"; text-align: "+C+"; color: "+A+"; ";return c},clearBox:function(){var a=this.getChildren();this.set({box:null},{silent:true});a.forEach(function(d,b,c){d.clearBox()})},calculateBox:function(c){var f=[],q=this.get("tlwh"),d=this.get("ca");if(!q&&this.get("st")==="b"){q=[0,0,"a","a"]}function t(F){var E=this.get("segments"),G=0;if(E){var m=this.get("sp"),C=m?m[F-1]:0,H=m?m[F==2?3:2]:0;for(var p=0,D=E.length;p<D;p++){var o=fluid.main.project.widgets.get(E[p].id);var n;if(!o){o=fluid.main.project.widgets.get(E[p].widget)}if(!o){return G}n=o.toJSON();if(!n){return G}G+=n.tlwh?n.tlwh[F]:n.wh[F-2]}G+=C+H}else{return c[F]}return G}var s=q[2]==null?0:q[2];if(s&&typeof(s)==="number"){f[2]=s}else{if(s&&s.indexOf("%")!==-1){f[2]=(parseFloat(s)/100)*c[2]}else{if(s=="a"){f[2]=t.call(this,2)}else{f[2]=c[2]}}}var a=q[3]==null?0:q[3];if(a&&typeof(a)==="number"){f[3]=a}else{if(a&&a.indexOf("%")!==-1){f[3]=(parseFloat(a)/100)*c[3]}else{if(a=="a"){f[3]=t.call(this,3)}else{f[3]=c[3]}}}var b=q[0]==null?0:q[0];if(!d||d[0]=="t"){if(typeof(b)==="number"){f[1]=b+c[1]}else{if(b.indexOf("%")!==-1){f[1]=((parseFloat(b)/100)*c[3])+c[1]}else{f[1]=parseInt(b,10)+c[1]}}}else{if(d[0]=="c"){if(typeof(b)==="number"){f[1]=b+c[1]+c[3]/2-f[3]/2}else{if(b.indexOf("%")!==-1){f[1]=((parseFloat(b)/100)*c[3])+c[1]+c[3]/2-f[3]/2}else{f[1]=parseInt(b,10)+c[1]+c[3]/2-f[3]/2}}}else{if(d[0]=="b"){if(typeof(b)==="number"){f[1]=c[1]+c[3]-b-f[3]}else{if(b.indexOf("%")!==-1){f[1]=c[1]+c[3]-((parseFloat(b)/100)*c[3])-f[3]}else{f[1]=c[1]+c[3]-parseInt(b,10)}}}}}var r=q[1]==null?0:q[1];if(!d||d[1]=="l"){if(typeof(r)==="number"||r.indexOf("%")===-1){f[0]=r+c[0]}else{if(r.indexOf("%")!==-1){f[0]=((parseFloat(r)/100)*c[2])+c[0]}else{f[0]=parseInt(r,10)+c[0]}}}else{if(d[1]=="c"){if(typeof(r)==="number"){f[0]=r+c[0]+c[2]/2-f[2]/2}else{if(r.indexOf("%")!==-1){f[0]=((parseFloat(r)/100)*c[2])+c[0]+c[2]/2-f[2]/2}else{f[0]=parseInt(r,10)+c[0]+c[2]/2}}}else{if(d[1]=="r"){if(typeof(r)==="number"){f[0]=c[0]+c[2]-r-f[2]}else{if(r.indexOf("%")!==-1){f[0]=c[0]+c[2]-((parseFloat(r)/100)*c[2])-f[2]}else{f[0]=c[0]+c[0]-parseInt(r,10)}}}}}f[0]=~~f[0];f[1]=~~f[1];f[2]=~~f[2];f[3]=~~f[3];this.set({box:f},{silent:true});return f},getBox:function(c){var b,a,d,o,f,p;o=this.get("box");if(!c&&o){return o}if(!this.get("of")){f=this.get("st");a=this.getPage();if(f&&(f==="f"||f==="fb")){p=this.getProject().get("pageWH");if(a.get("orientation")==="Landscape"){p=[p[1],p[0]]}b=[0,0,p[0],p[1]]}else{b=[0,0,a.get("width"),a.get("height")]}}else{d=this.getParent();if(!d){a=this.getPage();b=[0,0,a.get("width"),a.get("height")]}else{b=d.getBox()}}o=this.calculateBox(b);return o},getRoot:function(){if(this.get("of")&&this.getParent()){return this.getParent().getRoot()}else{return this}},getSegmentRoot:function(){if(this.get("segmentRoot")){return this.collection.get(this.get("segmentRoot"))}else{return this.getRoot()}},getSegmentContainer:function(){if(this.get("seg")){return this}else{if(this.get("segmentRoot")&&this.collection.get(this.get("segmentRoot")).get("seg")){return this.collection.get(this.get("segmentRoot"))}else{if(this.get("of")){return this.collection.get(this.get("of")).getSegmentContainer()}else{return this.getRoot()}}}},getDependents:function(){var a=this.collection.where({lockTo:this.id,of:this.id});return a},getDependentsIds:function(a){var b=[];if(!a){a={}}if(a.recursive!==false&&this.get("lockTo")===this.id){b=_.map(this.getLockTos(),function(c){return c.id})}else{if(this.get("lockTo")===this.id){b=this.getOfs().getIds()}else{if(this.getOfs().length){b=b.concat(this.getOfs().getIds())}}}b=_.uniq(_.without(b,this.id));return b},getOfs:function(){var a=new fluid.collections.Widgets();a.add(this.collection.where({of:this.id}));return a},getLockTos:function(){var b=this.getRoot();var a=this.collection.where({lockTo:b.id});return a},getChildren:function(){var a=this.collection&&this.collection.where({of:this.id})||[];return a},getParent:function(){return this.collection&&this.collection.get(this.get("of"))},getPage:function(){var a=this.getProject().pages.get(this.get("pageId"));if(a&&this.get("pageId")){return a}else{a=false;this.getProject().pages.every(function(b,c,d){if(b.get("widgets").indexOf(this.id)!==-1){a=b;this.set({pageId:b.id},{silent:true});return false}return true},this);return a}},getProject:function(){return this.collection.projectModel},containsText:function(){var a=false;if(this.get("tc")){a=true}else{if(this.attributes.ad&&this.attributes.ad.length){this.attributes.ad.forEach(function(d){if(d&&d[0]){var b=d[0];var c=widgets.summary[b];if(c&&c.tc){a=true}}})}}return a},getSubTextElements:function(){var a=[],b=this.getOfs();b.forEach(function(c){a=a.concat(c.getSubTextElements())});if(this.get("tc")){a.push(this)}return a},getGroup:function(){var b=this.getProject().wdgGroups;var c=this.id;var a=b.find(function(d){if(d.get("widgets").indexOf(c)!==-1){return true}else{return false}});return a},getAllFromGroup:function(){var a=this.getGroup();var b=[];if(a){var c=a.get("widgets");b=fluid.main.project.widgets.filter(function(d){if(c.indexOf(d.id)!==-1){return true}return false})}return b}});l.exports=k},{"../fluid.model":69}],85:[function(l,k,i){var j=l("../fluid.model");var h=j.extend({initialize:function(b,a){},parse:function(a,b){return a}});k.exports=h},{"../fluid.model":69}],86:[function(z,A,u){var r=z("../fluid.module");var p=z("../lib/underscore");var w=z("../../utils-editor").loadjscssfile;var B=z("../../instanceIdUtil");var s=z("../../checkHost");var D=z("../../reloader");var t=z("../../class-storage");var q=z("../../class-dbStorage");var C=z("./crcCheck");var v=z("jsondiffpatch");r.define("fluid.api",function(b){p.extend(b,{_maxRetryCount:2,_interval:100,_timeoutShort:45,_timeoutLong:600,_serverCheckAfter:5,_timeoutServerStatus:5,_debounceTime:5,_serverStatusInterval:20,_originalServerStatusInterval:20,_pendingShort:false,_pendingObj:null,_queueShort:[],_queueLong:[],_queueIncremental:[],_logoutHandler:null,_RETRY:true,_NO_RETRY:false,_LOCK:true,_NO_LOCK:false,_processIncrementalTimeout:null,incrementalsObject:{},incrementals:{cleanMeUp:function(h){var d=[];for(var i in b.incrementalsObject){if(b.incrementalsObject.hasOwnProperty(i)){if(b.incrementalsObject[i].projectId===h){d.push(i)}}}for(var f in d){delete b.incrementalsObject[d[f]]}b.incrementals.save();if(Object.keys(b.incrementalsObject).length===0){fluid.main.fire("incrementalsSynced",h)}},add:function(f,h,d){fluid.main.fire("incrementalsSyncing");b.incrementalsObject[f]={timestamp:new Date().getTime(),projectId:h,fullSnap:!!d};b.incrementals.save()},remove:function(f){if(!b.incrementalsObject[f]){return}var h=b.incrementalsObject[f].projectId;var j=b.incrementalsObject[f].timestamp;var d=b.incrementalsObject[f].fullSnap;delete b.incrementalsObject[f];if(d){for(var i in b.incrementalsObject){if(b.incrementalsObject.hasOwnProperty(i)){if(b.incrementalsObject[i].projectId===h){if(b.incrementalsObject[i].timestamp<=j){delete b.incrementalsObject[i]}}}}}b.incrementals.save();if(Object.keys(b.incrementalsObject).length===0){fluid.main.fire("incrementalsSynced",h)}},save:function(){var d=fluid.main.account.id+"_"+B();fluid.main.fire("dbStorage.set","incrementalQueue",{id:d,data:JSON.stringify(b.incrementalsObject)})},check:function(){var d=5*60*1000;p.each(b.incrementalsObject,function(f){if(f.timestamp+d<new Date().getTime()){b.incrementals.cleanMeUp(f.projectId);b.incrementals.fullSync(f.projectId)}})},fullSync:function(j){if(fluid.main.projects.get(j)&&!fluid.main.projects.get(j).get("unloaded")){var f=fluid.main.projects.get(j).bundle();if(f&&f.hasOwnProperty("unloaded")&&f.unloaded){return}var i=true;if(fluid.main.account&&fluid.main.account.isAnonymous()){i=false}if(i&&fluid.main.projects&&fluid.main.projects.get(j).get("mode")==="comment"){i=false}if(!i){return}var h=b.genUuid();b.incrementals.add(h,j,true);b._callIncremental("projectSync",{objectId:j,uuid:h,crc:C.getProjectCrc(f),data:JSON.parse(JSON.stringify(f))},b._RETRY,b._NO_LOCK,function(n){var o=JSON.parse(n);if(fluid.main.projects.get(j)&&o.r==="s"){fluid.main.projects.get(j).set("synced",true)}var m=o.lastSync;window["lastSync_"+j]=m;localStorage.setItem("lastSync_"+j,m);l.apply(this,arguments)},k)}else{var d=j;fluid.api.syncDown(d,false,false,function(n){var o=JSON.parse(n);var J=o.t;if(J.length){J=J[0].replace(/[\r\n]/g,"\\n")}var M;try{M=JSON.parse(J)}catch(K){}if(!M){return}var m=fluid.main.projects.get(d);var N=fluid.main.projects.indexOf(m);M[d].unloaded=false;M[d].removed=false;M[d].uniqueUploads=Object.keys(M.uploads);var L=new fluid.models.Project(M,{parse:true,projectId:d});fluid.main.projects.remove(m);fluid.main.projects.add(L,{at:N})},k,true)}function l(){}function k(){}},init:function(){return new Promise(function(f,h){if(window.g_preview){f()}var d=fluid.main.account.id+"_"+B();q.get("incrementalQueue",[d]).then(function(j){if(j&&j.resultsObj&&j.resultsObj[d]){try{b.incrementalsObject=JSON.parse(j.resultsObj[d].data);f();i()}catch(k){h()}}else{f();i()}},function(){});function i(){if(Object.keys(b.incrementalsObject).length){b.incrementals.fullSync(Object.keys(b.incrementalsObject)[0])}setInterval(b.incrementals.check,15*1000)}})}}});b.setLogoutHandler=function(d){b._logoutHandler=d};b.getNoLoginParams=function(){var h=window.location.pathname.split("/"),f=h.indexOf("comment");if(f!==-1){var i=atob(h[f+1]);var d={initAction:"comment",projectId:i};return d}else{return false}};b.accountSettingsSync=function(d,h,f){b._call("accountSettingsSync",{data:d},b._RETRY,b._LOCK,h,f)};b.checkSession=function(d){$.ajax({url:"index.php",data:b._prepareBlock("serverStatus"),type:"POST",timeout:b._timeoutServerStatus*1000}).done(d).error(d)};b.accountStateInit=function(f,d){b._call("accountStateInit",{objectId:fluid.main.account.id,publicAccess:b.getNoLoginParams()?true:false,data:{instanceId:B(),api_version_date:api_version_date,projectCrc:fluid.main.project&&C.getCurrentProjectCrc()},projectId:fluid.main.project&&fluid.main.project.id||fluid.main.account.get("lastOpenProject")},b._RETRY,b._LOCK,f,d)};b.accountState=function(f,d){b._call("accountState",{objectId:fluid.main.account.id,publicAccess:b.getNoLoginParams()?true:false,data:{instanceId:B(),api_version_date:api_version_date},projectId:fluid.main.project&&fluid.main.project.id||fluid.main.account.get("lastOpenProject")},b._RETRY,b._LOCK,f,d)};b.changeBilling=function(d,h,f){b._call("changeBilling",{data:d},b._RETRY,b._LOCK,h,f)};b.changeEmail=function(f,d,i,h){b._call("changeEmail",{data:{info:f,validation:d}},b._RETRY,b._LOCK,i,h)};b.changePass=function(f,d,i,h){b._call("changePass",{data:{old:f,"new":d}},b._RETRY,b._LOCK,i,h)};b.genUuid=function c(){function d(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return d()+d()+d()+d()+d()+d()+d()+d()+d()+d()+d()+d()+d()+d()+d()+d()};b.sendIncremental=function(j,F,k,m,h,f){var d=j.projectId;if(!d){throw"no projectId in incremental context"}var n=true;if(fluid.main.account&&fluid.main.account.isAnonymous()){n=false}if(n&&fluid.main.projects&&fluid.main.projects.get(d).get("mode")==="comment"){n=false}if(!n){if(F!=="fluid.controllers.comment"){console.log("Command not allowed: "+F);return m()}}var i=fluid.main.projects.get(d).bundle();var l=v.diff(fluid.main.projects.get(d)._lastBundle,i);if(l===undefined){return m()}var o={crc:f,uuid:b.genUuid(),patch:l};b.incrementals.add(o.uuid,d);o[F]={name:j.name,context:j.context,executor:k};b._callIncremental("syncProjectIncremental",JSON.parse(JSON.stringify([o])),b._RETRY,b._NO_LOCK,m,h)};b.contact=function(d,h,f,j,i){b._call("contact",{data:{from:d,subject:h,message:f}},b._RETRY,b._LOCK,j,i)};b.setMaster=function(d){b._call("setMaster",{publicAccess:b.getNoLoginParams()?true:false},b._RETRY,b._LOCK,d,d,true)};b.create=function(h,m,d,f,l,j,k,i){b._call("create",{signUp:true,tandc:l,email:h,password1:m,password2:d,instanceId:B(),strict:j},b._RETRY,b._LOCK,function(){b.lock=false;k.apply(this,arguments)},i,true)};b.login=function(f,h,l,d,j,k,i){b._call("login",{signIn:true,tandc:d,email:f,password1:h,instanceId:B(),strict:j},b._RETRY,b._LOCK,function(){b.lock=false;k.apply(this,arguments)},i,true)};b.emailRegd=function(d,h,f){b._call("emailRegd",{data:{email:d}},b._RETRY,b._LOCK,h,f)};b.getPayments=function(f,d){b._call("getPayments",{},b._RETRY,b._LOCK,f,d)};b.getLibrariesWhitelist=function(f,d){b._call("getLibrariesWhitelist",{},b._RETRY,b._LOCK,f,d)};b.imageSync=function(h,d,i,f){b._call("imageSync",{objectId:h,data:d},b._RETRY,b._NO_LOCK,i,f)};b.importUserPackage=function(d,h,f){b._call("importUserPackage",{},b._RETRY,b._LOCK,h,f)};b.libSync=function(h,d,i,f){b._call("libSync",{objectId:h,data:d},b._RETRY,b._NO_LOCK,i,f)};b.listProjects=function(d,h,f){b._call("listProjects",{data:{userId:d}},b._RETRY,b._LOCK,h,f)};b.updateCard=function(d,h,f){b._call("updateCard",d,b._RETRY,b._LOCK,h,f)};b.previewMail=function(d,f,i,h){b._call("previewMail",{email:d,p:f},b._RETRY,b._LOCK,i,h)};b.projectDuplicate=function(d,h,i,f){b._call("projectDuplicate",{data:{newName:h,projectId:d}},b._RETRY,b._LOCK,i,f)};b.projectSync=function(h,d,i,f){if(i){i()}return};b.serverStatus=function(d){$.ajax({url:"index.php",data:b._prepareBlock("serverStatus",{publicAccess:b.getNoLoginParams()?true:false}),type:"POST",timeout:b._timeoutServerStatus*1000}).done(function(i){var f;try{f=JSON.parse(i)}catch(h){d(false)}if(f&&f.r==="x"){if(fluid.main.account.get("loggedIn")==="yes"){b.accountState(function(k,j){fluid.main.fire("accountValidatedSuccess",k,j)},function(){fluid.main.fire("accountValidatedFailure",d)})}else{d(true)}}else{if(f&&f.r==="s"){d(true)}else{d(false)}}}).error(function(f){if(f&&f.status===400){if(fluid.main.account.get("loggedIn")==="yes"){b.accountState(function(h,i){fluid.main.fire("accountValidatedSuccess",h,i)},function(){fluid.main.fire("accountValidatedFailure",d)})}else{d(true)}}else{d(false)}})};b.onlineCallbacks=[];b.ensureServerOK=function(k,j,d){if(d){i()}else{if(!j){b.onlineCallbacks.push(k)}var f=b.onlineCallbacks.length;b.serverStatus(function(m){if(m){fluid.main.fire("connectionProblemOff");b._serverStatusInterval=b._originalServerStatusInterval;for(var l=0;l<b.onlineCallbacks.length;l++){if($.isFunction(b.onlineCallbacks[l])){b.onlineCallbacks[l]()}}b.onlineCallbacks=[]}else{if(f===1){if(!j){fluid.main.fire("connectionProblem",{nextCheckIn:b._serverStatusInterval})}else{b._serverStatusInterval+=20;fluid.main.fire("startCountdown");fluid.main.fire("updateCountdown",b._serverStatusInterval)}}else{if(j){b._serverStatusInterval+=20}fluid.main.fire("startCountdown");fluid.main.fire("updateCountdown",b._serverStatusInterval)}}})}function h(){setTimeout(b.ensureServerOK.bind(this,k,true),1000)}function i(){h()}};b.shareProjectWithUser=function(d,h,f){b._call("shareProjectWithUser",d,b._RETRY,b._LOCK,function(i){h(JSON.parse(i))},f)};b.unshareProjectWithUser=function(d,h,f){b._call("unshareProjectWithUser",d,b._RETRY,b._LOCK,h,f)};b.listSharedProjectWithUsers=function(d,h,f){b._call("listSharedProjectWithUsers",{pid:d},b._RETRY,b._LOCK,h,f)};b.projectTransfer=function(f,d,i,h){b._call("projectTransfer",{data:{projectId:f,emails:d}},b._RETRY,b._LOCK,i,h)};b.projectVersionList=function(d,h,f){b._call("projectVersionList",{data:{projectId:d}},b._RETRY,b._LOCK,h,f)};b.projectVersionRestore=function(d,f,i,j,h){b._call("projectVersionRestore",{data:{projectId:d,projectDate:f,createNew:i}},b._RETRY,b._LOCK,j,h)};b.remove=function(f,h,d){b._call("remove",{objectId:f},b._RETRY,b._LOCK,h,d)};b.removeAccount=function(f,h,d){b._call("removeAccount",{},b._RETRY,b._LOCK,h,d)};b.requestDiscountCoupon=function(f,h,d){b._call("requestDiscountCoupon",{},b._RETRY,b._LOCK,h,d)};b.restore=function(f,h,d){b._call("restore",{objectId:f},b._RETRY,b._LOCK,h,d)};b.shareLog=function(h,d,i,f){b._call("shareLog",{data:{objectId:h,target:d}},b._RETRY,b._LOCK,i,f)};b.syncDown=function(h,i,d,j,f,k){if(d){b._call("syncDown",{objectId:h,multiple:i,unloaded:d,publicAccess:b.getNoLoginParams()?true:false},b._RETRY,b._LOCK,j,f,k)}else{b._call("syncDown",{objectId:h,multiple:i,publicAccess:b.getNoLoginParams()?true:false},b._RETRY,b._LOCK,j,f,k)}};if(s){b.syncDown=function(d){w(d+".flui","js")}}b.uploadExportForSafari=function(d,h,f){b._call("uploadExportForSafari",{},b._RETRY,b._LOCK,h,f)};b.validatePass=function(d,h,f){b._call("validatePass",{info:d},b._RETRY,b._LOCK,h,f)};b.verifyDiscountCoupon=function(d,h,f){b._call("verifyDiscountCoupon",{code:d},b._RETRY,b._LOCK,h,f)};b.listProjectsExtended=function(f,i,h){b._call("listProjectsExtended",{data:{userId:f}},b._RETRY,b._LOCK,function d(j){try{j=JSON.parse(j);j.t=JSON.parse(j.t);if(j.t.length){fluid.main.fire("projectListFetched",j.t);i(j)}else{h({r:"f"})}}catch(k){h({r:"f"})}},h)};b.getTeam=function(f,d){b._call("getTeammates",{},b._RETRY,b._LOCK,f,d)};b.addTeammate=function(d,h,f){b._call("addTeammate",{email:d},b._RETRY,b._LOCK,h,f)};b.removeTeammate=function(d,h,f){b._call("removeTeammate",{email:d},b._RETRY,b._LOCK,h,f)};b._callIncremental=function(f,l,j,h,k,i){var m=b._queueIncremental.length;if(f==="projectSync"){b._queueIncremental.push({type:f,data:l,retry:((j!==undefined)&&($.type(j)==="boolean"))?j:false,successCallback:((k!==undefined)&&($.isFunction(k)))?k:null,errorCallback:((i!==undefined)&&($.isFunction(i)))?i:null,_retries:0,_started:0,_finished:false,_ajax:null})}else{var d;p.each(b._queueIncremental,function(n,o){if(n.type==="syncProjectIncremental"){d=o}});if(("fluid.controllers.project" in l[0])&&l[0]["fluid.controllers.project"]&&l[0]["fluid.controllers.project"].context.projectId){l[0].projectId=l[0]["fluid.controllers.project"].context.projectId}else{l[0].projectId=fluid.main.project.id}if(m===0||d===undefined||b._queueIncremental[d]._ajax){b._queueIncremental.push({type:f,data:{iid:B(),t:"syncProjectIncremental",projectId:fluid.main.project?fluid.main.project.id:l[0]["fluid.controllers.project"].context.projectId,publicAccess:b.getNoLoginParams()?true:false,incrementals:l},retry:((j!==undefined)&&($.type(j)==="boolean"))?j:false,successCallback:((k!==undefined)&&($.isFunction(k)))?k:null,errorCallback:((i!==undefined)&&($.isFunction(i)))?i:null,_retries:0,_started:0,_finished:false,_ajax:null})}else{b._queueIncremental[d].data.incrementals=b._queueIncremental[d].data.incrementals.concat(l)}}if(b._processIncrementalTimeout===null){b.processIncremental()}};b._call=function(l,d,j,f,k,i,m){var h=((f!==undefined)&&($.type(f)==="boolean"))?f:false;if(h){b._queueShort.push({type:l,data:d,retry:((j!==undefined)&&($.type(j)==="boolean"))?j:false,successCallback:((k!==undefined)&&($.isFunction(k)))?k:null,errorCallback:((i!==undefined)&&($.isFunction(i)))?i:null,_retries:0,_started:0,_finished:false,_ajax:null});if(m){b._processShort(b._queueShort.length-1)}}else{b._queueLong.push({type:l,data:d,retry:((j!==undefined)&&($.type(j)==="boolean"))?j:false,successCallback:((k!==undefined)&&($.isFunction(k)))?k:null,errorCallback:((i!==undefined)&&($.isFunction(i)))?i:null,_retries:0,_started:0,_finished:false,_ajax:null});if(m){b._processLong(b._queueLong.length-1)}}if(b._process===null){b.process()}};b.time=function(){return Math.floor(Date.now()/1000)};b._prepareBlock=function(i,h){var f={},d;for(d in h){if(h.hasOwnProperty(d)){f[d]=h[d]}}if(f.data&&typeof(f.data)!=="string"){f.data=JSON.stringify(f.data)}f.t=i;f.iid=B();return f};b.incrementalsApplied=function(d){if(!p.isArray(d)){d=[d]}d.forEach(function(f){b.incrementals.remove(f)})};b._delIncremental=function(d){var f=b._queueIncremental.indexOf(d);if(f===-1){return}b._queueIncremental.splice(f,1)};b._delShort=function(d){var f=b._queueShort.indexOf(d);if(f===-1){return}b._queueShort.splice(f,1)};b._delLong=function(d){var f=b._queueLong.indexOf(d);if(f===-1){return}b._queueLong.splice(f,1)};b._processIncremental=function(f){if(b._queueIncremental[f]._retries>b._maxRetryCount){if(b._logoutHandler){return b._logoutHandler()}}var h;if(b._queueIncremental[f].type==="projectSync"){h=b._prepareBlock(b._queueIncremental[f].type,b._queueIncremental[f].data)}else{h=b._queueIncremental[f].data;if(h.incrementals&&typeof h.incrementals!=="string"){h.incrementals=JSON.stringify(h.incrementals)}}var i=false;var d=setTimeout(function(){i=true;b.ensureServerOK($.noop)},b._serverCheckAfter*1000);b._queueIncremental[f]._ajax=$.ajax({url:"index.php",data:h,type:"POST",timeout:b._timeoutShort*1000});b._queueIncremental[f]._ajax.error(b._errorHandler.bind(this,b._queueIncremental[f],b._processIncremental,b._queueIncremental,b._delIncremental,d,i));b._queueIncremental[f]._ajax.success(b._successHandler.bind(this,b._queueIncremental[f],b._processIncremental,b._queueIncremental,b._delIncremental,d))};b._processLong=function(f){if(b._queueLong[f]._retries>b._maxRetryCount){if(b._logoutHandler){return b._logoutHandler()}}var h=b._prepareBlock(b._queueLong[f].type,b._queueLong[f].data);var i=false;var d=setTimeout(function(){i=true;b.ensureServerOK($.noop)},b._serverCheckAfter*1000);b._queueLong[f]._ajax=$.ajax({url:"index.php",data:h,type:"POST",timeout:b._timeoutLong*1000});b._queueLong[f]._ajax.error(b._errorHandler.bind(this,b._queueLong[f],b._processLong,b._queueLong,b._delLong,d,i));b._queueLong[f]._ajax.success(b._successHandler.bind(this,b._queueLong[f],b._processLong,b._queueLong,b._delLong,d))};b._successHandler=function(I,H,h,o,i,j,n){var J=fluid.main&&fluid.main.project&&fluid.main.project.id;clearTimeout(i);var d=JSON.parse(j),m={};if(d.mode){m.mode=d.mode}if(!fluid.main.account&&d.t==="notMaster"){b.lock=true;return b.setMaster(function(){b.lock=false})}if(d.t==="notMaster"&&(fluid.main.account.get("loggedIn")==="yes")){var k=false;var f;b.lock=true;if(d.lastSync&&!J&&fluid.main.account.get("loggedIn")==="yes"){fluid.main.fire("showNotificationAboutConnectionLost")}else{if(J&&d.lastSync){f=parseInt(window["lastSync_"+J]||localStorage.getItem("lastSync_"+J)||0,10)}}if(fluid.main.projects.get(J)){f=fluid.main.projects.get(J).get("updated")}if(f&&d.lastSync&&f<d.lastSync){}k=true;if(k){fluid.main.fire("setMasterPromptNeeded",true,function l(){fluid.api.setMaster(function(){b.lock=false;fluid.main.fire("showNotificationAboutUpdatingProject");var E=false;var F=false;if(h.indexOf(I)!==-1){H(h.indexOf(I))}setTimeout(function(){E=true;if(F){fluid.main.fire("hideLock")}},1000);a(function(G){if(E||G){fluid.main.fire("hideLock")}else{F=true}})})})}else{fluid.main.fire("setMasterPromptNeeded",false,function(){fluid.api.setMaster(function(){b.lock=false;fluid.main.fire("hideLock");if(h.indexOf(I)!==-1){H(h.indexOf(I))}})})}}else{if(I.successCallback!==null){I.successCallback(j,n,m)}o(I);fluid.main.fire("apicallsuccess",I.type)}};b._errorHandler=function(h,d,k,i,l,j){clearTimeout(l);if(!j){b.ensureServerOK(f)}else{f()}function f(){if(h.retry){if(h._retries<b._maxRetryCount){h._retries++;d(k.indexOf(h))}else{if(h.errorCallback!==null){h.errorCallback()}i(h);fluid.main.fire("showNotificationAboutConnectionLost")}}}};b._processShort=function(f){if(b._queueShort[f]._retries>b._maxRetryCount){if(b._logoutHandler){return b._logoutHandler()}}var h=b._prepareBlock(b._queueShort[f].type,b._queueShort[f].data);var i=false;var d=setTimeout(function(){i=true;b.ensureServerOK($.noop)},b._serverCheckAfter*1000);b._queueShort[f]._ajax=$.ajax({url:"index.php",data:h,type:"POST",timeout:b._timeoutShort*1000});b._queueShort[f]._ajax.error(b._errorHandler.bind(this,b._queueShort[f],b._processShort,b._queueShort,b._delShort,d,i));b._queueShort[f]._ajax.success(b._successHandler.bind(this,b._queueShort[f],b._processShort,b._queueShort,b._delShort,d))};function a(d){var f=fluid.main.project.id;fluid.api.syncDown(f,false,false,function(n){var h=JSON.parse(n);var m=h.t;if(m.length){m=m[0].replace(/[\r\n]/g,"\\n")}else{m=m.replace(/[\r\n]/g,"\\n")}var j=JSON.parse(m);var l=fluid.main.projects.get(f);var k=fluid.main.projects.indexOf(l);j[f].unloaded=false;j[f].removed=false;j[f].uniqueUploads=Object.keys(j.uploads);var i=new fluid.models.Project(j,{parse:true,projectId:f,mode:h.mode});fluid.main.setMainProject(i);fluid.main.projects.remove(l);fluid.main.projects.add(i,{at:k});if(i.get("active")===false){i.close();d(true);fluid.main.fire("updatedProjectIsNowArchived")}else{fluid.command.create("open",{id:f,onLoad:function(){fluid.zoom.zoomToAllPages();d()}}).dispatchTo("fluid.controllers.project")}},d,true)}b.processIncremental=function(){if(b.lock){return b._processIncrementalTimeout=setTimeout(b.processIncremental,b._interval)}b.processingIncremental=true;if(b._queueIncremental.length>0){if((b._queueIncremental[0]._ajax===null)){b._processIncremental(0)}else{if(b._queueIncremental[0]._ajax.responseText){var d;try{d=JSON.parse(b._queueIncremental[0]._ajax.responseText)}catch(f){}if(d&&d.t==="notMaster"){b._queueIncremental[0]._ajax=null;b._processIncremental(0)}}}}else{b.processingIncremental=false}b._processIncrementalTimeout=setTimeout(b.processIncremental,b._interval)};b.process=function(){if(b.lock){return b._process=setTimeout(b.process,b._interval)}b.processing=true;if(b._queueShort.length>0){if((b._queueShort[0]._ajax===null)){b._processShort(0)}else{if(b._queueShort[0]._ajax.responseText){var d;try{d=JSON.parse(b._queueShort[0]._ajax.responseText)}catch(f){}if(d&&d.t==="notMaster"){b._queueShort[0]._ajax=null;b._processShort(0)}}}}else{if(b._queueLong.length>0){for(var h in b._queueLong){if(b._queueLong[h]._ajax===null){b._processLong(h)}}}else{b.processing=false}}b._process=setTimeout(b.process,b._interval)};b.init=function(d){p.each(d,function(f,h){b[h]=f});b.process()};fluid.main.on("lockApiHandlerForUpdatingProject",function(i,d){b.lock=true;var f=false;if(fluid.main.project){f=true}fluid.main.fire("setMasterPromptNeeded",f,function h(){fluid.api.setMaster(function(){b.lock=false;if(!f){return fluid.main.fire("hideLock")}fluid.main.fire("showNotificationAboutUpdatingProject");var k=false;var j=false;setTimeout(function(){k=true;if(j){fluid.main.fire("hideLock")}},1000);a(function(l){if(k||l){fluid.main.fire("hideLock")}else{j=true}})})})});fluid.main.on("listallapiqueues",function(){console.log("short: ",b._queueShort);console.log("long: ",b._queueLong)});fluid.main.on("serverStatus:forceCheck",function(){b.ensureServerOK($.noop,true,true)});b.debounceWithLimit=function(m,i,n,l){var d,f,F,h,o,j=new Date().getTime();var k=function(){var E=new Date().getTime()-h;if(E<i&&E>=0&&h-j<=l){d=setTimeout(k,i-E)}else{j=new Date().getTime();d=null;if(!n){o=m.apply(F,f);if(!d){F=f=null}}}};return function(){F=this;f=arguments;h=new Date().getTime();var E=n&&!d;if(!d){d=setTimeout(k,i)}if(E){o=m.apply(F,f);F=f=null}return o}};fluid.main.on("apiRequestSnapshot",function(){var d=arguments[1];var h=d.projectId;if(fluid.main.projects.get(h)&&!fluid.main.projects.get(h).get("unloaded")){var f=fluid.main.projects.get(h).bundle(h);if(f&&f.hasOwnProperty("unloaded")&&f.unloaded){return}fluid.main.projects.get(h)._lastBundle=f}});fluid.main.on("apiRequest",function(){var d=arguments[1];var f=Array.prototype.slice.call(arguments,2);fluid.api[d].apply(this,f)});fluid.main.on("apiFullSync",function(f,d){fluid.api.incrementals.fullSync(d)});fluid.event.mixinTo(b)})},{"../../checkHost":25,"../../class-dbStorage":29,"../../class-storage":46,"../../instanceIdUtil":94,"../../reloader":97,"../../utils-editor":98,"../fluid.module":70,"../lib/underscore":72,"./crcCheck":89,jsondiffpatch:20}],87:[function(k,r,l){var o=k("buffer");var p=k("./define_crc");var q=m(p);function m(a){return a&&a.__esModule?a:{"default":a}}var n=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];if(typeof Int32Array!=="undefined"){n=new Int32Array(n)}r.exports=(0,q.def)("crc-32",function(b,f){if(!o.Buffer.isBuffer(b)){b=(0,o.Buffer)(b)}var d=f===0?0:~~f^-1;for(var c=0;c<b.length;c++){var a=b[c];d=n[(d^a)&255]^d>>>8}return d^-1})},{"./define_crc":88,buffer:2}],88:[function(d,h,f){Object.defineProperty(f,"__esModule",{value:true});f.def=function(b,c){var a=function a(l,k){return c(l,k)>>>0};a.signed=c;a.unsigned=a;a.model=b;return a}},{}],89:[function(s,v,r){var t=s("./crc/crc32");var q=["created","updated","canvasWidth","canvasHeight","stored","saved","unloaded","preview"];var p;function n(a){return Object.keys(a).sort()}function m(){var a;if(fluid&&fluid.main&&fluid.main.project){a=fluid.main.project.bundle();q.forEach(function(b){delete a[fluid.main.project.id][b]})}return a}function u(a){if(a===undefined||a===null){return}var d=n(a);var f,c;for(var h=0;h<d.length;h++){c=a[d[h]];f=typeof c;if(f==="number"||f==="string"||f==="boolean"){p=t(c.toString(),p)}else{if(_.isArray(c)){for(var b=0;b<c.length;b++){if(c[b]){p=t(c[b].toString(),p)}}}else{u(c)}}}}var o={getCurrentProjectCrc:function(){var a=m();return o.getProjectCrc(a)},getProjectCrc:function(a){p=t("start");u(a);return p.toString(16)}};v.exports=o},{"./crc/crc32":87}],90:[function(n,l,j){var m=n("../fluid.module");var i=n("../lib/underscore");var k=n("../../class-storage");m.define("fluid.upload",function(a){a.priority={};a.priority.lib=7;a.priority.defaultVal=5;a.priority.pageZoomedOut=3;a.priority.pageZoomedIn=1;var c=6;var f=[];var h=[];var b=document.createElement("canvas"),d=b.getContext("2d");a.get=function(A){if(!A||!A.id){if(!A.callback){return false}else{A.callback({success:false})}}if(!A.priority){A.priority=a.priority.defaultVal}if(A.priority===a.priority.lib){fluid.main.fire("dbStorage.get","uploadThumbs",A.id,function(p,o){if(o.fetched.length){a.onIndexedDBLoad(p,o)}else{fluid.main.fire("dbStorage.onReady","uploads",p.id,a.onIndexedDBLoad.bind(this,p))}}.bind(this,A))}else{var D=k.get(A.id,{returnModel:true});if(D&&D.get("imgData")){if(A.image){var w=atob(D.get("imgData").split(";base64,")[1]);var v=new Array(w.length);for(var z=0;z<w.length;z++){v[z]=w.charCodeAt(z)}var C=new Uint8Array(v);var B=new Blob([C],{type:"image/png"});A.image.src=URL.createObjectURL(B)}else{A.callback({success:true,id:A.id,priority:A.priority,imgData:D.get("imgData")})}}else{fluid.main.fire("dbStorage.get","uploads",A.id,a.onIndexedDBLoad.bind(this,A))}}};a.onIndexedDBLoad=function(v,u){if(u.fetched.length){if(!v.image){v.callback({success:true,id:v.id,priority:v.priority,imgData:u.resultsObj[v.id].data})}else{v.image.onload=function(){v.callback({success:true,id:v.id,priority:v.priority,imgData:u.resultsObj[v.id].data,image:this})};v.image.src=u.resultsObj[v.id].data}}else{var t=i.findWhere(f,{id:v.id}),s=i.findWhere(h,{id:v.id});if(s){s.callback.push(v.callback)}else{if(t){t.callback.push(v.callback);t.priority=Math.min(t.priority,v.priority)}else{f.push({id:v.id,callback:[v.callback],priority:v.priority,image:v.image||null})}}a.startQueue()}};a.startQueue=function(){if(h.length<c&&f.length){f=i.sortBy(f,"priority");var s;var t;var r;while(h.length<c&&f.length){r=f.shift();h.push(r);s=h[h.length-1].image||(new Image());t=k.get(r.id);s.onload=a.onImageLoad.bind(s,r.id);s.onerror=a.onImageError.bind(s,r.id);if(t.storage==="db"){s.src="data/img/"+r.id;h[h.length-1].image=s}else{if(r.id||widgets.summary[r.id]){s.crossOrigin="Anonymous";s.src=imgCloudUrl+(r.id||widgets.summary[r.id].data)+".png";if(!t||!t.storage){h[h.length-1].retryDbLoad=true}h[h.length-1].image=s}else{h[h.length-1].image=s;a.onImageError.call(s,r.id)}}}}};a.removeLoadingItem=function(p){h=i.filter(h,function(o){if(o.id===p){return false}else{return true}})};a.onImageLoad=function(t,z){var u=i.findWhere(h,{id:t});if(u.priority===a.priority.lib){b.height=50;b.width=50;d.fillStyle="#cccccc";d.fillRect(0,0,50,50);if(this.width===0&&this.height===0){d.drawImage(this,0,0)}else{if(this.width<=50&&this.height<=50){d.drawImage(this,25-this.width/2,25-this.height/2-Math.max((34-this.height)/2,0))}else{if(this.width<this.height){d.drawImage(this,0,0,50*this.width/this.height,50)}else{d.drawImage(this,0,0,50,50*this.height/this.width)}}}}else{b.height=this.naturalHeight;b.width=this.naturalWidth;d.clearRect(0,0,this.naturalWidth,this.naturalHeight);d.drawImage(this,0,0)}var v=b.toDataURL("image/png");if(u.callback.length){for(var w=0;w<u.callback.length;w++){u.callback[w]({success:true,image:this,imgData:v,id:u.id})}}if(u.priority===a.priority.lib){fluid.main.fire("dbStorage.set","uploadThumbs",{id:u.id,data:v},function(o){a.removeLoadingItem(t);a.startQueue()})}else{fluid.main.fire("dbStorage.set","uploads",{id:u.id,data:v},function(o){a.removeLoadingItem(t);a.startQueue()})}};a.onImageError=function(s,v){var t=i.findWhere(h,{id:s});if(t.retryDbLoad){t.retryDbLoad=false;t.image.src="data/img/"+t.id;return}a.removeLoadingItem(s);if(t.callback.length){for(var u=0;u<t.callback.length;u++){t.callback[u]({success:false,image:this,id:t.id})}}};fluid.event.mixinTo(a)})},{"../../class-storage":46,"../fluid.module":70,"../lib/underscore":72}],91:[function(C,E,A){var v=C("./class-widget");var D=C("./utils-editor");var t=C("./class-preview");var w=C("./class-userSettings");var G=C("./class-grid");var r=C("./class-propertyInspectorController");E.exports.updateTLWH=function(){if(!fluid.selection){return}var a=fluid.selection.getSelectionModel().getBox({returnMode:"tlwhObj"});$("#TLindicatorX").text(parseInt(a.left));$("#TLindicatorY").text(parseInt(a.top));$("#WHindicatorX").text(parseInt(a.width));$("#WHindicatorY").text(parseInt(a.height));v._selectionTLWH={width:a.width,height:a.height,top:a.top,left:a.left};v._selectionBoxCoord={top:a.top,left:a.left}};E.exports.showPostLoadMessage=function(){if(!localStorage){return}var a=localStorage.getItem("postloadMessage");var b={tab:"Project updated. Please close other tabs or windows where the project may be open.",serverRefresh:"A newer version of a project has been found. Updated.",serverLogout:"This account appears to be open elsewhere and has been logged out to protect your changes.",loginAgain:'Something went wrong. Please <span class="inlineLink open-fluid-menu close">sign in</span> again.',panicRefresh:"Something went wrong. Application has been reloaded.",updateLogout:"Welcome back. We've made some changes since you've last been here &ndash; please <span class=\"inlineLink open-fluid-menu close\">sign in</span> again to get the latest version.",loginSyncFailed:'Application failed to sign in and sync all user data properly. Try to <span class="inlineLink open-fluid-menu close">sign in</span> again.'};if(b[a]){if(a==="serverLogout"){fluid.main.fire("addNotification","alert",b[a])}else{fluid.main.fire("addNotification","alert",b[a],{permanent:true})}}localStorage.removeItem("postloadMessage")};E.exports.cmLink2Helper=function(a){var b=$(this).data("clickDragHelper");return b||$("#tmplDragHelper").tmpl()};E.exports.setFocus=function(a){a.bounce().focus()};E.exports.keyD=function(j){var o=navigator.platform.match("Mac")?j.metaKey:j.ctrlKey;if(j.ctrlKey&&j.altKey&&j.shiftKey&&j.keyCode==48){$("#console").toggle();j.preventDefault();j.stopImmediatePropagation();return}if($("#lock-overlay, .createFormBody").is(":visible")){return}if(o&&fluid.selection.getSelectionModel().length){if([66,73,85].indexOf(j.keyCode)>-1){var S=fluid.selection.getSelectionModel().getTextWidgets(),q=S.getElements().last(),i=fluid.controllers.widget.propMap.textPropMap,m={66:"textBold",73:"textItalics",85:"textUnderline"}[j.keyCode],h=i[m],V=r.widgetTextPropGet(h,q),R=(V==h.active)?h.inactive:h.active;r._exportProps(m,R);if(/^(input|textarea)$/i.test(j.target.nodeName)){$(j.target).css(h.property,R)}j.preventDefault();return}}if(o&&j.keyCode==83){j.preventDefault();fluid.main.fire("addNotification","alert","Saving project...");fluid.main.fire("needprojectsync",function(){fluid.main.project.synced=true;fluid.main.fire("notification:removeAll","alert");fluid.main.fire("addNotification","alert","Project saved.",{duration:2000})})}if(!o&&!j.altKey&&!w.isOpen&&j.target.tagName.toLowerCase()!=="textarea"&&j.target.tagName.toLowerCase()!=="input"){if(j.keyCode==80){if(fluid.main.project.widgets.length===0){return}fluid.viewMgr.setView({viewName:"projectPreview"})}if(j.keyCode==69){fluid.viewMgr.setView({viewName:"projectEditing"})}if(j.keyCode==76){fluid.main.fire("lib:toggle")}if(j.keyCode==67){var a=fluid.viewMgr.getView().viewName;if(a!=="projectCommenting"){if(!fluid.main.project||fluid.main.project.pages.length===0){return}else{fluid.viewMgr.setView({viewName:"projectCommenting"})}}}if(fluid.zoom.getCtx()!=="project"&&fluid.viewMgr.viewIs("projectEditing")){if(j.keyCode==71){fluid.viewMgr.getView().handleGridChange()}}}if(o&&j.keyCode==65&&fluid.viewMgr.viewIs("projectEditing")){D.selectText("control+a");if(fluid.zoom.getCtx()!=="project"){var W=$(".screen.active").attr("id");fluid.selection.select(fluid.main.project.widgets.getRoots().filter(function(I){return I.get("pageId")===W&&!I.get("locked")}))}return true}if(o&&j.keyCode==71&&!j.shiftKey&&fluid.viewMgr.viewIs("projectEditing")){j.preventDefault();if(!$("#canvas").hasClass("zoomedOut")){var n=fluid.selection.getSelectedIds();var W=fluid.zoom.getActivePageId();if(fluid.main.project.wdgGroups.getCommonGroup(n)){fluid.command.create("ungroupWidgets",{ids:n,pageId:W}).dispatchTo("fluid.controllers.widget")}else{if(n&&n.length>=2&&W){fluid.command.create("groupWidgets",{ids:n,pageId:W}).dispatchTo("fluid.controllers.widget")}}}return true}if(o&&j.keyCode==71&&j.shiftKey&&fluid.viewMgr.viewIs("projectEditing")){j.preventDefault();if(!$("#canvas").hasClass("zoomedOut")){var n=fluid.selection.getSelectedIds();var W=fluid.zoom.getActivePageId();if(n&&n.length>=2&&W){fluid.command.create("ungroupWidgets",{ids:n,pageId:W}).dispatchTo("fluid.controllers.widget")}}return true}if(j.keyCode===27){if(!fluid.main.fire("escpressed",j)){return}}if(o&&j.keyCode==13){if(fluid.zoom.getCtx()==="widget"){fluid.zoom.zoomOut()}}if(j.keyCode==13){fluid.main.fire("projectSettings: keydown",j)}if(j.keyCode>=37&&j.keyCode<=40&&fluid.viewMgr.viewIs("projectEditing")){if(fluid.main.project){if(o){var T=j.keyCode==37,U=j.keyCode==38,b=j.keyCode==39,f=j.keyCode==40,c=j.shiftKey,X={left:(T&&!c&&-1)||(b&&c&&1)||0,top:(U&&!c&&-1)||(f&&c&&1)||0,right:(b&&!c&&1)||(T&&c&&-1)||0,bottom:(f&&!c&&1)||(U&&c&&-1)||0};v.resizeBy(X)}else{v.nudge(j)}fluid.main.fire("cm:place");return false}}else{if((j.keyCode==46||j.keyCode==8)&&j.target.tagName!=="INPUT"&&j.target.tagName!=="TEXTAREA"){if(j.keyCode==8){$(".userSettingsDone:visible").click()}if(fluid.viewMgr.viewIs("projectEditing")){u(j.keyCode)}return false}else{if(o){var p=$("#multiSelBox");if(p.is(":visible")){$("#canvasPages .backgroundWidget").css("z-index",-2);p.css("z-index",-1)}var d,Q=true;if(j.target.tagName==="TEXTAREA"){return}if(fluid.viewMgr.viewIs("projectEditing")){switch(j.keyCode){case 67:d="copy";Q=false;break;case 68:d="clone";break;case 86:d="paste";break;case 88:d="cut";break;case 89:fluid.command.history.redo();break;case 80:fluid.command.history.redo();break;case 90:if(j.shiftKey){fluid.command.history.redo()}else{fluid.command.history.undo()}break;default:return true}if(d&&fluid.zoom.getCtx()!=="project"){var k={pageId:$("#canvasPages .active").attr("id"),lockTosIds:fluid.selection.getSelectionModel().getLockTos().getIds()};if(d==="copy"||d==="cut"||d==="clone"){fluid.clipboard.copy(k.lockTosIds,{originPageId:k.pageId});if(d==="copy"||k.lockTosIds.length===0){j.preventDefault();return}}if(d==="paste"||d==="clone"){var l=fluid.clipboard.getLastCopy();if(!l){return}k.pastedClipboard=fluid.clipboard.paste({pageId:k.pageId,clipboard:l,idMap:fluid.clipboard.generateMap(_.map(l,function(I){return I.id}))})}if(d==="clone"){var l=fluid.clipboard.copy(k.lockTosIds,{originPageId:k.pageId,returnCopy:true});if(!l){return}k.selIds=fluid.selection.getSelectedIds();k.pastedClipboard=fluid.clipboard.paste({pageId:k.pageId,clipboard:l,idMap:fluid.clipboard.generateMap(_.map(l,function(I){return I.id}))})}fluid.main.fire("beforeCmAction");fluid.command.create(d,k).dispatchTo("fluid.controllers.widget",Q);if(d==="paste"){fluid.main.fire("uiWidgetAdded")}}}}}}if(j.keyCode===27){fluid.main.fire("afterescpressed",j)}};E.exports.keyU=function(a){if($("#lock-overlay").is(":visible")){return}if(/^(input|textarea)$/i.test(a.target.nodeName)){return}if(a.keyCode>=37&&a.keyCode<=40){if(a){var b=a.target.nodeName.toLowerCase();if((b=="input")||(b=="textarea")||(b=="select")){return false}}fluid.main.fire("keyup",a);return false}$("#canvasPages .backgroundWidget").css("z-index","");$("#multiSelBox").css("z-index","")};E.exports.load=function(){var a=window.open("terms.html","","scrollbars=no,menubar=no,height=600,width=800,resizable=yes,toolbar=no,location=no,status=yes")};E.exports.tidyUp=function(a){if(v._resizeEl){return}if(fluid.main.preventTidyUp){fluid.main.preventTidyUp=false;return}var b=$(a.target);if(b.attr("id")==="previewHolder"||b.parents("#previewHolder").length||b.parent(".share-toggle").length){fluid.main.fire("closeallpopups",a)}if(b.attr("id")==="previewHolder2"||b.parents("#previewHolder2").length){fluid.main.fire("closeallpopups",a)}if(b.closest(".component").length>0){return}if($(a.target).hasClass("widgetHolder")&&a.altKey){return}if($(a.target).hasClass("prevent-tidy-up")||$(a.target).parents(".prevent-tidy-up").length){return}fluid.main.fire("closeallpopups",a);if(window.g_window_print&&!window.g_window_print.closed&&!$(a.target).hasClass("shareLinkPrint")){window.g_window_print.close();window.g_window_print=null}};E.exports.setValid=function(a){var b=a.next("aside");if(!b.hasClass("formCorrect")){b.fadeTo(0,1).addClass("formCorrect").bounce()}};E.exports.validateInput=function(b,a){var c=$(a);if(a==null||a==undefined){a=this;c=$(this)}if(!a.validity){return}$form=c.parents(".form").eq(0);if($form.hasClass("shareSendMail")){return}if($form.hasClass("shareToUser")){return}if(((a.validity.valid&&c.is(":checkbox")==false)||(c.attr("type")=="checkbox"&&c.prop("checked"))==true)&&c.attr("type")!="submit"){E.exports.setValid(c)}else{c.next("aside").fadeTo(200,0).removeClass("formCorrect")}if(!$form.hasClass("createForm")){var d=$form.find("input").not("[type=hidden], [type=submit]").length;var f=$form.find(".formCorrect").length;setSubmitStyle($form,d==f)}};var s=E.exports.intersectTrash=function(c,d){if($("#trash").css("display")!="none"){c=$(c);var a=c[0].dataset.lockto;if(a&&a!==c[0].id){c=$("#"+a)}var h=D.getTLWH(c);if(c.hasClass("screen")){var f=fluid.zoom.getCurrentScale(),i=$(".page",c);if(fluid.zoom.isEditMode()){return false}if(i.size()>0){h=D.getTLWH(i)}h.width=h.width*f;h.height=h.height*f}var b=$("#libraryWidgetDragging");if(b.size()>0){if(b.hasClass("upload")){h.width=24;h.height=24}else{h=D.getTLWH(b.find(".pageWidget"))}}var j=D.getTLWH("#trash");if(d&&(h.width>200||h.height>200)){h.top=d.pageY;h.left=d.pageX;h.width=0;h.height=0}if((h.top+h.height>=j.top)&&(h.left+h.width>=j.left)){$("#trash").addClass("droppableStyle");return true}}$("#trash").removeClass("droppableStyle");return false};E.exports.dropInViewport=function(d,b){if(o=="cmLink2"){return true}if(fluid.zoom.isZoomingNow()){return false}if(d.isPropagationStopped()||(d.originalEvent&&d.originalEvent.isPropagationStopped())){return}var n=$(b.draggable);var o=n.attr("id")||n.attr("data-id");if(n.hasClass("pageWidget")){return true}if($("#trash").hasClass("droppableStyle")){var j=n.attr("data-id");if(!j){j=n.attr("id")}if(j.indexOf("scaled-")!==-1){j=j.split("-")[1]}fluid.command.create("drop",{id:j,title:fluid.main.uploads.get(j).get("title")}).dispatchTo("fluid.controllers.bin");$("#trash").removeClass("droppableStyle");return}if(o=="canvas"){return true}if(n.hasClass("libraryWidget")&&d.pageX<fluid.main.account.get("libraryWidth")){return false}var f=b.draggable.add(b.helper).add($("#dragCanvas")).add(".pageWidget.ui-selected");var h=false;var i=B(d);var a=i.pageId?i.pageId:false;var m=b.draggable.attr("id")||b.draggable.attr("data-id");if(a){var l=$("#"+a);if(o=="cmLink2"){var c=l;var k=fluid.zoom.getselectedBeforeZoomOut();fluid.command.create("create",{originId:k,destinationId:c.attr("id")}).dispatchTo("fluid.controllers.link");h=true}}if($(b.draggable).attr("id")==="cmLink2"){if(h){v.resetSelection()}}};E.exports.setSubmitStyle=function(b,c){var a=b.find(":submit");if(c===undefined){c=!a.hasClass("inactive")}if(c||b.attr("id")=="upgradeForm"){var d=b.data("existing")?"accept-existing":"accept";a.removeClass("inactive accept accept-existing").addClass(d).bounce()}else{a.removeClass("accept accept-existing").addClass("inactive")}};E.exports.deleteObject=u;function u(h,d){function c(){var k=fluid.selection.getSelectedIds(),j,o;if(k.length==0){return false}var l=[],p=[];for(var m=0;m<k.length;m++){j=k[m];o=fluid.main.project.widgets.get(j);if(j===o.get("segment")){p.push(j)}else{l.push(j);var i=o.get("insertAfterId")?fluid.main.project.widgets.get(o.get("insertAfterId")):false;if(i===false){i=o.get("of")?fluid.main.project.widgets.get(o.get("of")):false}if(i&&i.get("blur")&&_.difference(i.getBox(),o.getBox()).length===0){l.push(i.get("id"))}}}if(l.length>0){fluid.command.create("delete",{id:l,pageId:$(".screen.active").attr("id")}).dispatchTo("fluid.controllers.widget")}if(p.length>0){var n=fluid.main.project.widgets.get(p[0]).get("segmentRoot");fluid.command.create("deleteSegment",{id:p,rootId:n,pageId:$(".screen.active").attr("id")}).dispatchTo("fluid.controllers.widget")}fluid.main.fire("cm:hide")}if((h==46||h==8||h=="delete")){return c()}if(!d||!d.draggable){return false}var a=$(d.helper);if(s(a)==true){if(a.hasClass("pageWidget")){c();v._dragSelection=null}else{if(a.hasClass("userWidget")){var b=a.data("widget-id");fluid.command.create("drop",{id:b,thumb:$("#"+b+" img").attr("src")}).dispatchTo("fluid.controllers.bin")}else{if(a.hasClass("screen")){fluid.command.create("delete",{id:a.attr("id")}).dispatchTo("fluid.controllers.page")}else{if(a.hasClass("scaled-screen")){fluid.command.create("delete",{id:a.attr("id").split("-")[1]}).dispatchTo("fluid.controllers.page")}else{if(a.hasClass("project")){var f=fluid.main.projects.getIds();if(f.length>1){fluid.command.create("drop",{id:$(d.draggable).attr("id")}).dispatchTo("fluid.controllers.bin")}else{fluid.main.fire("addNotification","info","Sorry, the currently open project cannot be deleted. Please create another project before deleting this one.")}}}}}}$("#trash").removeClass("droppableStyle");return true}return false}function z(b,a){this.ms=b;this.callback=a;this.start()}E.exports.Timeout=z;var B=E.exports.getHoverPageParams=function(c){var a=document.getElementById("viewport");if(fluid.zoom.getCtx()!=="project"&&c.pageX<=fluid.zoom.getLibWidth()){return false}var j=(a.scrollLeft+c.pageX)/fluid.zoom.getCurrentScale();var d=(a.scrollTop+c.pageY)/fluid.zoom.getCurrentScale();var i=fluid.main.project.pages.filter(function(k){if(j>=k.get("x")&&j<=k.get("x")+k.get("width")&&d>=k.get("y")&&d<=k.get("y")+k.get("height")){return true}else{return false}});if(fluid.zoom.getCtx()==="project"){i=i[i.length-1]}else{var f=_.map(i,function(k){return k.get("id")});var h=$("#"+f.join(", #"));var b=h.filter(".active");if(b.length){i=fluid.main.project.pages.get(b.attr("id"))}else{i=fluid.main.project.pages.get(h.last().attr("id"))}}if(i&&i.get("id")){return{pageId:i.get("id"),offsetX:j-i.get("x"),offsetY:d-i.get("y")}}else{return false}};E.exports.getHoverDropAreaId=function(a){var c=$(".linkTargetBox:visible"),b;c.each(function(h,d){var f=$(d),k=f.position(),j=f.outerWidth(),i=f.outerHeight();if(a.pageX>=k.left&&a.pageX<(k.left+j)&&a.pageY>=k.top&&a.pageY<(k.top+i)){b=f.attr("id")}});return b};z.prototype={start:function(){if(!this.timeout){this.msRemaining=this.ms;this.startTime=new Date().valueOf();this.isPaused=false;this.isComplete=false;this._setTimeout(this.ms)}},started:function(){return Boolean(this.timeout)},stop:function(){if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null;this.isPaused=false}},pause:function(){if(this.timeout){window.clearTimeout(this.timeout);this.timeout=null;this.msRemaining-=new Date().valueOf()-this.startTime;this.isPaused=true}},paused:function(){return Boolean(this.isPaused)},resume:function(){if(this.isPaused&&!this.timeout){this.startTime=new Date().valueOf();this._setTimeout(this.msRemaining);this.isPaused=false}},timeRemaining:function(){if(this.isPaused){return this.msRemaining}else{return this.msRemaining-new Date().valueOf()+this.startTime}},exec:function(){this.stop();this.callback.call();this.isComplete=true},complete:function(){return Boolean(this.isComplete)},_setTimeout:function(a){this.timeout=window.setTimeout((function(b){return function(){if($.isFunction(b.callback)){b.isComplete=true;b.callback.call();b.timeout=null}}})(this),a)}};E.exports.rgb2hex=function(b){b=b.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function a(c){return("0"+parseInt(c).toString(16)).slice(-2)}return"#"+a(b[1])+a(b[2])+a(b[3])};E.exports.fetchSvgIcons=function(){var a=new XMLHttpRequest();a.open("GET","img/all_icons.svg",true);a.onload=function(c){var d=new XMLSerializer();var b=d.serializeToString(c.target.responseXML.documentElement);document.head.appendChild(c.target.responseXML.documentElement);fluid.main.fire("dbStorage.onReady",function(){fluid.main.fire("dbStorage.set","uiIcons",{id:"svgIcons",data:b})})};a.send(null)};E.exports.preventDeleteBack=function(a){if(a.keyCode==8&&a.target.nodeName=="BODY"){return false}};fluid.main.on("widgetMoved",function(b,a){E.exports.updateTLWH()});function F(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}E.exports.validateEmail=F;function H(d){d=d.split("+").join(" ");var a={},b,c=/[?&]?([^=]+)=([^&]*)/g;while(b=c.exec(d)){a[decodeURIComponent(b[1])]=decodeURIComponent(b[2])}return a}E.exports.getQueryParams=H},{"./class-grid":31,"./class-preview":37,"./class-propertyInspectorController":40,"./class-userSettings":47,"./class-widget":49,"./utils-editor":98}],92:[function(p,n,j){var m=p("./browserdetect");window.preview=p("./class-preview");window.previewMenu=p("./class-previewMenu");var k=p("./class-dbStorage");p("./fluid/fluid");m.init();window.imgCloudUrl=window.location.protocol=="http:"?"//561f5b186ef3d1bbffae-670dcfae82c728eff02629d9c4d77cbb.r43.cf2.rackcdn.com/":"//e92360842a005b2d5215-670dcfae82c728eff02629d9c4d77cbb.ssl.cf2.rackcdn.com/";var l="Not Loaded";var o=p("./init/modelsCollectionsInit");$(document).ready(function(f){$(document).keyup(preview.navigateWithKeys);var a=$.event.props,d=a.length,c=[];while(d--){var b=a[d];if(b!="layerX"&&b!="layerY"){c.push(b)}}$.event.props=c;document.onselectstart=function(){return false}});if(m.browser=="Explorer"||/Trident/.test(navigator.userAgent)||m.browser=="Opera"){$(document).ready(function(a){$("body").empty().append($("#tmplInvalid").tmpl())})}else{if(window.g_preview!=undefined){fluid.api.init();o().then(k.init).then(function(){var a=document.createElement("style");a.id="homePageStyle";a.type="text/css";a.innerHTML="#homePage { background-image: none; }";document.head.appendChild(a);preview.load(window.g_preview,preview.afterPreviewLoad)})}}},{"./browserdetect":24,"./class-dbStorage":29,"./class-preview":37,"./class-previewMenu":38,"./fluid/fluid":67,"./init/modelsCollectionsInit":93}],93:[function(h,l,i){var j=h("../fluid/models");var k=h("../fluid/collections");l.exports=function(){return new Promise(function(a){j.init();k.init();if(!window.g_preview){fluid.main.projects=new fluid.collections.Projects()}if(!window.g_preview){fluid.main.uploads=new fluid.collections.Uploads()}a()})}},{"../fluid/collections":52,"../fluid/models":73}],94:[function(j,o,k){var m=null;o.exports=l;function n(){p(window.name)}function p(c){if(m){return m}if(c){l.restored=true;m=c;if(location.pathname.match("comment")){localStorage.setItem("lastIidSetInCommentMode",m)}else{var b;try{b=parseInt(localStorage.getItem("lastIidSetInCommentMode"),10)}catch(a){}if(b&&b===m){window.name=m=parseInt(Math.random()*100000000)}}Logger({key:"instanceId",group:"other",message:"restoring instanceId to "+m})}else{window.name=m=parseInt(Math.random()*100000000);Logger({key:"instanceId",group:"other",message:"setting new instanceId to "+m})}}function l(){if(!m){n()}return m}fluid.main.on("reloadingEditorFromServer editor.afterLogout",function(){m=null;p()})},{}],95:[function(q,p,r){var n=q("./browserdetect");var k=q("./utils");var o=q("./class-widget");var m=q("./class-propertyInspectorController");var l={getWidgetForCP:function(){var a={};function b(){var f=$(this);var d=f.attr("id");var h=fluid.main.project.widgets.get(d).toJSON();if(h.bgc){$.extend(true,a,h);return false}}var c=fluid.selection.getSelectionModel().getShapeWidgets(true).getElements();c.each(b);return a},getTextWidgetCP:function(){var a=fluid.selection.getSelectionModel().getLockTos().getTextWidgets().getElements().last();return o.get(a.attr("id"))},segmentRootId:false,getSelectedOnly:function(d){function b(){var h=$(this);var f=h.attr("id");var j=fluid.main.project.widgets.get(f).toJSON();if(j.seg){if(j.bgc){c=c.add(h);l.segmentRootId=f}else{if(j.segments&&j.segments.length&&fluid.main.project.get(j.segments[0].id).bgc){for(var i=0;i<j.segments.length;i++){c=c.add("#"+j.segments[i].id)}}}}else{if(j.segment&&(j.of==l.segmentRootId)){if(h.hasClass("ui-selected")){c=c.add(h)}else{c=c.not(h)}}else{c=c.add(h)}}}var c=$([]);var a=d||fluid.selection.getSelectionModel().getShapeWidgets().getElements();a.each(b);return c},clickOnSelectorEdge:function(f){var c=l.pickerWidth/2;var a=Math.abs(f.offsetX-c);var b=Math.abs(f.offsetY-c);var d=Math.sqrt((a*a)+(b*b));if(d>c){if(f.originalEvent.target.id=="hslSelector"){l.hslClick(f)}else{if(f.originalEvent.target.id=="rgbSelector"){l.rgbClick(f)}}}},tempFontColor:false,getTextColor:function(){var c=l.getTextWidgetCP();var a=l.getFontColorFromCSS(c.ts);l.tempFontColor=a;var b=k.toHSL(a);l.updateDisplay(b);l.updateBackupColor(a);$("#textColor").css("background-color",a)},extractTextColor:function(a){var b=[];a.each(function(){b.push(l.getFontColorFromCSS(o.get($(this).attr("id")).ts))});return b},getFontColorFromCSS:function(a){var f=a.split(/;/);for(var b=0;b<f.length;b++){if(f[b].match("color")){var d=b}}var c=f[d];var h=c?c.replace(/"/g,"").replace(/color:/,""):"rgb(0,0,0)";return h},rgbClick:function(b){var c=b.target.id;l.setActivePickerBorder(c);var a=$("#rainbowColorPicker").offset();var d=l.getRGBAngle(b.pageX,b.pageY,a.top,a.left);$("#rgbSelector").css({top:d.top,left:d.left});l.rgbSet(d);l.applyToWidget(null)},hslClick:function(b){var c=b.target.id;l.setActivePickerBorder(c);var a=$("#rainbowColorPicker").offset();var d=l.getHSLAngle(b.pageX,b.pageY,a.top,a.left);$("#hslSelector").css({top:d.top,left:d.left});l.hslSet(d);l.applyToWidget(null)},setActivePickerBorder:function(a){$("#rgbSelector, #hslSelector").removeClass("inactiveSelector");if(a=="hslSelector"||a=="hslArea"){$("#rgbSelector").addClass("inactiveSelector")}else{if(a=="rgbSelector"||a=="rgbArea"){$("#hslSelector").addClass("inactiveSelector")}}},setColorStops:function(d){var c=l.getWidgetForCP();var f=(l.colorStopNumber)?l.colorStopNumber:0;var a=c.bgc[f];var b=k.toHSL(a);l.updateDisplay(b);l.updateBackupColor(a);return false},changeColorStopSlider:function(a){var d=$(a.target);var c=d.attr("data-colorStop");var b=Math.round(d.attr("value"));$("#gradientStop .colorStopIndicator").eq(c).text(b);l.applyToWidget(a)},getColorBackground:function(){var c=l.getWidgetForCP();var a=(c.bgc)?c.bgc[0]:"#000000";var b=k.toHSL(a);l.updateDisplay(b);l.updateBackupColor(a)},getBorderColor:function(){var c=l.getWidgetForCP();var a=(c.b)?c.b[1]:"#000000";var b=k.toHSL(a);l.updateDisplay(b);l.updateBackupColor(a)},inputHexOnChange:function(h){if(n.browser=="Safari"){return}var a=h.target,c=a.selectionStart,d=a.value.match(/[^0-9a-f]*/gi).filter(function(j){return j!==""}),f=a.value.replace(/[^0-9a-f]*/gi,""),i=f.length===3?[f[0],f[0],f[1],f[1],f[2],f[2]].join(""):f;a.value=f;c-=d.length;a.setSelectionRange(c,c);if(!(f.length===3||f.length===6)){return false}var b=k.toHSL("#"+i);l.updateDisplay(b,f);l.applyToWidget(null)},inputHex:function(h){var a=h.target,c=a.selectionStart,d=a.value.match(/[^0-9a-f]*/gi).filter(function(j){return j!==""}),f=a.value.replace(/[^0-9a-f]*/gi,""),i=f.length===3?[f[0],f[0],f[1],f[1],f[2],f[2]].join(""):f;a.value=f;c-=d.length;a.setSelectionRange(c,c);if(!(f.length===6)){return false}var b=k.toHSL("#"+i);l.updateDisplay(b,f);l.applyToWidget(null)},colorWheelRadius:79,hslWheelRadius:56,grayWheelRadius:81,colorPickerWidth:93,flatColorArc:20,numDegrees:360,numColors:6,hslLimit:100,currentHSL:{h:false,s:false,l:false},updateDisplay:function(L,M){function j(w){var v=l.numDegrees/l.numColors;var t=v-l.flatColorArc;var u=Math.floor(w.h/v);var s=u*v;if(w.h>s){var s=(w.h*(t/v))+((l.flatColorArc*u)+(l.flatColorArc/2))}return s}function F(S){function B(){var R=v/(v-t);var W=(w-t)*R;var X=l.hslLimit/v;var Q=l.hslLimit-(X*W);return Q}function A(){var W=l.hslLimit/v;var X=(l.hslLimit-L.s)/W;var R=v/(v-t);var Q=(X/R)+t;return Q}var t=l.pickerWidth/2;var w=l.pickerWidth;var v=l.hslWheelRadius-(l.pickerWidth/5);var B=B();if(L.s==0){if(S==0){var C=l.flatColorArc/2}else{if(S>0&&S<l.numDegrees){var E=(l.numDegrees+(2*l.flatColorArc))/l.numDegrees;var C=l.flatColorArc+S/E}else{if(S==l.numDegrees){var C=l.numDegrees-(l.flatColorArc/2)}}}}else{if(L.s>0&&L.s<=B){var C=S}else{if(L.s>B&&L.s<l.hslLimit){var s=w-t;var u=l.hslLimit/2;var T=A();var z=(L.l-u)/(T-t);var D=z*s+u;var C=(D*l.numDegrees)/l.hslLimit}else{if(L.s==l.hslLimit){var C=0}}}}return C}function J(){var u=l.pickerWidth/2;var v=l.hslWheelRadius-(l.pickerWidth/5);if(L.s==0){var s=l.hslWheelRadius}else{if(L.s>0&&L.s<l.hslLimit){var w=l.hslLimit/v;var z=(l.hslLimit-L.s)/w;var t=v/(v-u);var s=(z/t)+u}else{if(L.s==l.hslLimit){var s=0}}}return s}var N=0;var K=0;l.currentHSL.h=(L.h!==false)?L.h:l.currentHSL.h;l.currentHSL.s=(L.s!==false)?L.s:l.currentHSL.s;l.currentHSL.l=(L.l!==false)?L.l:l.currentHSL.l;L=l.currentHSL;var h={top:0,left:0};var b=parseInt($("#rgbSelector").css("width"));var f=parseInt($("#rgbSelector").css("height"));var O=j(L)*2*Math.PI/l.numDegrees;var i=-(l.colorWheelRadius*Math.cos(O));var P=l.colorWheelRadius*Math.sin(O);i=l.colorPickerWidth+N-(f/2)+i;P=l.colorPickerWidth+K-(b/2)+P;var G=L.l*l.numDegrees/l.hslLimit;var c=F(G);var d=(c*(Math.PI*2))/l.numDegrees;var I=J();var a=-(I*Math.cos(d));var H=I*Math.sin(d);a=l.colorPickerWidth+N-(f/2)+a;H=l.colorPickerWidth+K-(b/2)+H;$("#rgbSelector").css({top:i,left:P});$("#hslSelector").css({top:a,left:H});$("#colorHexValue").val(M||k.hslToHex(L));$("#bgColorDisplay").css("background-color","#"+(M||k.hslToHex(L)));$("#hueSaturationBase").css("background-image","-webkit-radial-gradient(center center, hsl("+L.h+", 100%, 50%),hsl(0,0%,50%) 80%, hsl(0,0%,50%) 100%)").css("background-image","-moz-radial-gradient(center center, hsl("+L.h+", 100%, 50%),hsl("+L.h+", 100%, 50%) 20%, hsl(0,0%,50%) 80%, hsl(0,0%,50%) 100%)")},updateBackupColor:function(a){$("#bgColorOriginal").css("background-color",a)},dragEl:false,pickerWidth:false,pickerRadius:false,cpCenter:false,activeWidget:false,rainbowColorDivPosition:false,dragStart:function(a){l.cpCenter=l.cpCenter||$("#rainbowColorPicker").offset();l.dragEl=l.dragEl||$(this);var b=a.target.id;l.setActivePickerBorder(b)},getRGBAngle:function(j,w,b,a){var i=j-a-(l.pickerWidth/2)-l.colorWheelRadius;var z=w-b-(l.pickerWidth/2)-l.colorWheelRadius;var h=Math.sqrt(i*i+z*z);var B=l.colorWheelRadius/h;var d=l.pickerRadius+(i*B)-(l.pickerWidth/2);var c=l.pickerRadius+(z*B)+l.rainbowColorDivPosition.top-(l.pickerWidth/2);var A=Math.asin(i/h);var f=(180/Math.PI)*A;if(w>b+l.colorWheelRadius+(l.pickerWidth/2)){f=180-f}else{if(j<a+l.colorWheelRadius+(l.pickerWidth/2)){f=360+f}}if(f>360){var f=f-l.numDegrees}return{top:c,left:d,angle:f}},rgbDrag:function(b){var a=l.getRGBAngle(b.pageX,b.pageY,l.cpCenter.top,l.cpCenter.left);l.dragEl.data().draggable.position.top=a.top;l.dragEl.data().draggable.position.left=a.left;l.rgbSet(a);$("#colorPickerElement, #lightDarkOverlay").css("cursor","none")},rgbSet:function(d){var b=c(d.angle);function c(f){var w=l.numDegrees/l.numColors;var h=w-l.flatColorArc;var j=Math.floor(f/w)*w;var B=j+w-(l.flatColorArc/2);var i=j+(l.flatColorArc/2);if(f>B&&f<(j+w)){var z=j+w}else{if(f>j&&f<i){var z=j}else{var A=((w/h)*(l.flatColorArc/2))+(j/2);var z=(w/h)*f-A}}return z}var a=lValue=false;if(l.currentHSL.s===0){a=l.hslLimit;lValue=50}l.updateDisplay({h:b,s:a,l:lValue})},rgbDragStop:function(a){fluid.main.preventTidyUp=true;l.rgbDrag(a);l.dragEl=false;l.cpCenter=false;l.applyToWidget(null);$("#colorPickerElement, #lightDarkOverlay").css("cursor","default")},hslDrag:function(b){var a=l.getHSLAngle(b.pageX,b.pageY,l.cpCenter.top,l.cpCenter.left);l.dragEl.data().draggable.position.top=a.top;l.dragEl.data().draggable.position.left=a.left;l.hslSet(a);$("#colorPickerElement, #lightDarkOverlay").css("cursor","none")},getHSLAngle:function(j,w,b,a){var i=j-a-l.hslWheelRadius-(3*l.pickerWidth/2)+0.01;var z=w-b-l.hslWheelRadius-(3*l.pickerWidth/2)+0.01;var h=Math.sqrt(i*i+z*z);var B=l.hslWheelRadius/h;var A=Math.asin(i/h);var f=Math.round((180/Math.PI)*A);var d=l.pickerRadius+(i*B)+$("#rainbowColorPicker").position().left-(l.pickerWidth/2);var c=l.pickerRadius+(z*B)+$("#rainbowColorPicker").position().top-(l.pickerWidth/2);if(h<l.hslWheelRadius){var c=l.pickerRadius+z-(l.pickerWidth/2);var d=l.pickerRadius+i-(l.pickerWidth/2)}if(w>(b+l.hslWheelRadius+(3/2*l.pickerWidth))){f=(l.numDegrees/2)-f}else{if(j<(a+l.hslWheelRadius+(3/2*l.pickerWidth))){f=l.numDegrees+f}}if(f>360){var f=f-l.numDegrees}var f=Math.abs(f);return{top:c,left:d,angle:f,hypot:h}},hslSet:function(d){function c(){if(d.hypot<a){var A=l.hslLimit/2}else{if(d.hypot>=a&&d.hypot<f){var B=l.hslLimit/2;var D=d.angle*l.hslLimit/l.numDegrees;var E=(D-B)/(f-a);var A=(E*(d.hypot-a))+B}else{if(d.hypot>=f&&d.hypot<b){var A=d.angle*l.hslLimit/l.numDegrees}else{if(d.hypot>=b){if(d.angle<l.flatColorArc){var A=0}else{if(d.angle>=l.flatColorArc&&d.angle<=(l.numDegrees-l.flatColorArc)){var F=(l.numDegrees+(2*l.flatColorArc))/l.numDegrees;var C=(d.angle-l.flatColorArc)*F;var A=l.hslLimit*C/l.numDegrees}else{if(d.angle>(l.numDegrees-l.flatColorArc)){var A=l.hslLimit}}}}}}}return A}function i(){w=l.hslLimit;if(d.hypot>=a&&d.hypot<b){var z=b/(b-a);var A=(d.hypot-a)*z;var B=l.hslLimit/b;var w=l.hslLimit-(B*A)}if(d.hypot>=b){var w=0}return w}var a=l.pickerWidth/2;var f=l.pickerWidth;var b=l.hslWheelRadius-(l.pickerWidth/5);var j=c();var h=i();l.updateDisplay({h:false,s:h,l:j})},hslDragStop:function(a){fluid.main.preventTidyUp=true;l.hslDrag(a);l.dragEl=false;l.cpCenter=false;l.applyToWidget(null);$("#colorPickerElement, #lightDarkOverlay").css("cursor","default")},populateAdvancedGradient:function(){var b=l.getWidgetForCP();if(b.bg=="s"){l.colorStopNumber=1;return false}else{if(b.bgc[0]==="rgba(0,0,0,0.0)"&&b.bgc[1]=="rgba(0,0,0,0.0)"){l.colorStopNumber=1;return false}else{var c=(b.bgd)?$.merge([],b.bgd):[1];var a=(b.bgc)?$.merge([],b.bgc):["#fff"]}}$("#gradientTypeSelector").val(b.bg);l.removeColorStop(null,"all",true);l.addColorStops(null,a,c,true);return false},redraw:function(d){var c=fluid.main.project.widgets.get(d).toJSON();var a=$("#"+d);if(a.length){var b=o._setTMPLVars(d,c,false,false);b.absTLWH=[parseInt(a.css("top")),parseInt(a.css("left")),a.outerWidth(),a.outerHeight()];o._drawCanvasOrImage(a,b)}},sortApplyColors:function(a){var b=$(a.target).css("background-color");l.applyToWidget(null,false,b)},getColorsFromIds:function(f){var a=[];for(var b=0,c=f.length;b<c;b++){var d=fluid.main.project.get(f[b]);if(d){a[b]={bg:d.bg,bgc:d.bgc,bgd:d.bgd}}}return a},getCurrentColor:"rgb(0,0,0)",applyToWidget:function(b,B,a){function h(){var s=l.getColorsFromIds(A(l.getSelectedOnly(i)));var t=l.applyToBackground(b,d,i,d);f=fluid.command.create("setBackgroundColor",{id:A(l.getSelectedOnly(i)),color:t,fromColor:s,pageId:$(".screen.active").attr("id")})}var i=l.getSelectedOnly();var d=(a)?a:$("#bgColorDisplay").css("background-color");var f;function A(s){return s.map(function(){return $(this).attr("id")}).get()}if(l.lastAction=="showTextColor"){var i=fluid.selection.getSelectionModel().getTextWidgets().getElements();f=fluid.command.create("setColor",{id:A(i),pageId:$("#canvasPages .active").attr("id"),fromColor:l.extractTextColor(i),color:d||$("#bgColorDisplay").css("background-color")})}else{if(l.lastAction=="showFlatColor"||l.lastAction=="showGradientGallery"||l.lastAction=="showColorStopEditor"){h()}else{if(l.lastAction=="showAdvancedGradientEditor"){var w=i.first().attr("id");var c=o.get(w);if(c.bgc){if(c.bgc.length>0){l.getCurrentColor=c.bgc[0]}}d=l.getCurrentColor;if(b){var z=$(b.target);if(z.hasClass("gradientStopSlider")){if(b.type=="mouseup"){h()}else{l.applyToBackground(b,d,i,d)}}else{h()}}else{h()}}else{if(l.lastAction=="showBorder"){var j=A(l.getSelectedOnly(i));f=fluid.command.create("setBorderColor",{id:j,fromColor:l.extractBorderColor(j),pageId:$("#canvasPages .active").attr("id"),color:d})}}}}if(f){f.dispatchTo("fluid.controllers.widget",!B)}},applyToBackground:function(d,f,j,h){function a(){var O=$(this).attr("id");var X=$.extend(true,{},o.get(O));if($(this).hasClass("rootWidget")&&!X.bg&&X.seg){return true}if(!X.bg&&X.tc){return}if(l.lastAction=="showFlatColor"){var S=(X.bgc)?X.bgc[0]:"rgba(0,0,0,0.50)";var R=k.addAlpha(S,b,i);var T=R.split();c.push({bg:"c",bgc:T,bgd:undefined})}else{if(l.lastAction=="showAdvancedGradientEditor"){var P=$("#gradientTypeSelector").val();var V=new Array(l.colorStopAmount);var Q=new Array(l.colorStopAmount);var S=h;for(var M=0;M<l.colorStopAmount;M++){var J=$("#gradientStop .colorPickerTrigger").eq(M).css("background-color");V[M]=k.addAlpha(S,J,i);Q[M]=$("#gradientStop .gradientStopSlider").eq(M).attr("value")/100}c.push({bg:P,bgc:V,bgd:Q})}else{if(l.lastAction=="showGradientGallery"){var U=$.parseJSON($(d.originalEvent.target).attr("data-color"));var L=$.extend(true,{},U);var S=(X.bgc)?X.bgc[0]:"rgb(0,0,0)";if(U.bgc[0]!=="rgba(0,0,0,0.0)"){for(var N=0;N<U.bgc.length;N++){var K=U.bgc[N];var W=k.hex2rgba(K);L.bgc[N]=k.addAlpha(S,W,i)}}c.push(L)}else{if(l.lastAction=="showColorStopEditor"){var T=$.merge([],X.bgc);var S=T[l.colorStopNumber];var R=k.addAlpha(S,b);T[l.colorStopNumber]=R;c.push({bgc:T})}}}}l.redraw(O)}j=j||l.getSelectedOnly();var b=f||$("#bgColorDisplay").css("background-color");var i=true;var c=[];j.each(a);fluid.main.fire("colorpickercolorapplied","background");return c},applyToBorder:function(d,f){function a(w,z,h){var j=w[1];var i=k.addAlpha(j,c);w[1]=i;var v={};v[h]=w;fluid.main.project.widgets.get(z).set(v);return i}function b(){var z=$(this).attr("id");var A=fluid.main.project.widgets.get(z).toJSON();if($(this).hasClass("rootWidget")&&!A.b){return true}var j=$.extend(true,{},A);if(j.b||j.bbs||j.bts||j.bms||j.bls||j.brs||j.bs){var w=["b","bs","bts","bls","bms","bbs","brs"];for(var h=0;h<w.length;h++){if(j[w[h]]){var B=j[w[h]];var i=a(B,z,w[h])}}}else{var B=[0,"#000",0];var i=a(B,z)}l.redraw(z)}var c=d;f=f||l.getSelectedOnly();f.each(b);fluid.main.fire("colorpickercolorapplied","border");return false},tempTextId:false,removeColorStop:function(b,c,a){if(c=="all"){c=$("#gradientStop .colorStopOption")}c.remove();l.setColorStopProperties(b,a)},addColorStops:function(h,c,d,f){if(!c){c=["#000"]}if(!d){d=[1]}for(var b=0;b<c.length;b++){var a=Math.round(d[b]*100);$("#tmplGradientColorStop").tmpl({bgColor:c[b],bgIndex:d[b],val:a}).appendTo("#gradientStop")}l.setColorStopProperties(h,f)},colorStopAmount:1,setColorStopProperties:function(a,w){var h=$("#gradientStop .colorStopOption");var v=h.index();var b=v+1;l.colorStopAmount=b;var f=$("#gradientStop .colorStopButton");var j=$("#gradientStop .gradientStopSlider");var z=$("#gradientStop .colorStopDelete");if(!w&&(b==2)){var i=parseInt(j.eq(0).val());if(i==100){var d=50;j.eq(0).val(d);$("#gradientStop .colorStopIndicator").eq(0).text(d)}}for(var c=0;c<b;c++){h.eq(c).attr("data-colorStop",c);f.eq(c).attr("data-colorStop",c);j.eq(c).attr("data-colorStop",c);z.eq(c).attr("data-colorStop",c)}l.applyToWidget(null,w)},extractBorderColor:function(f){var b,d=[],c,a;for(var h=0;h<f.length;h++){c=fluid.main.project.get(f[h]);b=(c.b&&c.b[1])?c.b[1]:"#333";a=b&&b.match(/rgba\s*\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+(?:\.\d+)?)\s*\)/);if(a){b="rgb("+a[1]+","+a[2]+","+a[3]+")"}d.push(b)}return d}};p.exports=l},{"./browserdetect":24,"./class-propertyInspectorController":40,"./class-widget":49,"./utils":99}],96:[function(j,i,f){var h={checkVATNumber:function(a,z){var d=new Array();var c="GB";if(z){z=z.replace(/\s*/gi,"").toUpperCase()}a=a.replace(/\s*/gi,"");d.push(/^(AT)U(\d{8})$/);d.push(/^(BE)(0?\d{9})$/);d.push(/^(BG)(\d{9,10})$/);d.push(/^(CH)E(\d{9})((MWST)|(IVA)|(TVA))/);d.push(/^(CY)([0-5|9]\d{7}[A-Z])$/);d.push(/^(CZ)(\d{8,10})(\d{3})?$/);d.push(/^(DE)([1-9]\d{8})$/);d.push(/^(DK)((\d{8}))$/);d.push(/^(EE)(10\d{7})$/);d.push(/^(EL)(\d{9})$/);d.push(/^(ES)([A-Z]\d{8})$/);d.push(/^(ES)([A-H|N-S|W]\d{7}[A-J])$/);d.push(/^(ES)([0-9|Y|Z]\d{7}[A-Z])$/);d.push(/^(ES)([K|L|M|X]\d{7}[A-Z])$/);d.push(/^(EU)(\d{9})$/);d.push(/^(FI)(\d{8})$/);d.push(/^(FR)(\d{11})$/);d.push(/^(FR)[(A-H)|(J-N)|(P-Z)]\d{10}$/);d.push(/^(FR)\d[(A-H)|(J-N)|(P-Z)]\d{9}$/);d.push(/^(FR)[(A-H)|(J-N)|(P-Z)]{2}\d{9}$/);d.push(/^(GB)?(\d{9})$/);d.push(/^(GB)?(\d{12})$/);d.push(/^(GB)?(GD\d{3})$/);d.push(/^(GB)?(HA\d{3})$/);d.push(/^(GR)(\d{8,9})$/);d.push(/^(HR)(\d{11})$/);d.push(/^(HU)(\d{8})$/);d.push(/^(IE)(\d{7}[A-W]{1,2})$/);d.push(/^(IE)([7-9][A-Z\*\+)]\d{5}[A-W])$/);d.push(/^(IT)(\d{11})$/);d.push(/^(LV)(\d{11})$/);d.push(/^(LT)(\d{9}|\d{12})$/);d.push(/^(LU)(\d{8})$/);d.push(/^(MT)([1-9]\d{7})$/);d.push(/^(NL)(\d{9})B\d{2}$/);d.push(/^(PL)(\d{10})$/);d.push(/^(PT)(\d{9})$/);d.push(/^(RO)([1-9]\d{1,9})$/);d.push(/^(SI)([1-9]\d{7})$/);d.push(/^(SK)([1-9]\d[(2-4)|(6-9)]\d{7})$/);d.push(/^(SE)(\d{10}01)$/);var s=a.toUpperCase();var t=[" ","-",",","."];for(var v=0;v<t.length;v++){while(s.indexOf(t[v])!=-1){s=s.slice(0,s.indexOf(t[v]))+s.slice(s.indexOf(t[v])+1)}}var A=false;var u=false;if(z){switch(z){case"AT":if(z=="AT"){u=true}break;case"BE":if(z=="BE"){u=true}break;case"BG":if(z=="BG"){u=true}break;case"CH":if(z=="CH"){u=true}break;case"CY":if(z=="CY"){u=true}break;case"CZ":if(z=="CZ"){u=true}break;case"DE":if(z=="DE"){u=true}break;case"DK":if(z=="DK"){u=true}break;case"EE":if(z=="EE"){u=true}break;case"EL":if(z=="GR"){u=true}break;case"ES":if(z=="ES"){u=true}break;case"EU":if(z=="EU"){u=true}break;case"FI":if(z=="FI"){u=true}break;case"FR":if(z=="FR"||z=="GF"||z=="PF"||z=="TF"){u=true}break;case"GB":if(z=="GB"){u=true}break;case"GR":if(z=="GR"){u=true}break;case"HR":if(z=="HR"){u=true}break;case"HU":if(z=="HU"){u=true}break;case"IE":if(z=="IE"){u=true}break;case"IT":if(z=="IT"){u=true}break;case"LT":if(z=="LT"){u=true}break;case"LU":if(z=="LU"){u=true}break;case"LV":if(z=="LV"){u=true}break;case"MT":if(z=="MT"){u=true}break;case"NL":if(z=="NL"){u=true}break;case"PL":if(z=="PL"){u=true}break;case"PT":if(z=="PT"){u=true}break;case"RO":if(z=="RO"){u=true}break;case"SE":if(z=="SE"){u=true}break;case"SI":if(z=="SI"){u=true}break;case"SK":if(z=="SK"){u=true}break;default:u=false}}for(v=0;v<d.length;v++){if(d[v].test(s)){var b=RegExp.$1;var w=RegExp.$2;if(b.length==0){b=c}switch(b){case"AT":A=h.ATVATCheckDigit(w);u=(!z||z=="AT");break;case"BE":A=h.BEVATCheckDigit(w);u=(!z||z=="BE");break;case"BG":A=h.BGVATCheckDigit(w);u=(!z||z=="BG");break;case"CH":A=h.CHVATCheckDigit(w);u=(!z||z=="CH");break;case"CY":A=h.CYVATCheckDigit(w);u=(!z||z=="CY");break;case"CZ":A=h.CZVATCheckDigit(w);u=(!z||z=="CZ");break;case"DE":A=h.DEVATCheckDigit(w);u=(!z||z=="DE");break;case"DK":A=h.DKVATCheckDigit(w);u=(!z||z=="DK");break;case"EE":A=h.EEVATCheckDigit(w);u=(!z||z=="EE");break;case"EL":A=h.ELVATCheckDigit(w);u=(!z||z=="GR");break;case"ES":A=h.ESVATCheckDigit(w);u=(!z||z=="ES");break;case"EU":A=h.EUVATCheckDigit(w);u=(!z||z=="EU");break;case"FI":A=h.FIVATCheckDigit(w);u=(!z||z=="FI");break;case"FR":A=h.FRVATCheckDigit(w);u=(!z||z=="FR"||z=="GF"||z=="PF"||z=="TF");break;case"GB":A=h.UKVATCheckDigit(w);u=(!z||z=="GB");break;case"GR":A=h.ELVATCheckDigit(w);u=(!z||z=="GR");break;case"HR":A=h.HRVATCheckDigit(w);u=(!z||z=="HR");break;case"HU":A=h.HUVATCheckDigit(w);u=(!z||z=="HU");break;case"IE":A=h.IEVATCheckDigit(w);u=(!z||z=="IE");break;case"IT":A=h.ITVATCheckDigit(w);u=(!z||z=="IT");break;case"LT":A=h.LTVATCheckDigit(w);u=(!z||z=="LT");break;case"LU":A=h.LUVATCheckDigit(w);u=(!z||z=="LU");break;case"LV":A=h.LVVATCheckDigit(w);u=(!z||z=="LV");break;case"MT":A=h.MTVATCheckDigit(w);u=(!z||z=="MT");break;case"NL":A=h.NLVATCheckDigit(w);u=(!z||z=="NL");break;case"PL":A=h.PLVATCheckDigit(w);u=(!z||z=="PL");break;case"PT":A=h.PTVATCheckDigit(w);u=(!z||z=="PT");break;case"RO":A=h.ROVATCheckDigit(w);u=(!z||z=="RO");break;case"SE":A=h.SEVATCheckDigit(w);u=(!z||z=="SE");break;case"SI":A=h.SIVATCheckDigit(w);u=(!z||z=="SI");break;case"SK":A=h.SKVATCheckDigit(w);u=(!z||z=="SK");break;default:if(z){A=false}else{A=true}break}break}}return{valid_country:u,valid_vat:A,number:s}},ATVATCheckDigit:function(b){var c=0;var a=[1,2,1,2,1,2,1];var m=0;for(var d=0;d<7;d++){m=Number(b.charAt(d))*a[d];if(m>9){c=c+Math.floor(m/10)+m%10}else{c=c+m}}c=10-(c+4)%10;if(c==10){c=0}if(c==b.slice(7,8)){return true}else{return false}},BEVATCheckDigit:function(a){if(a.length==9){a="0"+a}if(a.slice(1,2)==0){return false}if(97-a.slice(0,8)%97==a.slice(8,10)){return true}else{return false}},BGVATCheckDigit:function(c){if(c.length==9){var d=0;var o=0;for(var n=0;n<8;n++){o=o+Number(c.charAt(n))*(n+1)}d=o%11;if(d!=10){if(d==c.slice(8)){return true}else{return false}}var o=0;for(var n=0;n<8;n++){o=o+Number(c.charAt(n))*(n+3)}d=o%11;if(d==10){d=0}if(d==c.slice(8)){return true}else{return false}}if((/^\d\d[0-5]\d[0-3]\d\d{4}$/).test(c)){var a=Number(c.slice(2,4));if((a>0&&a<13)||(a>20&a<33)){var b=[2,4,8,5,10,9,7,3,6];var d=0;for(var n=0;n<9;n++){d=d+Number(c.charAt(n))*b[n]}d=d%11;if(d==10){d=0}if(d==c.substr(9,1)){return true}}}var b=[21,19,17,13,11,9,7,3,1];var d=0;for(var n=0;n<9;n++){d=d+Number(c.charAt(n))*b[n]}if(d%10==c.substr(9,1)){return true}var b=[4,3,2,7,6,5,4,3,2];var d=0;for(var n=0;n<9;n++){d=d+Number(c.charAt(n))*b[n]}d=11-d%11;if(d==10){return false}if(d==11){d=0}if(d==c.substr(9,1)){return true}else{return false}},CHVATCheckDigit:function(b){var c=0;var a=[5,4,3,2,7,6,5,4];for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}c=(11-(c%11))%11;if(c==b.slice(8,9)){return true}else{return false}},CYVATCheckDigit:function(a){if(Number(a.slice(0,2)==12)){return false}var b=0;for(var c=0;c<8;c++){var d=Number(a.charAt(c));if(c%2==0){switch(d){case 0:d=1;break;case 1:d=0;break;case 2:d=5;break;case 3:d=7;break;case 4:d=9;break;default:d=d*2+3}}b=b+d}b=b%26;b=String.fromCharCode(b+65);if(b==a.substr(8,1)){return true}else{return false}},CZVATCheckDigit:function(b){var c=0;var q=[8,7,6,5,4,3,2];var d=new Array();d[0]=(/^\d{8}$/);d[1]=(/^[0-5][0-9][0|1|5|6]\d[0-3]\d\d{3}$/);d[2]=(/^6\d{8}$/);d[3]=(/^\d{2}[0-3|5-8]\d[0-3]\d\d{4}$/);var o=0;if(d[0].test(b)){for(var o=0;o<7;o++){c=c+Number(b.charAt(o))*q[o]}c=11-c%11;if(c==10){c=0}if(c==11){c=1}if(c==b.slice(7,8)){return true}else{return false}}else{if(d[1].test(b)){if(p=Number(b.slice(0,2))>53){return false}return true}else{if(d[2].test(b)){for(var o=0;o<7;o++){c=c+Number(b.charAt(o+1))*q[o]}c=11-c%11;if(c==10){c=0}if(c==11){c=1}var a=[8,7,6,5,4,3,2,1,0,9,10];if(a[c-1]==b.slice(8,9)){return true}else{return false}}else{if(d[3].test(b)){var p=Number(b.slice(0,2))+Number(b.slice(2,4))+Number(b.slice(4,6))+Number(b.slice(6,8))+Number(b.slice(8));if(p%11==0&&Number(b)%11==0){return true}else{return false}}}}}return false},DEVATCheckDigit:function(a){var b=10;var c=0;var m=0;for(var d=0;d<8;d++){c=(Number(a.charAt(d))+b)%10;if(c==0){c=10}b=(2*c)%11}if(11-b==10){m=0}else{m=11-b}if(m==a.slice(8,9)){return true}else{return false}},DKVATCheckDigit:function(b){var c=0;var a=[2,7,6,5,4,3,2,1];for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}c=c%11;if(c==0){return true}else{return false}},EEVATCheckDigit:function(b){var c=0;var a=[3,7,1,3,7,1,3,7];for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}c=10-c%10;if(c==10){c=0}if(c==b.slice(8,9)){return true}else{return false}},ELVATCheckDigit:function(b){var c=0;var a=[256,128,64,32,16,8,4,2];if(b.length==8){b="0"+b}for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}c=c%11;if(c>9){c=0}if(c==b.slice(8,9)){return true}else{return false}},ESVATCheckDigit:function(b){var c=0;var p=0;var a=[2,1,2,1,2,1,2];var d=new Array();d[0]=(/^[A-H|J|U|V]\d{8}$/);d[1]=(/^[A-H|N-S|W]\d{7}[A-J]$/);d[2]=(/^[0-9|Y|Z]\d{7}[A-Z]$/);d[3]=(/^[K|L|M|X]\d{7}[A-Z]$/);var o=0;if(d[0].test(b)){for(o=0;o<7;o++){p=Number(b.charAt(o+1))*a[o];if(p>9){c=c+Math.floor(p/10)+p%10}else{c=c+p}}c=10-c%10;if(c==10){c=0}if(c==b.slice(8,9)){return true}else{return false}}else{if(d[1].test(b)){for(o=0;o<7;o++){p=Number(b.charAt(o+1))*a[o];if(p>9){c=c+Math.floor(p/10)+p%10}else{c=c+p}}c=10-c%10;c=String.fromCharCode(c+64);if(c==b.slice(8,9)){return true}else{return false}}else{if(d[2].test(b)){var q=b;if(q.substring(0,1)=="Y"){q=q.replace(/Y/,"1")}if(q.substring(0,1)=="Z"){q=q.replace(/Z/,"2")}return q.charAt(8)=="TRWAGMYFPDXBNJZSQVHLCKE".charAt(Number(q.substring(0,8))%23)}else{if(d[3].test(b)){return b.charAt(8)=="TRWAGMYFPDXBNJZSQVHLCKE".charAt(Number(b.substring(1,8))%23)}else{return false}}}}},EUVATCheckDigit:function(a){return true},FIVATCheckDigit:function(b){var c=0;var a=[7,9,10,5,8,4,2];for(var d=0;d<7;d++){c=c+Number(b.charAt(d))*a[d]}c=11-c%11;if(c>9){c=0}if(c==b.slice(7,8)){return true}else{return false}},FRVATCheckDigit:function(a){if(!(/^\d{11}$/).test(a)){return false}var b=a.substring(2);b=(b*100+12)%97;if(b==a.slice(0,2)){return true}else{return false}},HRVATCheckDigit:function(a){var b=10;var c=0;var m=0;for(var d=0;d<10;d++){c=(Number(a.charAt(d))+b)%10;if(c==0){c=10}b=(2*c)%11}if((b+a.slice(10,11)*1)%10==1){return true}else{return false}},HUVATCheckDigit:function(b){var c=0;var a=[9,7,3,1,9,7,3];for(var d=0;d<7;d++){c=c+Number(b.charAt(d))*a[d]}c=10-c%10;if(c==10){c=0}if(c==b.slice(7,8)){return true}else{return false}},IEVATCheckDigit:function(b){if(b.length===9){return true}var c=0;var a=[8,7,6,5,4,3,2];if(/^\d[A-Z\*\+]/.test(b)){b="0"+b.substring(2,7)+b.substring(0,1)+b.substring(7,8)}for(var d=0;d<7;d++){c=c+Number(b.charAt(d))*a[d]}c=c%23;if(c==0){c="W"}else{c=String.fromCharCode(c+64)}if(c==b.slice(7,8)){return true}else{return false}},ITVATCheckDigit:function(b){var c=0;var a=[1,2,1,2,1,2,1,2,1,2];var m;if(Number(b.slice(0,7))==0){return false}m=Number(b.slice(7,10));if((m<1)||(m>201)&&m!=999&&m!=888){return false}for(var d=0;d<10;d++){m=Number(b.charAt(d))*a[d];if(m>9){c=c+Math.floor(m/10)+m%10}else{c=c+m}}c=10-c%10;if(c>9){c=0}if(c==b.slice(10,11)){return true}else{return false}},LTVATCheckDigit:function(b){if(b.length==9){if(!(/^\d{7}1/).test(b)){return false}var c=0;for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*(d+1)}if(c%11==10){var a=[3,4,5,6,7,8,9,1];c=0;for(d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}}c=c%11;if(c==10){c=0}if(c==b.slice(8,9)){return true}else{return false}}else{if(!(/^\d{10}1/).test(b)){return false}var c=0;var a=[1,2,3,4,5,6,7,8,9,1,2];for(var d=0;d<11;d++){c=c+Number(b.charAt(d))*a[d]}if(c%11==10){var a=[3,4,5,6,7,8,9,1,2,3,4];c=0;for(d=0;d<11;d++){c=c+Number(b.charAt(d))*a[d]}}c=c%11;if(c==10){c=0}if(c==b.slice(11,12)){return true}else{return false}}},LUVATCheckDigit:function(a){if(a.slice(0,6)%89==a.slice(6,8)){return true}else{return false}},LVVATCheckDigit:function(b){if((/^[0-3]/).test(b)){if((/^[0-3][0-9][0-1][0-9]/).test(b)){return true}else{return false}}else{var c=0;var a=[9,1,4,8,3,10,2,5,7,6];for(var d=0;d<10;d++){c=c+Number(b.charAt(d))*a[d]}if(c%11==4&&b[0]==9){c=c-45}if(c%11==4){c=4-c%11}else{if(c%11>4){c=14-c%11}else{if(c%11<4){c=3-c%11}}}if(c==b.slice(10,11)){return true}else{return false}}},MTVATCheckDigit:function(b){var c=0;var a=[3,4,6,7,8,9];for(var d=0;d<6;d++){c=c+Number(b.charAt(d))*a[d]}c=37-c%37;if(c==b.slice(6,8)*1){return true}else{return false}},NLVATCheckDigit:function(b){var c=0;var a=[9,8,7,6,5,4,3,2];for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}c=c%11;if(c>9){c=0}if(c==b.slice(8,9)){return true}else{return false}},PLVATCheckDigit:function(b){var c=0;var a=[6,5,7,2,3,4,5,6,7];for(var d=0;d<9;d++){c=c+Number(b.charAt(d))*a[d]}c=c%11;if(c>9){c=0}if(c==b.slice(9,10)){return true}else{return false}},PTVATCheckDigit:function(b){var c=0;var a=[9,8,7,6,5,4,3,2];for(var d=0;d<8;d++){c=c+Number(b.charAt(d))*a[d]}c=11-c%11;if(c>9){c=0}if(c==b.slice(8,9)){return true}else{return false}},ROVATCheckDigit:function(c){var b=[7,5,3,2,1,7,5,3,2];var a=c.length;b=b.slice(10-a);var d=0;for(var m=0;m<c.length-1;m++){d=d+Number(c.charAt(m))*b[m]}d=(10*d)%11;if(d==10){d=0}if(d==c.slice(c.length-1,c.length)){return true}else{return false}},SEVATCheckDigit:function(c){var d=0;var a;for(var n=0;n<9;n=n+2){a=Number(c.charAt(n));d=d+Math.floor(a/5)+((a*2)%10)}var o=0;for(var n=1;n<9;n=n+2){o=o+Number(c.charAt(n))}var b=(10-(d+o)%10)%10;if(b==c.slice(9,10)){return true}else{return false}},SIVATCheckDigit:function(b){var c=0;var a=[8,7,6,5,4,3,2];for(var d=0;d<7;d++){c=c+Number(b.charAt(d))*a[d]}c=11-c%11;if(c==10){c=0}if(c!=11&&c==b.slice(7,8)){return true}else{return false}},SKVATCheckDigit:function(a){if(Number(a%11)==0){return true}else{return false}},UKVATCheckDigit:function(d){var c=[8,7,6,5,4,3,2];if(d.substr(0,2)=="GD"){if(d.substr(2,3)<500){return true}else{return false}}if(d.substr(0,2)=="HA"){if(d.substr(2,3)>499){return true}else{return false}}var n=0;if(Number(d.slice(0))==0){return false}var a=Number(d.slice(0,7));for(var o=0;o<7;o++){n=n+Number(d.charAt(o))*c[o]}var b=n;while(b>0){b=b-97}b=Math.abs(b);if(b==d.slice(7,9)&&a<9990001&&(a<100000||a>999999)&&(a<9490001||a>9700000)){return true}if(b>=55){b=b-55}else{b=b+42}if(b==d.slice(7,9)&&a>1000000){return true}else{return false}}};i.exports=h},{}],97:[function(h,l,i){function k(b,a){Logger({key:"reloadByLocChange",group:"reload",message:"location change: "+a});Logger.emptyQueue(function(){window.location.href=b})}l.exports.goTo=k;function j(b,c,a){Logger({key:"windowLoadDone",group:"pageLoad",processEnded:true,message:"windowLoad done"});Logger({key:"reloadByLocationRefresh",group:"reload",message:"reload: "+b,error:true});Logger.emptyQueue(function(){if(a){fluid.main.fire("newVersionPromptNeeded")}else{if(c){fluid.main.fire("logInAgainPromptNeeded")}else{fluid.main.fire("outOfDatePromptNeeded")}}})}l.exports.reload=j;fluid.main.on("reloader.reload",function(c,b,d,a){j(b,d,a)})},{}],98:[function(f,j,h){(function(){var b=0;var a=["ms","moz","webkit","o"];for(var c=0;c<a.length&&!window.requestAnimationFrame;++c){window.requestAnimationFrame=window[a[c]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[a[c]+"CancelAnimationFrame"]||window[a[c]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(d){var p=new Date().getTime();var o=Math.max(0,16-(p-b));var n=window.setTimeout(function(){d(p+o)},o);b=p+o;return n}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var i={selectText:function(a){var b=(a=="control+a")?$(".ui-selected").find("textarea"):$(this);b.focus();b.select();return false},getTLWH:function(c){var a=$(c);if(a.length===0){return{top:0,left:0,width:0,height:0}}var d=a.offset();var b=a.outerWidth();var l=a.outerHeight();return{top:d.top,left:d.left,width:b,height:l}},getBoundingArea:function(c){i.boundingLeft=null;i.boundingTop=null;i.boundingRight=null;i.boundingBottom=null;var a=$(c);if(a.length===0){return{top:0,left:0,bottom:0,right:0}}a.each(function(){var d=i.getTLWH(this);if((i.boundingLeft>d.left)||i.boundingLeft==null){i.boundingLeft=d.left}if((i.boundingTop>d.top)||i.boundingTop==null){i.boundingTop=d.top}if((i.boundingRight<d.left+d.width)||i.boundingRight==null){i.boundingRight=d.left+d.width}if((i.boundingBottom<d.top+d.height)||i.boundingBottom==null){i.boundingBottom=d.top+d.height}});var b={top:i.boundingTop,left:i.boundingLeft,bottom:i.boundingBottom,right:i.boundingRight};return b},prevent:function(a){a.stopPropagation();a.preventDefault();return false},isMobileDevice:function(){var a=false;if(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i)){a=true}return a},hideBrowserBar:function(){var a=false;if(navigator.userAgent.match(/Android/i)){a=true}return a},animateRaf:function(z,t,c,u,a){if($.isFunction(c)){u=c;c=undefined}var w,r,s,b=false;var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(k){window.setTimeout(function(){k(new Date().valueOf())},16.667)};function v(k){if(!b&&k<946684800000){if(s){w=startTimeHiResClock;r=endTimeHiResClock;b=true}else{k=new Date().valueOf()}}var m=k-w;var l=r!=w?m/t:1;if(l<1){if(c){l=c(l,m,0,1,t)}z(l,a);d(v)}else{z(1,a);if(u&&$.isFunction(u)){window.setTimeout(u,10)}}}if(t===undefined){t=300}s=window.hasOwnProperty("performance")&&window.performance.hasOwnProperty("now");w=new Date().valueOf();startTimeHiResClock=s?window.performance.now():w;r=w+t;endTimeHiResClock=startTimeHiResClock+t;if(c){c=$.easing[c]}d(v)},Vector:(function(){function a(d,b,c){if(!(this instanceof a)){return new a(d,b,c)}if(d instanceof Object){b=d.y;c=d.z;d=d.x}c=c||0;if(typeof d!=="number"||typeof b!=="number"){d=b=c=0}this.x=d;this.y=b;this.z=c;a.created++}a.created=0;a.prototype={set:function(d,b,c){if(d instanceof Object){b=d.y;d=d.x;c=d.z}c=c||0;if(typeof d==="number"&&typeof b==="number"&&typeof c==="number"){this.x=d;this.y=b;this.z=c}return this},distanceTo:function(d){var l=this.x-d.x,b=this.y-d.y,c=this.z-d.z;return Math.sqrt(l*l+b*b+c*c)},distanceSqTo:function(c){var d=this.x-c.x,b=this.y-c.y;return d*d+b*b},plus:function(b){return new a(this.x+b.x,this.y+b.y,this.z+b.z)},minus:function(b){return new a(this.x-b.x,this.y-b.y,this.z-b.z)},scale:function(b){return new a(this.x*b,this.y*b,this.z*b)},dot:function(b){return this.x*b.x+this.y*b.y+this.z*b.z},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},angle:function(b){if(!b){b=a.I}else{return this.angle()-b.angle()}if(this.y<0){return 2*Math.PI-(new a(this.x,-this.y,this.y)).angle(b)}return Math.acos(this.dot(b)/(this.magnitude()*b.magnitude()))},rotateBy:function(b){if(b>Math.PI){return this.rotateBy(-(2*Math.PI-b))}else{if(b<-Math.PI){return this.rotateBy(2*Math.PI+b)}}return new a(this.x*Math.cos(b)-this.y*Math.sin(b),this.x*Math.sin(b)+this.y*Math.cos(b))},rotateTo:function(b){var c=b-this.angle();return this.rotateBy(c)},unitVector:function(){return this.scale(1/this.magnitude())},add:function(b){this.x+=b.x;this.y+=b.y;return this},sub:function(b){this.x-=b.x;this.y-=b.y;return this},mul:function(b){this.x*=b;this.y*=b;return this},rotBy:function(b){this.x=this.x*Math.cos(b)-this.y*Math.sin(b);this.y=this.x*Math.sin(b)+this.y*Math.cos(b);return this},rotTo:function(b){var c=b-this.angle();return this.rotBy(c)},copy:function(){return new a(this.x,this.y)}};a.I=Object.freeze(new a(1,0,0));a.J=Object.freeze(new a(0,1,0));a.K=Object.freeze(new a(0,0,1));return a}()),drawVectors:function(b,a,C){var u=[],A=[],t=C[0],v=[],d=a.length,w,B;for(B=d-1,w=0;w<d;w++){A[B]=a[w].distanceTo(a[B]);B=w}for(w=0,B=d-1;w<d;w++){v[w]=Math.min(t,A[B]/2,A[w]/2)}for(B=d-1,w=0;w<d;w++){u[B]=a[w].minus(a[B]).unitVector().scale(v[B]);B=w}var c=a[0].plus(u[0]);b.moveTo(c.x,c.y);for(w=0;w<d;w++){var z=w<d-1?w+1:0;c=a[z].minus(u[w]);b.lineTo(c.x,c.y);c=a[z].plus(u[z]);b.quadraticCurveTo(a[z].x,a[z].y,c.x,c.y)}},isTaintedCanvas:function(a){a=(a instanceof HTMLCanvasElement)?a.getContext("2d"):a;try{return !a.getImageData(0,0,1,1)}catch(b){return b.code===18}},getParentWindow:function(){var c;var a;try{c=window.frameElement.ownerDocument;a=c.defaultView}catch(b){a=null}return a},getTrueHeight:function(){return(window.hasOwnProperty("innerHeight")?window.innerHeight:$(window).height())||480},getActivePageId:function(){return $("#"+fluid.zoom.getActivePageId()).attr("id")},getNavigationKeyDirection:function(a){var b="";switch(a){case 37:b="left";break;case 38:b="top";break;case 39:b="right";break;case 40:b="bottom";break}return b},findPositionOnScreen:function(d,a,u){function t(r,o,m){o=$.extend(true,[],o);var p=fluid.main.project.widgets.get(r).toJSON();var n=20;var q=(o[0]<o[1])?"Portrait":"Landscape";var l=o[0]+n;var k=o[1]+n;if(m!==q){l=o[1]+n;k=o[0]+n}s=((p.tlwh[0]>(k-n-5))||(p.tlwh[1]>(l-n-5)))?false:true}var s=false,w;if(u===true){w=$(".page").attr("id");var v=fluid.main.project?fluid.main.project.toJSON():window.top.fluid.main.project.toJSON();var c=v.pageWH;var z=fluid.main.project?fluid.main.project.pages.get(w).toJSON():window.top.fluid.main.project.pages.get(w).toJSON();if(c){var A=a;var B=z.orientation;t(A,c,B)}}else{w=fluid.zoom.getActivePageId();var b=fluid.main.project.widgets.getRoots(d);b.each(function(){var k=$(this).attr("id");var m=fluid.main.project.get("pageWH");var l=fluid.main.project.pages.get(w).get("orientation");t(k,m,l)})}return s},loadjscssfile:function(c,b){var a;if(b=="js"){a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("src",c)}else{if(b=="css"){a=document.createElement("link");a.setAttribute("rel","stylesheet");a.setAttribute("type","text/css");a.setAttribute("href",c)}}if(a!==undefined){document.getElementsByTagName("head")[0].appendChild(a)}},hashCode:function(d){var a=0,b;if(d.length==0){return a}for(var c=0;c<d.length;c++){b=d.charCodeAt(c);a=((a<<5)-a)+b;a=a&a}return Math.abs(a)}};j.exports=i},{}],99:[function(j,i,f){var h={guid:function(n){var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";var a=32;var c="";for(var d=0;d<a;d++){var o=Math.floor(Math.random()*b.length);c+=b.substring(o,o+1)}return n+"_"+c},hslToHex:function(c){function d(n,k,m){if(m<0){m+=1}else{if(m>1){m-=1}}if(m*6<1){return n+(k-n)*m*6}if(m*2<1){return k}if(m*3<2){return n+(k-n)*(2/3-m)*6}return n}var s=c.h/360,w=c.s/100,u=c.l/100;var a,b;if(u<=0.5){b=u*(1+w)}else{b=u+w-(u*w)}a=u*2-b;var v=d(a,b,s+1/3);var r=d(a,b,s);var l=d(a,b,s-1/3);v=Math.round(v*255);r=Math.round(r*255);l=Math.round(l*255);v=parseInt(v).toString(16);r=parseInt(r).toString(16);l=parseInt(l).toString(16);if(v.length<2){v="0"+v}if(r.length<2){r="0"+r}if(l.length<2){l="0"+l}return v+r+l},hex2rgba:function(a,c){if(!a[0]=="#"){return false}if(a.indexOf("rgba(")===0){return a}if(a.indexOf("rgb(")===0){var b;a=a.replace("rgb(","rgba(");b=a.split(",");b[b.length-1]=parseInt(b[b.length-1]);b.push("1)");a=b.join(",");return a}if(a.length=="4"){a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]}return"rgba("+(parseInt(a.substr(1,2),16))+","+(parseInt(a.substr(3,2),16))+","+(parseInt(a.substr(5,2),16))+","+(c||1)+")"},rgb2hex:function(b){b=b.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);function a(c){return("0"+parseInt(c).toString(16)).slice(-2)}return"#"+a(b[1])+a(b[2])+a(b[3])},toHSL:function(a){var v,d,b;a=(a)?a:"rgb(0, 0, 0)";a=a.replace(/ /g,"");if(a.match(/hsla/gi)){return{h:a.match(/[0-9]*/g)[5],s:a.match(/[0-9]*/g)[7],l:a.match(/[0-9]*/g)[10]}}if(a.match(/hsl/gi)){return{h:a.match(/[0-9]*/g)[4],s:a.match(/[0-9]*/g)[6],l:a.match(/[0-9]*/g)[9]}}if(a.match(/#/gi)){if(a.length==4){a="#"+a[1]+a[1]+a[2]+a[2]+a[3]+a[3]}else{if(a.length!=7){a="#000000"}}v=parseInt(a.substring(1,3),16);d=parseInt(a.substring(3,5),16);b=parseInt(a.substring(5,7),16)}else{if(a.match(/rgba/gi)){v=a.match(/[0-9]*/g)[5];d=a.match(/[0-9]*/g)[7];b=a.match(/[0-9]*/g)[9]}else{if(a.match(/rgb/gi)){v=a.match(/[0-9]*/g)[4];d=a.match(/[0-9]*/g)[6];b=a.match(/[0-9]*/g)[8]}}}v/=255;d/=255;b/=255;var u=Math.max(v,d,b);var r=Math.min(v,d,b);var l=0;var w=0;var s=(u+r)/2;if(u!=r){var c=u-r;w=(s<0.5)?c/(u+r):c/(2-u-r);switch(u){case v:l=(d-b)/c;break;case d:l=(b-v)/c+2;break;case b:l=(v-d)/c+4;break}l/=6;if(l<0){l+=1}}l=l*360;s=s*100;w=w*100;return{h:l,s:w,l:s}},replaceRgbaAlpha:function(b,d){var a=b.match(/rgba/i),c;if(a){c=b.split(",");c[c.length-1]=d+")";c=c.join(",");return c}return b},getRgbaAlpha:function(a){if(a[0]=="#"||a.indexOf("rgb(")!=-1){return 1}var b=a.split(",");b=b[b.length-1];b=parseFloat(b);return b},getAlphaFromColor:function(a){if(a[0]=="#"){return 1}else{if(a.indexOf("rgba(")===0){a=a.split(",");a=a[a.length-1].replace(")","");return a}}return 1},toPercent:function(d,a,c){if(typeof d=="string"){var b=h.parsePercentString(d);d=b&&!isNaN(b)?b*a/100:parseFloat(d)}var n=d*100/a;var m=Math.pow(10,c);return(Math.round(n*m))/m},parsePercentString:function(a){var b=NaN;if(typeof a=="string"){var c=a.match(/^\s*(\d+(?:\.\d*)?|\.\d+)\s*\%\s*$/);if(c){b=parseFloat(c[1])}}return b},isPercentString:function(a){var b=h.parsePercentString(a);return Boolean(b)&&!isNaN(b)},fromPercentString:function(a,b){var c=h.parsePercentString(a);if(c&&!isNaN(c)){c*=b/100}return c},getFitSize:function(d){var c,b,n=d.object.width>d.frame.width||d.object.height>d.frame.height,p=d.frame.width/d.frame.height,a=d.object.width/d.object.height;if(!n&&!d.expand){return d.object}var o={};if(p>a){c="height";b="width";o.top=0}else{c="width";b="height";o.left=0}o[c]=d.frame[c];o[b]=(d.frame[c]/d.object[c])*d.object[b];return o}};h.getLatestActiveProject=function(){var a;var b=fluid.main.projects.getIds();for(var c=b.length-1;c>=0;c--){if(fluid.main.projects.get(b[c]).get("active")!==false){a=b[c];break}}return a};h.addAlpha=function(c,q,s){c=(c)?c:"rgba(0,0,0,1.0)";var t=c.match(/rgba/gi),r;if(t==null){r=q}else{var a=q.match(/\d+/g);var b=c.match(/\d+/g);var d=b.length;var p=1;if(d==4){p=b[3]}else{if(d==5){p=b[3]+"."+b[4]}}if(s){p=(parseFloat(p)===0)?1:p}r="rgba("+a[0]+","+a[1]+","+a[2]+","+p+")"}return r};i.exports=h},{}]},{},[92]);